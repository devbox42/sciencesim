<!DOCTYPE html>
<html lang="de">
<!--
BLP-02 Passwort-Sicherheit | Informatik 10MR | 25 BE
Bewerteter Lernpfad (6 Phasen) | ES5-kompatibel | iPad-ready
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bewerteter Lernpfad: Passwort-Sicherheit | Informatik 10MR</title>
    <style>
        :root {
            --fach: #b35c00;
            --fach-light: #fff3e0;
            --bg: #f5f5f5;
            --white: #ffffff;
            --border: #dddddd;
            --text: #222222;
            --text-muted: #555555;
            --success: #2a7a4b;
            --success-bg: #e8f5e9;
            --warning: #b35c00;
            --warning-bg: #fff3e0;
            --error: #c62828;
            --error-bg: #ffebee;
            --hypo: #6a1b9a;
            --hypo-light: #f3e5f5;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); font-size: 16px; line-height: 1.5; }
        .container { max-width: 950px; margin: 0 auto; padding: 20px; }
        header { background: var(--fach); color: var(--white); padding: 15px 20px; margin: -20px -20px 0; text-align: center; }
        header h1 { font-size: 1.3em; font-weight: 600; margin-bottom: 4px; }
        header p { font-size: 0.85em; opacity: 0.9; }
        .bewertung-badge { display: inline-block; background: var(--error); color: white; padding: 3px 12px; font-size: 0.75em; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-top: 6px; }
        .ew-nav { display: flex; align-items: center; justify-content: center; gap: 2px; padding: 12px 10px; background: var(--white); border-bottom: 1px solid var(--border); margin: 0 -20px 15px; flex-wrap: wrap; }
        .ew-step { padding: 6px 10px; font-size: 0.7em; font-weight: 600; background: var(--border); color: var(--text-muted); text-align: center; min-width: 44px; min-height: 36px; display: flex; align-items: center; justify-content: center; }
        .ew-step.active { background: var(--fach); color: white; }
        .ew-step.done { background: var(--success); color: white; }
        .ew-step.graded { border-bottom: 3px solid var(--error); }
        .ew-arrow { font-size: 0.8em; color: var(--text-muted); padding: 0 2px; }
        .progress-bar { background: var(--border); height: 6px; margin: 0 0 15px; }
        .progress-fill { background: var(--fach); height: 100%; width: 0%; transition: width 0.3s; }
        .step { background: var(--white); border: 1px solid var(--border); padding: 20px; margin-bottom: 15px; display: none; }
        .step.active { display: block; }
        .step-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid var(--fach); }
        .step-title { font-size: 1.1em; font-weight: 600; color: var(--fach); }
        .step-badge { font-size: 0.75em; background: var(--fach-light); color: var(--fach); padding: 3px 8px; }
        .be-badge { font-size: 0.75em; background: var(--error-bg); color: var(--error); padding: 3px 8px; font-weight: 700; }
        .practice-zone { border: 2px solid var(--fach); border-style: dashed; padding: 15px; margin: 15px 0; position: relative; }
        .practice-zone::before { content: "\00dcBUNG (unbewertet, beliebig oft)"; display: inline-block; background: var(--fach); color: white; font-size: 0.7em; font-weight: 700; padding: 2px 10px; position: absolute; top: -12px; left: 10px; letter-spacing: 0.5px; }
        .assess-zone { border: 2px solid var(--error); padding: 15px; margin: 15px 0; position: relative; }
        .assess-zone::before { content: attr(data-label); display: inline-block; background: var(--error); color: white; font-size: 0.7em; font-weight: 700; padding: 2px 10px; position: absolute; top: -12px; left: 10px; letter-spacing: 0.5px; }
        .assess-zone.locked { opacity: 0.85; pointer-events: none; }
        h3 { font-size: 1em; font-weight: 600; margin: 15px 0 10px; color: var(--text); }
        p { margin-bottom: 12px; }
        .info-box { background: var(--fach-light); border-left: 3px solid var(--fach); padding: 12px 15px; margin: 15px 0; font-size: 0.95em; }
        .formel-box { background: var(--white); border: 2px solid var(--fach); padding: 15px; margin: 15px 0; text-align: center; font-size: 1.3em; }
        .btn { background: var(--fach); color: var(--white); border: none; padding: 10px 20px; font-size: 1em; cursor: pointer; margin-top: 10px; min-height: 44px; min-width: 44px; }
        .btn:hover { opacity: 0.9; }
        .btn:disabled { background: var(--border); cursor: not-allowed; }
        .btn-assess { background: var(--error); }
        .btn-small { padding: 6px 12px; font-size: 0.9em; margin: 3px; }
        .nav-buttons { display: flex; justify-content: flex-end; margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border); }
        input[type="number"], input[type="text"] { border: 1px solid var(--border); padding: 8px 10px; font-size: 1em; width: 80px; text-align: center; }
        select { padding: 8px 10px; font-size: 1em; border: 1px solid var(--border); min-height: 44px; }
        .feedback { padding: 10px; margin-top: 10px; display: none; font-size: 0.9em; }
        .feedback.correct { background: var(--success-bg); border: 1px solid var(--success); color: var(--success); display: block; }
        .feedback.incorrect { background: var(--error-bg); border: 1px solid var(--error); color: var(--error); display: block; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        th, td { border: 1px solid var(--border); padding: 8px; text-align: center; }
        th { background: var(--fach-light); }
        .mc-options { margin: 10px 0; }
        .mc-option { display: block; padding: 10px 15px; margin-bottom: 8px; border: 1px solid var(--border); cursor: pointer; min-height: 44px; }
        .mc-option:hover { background: var(--fach-light); }
        .mc-option.selected { background: var(--fach-light); border-color: var(--fach); font-weight: 600; }
        .mc-option.correct-reveal { background: var(--success-bg); border-color: var(--success); }
        .mc-option.wrong-reveal { background: var(--error-bg); border-color: var(--error); }
        .mc-option.disabled { pointer-events: none; cursor: default; opacity: 0.85; }
        .results-grid { display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; margin: 20px 0; }
        .result-box { flex: 1 1 120px; text-align: center; padding: 15px; border: 1px solid var(--border); background: var(--white); }
        .result-box .value { font-size: 2em; font-weight: 700; color: var(--fach); }
        .result-box .label { font-size: 0.8em; color: var(--text-muted); margin-top: 5px; }
        .grade-display { text-align: center; margin: 20px 0; }
        .grade-display .grade { font-size: 3em; font-weight: 700; }
        .grade-display .grade.g1 { color: var(--success); }
        .grade-display .grade.g2 { color: #4caf50; }
        .grade-display .grade.g3 { color: var(--warning); }
        .grade-display .grade.g4 { color: #e65100; }
        .grade-display .grade.g5 { color: var(--error); }
        .grade-display .grade.g6 { color: #b71c1c; }
        .phase-breakdown { margin: 15px 0; }
        .phase-breakdown td:first-child { text-align: left; }
        .beleg { max-width: 700px; margin: 20px auto; }
        .beleg-header { text-align: center; border-bottom: 2px solid var(--fach); padding-bottom: 10px; margin-bottom: 15px; }
        .beleg-header h2 { font-size: 1.1em; margin-bottom: 4px; }
        .beleg-phase { margin-bottom: 20px; }
        .beleg-phase h3 { background: var(--fach-light); padding: 8px 12px; margin: 0 0 10px; font-size: 0.95em; }
        .beleg-item { padding: 10px; border-left: 3px solid #ccc; margin-bottom: 10px; background: #fafafa; }
        .beleg-item.beleg-correct { border-left-color: var(--success); }
        .beleg-item.beleg-wrong { border-left-color: #c0392b; }
        .beleg-q { font-weight: 600; margin-bottom: 5px; font-size: 0.95em; }
        .beleg-options { display: flex; flex-wrap: wrap; gap: 5px; margin: 5px 0; }
        .beleg-opt { padding: 3px 8px; border: 1px solid #ddd; border-radius: 3px; font-size: 0.85em; }
        .beleg-opt-correct { border-color: var(--success); background: #e8f5e9; font-weight: 600; }
        .beleg-opt-given { outline: 2px solid var(--fach); }
        .beleg-opt-correct.beleg-opt-given { outline-color: var(--success); }
        .beleg-nums { font-size: 0.9em; margin: 5px 0; }
        .beleg-points { font-size: 0.85em; font-weight: 600; color: var(--text-muted); }
        .beleg-explain { font-size: 0.85em; color: #555; font-style: italic; margin-top: 3px; }
        .login-box { max-width: 400px; margin: 40px auto; padding: 30px; background: var(--white); border: 1px solid var(--border); text-align: center; }
        .login-box .hint { font-size: 0.85em; color: var(--text-muted); margin-top: 10px; }
        .teacher-reset { position: fixed; bottom: 10px; right: 10px; font-size: 0.7em; color: var(--text-muted); cursor: pointer; opacity: 0.5; }
        .teacher-reset:hover { opacity: 1; }
        .tab-warning-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); z-index: 9999; justify-content: center; align-items: center; }
        .tab-warning-overlay.visible { display: flex; }
        .tab-warning-content { background: var(--white); padding: 40px; text-align: center; max-width: 400px; }
        .tab-warning-icon { font-size: 3em; margin-bottom: 15px; }
        .tab-warning-content h2 { color: var(--error); margin-bottom: 10px; }
        .tab-count { color: var(--error); font-size: 0.9em; margin-top: 10px; }
        .locked-notice { background: var(--warning-bg); border: 2px solid var(--warning); padding: 15px; text-align: center; margin-bottom: 15px; display: none; }
        .locked-notice.visible { display: block; }
        .hefter-hint { background: #e8f5e9; border-left: 3px solid var(--success); padding: 10px 15px; margin: 15px 0; font-size: 0.9em; }
        .hefter-hint::before { content: "\1F4D3 "; }
        /* PW Tester */
        .pw-input-wrap { position: relative; margin: 15px 0; }
        .pw-input-wrap input { width: 100%; padding: 12px; font-size: 1.1em; font-family: monospace; border: 2px solid var(--border); }
        .pw-input-wrap input:focus { outline: none; border-color: var(--fach); }
        .strength-bar { height: 10px; background: #eee; margin: 8px 0; overflow: hidden; }
        .strength-fill { height: 100%; width: 0%; transition: width 0.3s, background 0.3s; }
        .strength-fill.s1 { width: 20%; background: #c62828; }
        .strength-fill.s2 { width: 40%; background: #e65100; }
        .strength-fill.s3 { width: 60%; background: #f9a825; }
        .strength-fill.s4 { width: 80%; background: #558b2f; }
        .strength-fill.s5 { width: 100%; background: #2e7d32; }
        .pw-details { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 10px 0; font-size: 0.9em; }
        .pw-detail-item { padding: 6px 10px; background: #f5f5f5; border-left: 3px solid var(--border); }
        .pw-detail-item.active { border-left-color: var(--success); background: var(--success-bg); }
        /* BF Calculator */
        .bf-calculator { background: #1a1a2e; color: #0f0; padding: 20px; font-family: monospace; margin: 15px 0; }
        .bf-calculator select, .bf-calculator input[type="range"] { width: 100%; padding: 8px; margin: 5px 0 15px 0; font-family: monospace; font-size: 1em; }
        .bf-calculator label { color: #aaa; font-size: 0.9em; }
        .bf-calculator .bf-result { font-size: 1.1em; padding: 15px; margin-top: 10px; border: 1px solid #0f0; text-align: center; }
        /* PW Cards */
        .pw-card { background: white; border: 2px solid var(--border); padding: 15px; margin: 12px 0; }
        .pw-card.answered { opacity: 0.85; }
        .pw-card .q-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .pw-card .q-number { background: var(--fach); color: white; padding: 2px 10px; font-size: 0.85em; font-weight: 600; }
        .pw-card .q-points { font-size: 0.8em; color: var(--text-muted); font-weight: 600; }
        .pw-card .pw-display { font-family: monospace; font-size: 1.3em; font-weight: 700; padding: 10px; background: #f5f5f5; text-align: center; margin-bottom: 12px; letter-spacing: 2px; }
        .pw-card .pw-buttons { display: flex; gap: 10px; justify-content: center; }
        .pw-card .pw-btn { padding: 10px 25px; font-size: 1em; cursor: pointer; border: 2px solid var(--border); background: white; min-width: 120px; min-height: 48px; }
        .pw-card .pw-btn:hover { border-color: var(--fach); }
        .pw-card .pw-btn.selected { border-color: var(--fach); background: var(--fach-light); font-weight: 600; }
        .pw-card .pw-btn.chosen-correct { background: var(--success-bg); border-color: var(--success); color: var(--success); font-weight: 600; }
        .pw-card .pw-btn.chosen-wrong { background: var(--error-bg); border-color: var(--error); color: var(--error); font-weight: 600; }
        .pw-card .pw-btn.disabled { pointer-events: none; opacity: 0.6; }
        .pw-reasons { display: flex; flex-direction: column; gap: 8px; }
        .pw-reason-btn { display: flex; align-items: center; padding: 10px 15px; border: 2px solid var(--border); background: white; cursor: pointer; text-align: left; font-size: 0.95em; min-height: 48px; }
        .pw-reason-btn:hover { border-color: var(--fach); background: var(--fach-light); }
        .pw-reason-btn .letter { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border: 2px solid var(--border); margin-right: 12px; font-weight: 700; font-size: 0.85em; flex-shrink: 0; }
        .pw-reason-btn.selected { border-color: var(--fach); background: var(--fach-light); }
        .pw-reason-btn.chosen-correct { border-color: var(--success); background: var(--success-bg); }
        .pw-reason-btn.chosen-correct .letter { border-color: var(--success); color: var(--success); }
        .pw-reason-btn.chosen-wrong { border-color: var(--error); background: var(--error-bg); }
        .pw-reason-btn.chosen-wrong .letter { border-color: var(--error); color: var(--error); }
        .pw-reason-btn.show-correct { border-color: var(--success); background: var(--success-bg); }
        .pw-reason-btn.show-correct .letter { border-color: var(--success); color: var(--success); }
        .pw-reason-btn.disabled { pointer-events: none; }
        .pw-submit { padding: 10px 20px; font-size: 1em; cursor: pointer; border: none; background: var(--fach); color: white; min-height: 48px; }
        .pw-submit:disabled { opacity: 0.4; cursor: not-allowed; }
        .pw-card .pw-feedback { margin-top: 10px; padding: 8px 12px; font-size: 0.9em; display: none; }
        .pw-card .pw-feedback.visible { display: block; }
        @media print {
            .ew-nav, .step-badge, .btn, .tab-warning-overlay, #btnBeleg, .hefter-hint, .nav-buttons, .teacher-reset, .bewertung-badge, .progress-bar { display: none !important; }
            .step { display: none !important; }
            #step7 { display: block !important; }
            #belegContainer { display: block !important; }
            .beleg-item { break-inside: avoid; }
            body { font-size: 11pt; }
            header { background: none !important; color: var(--text) !important; border-bottom: 2px solid var(--fach); }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>Passwort-Sicherheit</h1>
        <p>Informatik 10MR | Bewerteter Lernpfad | 25 BE</p>
        <div class="bewertung-badge">Bewertet &ndash; Jede markierte Antwort z&auml;hlt!</div>
    </header>

    <div class="locked-notice" id="lockedNotice">
        <strong>Lernpfad bereits abgeschlossen!</strong> Dein Ergebnis wird angezeigt.
    </div>

    <div class="ew-nav" id="ewNav">
        <div class="ew-step graded" data-phase="1" id="ew1">Grundlagen</div>
        <div class="ew-arrow">&rarr;</div>
        <div class="ew-step graded" data-phase="2" id="ew2">Brute-Force</div>
        <div class="ew-arrow">&rarr;</div>
        <div class="ew-step graded" data-phase="3" id="ew3">Schutz</div>
        <div class="ew-arrow">&rarr;</div>
        <div class="ew-step graded" data-phase="4" id="ew4">Bewertung</div>
        <div class="ew-arrow">&rarr;</div>
        <div class="ew-step graded" data-phase="5" id="ew5">Anwendung</div>
        <div class="ew-arrow">&rarr;</div>
        <div class="ew-step graded" data-phase="6" id="ew6">Transfer</div>
        <div class="ew-arrow">&rarr;</div>
        <div class="ew-step" data-phase="7" id="ew7">Ergebnis</div>
    </div>

    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>

    <!-- Phase 0: Login -->
    <div class="step active" id="step0">
        <div class="login-box">
            <h2 style="color: var(--fach); margin-bottom: 10px;">Bewerteter Lernpfad</h2>
            <label for="platzSelect" style="font-size: 1.1em; font-weight: 600; display: block; margin: 15px 0 8px;">Platzkarten-Nummer:</label>
            <select id="platzSelect" style="font-size: 1.3em; padding: 10px 16px; border: 2px solid var(--fach); border-radius: 4px; min-width: 140px; min-height: 44px; background: #fff;">
                <option value="0">-- w&auml;hlen --</option>
            </select>
            <button class="btn" id="btnStart" style="margin-top: 15px;" onclick="startLP()">Lernpfad starten</button>
            <p class="hint">W&auml;hle die Nummer deiner Platzkarte und best&auml;tige. (<span id="hintBE">25</span> BE)</p>
        </div>
    </div>

    <!-- Phase 1: Grundlagen -->
    <div class="step" id="step1">
        <div class="step-header">
            <span class="step-title">Phase 1: Grundlagen &ndash; Zeichens&auml;tze &amp; PW-St&auml;rke</span>
            <span class="be-badge">3 BE</span>
        </div>

        <div class="info-box">
            <strong>Zeichens&auml;tze und ihre Gr&ouml;&szlig;e:</strong>
            <p style="margin-top: 8px;">Ein Passwort besteht aus Zeichen. Je mehr <strong>verschiedene Zeichen</strong> m&ouml;glich sind, desto schwerer ist es zu knacken:</p>
            <table style="margin-top: 10px;">
                <tr><th>Zeichensatz</th><th>Gr&ouml;&szlig;e</th></tr>
                <tr><td style="text-align:left;">Nur Zahlen (0-9)</td><td>10</td></tr>
                <tr><td style="text-align:left;">Kleinbuchstaben (a-z)</td><td>26</td></tr>
                <tr><td style="text-align:left;">+ Gro&szlig;buchstaben (A-Z)</td><td>52</td></tr>
                <tr><td style="text-align:left;">+ Zahlen</td><td>62</td></tr>
                <tr><td style="text-align:left;">+ Sonderzeichen (!@#$...)</td><td>94</td></tr>
            </table>
        </div>

        <div class="practice-zone">
            <p style="margin-top: 8px;"><strong>Passwort-Tester:</strong> Gib ein Test-Passwort ein (nicht dein echtes!) und beobachte die Analyse:</p>
            <div class="pw-input-wrap">
                <input type="text" id="pwTestInput" placeholder="Test-Passwort eingeben..." oninput="analyzePW()" autocomplete="off">
            </div>
            <div class="strength-bar"><div class="strength-fill" id="strengthFill"></div></div>
            <div id="strengthLabel" style="text-align: center; font-weight: 600; margin-bottom: 10px;">-</div>
            <div class="pw-details">
                <div class="pw-detail-item" id="pd-length">L&auml;nge: -</div>
                <div class="pw-detail-item" id="pd-charset">Zeichensatz: -</div>
                <div class="pw-detail-item" id="pd-combos">Kombinationen: -</div>
                <div class="pw-detail-item" id="pd-time">Knackzeit: -</div>
            </div>
        </div>

        <div class="info-box" style="background: var(--success-bg); border-left-color: var(--success);">
            <strong>Merke:</strong> Zwei Faktoren bestimmen die Passwort-St&auml;rke: <strong>L&auml;nge</strong> (jedes zus&auml;tzliche Zeichen vervielfacht die Kombinationen) und <strong>Zeichenvielfalt</strong> (mehr verschiedene Zeichenarten = gr&ouml;&szlig;erer Suchraum).
        </div>

        <div class="assess-zone" data-label="BEWERTET &ndash; 3 BE (1 Versuch)" id="assess1">
            <p style="margin-top: 8px;"><strong>Aufgabe:</strong> Beantworte die folgenden Fragen.</p>
            <div id="assess1-container"></div>
            <button class="btn btn-assess" id="btn-assess1" onclick="submitPhase1()">Abgeben (1 Versuch!)</button>
            <div class="feedback" id="fb-assess1"></div>
        </div>

        <div class="hefter-hint">Notiere die 5 Zeichens&auml;tze mit ihrer Gr&ouml;&szlig;e.</div>

        <div class="nav-buttons">
            <button class="btn" id="btn-next1" disabled onclick="goToPhase(2)">Weiter zu Brute-Force &rarr;</button>
        </div>
    </div>

    <!-- Phase 2: Brute-Force -->
    <div class="step" id="step2">
        <div class="step-header">
            <span class="step-title">Phase 2: Brute-Force &ndash; Die Bedrohung</span>
            <span class="be-badge">4 BE</span>
        </div>

        <div class="formel-box">
            Kombinationen = Zeichensatzgr&ouml;&szlig;e<sup>Passwortl&auml;nge</sup>
        </div>

        <div class="info-box">
            <strong>Was ist Brute Force?</strong>
            <p style="margin-top: 8px;">Ein Computer probiert <strong>alle m&ouml;glichen Kombinationen</strong> durch. Moderne Computer schaffen &uuml;ber <strong>1 Milliarde Versuche pro Sekunde</strong>.</p>
            <p>Beispiel: Ein 4-stelliger Zahlen-PIN hat 10<sup>4</sup> = <strong>10.000</strong> Kombinationen &ndash; in unter 0,001 Sekunden geknackt!</p>
        </div>

        <div class="practice-zone">
            <p style="margin-top: 8px;"><strong>Brute-Force-Rechner:</strong> Spiele mit Zeichensatz und L&auml;nge:</p>
            <div class="bf-calculator">
                <label>Zeichensatz:</label>
                <select id="bfCharset" onchange="calculateBF()">
                    <option value="10">Nur Zahlen (0-9) = 10 Zeichen</option>
                    <option value="26">Kleinbuchstaben (a-z) = 26 Zeichen</option>
                    <option value="52">Klein + Gro&szlig; = 52 Zeichen</option>
                    <option value="62" selected>Buchstaben + Zahlen = 62 Zeichen</option>
                    <option value="94">Alles inkl. Sonderzeichen = 94 Zeichen</option>
                </select>
                <label>Passwortl&auml;nge: <strong id="bfLengthDisplay">8</strong> Zeichen</label>
                <input type="range" id="bfLength" min="4" max="16" value="8" oninput="calculateBF()" style="min-height:44px;">
                <div class="bf-result" id="bfResult">W&auml;hle Zeichensatz und L&auml;nge...</div>
            </div>
        </div>

        <div class="assess-zone" data-label="BEWERTET &ndash; 4 BE (1 Versuch)" id="assess2">
            <p style="margin-top: 8px;"><strong>Aufgabe:</strong> Beantworte die folgenden Fragen.</p>
            <div id="assess2-container"></div>
            <button class="btn btn-assess" id="btn-assess2" onclick="submitPhase2()">Abgeben (1 Versuch!)</button>
            <div class="feedback" id="fb-assess2"></div>
        </div>

        <div class="hefter-hint">Notiere die BF-Formel und berechne: Wie viele Kombinationen hat ein 8-Zeichen-PW mit vollem Zeichensatz?</div>

        <div class="nav-buttons">
            <button class="btn" id="btn-next2" disabled onclick="goToPhase(3)">Weiter zu Schutz &rarr;</button>
        </div>
    </div>

    <!-- Phase 3: Schutz -->
    <div class="step" id="step3">
        <div class="step-header">
            <span class="step-title">Phase 3: Schutz &ndash; Ma&szlig;nahmen gegen Angriffe</span>
            <span class="be-badge">4 BE</span>
        </div>

        <div class="info-box" style="background: #1a1a2e; border-left-color: #ff6b6b; color: #eee;">
            <strong style="color: #ff6b6b;">Max' digitaler Albtraum (Kurzfassung):</strong>
            <p style="margin-top: 8px;">Max (16) nutzt f&uuml;r alles dasselbe Passwort: <code style="background:#333;padding:2px 6px;color:#0f0;">Sommer2025!</code>. Ein Onlineshop wird gehackt &ndash; das nennt man ein <strong>Datenleck</strong>. Die Angreifer probieren Max' Passwort bei Instagram, E-Mail, Steam &ndash; <strong>alles funktioniert</strong>. Innerhalb von 3 Tagen sind alle Konten &uuml;bernommen.</p>
        </div>

        <h3>4 Schutzma&szlig;nahmen</h3>
        <div class="info-box">
            <ol style="margin: 0 0 0 20px;">
                <li style="margin-bottom: 8px;"><strong>Starke Passw&ouml;rter:</strong> Mindestens 12 Zeichen, alle Zeichenarten, keine W&ouml;rter/Muster/pers&ouml;nliche Daten.</li>
                <li style="margin-bottom: 8px;"><strong>Verschiedene Passw&ouml;rter:</strong> F&uuml;r jeden Dienst ein eigenes Passwort &ndash; so ist bei einem Datenleck nur ein Konto betroffen.</li>
                <li style="margin-bottom: 8px;"><strong>Passwort-Manager:</strong> Programme wie Bitwarden oder KeePass speichern alle Passw&ouml;rter <strong>verschl&uuml;sselt</strong>. Man merkt sich nur ein <strong>Master-Passwort</strong>.</li>
                <li><strong>Zwei-Faktor-Authentifizierung (2FA):</strong> Zwei Nachweise beim Login &ndash; <em>Wissen</em> (Passwort) + <em>Besitz</em> (Handy-Code). Selbst mit gestohlenem Passwort kommt niemand rein.</li>
            </ol>
        </div>

        <div class="info-box">
            <strong>Tipp: Passphrasen-Technik</strong>
            <p style="margin-top: 8px;">Kombiniere zuf&auml;llige W&ouml;rter: <code style="font-size:1.1em;background:#f5f5f5;padding:4px 8px;">KatzeRegenBuch42!</code> &ndash; lang, alle Zeichenarten, aber leichter zu merken.</p>
        </div>

        <div class="assess-zone" data-label="BEWERTET &ndash; 4 BE (1 Versuch)" id="assess3">
            <p style="margin-top: 8px;"><strong>Aufgabe:</strong> Beantworte die folgenden Fragen.</p>
            <div id="assess3-container"></div>
            <button class="btn btn-assess" id="btn-assess3" onclick="submitPhase3()">Abgeben (1 Versuch!)</button>
            <div class="feedback" id="fb-assess3"></div>
        </div>

        <div class="hefter-hint">Notiere die 4 Schutzma&szlig;nahmen und erkl&auml;re jeweils in einem Satz, warum sie helfen.</div>

        <div class="nav-buttons">
            <button class="btn" id="btn-next3" disabled onclick="goToPhase(4)">Weiter zur Bewertung &rarr;</button>
        </div>
    </div>

    <!-- Phase 4: Bewertung -->
    <div class="step" id="step4">
        <div class="step-header">
            <span class="step-title">Phase 4: Bewertung &ndash; Passw&ouml;rter beurteilen</span>
            <span class="be-badge">5 BE</span>
        </div>

        <div class="info-box">
            <strong>Erinnerung:</strong> Ein starkes Passwort hat mindestens 12 Zeichen, nutzt alle Zeichenarten und enth&auml;lt keine W&ouml;rter, Muster oder pers&ouml;nlichen Daten. Bewerte jetzt konkrete Passw&ouml;rter &ndash; beide Schritte m&uuml;ssen stimmen f&uuml;r den vollen Punkt!
        </div>

        <div class="assess-zone" data-label="BEWERTET &ndash; 5 BE (1 Versuch)" id="assess4">
            <div id="assess4-container"></div>
            <div class="feedback" id="fb-assess4"></div>
        </div>

        <div class="hefter-hint">Notiere ein Beispiel f&uuml;r ein schwaches und ein starkes Passwort mit Begr&uuml;ndung.</div>

        <div class="nav-buttons">
            <button class="btn" id="btn-next4" disabled onclick="goToPhase(5)">Weiter zur Anwendung &rarr;</button>
        </div>
    </div>

    <!-- Phase 5: Anwendung -->
    <div class="step" id="step5">
        <div class="step-header">
            <span class="step-title">Phase 5: Anwendung &ndash; Szenarien l&ouml;sen</span>
            <span class="be-badge">5 BE</span>
        </div>

        <div class="info-box" style="background:#f0f4f8; border-left:4px solid var(--fach); padding:12px 15px; margin-bottom:15px; font-size:0.92em;">
            <strong>Wichtige Fakten zur Erinnerung:</strong>
            <ul style="margin: 8px 0 0 16px;">
                <li>BF-Formel: Kombinationen = Zeichensatzgr&ouml;&szlig;e<sup>L&auml;nge</sup></li>
                <li>Moderne Computer: ca. 1 Milliarde Versuche/Sek</li>
                <li>Passwort-Manager speichern alles verschl&uuml;sselt (1 Master-PW)</li>
                <li>2FA = Passwort + Handy-Code</li>
                <li>Passphrasen: zuf&auml;llige W&ouml;rter + Zahl + Sonderzeichen</li>
            </ul>
        </div>

        <div class="assess-zone" data-label="BEWERTET &ndash; 5 BE (1 Versuch)" id="assess5">
            <p style="margin-top: 8px;"><strong>Aufgabe:</strong> Beantworte die folgenden Szenarien.</p>
            <div id="assess5-container"></div>
            <button class="btn btn-assess" id="btn-assess5" onclick="submitPhase5()">Abgeben (1 Versuch!)</button>
            <div class="feedback" id="fb-assess5"></div>
        </div>

        <div class="nav-buttons">
            <button class="btn" id="btn-next5" disabled onclick="goToPhase(6)">Weiter zum Transfer &rarr;</button>
        </div>
    </div>

    <!-- Phase 6: Transfer -->
    <div class="step" id="step6">
        <div class="step-header">
            <span class="step-title">Phase 6: Transfer &ndash; Synthese</span>
            <span class="be-badge">4 BE</span>
        </div>

        <div class="assess-zone" data-label="BEWERTET &ndash; 4 BE (1 Versuch)" id="assess6">
            <p style="margin-top: 8px;"><strong>Aufgabe:</strong> Beantworte die folgenden Transfer-Fragen.</p>
            <div id="assess6-container"></div>
            <button class="btn btn-assess" id="btn-assess6" onclick="submitPhase6()">Abgeben (1 Versuch!)</button>
            <div class="feedback" id="fb-assess6"></div>
        </div>

        <div class="hefter-hint">Formuliere 3 goldene Regeln f&uuml;r sichere Passw&ouml;rter.</div>

        <div class="nav-buttons">
            <button class="btn" id="btn-next6" disabled onclick="showResults()">Ergebnis anzeigen &rarr;</button>
        </div>
    </div>

    <!-- Phase 7: Ergebnis -->
    <div class="step" id="step7">
        <div class="step-header">
            <span class="step-title">Ergebnis</span>
            <span class="step-badge">Abschluss</span>
        </div>
        <p style="text-align: center; font-size: 1.1em; margin-bottom: 5px;" id="resultName"></p>
        <div class="results-grid">
            <div class="result-box"><div class="value" id="resBE">0</div><div class="label" id="resTotalLabel">von 25 BE</div></div>
            <div class="result-box"><div class="value" id="resProzent">0%</div><div class="label">erreicht</div></div>
        </div>
        <div class="grade-display"><div class="grade" id="resNote">&ndash;</div><div class="label" id="resGradeLabel">Note</div></div>
        <h3>Phasen-Aufschl&uuml;sselung</h3>
        <table class="phase-breakdown" id="resBreakdownTable"></table>
        <h3>Notenspiegel</h3>
        <table id="resGradeTable"></table>
        <div style="text-align: center; margin-top: 20px; padding: 15px; background: var(--fach-light);">
            <p>Pr&uuml;fcode: <strong id="resCode">&ndash;</strong></p>
            <p style="font-size:0.8em; color: var(--text-muted);" id="resTimestamp"></p>
        </div>
        <div id="resTabInfo" style="margin-top: 10px; font-size: 0.85em; color: var(--text-muted); text-align: center;"></div>
        <div style="text-align:center; margin-top:20px;">
            <button class="btn" id="btnBeleg" onclick="showBeleg()" style="background:var(--fach);">Detailbeleg ausblenden</button>
            <button class="btn" onclick="window.print()" style="background:#555; margin-left:8px;">Drucken / PDF</button>
        </div>
        <div id="belegContainer"></div>
    </div>
</div>

<div class="tab-warning-overlay" id="tabWarning">
    <div class="tab-warning-content">
        <div class="tab-warning-icon">&#9888;</div>
        <h2>Tab-Wechsel erkannt!</h2>
        <p>Du hast den Tab verlassen. Dies wird registriert.</p>
        <p class="tab-count">Bisherige Wechsel: <strong id="tabWarnCount">0</strong></p>
        <p class="tab-count">Gesamtzeit au&szlig;erhalb: <strong id="tabWarnTime">0s</strong></p>
        <button class="btn" id="tabWarnDismiss" onclick="dismissTabWarning()" disabled>Bitte warten&hellip;</button>
    </div>
</div>
<div class="teacher-reset" onclick="teacherReset()">Lehrer-Reset</div>

<script>
// BLP-02 Passwort-Sicherheit | ES5 | 25 BE | 6 Phasen

/* ══ Config ══ */
var BLP_ID = 'blp-02-passwort';
var LP_VERSION = '1.0';
var TOTAL_BE = 25;

var PHASE_CONFIG = [
    { name: 'Grundlagen', maxBE: 3 },
    { name: 'Brute-Force', maxBE: 4 },
    { name: 'Schutz', maxBE: 4 },
    { name: 'Bewertung', maxBE: 5 },
    { name: 'Anwendung', maxBE: 5 },
    { name: 'Transfer', maxBE: 4 }
];

var GRADE_SCALE = [
    { min: 23, grade: 1 },
    { min: 20, grade: 2 },
    { min: 15, grade: 3 },
    { min: 12, grade: 4 },
    { min: 7, grade: 5 },
    { min: 0, grade: 6 }
];

var HYPO_TIMER = 0;
var EXP_TIMER = 0;
var TEACHER_CODE = '2026';

/* ══ Fragen-Pools ══ */
var MC_POOL_1 = [
    { text: 'Wie viele Zeichen umfasst der Zeichensatz "Kleinbuchstaben (a-z)"?', options: ['10', '26', '52', '94'], correct: 1, fb: 'Das Alphabet a-z enth\u00e4lt genau 26 Buchstaben.' },
    { text: 'Wie gro\u00df ist der volle Zeichensatz (Gro\u00df-/Kleinbuchstaben + Zahlen + Sonderzeichen)?', options: ['52 Zeichen', '62 Zeichen', '72 Zeichen', '94 Zeichen'], correct: 3, fb: '26 + 26 + 10 + 32 = 94 verschiedene Zeichen.' },
    { text: 'Welches Passwort ist am sichersten?', options: ['sommer2024', 'M@x!7kP#9wL', 'qwerty123', '123456789'], correct: 1, fb: 'Zuf\u00e4llige Kombinationen mit allen Zeichenarten sind am schwersten zu knacken.' },
    { text: 'Was bewirkt das Hinzuf\u00fcgen von Sonderzeichen zu einem Passwort?', options: ['Das Passwort wird langsamer beim Einloggen', 'Sonderzeichen helfen nicht', 'Der Zeichensatz w\u00e4chst und die Kombinationen steigen', 'Das Passwort wird automatisch k\u00fcrzer'], correct: 2, fb: 'Sonderzeichen erweitern den Zeichensatz von 62 auf 94 Zeichen - viel mehr Kombinationen!' },
    { text: 'Welches dieser Passw\u00f6rter enth\u00e4lt ein h\u00e4ufiges Muster?', options: ['xK9!mQ2p', '7Rm#kWz9', 'Hallo123!', 'Qp!4xNm8'], correct: 2, fb: '"Hallo" ist ein h\u00e4ufiges Wort und "123" eine einfache Zahlenfolge.' }
];

var MC_POOL_2 = [
    { text: 'Was ist ein Brute-Force-Angriff?', options: ['Ein besonders starkes Passwort', 'Alle m\u00f6glichen Kombinationen systematisch durchprobieren', 'Ein Computervirus', 'Eine Verschl\u00fcsselungsmethode'], correct: 1, fb: 'Bei Brute Force werden alle Kombinationen getestet, bis das richtige Passwort gefunden ist.' },
    { text: 'Wie berechnet man die Anzahl m\u00f6glicher Kombinationen eines Passworts?', options: ['Zeichensatz + L\u00e4nge', 'Zeichensatz mal L\u00e4nge', 'Zeichensatzgr\u00f6\u00dfe hoch Passwortl\u00e4nge', 'L\u00e4nge hoch Zeichensatzgr\u00f6\u00dfe'], correct: 2, fb: 'Die Formel lautet: Kombinationen = Zeichensatzgr\u00f6\u00dfe hoch Passwortl\u00e4nge (exponentiell!).' },
    { text: 'Wie viele Versuche pro Sekunde schafft ein moderner Computer bei Brute Force?', options: ['Ca. 1.000', 'Ca. 1 Million', 'Ca. 1 Milliarde', 'Ca. 1 Billion'], correct: 2, fb: 'Moderne Hardware schafft \u00fcber 1 Milliarde Versuche pro Sekunde.' },
    { text: 'Was passiert, wenn die Passwortl\u00e4nge um 1 Zeichen steigt?', options: ['Es dauert genau doppelt so lang', 'Es macht keinen Unterschied', 'Es dauert 1 Sekunde l\u00e4nger', 'Die Kombinationen vervielfachen sich um die Zeichensatzgr\u00f6\u00dfe'], correct: 3, fb: 'Jedes zus\u00e4tzliche Zeichen multipliziert die Kombinationen mit der Zeichensatzgr\u00f6\u00dfe - exponentielles Wachstum!' },
    { text: 'Wie schnell wird ein 4-stelliger Zahlen-PIN (0-9) per Brute Force geknackt?', options: ['In Minuten', 'In Stunden', 'In Tagen', 'Sofort (unter 1 Sekunde)'], correct: 3, fb: '10 hoch 4 = 10.000 Kombinationen - bei 1 Mrd. Versuchen/Sek in unter 0,001 Sekunden geknackt!' },
    { text: 'Rechenaufgabe: Ein Passwort hat 6 Zeichen und besteht nur aus Kleinbuchstaben (26). Wie viele Kombinationen gibt es?', options: ['156 Kombinationen (26 x 6) - sofort geknackt', 'Ca. 309 Millionen (26 hoch 6) - in unter 1 Sekunde geknackt', 'Ca. 12 Milliarden - in mehreren Minuten geknackt', 'Ca. 1 Billion - praktisch unknackbar'], correct: 1, fb: '26^6 = 308.915.776 - ca. 309 Millionen. Bei 1 Mrd. Versuchen/Sek. in 0,3 Sekunden geknackt!' }
];

var MC_POOL_3 = [
    { text: 'Was ist ein Passwort-Manager?', options: ['Ein Programm, das Passw\u00f6rter verschl\u00fcsselt speichert und verwaltet', 'Eine Person in der IT-Abteilung', 'Eine Website zum Passwort-Testen', 'Ein spezieller Browser'], correct: 0, fb: 'Passwort-Manager speichern alle Passw\u00f6rter verschl\u00fcsselt. Man braucht nur ein Master-Passwort.' },
    { text: 'Was bedeutet Zwei-Faktor-Authentifizierung (2FA)?', options: ['Zwei Passw\u00f6rter nacheinander eingeben', 'Zus\u00e4tzlich zum Passwort einen zweiten Nachweis (z.B. Handy-Code)', 'Das Passwort zweimal eingeben', 'Zwei Personen kennen das Passwort'], correct: 1, fb: '2FA nutzt zwei verschiedene Faktoren: Wissen (Passwort) + Besitz (Handy/App).' },
    { text: 'Was ist ein Datenleck?', options: ['Ein kaputtes Netzwerkkabel', 'Wenn Hacker die Datenbank eines Dienstes stehlen und Passw\u00f6rter ver\u00f6ffentlicht werden', 'Eine langsame Internetverbindung', 'Ein Virus auf dem Handy'], correct: 1, fb: 'Bei Datenlecks werden gespeicherte Nutzerdaten (inkl. Passw\u00f6rter) gestohlen und oft ver\u00f6ffentlicht.' },
    { text: 'Warum sollte man NICHT \u00fcberall dasselbe Passwort verwenden?', options: ['Man vergisst es sonst', 'Es ist gesetzlich verboten', 'Computer werden dadurch langsamer', 'Wird ein Dienst gehackt, sind alle Konten gef\u00e4hrdet'], correct: 3, fb: 'Bei einem Datenleck k\u00f6nnen Angreifer mit dem geleakten Passwort alle anderen Konten \u00fcbernehmen.' },
    { text: 'Was braucht man, um einen Passwort-Manager zu nutzen?', options: ['Ein einziges starkes Master-Passwort', 'F\u00fcr jeden Dienst ein Passwort merken', 'Einen teuren Computer', 'Eine spezielle SIM-Karte'], correct: 0, fb: 'Das Master-Passwort \u00f6ffnet den verschl\u00fcsselten Tresor - alle anderen Passw\u00f6rter werden dort gespeichert.' },
    { text: 'Warum ist "Sommer2025!" ein schwaches Passwort?', options: ['Es ist zu kurz', 'Es hat zu viele Sonderzeichen', 'Es enth\u00e4lt ein W\u00f6rterbuch-Wort und ein vorhersagbares Muster', 'Es enth\u00e4lt keine Zahlen'], correct: 2, fb: '"Sommer" ist ein W\u00f6rterbuch-Wort, "2025" eine Jahreszahl, "!" ein vorhersagbares Sonderzeichen.' }
];

var PW_WEAK = [
    { pw: 'hallo123', secure: false, correctReason: 0, reasons: ['Enth\u00e4lt das h\u00e4ufige Wort "hallo" und die einfache Zahlenfolge "123"', 'Hat weniger als 6 Zeichen und ist damit zu kurz', 'Ist ein Tastaturmuster wie "qwertz"', 'Enth\u00e4lt zu viele verschiedene Sonderzeichen'] },
    { pw: '12345678', secure: false, correctReason: 0, reasons: ['Besteht nur aus aufeinanderfolgenden Zahlen - wird sofort erraten', 'Enth\u00e4lt ein h\u00e4ufiges W\u00f6rterbuch-Wort', 'Verwendet zu viele verschiedene Sonderzeichen', 'Hat eine zuf\u00e4llige Zeichenfolge ohne erkennbares Muster'] },
    { pw: 'qwertzuiop', secure: false, correctReason: 0, reasons: ['Ist ein Tastaturmuster - steht auf jeder Brute-Force-Liste', 'Hat weniger als 8 Zeichen', 'Enth\u00e4lt pers\u00f6nliche Daten wie einen Namen', 'Verwendet nur Sonderzeichen und Zahlen'] },
    { pw: 'passwort', secure: false, correctReason: 0, reasons: ['Ist eines der h\u00e4ufigsten deutschen Passw\u00f6rter \u00fcberhaupt', 'Enth\u00e4lt zu viele Zahlen hintereinander', 'Verwendet nur Gro\u00dfbuchstaben', 'Ist ein kompliziertes Tastaturmuster'] },
    { pw: 'Sommer2025!', secure: false, correctReason: 0, reasons: ['Kombiniert ein W\u00f6rterbuch-Wort mit einer vorhersagbaren Jahreszahl', 'Hat weniger als 8 Zeichen', 'Verwendet keine Gro\u00dfbuchstaben', 'Besteht nur aus Sonderzeichen und Zahlen'] }
];

var PW_STRONG = [
    { pw: 'K@tz3!Bm#7xQ', secure: true, correctReason: 0, reasons: ['12 Zeichen mit allen Zeichenarten und keinem erkennbaren Muster', 'Enth\u00e4lt ein bekanntes Wort r\u00fcckw\u00e4rts geschrieben', 'Verwendet nur zwei verschiedene Zeichenarten', 'Ist ein h\u00e4ufiges Tastaturmuster'] },
    { pw: 'Mn7$kR!9xQ2p', secure: true, correctReason: 0, reasons: ['Zuf\u00e4llige Zeichenfolge ohne erkennbare W\u00f6rter oder Muster', 'Enth\u00e4lt eine vorhersagbare Jahreszahl', 'Besteht nur aus Buchstaben und Zahlen ohne Sonderzeichen', 'Ist k\u00fcrzer als 8 Zeichen'] },
    { pw: 'X#9pL!mK4wzR', secure: true, correctReason: 0, reasons: ['Maximale Zeichenvielfalt und kein Zusammenhang zwischen den Zeichen', 'Enth\u00e4lt den Namen einer bekannten Person', 'Verwendet nur Kleinbuchstaben und Zahlen', 'Hat ein vorhersagbares Muster am Ende'] },
    { pw: 'jF8!kWz#2mNp', secure: true, correctReason: 0, reasons: ['Alle vier Zeichenarten, keine W\u00f6rter und keine Muster', 'Beginnt mit einem h\u00e4ufigen deutschen Vornamen', 'Enth\u00e4lt nur Zahlen und Sonderzeichen', 'Ist ein bekannter Tastaturlauf auf QWERTZ'] },
    { pw: 'Tr0ub4d&r!3x', secure: true, correctReason: 0, reasons: ['Gemischte Zeichenarten mit kreativen Ersetzungen - kein einfaches Muster', 'Verwendet nur Gro\u00dfbuchstaben und Zahlen', 'Hat weniger als 8 Zeichen', 'Enth\u00e4lt eine einfache aufsteigende Zahlenfolge'] }
];

var MC_POOL_5 = [
    { text: 'Szenario: Lisa nutzt das Passwort "L!sa2025" f\u00fcr Instagram, E-Mail und einen Onlineshop. Der Onlineshop wird gehackt. Was muss Lisa SOFORT tun?', options: ['Nur das Shop-Passwort \u00e4ndern, die anderen sind nicht betroffen', 'Abwarten - vielleicht wurden ihre Daten nicht gestohlen', 'Den Onlineshop verklagen und nichts weiter tun', 'Alle drei Passw\u00f6rter \u00e4ndern und \u00fcberall 2FA aktivieren'], correct: 3, fb: 'Da Lisa \u00fcberall dasselbe Passwort nutzt, m\u00fcssen ALLE Passw\u00f6rter sofort ge\u00e4ndert werden.' },
    { text: 'Welche Aussage \u00fcber Passwort-Sicherheit ist FALSCH?', options: ['L\u00e4ngere Passw\u00f6rter sind grunds\u00e4tzlich sicherer als k\u00fcrzere', '8 Zeichen mit Sonderzeichen sind genauso sicher wie 12 Zeichen ohne', 'Sonderzeichen vergr\u00f6\u00dfern den Zeichensatz und damit die Kombinationen', 'Ein Passwort-Manager kann sichere Passw\u00f6rter automatisch erzeugen'], correct: 1, fb: 'FALSCH! 8 Zeichen mit Sonderzeichen (94^8) sind VIEL schw\u00e4cher als 12 Zeichen ohne (62^12).' },
    { text: 'Tim behauptet: "Mein Passwort \'aaaaaaaaaaaa\' ist unknackbar, weil es 12 Zeichen hat." Hat Tim recht?', options: ['Ja, 12 Zeichen sind immer unknackbar', 'Ja, die L\u00e4nge ist der einzige wichtige Faktor', 'Nein, weil es keine Zahlen enth\u00e4lt', 'Nein, wiederholte Zeichen werden von Angriffsprogrammen sofort getestet'], correct: 3, fb: 'Brute-Force-Programme testen Muster wie wiederholte Zeichen zuerst.' },
    { text: 'Eine Firma verlangt: "Passw\u00f6rter m\u00fcssen mindestens 8 Zeichen lang sein und eine Zahl enthalten." Beurteile diese Richtlinie.', options: ['Ausreichend sicher f\u00fcr den Arbeitsplatz', 'Perfekt, 8 Zeichen sind der internationale Standard', 'Unzureichend - 8 Zeichen sind zu kurz und es fehlen Vorgaben f\u00fcr Sonderzeichen und Gro\u00dfbuchstaben', 'Gut, weil die Zahl-Pflicht es sicher macht'], correct: 2, fb: '8 Zeichen sind per Brute Force in Stunden knackbar. Empfehlung: mindestens 12 Zeichen mit allen Zeichenarten.' },
    { text: 'Max hat 20 verschiedene sichere Passw\u00f6rter und notiert sie auf einem Zettel an seinem Monitor. Beurteile diese Strategie.', options: ['Gut - verschiedene Passw\u00f6rter sind das Wichtigste', 'Sicher - die Passw\u00f6rter sind ja komplex', 'Optimal - Aufschreiben ist besser als ein Passwort-Manager', 'Unsicher - jeder am Arbeitsplatz kann die Passw\u00f6rter lesen; ein Passwort-Manager w\u00e4re besser'], correct: 3, fb: 'Zettel am Monitor = physisch unsicher. Ein Passwort-Manager verschl\u00fcsselt alles.' },
    { text: 'Welche Aussage \u00fcber Zwei-Faktor-Authentifizierung (2FA) ist FALSCH?', options: ['2FA ist \u00fcberfl\u00fcssig, wenn man ein starkes Passwort verwendet', '2FA kombiniert Wissen (Passwort) und Besitz (z.B. Smartphone)', '2FA sch\u00fctzt auch dann, wenn das Passwort bei einem Datenleck ver\u00f6ffentlicht wird', 'Eine Authenticator-App gilt als sicherer als SMS-Codes'], correct: 0, fb: 'Auch ein starkes Passwort kann bei einem Datenleck ver\u00f6ffentlicht werden. 2FA bietet zus\u00e4tzlichen Schutz.' },
    { text: 'Vergleiche: Passwort A hat 10 Zeichen, nur Zahlen (0-9). Passwort B hat 6 Zeichen, alle Zeichenarten (94). Welches ist sicherer?', options: ['A ist sicherer, weil es l\u00e4nger ist', 'Beide sind gleich sicher', 'A ist sicherer, weil Zahlen schwerer zu erraten sind', 'B ist sicherer, weil 94 hoch 6 (ca. 690 Mrd.) gr\u00f6\u00dfer ist als 10 hoch 10 (10 Mrd.)'], correct: 3, fb: '10^10 = 10 Milliarden, aber 94^6 ca. 690 Milliarden - fast 70-mal mehr Kombinationen!' }
];

var MC_POOL_6 = [
    { text: 'Beurteile die Passphrase "MeinHundFrisst3\u00c4pfel!" als Passwort.', options: ['Unsicher, weil es W\u00f6rter enth\u00e4lt', 'Sicher: lang, alle Zeichenarten, schwer per Brute Force zu knacken', 'Unsicher, weil es ein Sonderzeichen am Ende hat', 'Sicher, aber nur wenn man 2FA aktiviert'], correct: 1, fb: 'Passphrasen sind lang und enthalten alle Zeichenarten. Die L\u00e4nge macht sie per Brute Force praktisch unknackbar.' },
    { text: 'Dein Freund will seinen Geburtstag r\u00fcckw\u00e4rts als Passwort nutzen (z.B. "5002.30.21"). Was sagst du?', options: ['Gute Idee \u2013 das err\u00e4t niemand', 'Sicher, weil es Zahlen und einen Punkt enth\u00e4lt', 'Unsicher \u2013 Geburtsdaten sind \u00fcber Social Media findbar und werden gezielt getestet', 'Sicher, wenn er noch ein ! anh\u00e4ngt'], correct: 2, fb: 'Pers\u00f6nliche Daten (auch r\u00fcckw\u00e4rts) stehen auf Angriffslisten.' },
    { text: 'Anna speichert ihre Passw\u00f6rter in einer unverschl\u00fcsselten Textdatei auf dem Desktop. Ist das ein guter "Passwort-Manager"?', options: ['Ja, solange sie die Datei nicht teilt', 'Ja, Hauptsache die Passw\u00f6rter sind unterschiedlich', 'Nein \u2013 jeder mit Zugang zum Computer kann die Datei lesen; ein echter PW-Manager verschl\u00fcsselt die Daten', 'Ja, das ist genauso sicher wie Bitwarden'], correct: 2, fb: 'Eine Klartextdatei bietet keinen Schutz. Echte PW-Manager verschl\u00fcsseln alles mit einem Master-Passwort.' },
    { text: 'Vergleiche: Passwort A hat 16 Zeichen nur Kleinbuchstaben. Passwort B hat 8 Zeichen mit vollem Zeichensatz (94). Welches ist sicherer?', options: ['B ist sicherer wegen der Zeichenvielfalt', 'Beide sind gleich sicher', 'A ist sicherer: 26^16 ist viel gr\u00f6\u00dfer als 94^8', 'Keines \u2013 beide sind unsicher'], correct: 2, fb: '26^16 \u2248 4,4 \u00d7 10^22 vs. 94^8 \u2248 6,1 \u00d7 10^15. L\u00e4nge schl\u00e4gt Zeichenvielfalt bei ausreichender L\u00e4nge!' },
    { text: 'Welche Kombination aus Schutzma\u00dfnahmen ist am effektivsten?', options: ['Langes Passwort + auf Zettel notieren', 'Kurzes Passwort + 2FA', 'Passwort-Manager + starke Passw\u00f6rter + 2FA', 'Gleiches starkes Passwort \u00fcberall + 2FA'], correct: 2, fb: 'Die Kombination aus PW-Manager (verschiedene Passw\u00f6rter), starken Passw\u00f6rtern und 2FA bietet den besten Schutz.' },
    { text: '"Mein Passwort wurde noch nie gehackt, also muss ich es nicht \u00e4ndern." Beurteile diese Aussage.', options: ['Stimmt \u2013 solange nichts passiert, ist alles sicher', 'Stimmt \u2013 regelm\u00e4\u00dfiges \u00c4ndern macht Passw\u00f6rter unsicherer', 'Falsch \u2013 Datenlecks werden oft erst Monate sp\u00e4ter entdeckt; man wei\u00df nie, ob das PW bereits kompromittiert ist', 'Stimmt \u2013 Hacker greifen nur gro\u00dfe Firmen an'], correct: 2, fb: 'Viele Datenlecks werden erst sp\u00e4t bekannt. Regelm\u00e4\u00dfige Pr\u00fcfung und starke, einzigartige Passw\u00f6rter sind wichtig.' }
];

/* ══ Personalisierte Aufgaben ══ */
var myPhase1Items = [];
var myPhase2Items = [];
var myPhase3Items = [];
var myPhase4Cards = [];
var myPhase5Items = [];
var myPhase6Items = [];
var pwReasonSelections = {};
var phase4Answered = 0;
var phase4BelegItems = [];

function buildPersonalTasks() {
    var rng1 = createRNG(state.seed + 100);
    myPhase1Items = shuffleWithRNG(MC_POOL_1.slice(), rng1).slice(0, 3);

    var rng2 = createRNG(state.seed + 200);
    myPhase2Items = shuffleWithRNG(MC_POOL_2.slice(), rng2).slice(0, 4);

    var rng3 = createRNG(state.seed + 300);
    myPhase3Items = shuffleWithRNG(MC_POOL_3.slice(), rng3).slice(0, 4);

    var rng4 = createRNG(state.seed + 400);
    var weakShuffled = shuffleWithRNG(PW_WEAK.slice(), rng4);
    var strongShuffled = shuffleWithRNG(PW_STRONG.slice(), rng4);
    var selected4 = [weakShuffled[0], weakShuffled[1], weakShuffled[2], strongShuffled[0], strongShuffled[1]];
    myPhase4Cards = shuffleWithRNG(selected4, rng4);

    var rng5 = createRNG(state.seed + 500);
    myPhase5Items = shuffleWithRNG(MC_POOL_5.slice(), rng5).slice(0, 5);

    var rng6 = createRNG(state.seed + 600);
    myPhase6Items = shuffleWithRNG(MC_POOL_6.slice(), rng6).slice(0, 4);
}


/* ── TEMPLATE: STATE ── */
var TOTAL_PHASES = PHASE_CONFIG.length + 1;

function sKey(suffix) {
    var p = window.location.search.match(/[?&]p=(\d+)/);
    var platz = p ? '-p' + p[1] : '';
    return BLP_ID + platz + '-' + suffix;
}

var state = { name: '', seed: 0, version: LP_VERSION, currentPhase: 0, scores: {}, submitted: {}, hypotheses: {}, measurements: [], completed: false, startTime: null, phaseTimestamps: {}, experimentTimeLeft: EXP_TIMER, beleg: [] };
(function() { for (var i = 0; i < PHASE_CONFIG.length; i++) { state.scores['p' + (i+1)] = 0; state.submitted['p' + (i+1)] = false; } })();

var tabSwitchCount = 0, tabSwitchStart = 0, tabSwitchSeconds = 0;
var audioCtx = null, alarmOsc = null, alarmGain = null, alarmActive = false;

/* ── TEMPLATE: Seed-Funktionen ── */
function seedFromName(name) { var hash = 0; var str = name.trim().toLowerCase(); for (var i = 0; i < str.length; i++) { hash = ((hash << 5) - hash) + str.charCodeAt(i); hash = hash & hash; } return Math.abs(hash); }
function createRNG(seed) { var s = seed; return { next: function() { s = (s * 9301 + 49297) % 233280; return s / 233280; }, nextInt: function(max) { return Math.floor(this.next() * max); } }; }
function shuffleWithRNG(arr, rng) { var result = arr.slice(); for (var i = result.length - 1; i > 0; i--) { var j = rng.nextInt(i + 1); var temp = result[i]; result[i] = result[j]; result[j] = temp; } return result; }
function generateVerification(name, score, date) { var str = name.toLowerCase().trim() + '-' + score + '-' + date; var hash = 0; for (var i = 0; i < str.length; i++) { hash = ((hash << 5) - hash) + str.charCodeAt(i); hash = hash & hash; } return Math.abs(hash).toString(36).toUpperCase().substr(0, 6); }
function parseNum(val) { if (!val) return NaN; return parseFloat(String(val).replace(',', '.')); }

/* ── TEMPLATE: Navigation ── */
function goToPhase(n) {
    var totalPhases = PHASE_CONFIG.length + 1;
    if (n < 0 || n > totalPhases) return;
    if (n < state.currentPhase && n !== 0) return;
    var steps = document.querySelectorAll('.step');
    for (var i = 0; i < steps.length; i++) steps[i].classList.remove('active');
    document.getElementById('step' + n).classList.add('active');
    for (var i = 1; i <= totalPhases; i++) { var el = document.getElementById('ew' + i); if (!el) continue; el.classList.remove('active', 'done'); if (i < n) el.classList.add('done'); if (i === n) el.classList.add('active'); }
    var numContent = PHASE_CONFIG.length;
    var pct = n === 0 ? 0 : ((n - 1) / numContent) * 100;
    document.getElementById('progressFill').style.width = Math.min(pct, 100) + '%';
    state.currentPhase = n; state.phaseTimestamps['phase' + n] = new Date().toISOString(); saveState(); window.scrollTo(0, 0);
}

function lockZone(id) {
    var zone = document.getElementById(id);
    if (zone) { var inputs = zone.querySelectorAll('input, select, button'); for (var i = 0; i < inputs.length; i++) inputs[i].disabled = true; var mcOpts = zone.querySelectorAll('.mc-option'); for (var i = 0; i < mcOpts.length; i++) mcOpts[i].classList.add('disabled'); }
}

/* ── TEMPLATE: Audio Alarm ── */
function initAudioContext() { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); var buf = audioCtx.createBuffer(1, 1, 22050); var src = audioCtx.createBufferSource(); src.buffer = buf; src.connect(audioCtx.destination); src.start(0); }
function ensureAudio(callback) { if (!audioCtx) { try { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); } catch(e) {} } if (audioCtx && audioCtx.state === 'suspended') { audioCtx.resume().then(function() { if (callback) callback(); }); return false; } return true; }
function startAlarm() { if (!audioCtx || alarmActive) return; alarmOsc = audioCtx.createOscillator(); alarmGain = audioCtx.createGain(); alarmOsc.connect(alarmGain); alarmGain.connect(audioCtx.destination); alarmOsc.frequency.value = 800; alarmOsc.type = 'square'; alarmGain.gain.value = 0.15; alarmOsc.start(); alarmActive = true; }
function stopAlarm() { if (alarmOsc) { try { alarmOsc.stop(); } catch(e) {} alarmOsc = null; } alarmActive = false; }

/* ── TEMPLATE: Tab-Tracking ── */
var TAB_WARN_BEEPS = 5; var pulseAlarmTimeout = null; var sessionReady = false;
function initTabTracking() { var sc = localStorage.getItem(sKey('tabswitches')); var ss = localStorage.getItem(sKey('tabseconds')); if (sc) tabSwitchCount = parseInt(sc); if (ss) tabSwitchSeconds = parseInt(ss); document.addEventListener('visibilitychange', function() { if (!sessionReady || state.completed) return; if (document.hidden) { tabSwitchStart = Date.now(); tabSwitchCount++; localStorage.setItem(sKey('tabswitches'), tabSwitchCount); } else { if (tabSwitchStart > 0) { var dur = Math.round((Date.now() - tabSwitchStart) / 1000); tabSwitchSeconds += dur; localStorage.setItem(sKey('tabseconds'), tabSwitchSeconds); tabSwitchStart = 0; } showTabWarningOverlay(); startPulseAlarm(); } }); }
function startPulseAlarm() { var btn = document.getElementById('tabWarnDismiss'); if (btn) { btn.disabled = true; btn.textContent = 'Bitte warten\u2026'; } var beepsDone = 0; var alarmStarted = false; function doPulse() { alarmStarted = true; if (beepsDone >= TAB_WARN_BEEPS) { stopAlarm(); if (btn) { btn.disabled = false; btn.textContent = 'Zur\u00fcck zum Test'; } return; } startAlarm(); pulseAlarmTimeout = setTimeout(function() { stopAlarm(); beepsDone++; pulseAlarmTimeout = setTimeout(doPulse, 500); }, 500); } var ready = ensureAudio(function() { doPulse(); }); if (ready) doPulse(); setTimeout(function() { if (!alarmStarted && btn) { btn.disabled = false; btn.textContent = 'Zur\u00fcck zum Test'; } }, 2000); }
function formatTabTime(sec) { if (sec < 60) return sec + 's'; var m = Math.floor(sec / 60); var s = sec % 60; return m + ':' + (s < 10 ? '0' : '') + s + ' min'; }
function showTabWarningOverlay() { document.getElementById('tabWarnCount').textContent = tabSwitchCount; document.getElementById('tabWarnTime').textContent = formatTabTime(tabSwitchSeconds); document.getElementById('tabWarning').classList.add('visible'); }
function dismissTabWarning() { if (document.getElementById('tabWarnDismiss').disabled) return; document.getElementById('tabWarning').classList.remove('visible'); if (pulseAlarmTimeout) { clearTimeout(pulseAlarmTimeout); pulseAlarmTimeout = null; } stopAlarm(); }

/* ── TEMPLATE: Persistenz ── */
function saveState() { var data = { name: state.name, seed: state.seed, version: state.version, currentPhase: state.currentPhase, scores: state.scores, submitted: state.submitted, hypotheses: state.hypotheses, measurements: state.measurements, completed: state.completed, startTime: state.startTime, phaseTimestamps: state.phaseTimestamps, experimentTimeLeft: state.experimentTimeLeft, beleg: state.beleg }; localStorage.setItem(sKey('state'), JSON.stringify(data)); }
function saveInputSnapshot() { var data = {}; var inputs = document.querySelectorAll('input[type="text"], input[type="number"], select'); for (var i = 0; i < inputs.length; i++) { if (inputs[i].id) data[inputs[i].id] = inputs[i].value; } var selected = document.querySelectorAll('.mc-option.selected'); for (var i = 0; i < selected.length; i++) { var parent = selected[i].parentNode; if (parent.id) { var idx = 0; var siblings = parent.querySelectorAll('.mc-option'); for (var j = 0; j < siblings.length; j++) { if (siblings[j] === selected[i]) { idx = j; break; } } data['mc-' + parent.id] = idx; } } localStorage.setItem(sKey('inputs'), JSON.stringify(data)); }
function loadInputSnapshot() { var saved = localStorage.getItem(sKey('inputs')); if (!saved) return; try { var data = JSON.parse(saved); for (var key in data) { if (key.indexOf('mc-') === 0) { var parentId = key.substr(3); var parent = document.getElementById(parentId); if (parent) { var opts = parent.querySelectorAll('.mc-option'); var idx = parseInt(data[key]); if (opts[idx]) opts[idx].classList.add('selected'); } } else { var el = document.getElementById(key); if (el) el.value = data[key]; } } } catch(e) {} }
function loadState() { var saved = localStorage.getItem(sKey('state')); if (!saved) return false; try { var data = JSON.parse(saved); if (!data.name || !data.seed) return false; if (data.version !== LP_VERSION) { localStorage.removeItem(sKey('state')); localStorage.removeItem(sKey('inputs')); return false; } state.name = data.name; state.seed = data.seed; state.version = data.version; state.currentPhase = data.currentPhase || 0; state.scores = data.scores || state.scores; state.submitted = data.submitted || state.submitted; state.hypotheses = data.hypotheses || state.hypotheses; state.measurements = data.measurements || state.measurements; state.completed = data.completed || false; state.startTime = data.startTime; state.phaseTimestamps = data.phaseTimestamps || {}; state.experimentTimeLeft = data.experimentTimeLeft || EXP_TIMER; state.beleg = data.beleg || []; return true; } catch (e) { return false; } }

/* ── TEMPLATE: Ergebnis ── */
function showResults() {
    var total = 0; for (var i = 0; i < PHASE_CONFIG.length; i++) total += state.scores['p' + (i+1)];
    var pct = Math.round((total / TOTAL_BE) * 100); var grade = getGrade(total);
    var now = new Date(); var code = generateVerification(state.name, total, now.toISOString().split('T')[0]);
    state.completed = true; saveState();
    localStorage.setItem(sKey('result'), JSON.stringify({ name: state.name, total: total, pct: pct, grade: grade, code: code, timestamp: now.toISOString() }));
    document.getElementById('resultName').textContent = state.name;
    document.getElementById('resBE').textContent = total;
    document.getElementById('resTotalLabel').textContent = 'von ' + TOTAL_BE + ' BE';
    document.getElementById('resProzent').textContent = pct + '%';
    var gradeEl = document.getElementById('resNote'); gradeEl.textContent = 'Note: ' + grade; gradeEl.className = 'grade g' + grade;
    var breakdownHTML = '<tr><th>Phase</th><th>Thema</th><th>erreicht</th><th>max</th></tr>';
    for (var i = 0; i < PHASE_CONFIG.length; i++) { breakdownHTML += '<tr><td>' + (i+1) + '</td><td>' + PHASE_CONFIG[i].name + '</td><td>' + state.scores['p'+(i+1)] + '</td><td>' + PHASE_CONFIG[i].maxBE + '</td></tr>'; }
    breakdownHTML += '<tr style="font-weight:700;"><td></td><td>Gesamt</td><td>' + total + '</td><td>' + TOTAL_BE + '</td></tr>';
    document.getElementById('resBreakdownTable').innerHTML = breakdownHTML;
    var gradeHTML = '<tr><th>Note</th>'; for (var i = 0; i < GRADE_SCALE.length; i++) gradeHTML += '<th>' + GRADE_SCALE[i].grade + '</th>'; gradeHTML += '</tr><tr><td>ab BE</td>'; for (var i = 0; i < GRADE_SCALE.length; i++) gradeHTML += '<td>' + GRADE_SCALE[i].min + '</td>'; gradeHTML += '</tr><tr><td>ab %</td>'; for (var i = 0; i < GRADE_SCALE.length; i++) gradeHTML += '<td>' + Math.round((GRADE_SCALE[i].min / TOTAL_BE) * 100) + '</td>'; gradeHTML += '</tr>';
    document.getElementById('resGradeTable').innerHTML = gradeHTML;
    document.getElementById('resCode').textContent = code;
    document.getElementById('resTimestamp').textContent = 'Abgabe: ' + now.toLocaleDateString('de-DE') + ' ' + now.toLocaleTimeString('de-DE');
    if (tabSwitchCount > 0) document.getElementById('resTabInfo').textContent = 'Tab-Wechsel: ' + tabSwitchCount + '\u00d7 (' + formatDuration(tabSwitchSeconds) + ')';
    goToPhase(PHASE_CONFIG.length + 1);
    showBeleg();
}
function getGrade(be) { for (var i = 0; i < GRADE_SCALE.length; i++) { if (be >= GRADE_SCALE[i].min) return GRADE_SCALE[i].grade; } return GRADE_SCALE[GRADE_SCALE.length - 1].grade; }
function formatDuration(sec) { var m = Math.floor(sec / 60); var s = sec % 60; return m + ':' + (s < 10 ? '0' : '') + s + ' Min.'; }

/* ── TEMPLATE: Beleg ── */
function showBeleg() { var container = document.getElementById('belegContainer'); if (container.style.display !== 'none') { container.style.display = 'none'; document.getElementById('btnBeleg').textContent = 'Detailbeleg anzeigen'; return; } var belegData = state.beleg || []; if (belegData.length === 0) { container.innerHTML = '<p style="text-align:center;color:var(--text-muted);padding:20px;">Keine Beleg-Daten vorhanden.</p>'; container.style.display = 'block'; document.getElementById('btnBeleg').textContent = 'Beleg ausblenden'; return; } var total = 0; for (var t = 0; t < PHASE_CONFIG.length; t++) total += state.scores['p'+(t+1)]; var html = '<div class="beleg"><div class="beleg-header"><h2>Detailbeleg: ' + state.name + '</h2><p>' + BLP_ID + ' | ' + total + '/' + TOTAL_BE + ' BE | ' + new Date().toLocaleDateString('de-DE') + '</p></div>'; for (var p = 0; p < belegData.length; p++) { var phase = belegData[p]; html += '<div class="beleg-phase"><h3>Phase ' + phase.phase + ': ' + phase.phaseName + ' (' + phase.phBE + '/' + phase.phMaxBE + ' BE)</h3>'; for (var i = 0; i < phase.items.length; i++) { var item = phase.items[i]; var itemClass = item.be >= item.maxBE ? 'beleg-correct' : 'beleg-wrong'; html += '<div class="beleg-item ' + itemClass + '"><div class="beleg-q">' + item.q + '</div>'; if (item.options && item.options.length > 0) { html += '<div class="beleg-options">'; for (var j = 0; j < item.options.length; j++) { var optClass = ''; if (item.options[j] === item.correct) optClass += ' beleg-opt-correct'; if (item.options[j] === item.given) optClass += ' beleg-opt-given'; html += '<span class="beleg-opt' + optClass + '">' + item.options[j] + '</span>'; } html += '</div>'; } html += '<div class="beleg-points">' + item.be + '/' + item.maxBE + ' BE</div><div class="beleg-explain">' + item.explain + '</div></div>'; } html += '</div>'; } html += '</div>'; container.innerHTML = html; container.style.display = 'block'; document.getElementById('btnBeleg').textContent = 'Beleg ausblenden'; }

/* ── TEMPLATE: Teacher-Reset ── */
function teacherReset() { var code = prompt('Lehrer-Code eingeben:'); if (code === TEACHER_CODE) { if (confirm('Wirklich alle Daten l\u00f6schen?')) { localStorage.removeItem(sKey('state')); localStorage.removeItem(sKey('inputs')); localStorage.removeItem(sKey('result')); localStorage.removeItem(sKey('tabswitches')); localStorage.removeItem(sKey('tabseconds')); alert('Zur\u00fcckgesetzt.'); location.reload(); } } else if (code !== null) { alert('Falscher Code!'); } }


/* ══ CONTENT: Helpers ══ */
function escapeHTML(str) { var div = document.createElement('div'); div.textContent = str; return div.innerHTML; }
function formatNumber(n) { if (n < 1e3) return n.toString(); if (n < 1e6) return Math.round(n / 1e3) + ' Tausend'; if (n < 1e9) return Math.round(n / 1e6) + ' Millionen'; if (n < 1e12) return Math.round(n / 1e9) + ' Milliarden'; if (n < 1e15) return Math.round(n / 1e12) + ' Billionen'; if (n < 1e18) return Math.round(n / 1e15) + ' Billiarden'; return n.toExponential(1); }
function formatTime(seconds) { if (seconds < 0.001) return 'sofort (< 0,001 Sek)'; if (seconds < 1) return 'unter 1 Sekunde'; if (seconds < 60) return Math.round(seconds) + ' Sekunden'; if (seconds < 3600) return Math.round(seconds / 60) + ' Minuten'; if (seconds < 86400) return Math.round(seconds / 3600) + ' Stunden'; if (seconds < 31536000) return Math.round(seconds / 86400) + ' Tage'; var years = seconds / 31536000; if (years < 1000) return Math.round(years) + ' Jahre'; if (years < 1e6) return Math.round(years / 1000) + ' Tausend Jahre'; if (years < 1e9) return Math.round(years / 1e6) + ' Millionen Jahre'; return Math.round(years / 1e9) + ' Milliarden Jahre'; }

/* ══ CONTENT: PW-Tester (Phase 1 practice) ══ */
function analyzePW() {
    var pw = document.getElementById('pwTestInput').value;
    var fill = document.getElementById('strengthFill');
    var label = document.getElementById('strengthLabel');
    if (pw.length === 0) { fill.className = 'strength-fill'; label.textContent = '-'; document.getElementById('pd-length').textContent = 'L\u00e4nge: -'; document.getElementById('pd-length').className = 'pw-detail-item'; document.getElementById('pd-charset').textContent = 'Zeichensatz: -'; document.getElementById('pd-charset').className = 'pw-detail-item'; document.getElementById('pd-combos').textContent = 'Kombinationen: -'; document.getElementById('pd-combos').className = 'pw-detail-item'; document.getElementById('pd-time').textContent = 'Knackzeit: -'; document.getElementById('pd-time').className = 'pw-detail-item'; return; }
    var hasLower = /[a-z]/.test(pw); var hasUpper = /[A-Z]/.test(pw); var hasNumber = /[0-9]/.test(pw); var hasSpecial = /[^a-zA-Z0-9]/.test(pw);
    var charsetSize = 0; if (hasLower) charsetSize += 26; if (hasUpper) charsetSize += 26; if (hasNumber) charsetSize += 10; if (hasSpecial) charsetSize += 32; if (charsetSize === 0) charsetSize = 26;
    var strength = 0; if (pw.length >= 6) strength++; if (pw.length >= 8) strength++; if (pw.length >= 12) strength++; if (hasLower && hasUpper) strength++; if (hasNumber) strength++; if (hasSpecial) strength++;
    var common = ['passwort', 'password', '123456', 'qwerty', 'qwertz', 'hallo', 'sommer', 'winter']; for (var i = 0; i < common.length; i++) { if (pw.toLowerCase().indexOf(common[i]) > -1) { strength = Math.max(0, strength - 3); break; } }
    strength = Math.min(5, Math.max(1, strength)); fill.className = 'strength-fill s' + strength;
    var labels = ['', 'Sehr schwach', 'Schwach', 'Mittel', 'Stark', 'Sehr stark']; var colors = ['', '#c62828', '#e65100', '#f9a825', '#558b2f', '#2e7d32'];
    label.textContent = labels[strength]; label.style.color = colors[strength];
    document.getElementById('pd-length').textContent = 'L\u00e4nge: ' + pw.length + ' Zeichen'; document.getElementById('pd-length').className = 'pw-detail-item' + (pw.length >= 8 ? ' active' : '');
    var types = []; if (hasLower) types.push('a-z'); if (hasUpper) types.push('A-Z'); if (hasNumber) types.push('0-9'); if (hasSpecial) types.push('Sonderz.');
    document.getElementById('pd-charset').textContent = 'Zeichensatz: ' + charsetSize + ' (' + types.join(', ') + ')'; document.getElementById('pd-charset').className = 'pw-detail-item' + (types.length >= 3 ? ' active' : '');
    var combos = Math.pow(charsetSize, pw.length); document.getElementById('pd-combos').textContent = 'Kombinationen: ' + formatNumber(combos); document.getElementById('pd-combos').className = 'pw-detail-item' + (combos > 1e15 ? ' active' : '');
    var seconds = combos / 1e9; document.getElementById('pd-time').textContent = 'Knackzeit: ' + formatTime(seconds); document.getElementById('pd-time').className = 'pw-detail-item' + (seconds > 31536000 ? ' active' : '');
}

/* ══ CONTENT: BF-Rechner (Phase 2 practice) ══ */
function calculateBF() {
    var charsetEl = document.getElementById('bfCharset'); var lengthEl = document.getElementById('bfLength');
    if (!charsetEl || !lengthEl) return;
    var charset = parseInt(charsetEl.value); var length = parseInt(lengthEl.value);
    document.getElementById('bfLengthDisplay').textContent = length;
    var combos = Math.pow(charset, length); var seconds = combos / 1e9;
    var html = '<div style="margin-bottom: 8px; color: #aaa;">Zeichensatz: ' + charset + ' | L\u00e4nge: ' + length + '</div>';
    html += '<div style="margin-bottom: 8px;">Kombinationen: <strong>' + formatNumber(combos) + '</strong></div>';
    html += '<div>Dauer bei 1 Mrd. Versuchen/Sek:</div>';
    html += '<div style="font-size: 1.4em; margin-top: 5px;"><strong>' + formatTime(seconds) + '</strong></div>';
    document.getElementById('bfResult').innerHTML = html;
}

/* ══ CONTENT: Generic MC Builder ══ */
function buildMCPhase(phaseNum, containerId, items) {
    var container = document.getElementById(containerId);
    container.innerHTML = '';
    var optRNG = createRNG(state.seed + phaseNum * 100 + 50);
    for (var q = 0; q < items.length; q++) {
        var item = items[q];
        var optIndices = []; for (var oi = 0; oi < item.options.length; oi++) optIndices.push(oi);
        var shuffledOpts = shuffleWithRNG(optIndices, optRNG);
        var qDiv = document.createElement('div');
        qDiv.className = 'mc-question'; qDiv.id = 'mc-p' + phaseNum + '-q' + q;
        qDiv.setAttribute('data-correct-shuffled', '');
        for (var ci = 0; ci < shuffledOpts.length; ci++) { if (shuffledOpts[ci] === item.correct) { qDiv.setAttribute('data-correct-shuffled', ci); break; } }
        var html = '<p style="font-weight:600; margin-bottom: 8px;">Frage ' + (q+1) + ':</p>';
        html += '<p>' + escapeHTML(item.text) + '</p>';
        html += '<div class="mc-options" id="mc-opts-p' + phaseNum + '-q' + q + '">';
        var letters = ['A', 'B', 'C', 'D'];
        for (var o = 0; o < shuffledOpts.length; o++) {
            html += '<div class="mc-option" data-opt="' + o + '" onclick="selectMCOption(' + phaseNum + ',' + q + ',' + o + ')">';
            html += '<strong>' + letters[o] + ')</strong>&nbsp; ' + escapeHTML(item.options[shuffledOpts[o]]);
            html += '</div>';
        }
        html += '</div>';
        qDiv.innerHTML = html;
        container.appendChild(qDiv);
    }
}

function selectMCOption(phaseNum, qIdx, optIdx) {
    var optsContainer = document.getElementById('mc-opts-p' + phaseNum + '-q' + qIdx);
    if (!optsContainer) return;
    var opts = optsContainer.querySelectorAll('.mc-option');
    for (var i = 0; i < opts.length; i++) opts[i].classList.remove('selected');
    opts[optIdx].classList.add('selected');
    saveInputSnapshot();
}

function submitMCPhase(phaseNum, items) {
    var key = 'p' + phaseNum;
    if (state.submitted[key]) return;
    var score = 0; var belegItems = [];
    for (var q = 0; q < items.length; q++) {
        var qDiv = document.getElementById('mc-p' + phaseNum + '-q' + q);
        var correctIdx = parseInt(qDiv.getAttribute('data-correct-shuffled'));
        var opts = document.getElementById('mc-opts-p' + phaseNum + '-q' + q).querySelectorAll('.mc-option');
        var selectedIdx = -1;
        for (var i = 0; i < opts.length; i++) { if (opts[i].classList.contains('selected')) { selectedIdx = i; break; } }
        var isCorrect = (selectedIdx === correctIdx);
        if (isCorrect) score++;
        // Visual feedback
        for (var i = 0; i < opts.length; i++) { opts[i].classList.add('disabled'); }
        if (selectedIdx >= 0) {
            opts[selectedIdx].classList.add(isCorrect ? 'correct-reveal' : 'wrong-reveal');
        }
        opts[correctIdx].classList.add('correct-reveal');
        // Beleg
        var optRNG = createRNG(state.seed + phaseNum * 100 + 50);
        // Re-derive shuffled options for this question
        var tempRNG = createRNG(state.seed + phaseNum * 100 + 50);
        for (var skip = 0; skip < q; skip++) { var tempArr = [0,1,2,3]; shuffleWithRNG(tempArr, tempRNG); }
        var optIndices2 = []; for (var oi = 0; oi < items[q].options.length; oi++) optIndices2.push(oi);
        var shuffledOpts2 = shuffleWithRNG(optIndices2, tempRNG);
        var givenText = selectedIdx >= 0 ? items[q].options[shuffledOpts2[selectedIdx]] : '(keine Antwort)';
        var correctText = items[q].options[items[q].correct];
        var allOptTexts = [];
        for (var oi = 0; oi < shuffledOpts2.length; oi++) allOptTexts.push(items[q].options[shuffledOpts2[oi]]);
        belegItems.push({ q: items[q].text, options: allOptTexts, correct: correctText, given: givenText, be: isCorrect ? 1 : 0, maxBE: 1, explain: items[q].fb });
    }
    state.scores[key] = score;
    state.submitted[key] = true;
    state.beleg.push({ phase: phaseNum, phaseName: PHASE_CONFIG[phaseNum-1].name, items: belegItems, phBE: score, phMaxBE: PHASE_CONFIG[phaseNum-1].maxBE });
    var fb = document.getElementById('fb-assess' + phaseNum);
    fb.className = 'feedback ' + (score > 0 ? 'correct' : 'incorrect');
    fb.textContent = score + '/' + PHASE_CONFIG[phaseNum-1].maxBE + ' BE';
    lockZone('assess' + phaseNum);
    document.getElementById('btn-next' + phaseNum).disabled = false;
    saveState();
}

/* ══ CONTENT: Phase 4 PW-Cards ══ */
function buildPWCards() {
    var container = document.getElementById('assess4-container');
    container.innerHTML = '';
    phase4Answered = 0; phase4BelegItems = []; pwReasonSelections = {};
    for (var i = 0; i < myPhase4Cards.length; i++) {
        var pw = myPhase4Cards[i];
        var cardRNG = createRNG(state.seed + 400 + 50 + i * 100);
        var reasonIndices = [0, 1, 2, 3];
        var shuffledRI = shuffleWithRNG(reasonIndices, cardRNG);
        var correctReasonShuffled = -1;
        for (var ri = 0; ri < shuffledRI.length; ri++) { if (shuffledRI[ri] === pw.correctReason) { correctReasonShuffled = ri; break; } }
        var card = document.createElement('div');
        card.className = 'pw-card'; card.id = 'pw-card-' + i;
        card.setAttribute('data-secure', pw.secure ? '1' : '0');
        card.setAttribute('data-correct-reason', correctReasonShuffled);
        var letters = ['A', 'B', 'C', 'D'];
        var reasonsHTML = '';
        for (var r = 0; r < shuffledRI.length; r++) {
            reasonsHTML += '<button class="pw-reason-btn" onclick="selectPWReason(' + i + ',' + r + ')">';
            reasonsHTML += '<span class="letter">' + letters[r] + '</span>';
            reasonsHTML += '<span>' + escapeHTML(pw.reasons[shuffledRI[r]]) + '</span></button>';
        }
        card.innerHTML = '<div class="q-header"><span class="q-number">Passwort ' + (i+1) + '</span><span class="q-points">1 BE</span></div>' +
            '<div class="pw-display">' + escapeHTML(pw.pw) + '</div>' +
            '<div class="pw-step1" id="pw-step1-' + i + '"><p style="font-weight:600;margin-bottom:8px;">Schritt 1: Ist dieses Passwort sicher oder unsicher?</p>' +
            '<div class="pw-buttons"><button class="pw-btn" onclick="selectPWRating(' + i + ',true)">Sicher</button><button class="pw-btn" onclick="selectPWRating(' + i + ',false)">Unsicher</button></div></div>' +
            '<div class="pw-step2" id="pw-step2-' + i + '" style="display:none;"><p style="font-weight:600;margin:12px 0 8px 0;">Schritt 2: Begr\u00fcnde deine Einsch\u00e4tzung:</p>' +
            '<div class="pw-reasons" id="pw-reasons-' + i + '">' + reasonsHTML + '</div>' +
            '<div style="text-align:center;margin-top:12px;"><button class="pw-submit" id="pw-submit-' + i + '" onclick="submitPW(' + i + ')" disabled>Antwort abgeben</button></div></div>' +
            '<div class="pw-feedback" id="pw-fb-' + i + '"></div>';
        container.appendChild(card);
    }
}

function selectPWRating(cardIdx, isSecure) {
    var card = document.getElementById('pw-card-' + cardIdx);
    if (card.classList.contains('answered')) return;
    if (state.hypotheses['pw-step1-' + cardIdx] !== undefined) return;
    state.hypotheses['pw-step1-' + cardIdx] = isSecure;
    var step1 = document.getElementById('pw-step1-' + cardIdx);
    var buttons = step1.querySelectorAll('.pw-btn');
    for (var i = 0; i < buttons.length; i++) buttons[i].classList.add('disabled');
    buttons[isSecure ? 0 : 1].classList.add('selected');
    document.getElementById('pw-step2-' + cardIdx).style.display = 'block';
    saveState();
}

function selectPWReason(cardIdx, reasonIdx) {
    var card = document.getElementById('pw-card-' + cardIdx);
    if (card.classList.contains('answered')) return;
    var reasons = document.getElementById('pw-reasons-' + cardIdx).querySelectorAll('.pw-reason-btn');
    for (var i = 0; i < reasons.length; i++) reasons[i].classList.remove('selected');
    reasons[reasonIdx].classList.add('selected');
    pwReasonSelections[cardIdx] = reasonIdx;
    document.getElementById('pw-submit-' + cardIdx).disabled = false;
}

function submitPW(cardIdx) {
    var card = document.getElementById('pw-card-' + cardIdx);
    if (card.classList.contains('answered')) return;
    if (state.hypotheses['pw-step1-' + cardIdx] === undefined) return;
    if (pwReasonSelections[cardIdx] === undefined) return;
    var isActuallySecure = card.getAttribute('data-secure') === '1';
    var correctReasonIdx = parseInt(card.getAttribute('data-correct-reason'));
    var selectedSecure = state.hypotheses['pw-step1-' + cardIdx];
    var selectedReason = pwReasonSelections[cardIdx];
    var step1Correct = (selectedSecure === isActuallySecure);
    var step2Correct = (selectedReason === correctReasonIdx);
    var bothCorrect = step1Correct && step2Correct;
    card.classList.add('answered');
    var reasons = document.getElementById('pw-reasons-' + cardIdx).querySelectorAll('.pw-reason-btn');
    for (var i = 0; i < reasons.length; i++) reasons[i].classList.add('disabled');
    document.getElementById('pw-submit-' + cardIdx).disabled = true;
    var step1Buttons = document.getElementById('pw-step1-' + cardIdx).querySelectorAll('.pw-btn');
    var ratingBtnIdx = selectedSecure ? 0 : 1;
    step1Buttons[ratingBtnIdx].classList.remove('selected');
    step1Buttons[ratingBtnIdx].classList.add(step1Correct ? 'chosen-correct' : 'chosen-wrong');
    reasons[selectedReason].classList.remove('selected');
    reasons[selectedReason].classList.add(step2Correct ? 'chosen-correct' : 'chosen-wrong');
    if (!step2Correct) reasons[correctReasonIdx].classList.add('show-correct');
    if (bothCorrect) state.scores.p4++;
    var fb = document.getElementById('pw-fb-' + cardIdx);
    fb.className = 'pw-feedback visible';
    if (bothCorrect) { fb.style.background = 'var(--success-bg)'; fb.style.borderLeft = '3px solid var(--success)'; fb.innerHTML = '<strong>1 BE</strong> - Bewertung und Begr\u00fcndung richtig!'; }
    else { fb.style.background = 'var(--error-bg)'; fb.style.borderLeft = '3px solid var(--error)'; var msg = '<strong>0 BE</strong> - '; if (!step1Correct && !step2Correct) msg += 'Bewertung und Begr\u00fcndung falsch.'; else if (!step1Correct) msg += 'Bewertung falsch.'; else msg += 'Begr\u00fcndung falsch.'; fb.innerHTML = msg; }
    phase4BelegItems.push({ q: 'Passwort: ' + myPhase4Cards[cardIdx].pw, options: ['Sicher', 'Unsicher'], correct: isActuallySecure ? 'Sicher' : 'Unsicher', given: selectedSecure ? 'Sicher' : 'Unsicher', be: bothCorrect ? 1 : 0, maxBE: 1, explain: 'Bewertung: ' + (step1Correct ? 'richtig' : 'falsch') + ', Begr\u00fcndung: ' + (step2Correct ? 'richtig' : 'falsch') });
    phase4Answered++;
    if (phase4Answered >= 5) {
        state.submitted.p4 = true;
        state.beleg.push({ phase: 4, phaseName: PHASE_CONFIG[3].name, items: phase4BelegItems, phBE: state.scores.p4, phMaxBE: PHASE_CONFIG[3].maxBE });
        var fbA = document.getElementById('fb-assess4');
        fbA.className = 'feedback ' + (state.scores.p4 > 0 ? 'correct' : 'incorrect');
        fbA.textContent = state.scores.p4 + '/' + PHASE_CONFIG[3].maxBE + ' BE';
        document.getElementById('btn-next4').disabled = false;
    }
    saveState();
}


/* ══ CONTENT: buildPhase1-6 ══ */
function buildPhase1() { buildMCPhase(1, 'assess1-container', myPhase1Items); }
function buildPhase2() { buildMCPhase(2, 'assess2-container', myPhase2Items); }
function buildPhase3() { buildMCPhase(3, 'assess3-container', myPhase3Items); }
function buildPhase4() { buildPWCards(); }
function buildPhase5() { buildMCPhase(5, 'assess5-container', myPhase5Items); }
function buildPhase6() { buildMCPhase(6, 'assess6-container', myPhase6Items); }

/* ══ CONTENT: submitPhase1-6 ══ */
function submitPhase1() { submitMCPhase(1, myPhase1Items); }
function submitPhase2() { submitMCPhase(2, myPhase2Items); }
function submitPhase3() { submitMCPhase(3, myPhase3Items); }
// Phase 4: handled by submitPW() auto-completing
function submitPhase5() { submitMCPhase(5, myPhase5Items); }
function submitPhase6() { submitMCPhase(6, myPhase6Items); }

/* ══ CONTENT: freezeExperiment (not used) ══ */
function freezeExperiment() {}

/* ── TEMPLATE: Auto-Save ── */
document.addEventListener('input', function(e) { if (e.target.matches('input, select')) { saveInputSnapshot(); saveState(); } });

/* ── Start / Restore ── */
function getPlatzFromURL() { var search = window.location.search || ''; var match = search.match(/[?&]p=(\d+)/); return match ? parseInt(match[1]) : 0; }

function startLP() {
    var sel = document.getElementById('platzSelect');
    var platz = parseInt(sel.value);
    if (!platz || platz < 1) { alert('Bitte w\u00e4hle deine Platzkarten-Nummer!'); return; }
    if (!getPlatzFromURL()) { history.replaceState(null, '', window.location.pathname + '?p=' + platz); }
    state.name = 'Platz ' + platz;
    state.seed = platz * 7919;
    state.startTime = new Date().toISOString();
    try { initAudioContext(); } catch(e) {}
    buildPersonalTasks();
    buildPhase1(); buildPhase2(); buildPhase3(); buildPhase4(); buildPhase5(); buildPhase6();
    saveState(); goToPhase(1); sessionReady = true;
}

function restoreSession() {
    buildPersonalTasks();
    buildPhase1(); buildPhase2(); buildPhase3(); buildPhase4(); buildPhase5(); buildPhase6();
    loadInputSnapshot();
    // Restore MC phases
    var mcPhases = [1, 2, 3, 5, 6];
    for (var m = 0; m < mcPhases.length; m++) {
        var pn = mcPhases[m];
        if (state.submitted['p' + pn]) {
            lockZone('assess' + pn);
            var nextBtn = document.getElementById('btn-next' + pn);
            if (nextBtn) nextBtn.disabled = false;
        }
    }
    // Restore Phase 4 PW cards
    if (state.submitted.p4) {
        // All 5 answered - lock everything
        for (var ci = 0; ci < 5; ci++) {
            var card = document.getElementById('pw-card-' + ci);
            if (card) card.classList.add('answered');
            var reasons = document.getElementById('pw-reasons-' + ci);
            if (reasons) { var rbtns = reasons.querySelectorAll('.pw-reason-btn'); for (var rb = 0; rb < rbtns.length; rb++) rbtns[rb].classList.add('disabled'); }
            var submit = document.getElementById('pw-submit-' + ci);
            if (submit) submit.disabled = true;
            var step1Btns = document.getElementById('pw-step1-' + ci);
            if (step1Btns) { var btns = step1Btns.querySelectorAll('.pw-btn'); for (var b = 0; b < btns.length; b++) btns[b].classList.add('disabled'); }
            var step2 = document.getElementById('pw-step2-' + ci);
            if (step2) step2.style.display = 'block';
        }
        var fb4 = document.getElementById('fb-assess4');
        fb4.className = 'feedback ' + (state.scores.p4 > 0 ? 'correct' : 'incorrect');
        fb4.textContent = state.scores.p4 + '/' + PHASE_CONFIG[3].maxBE + ' BE';
        document.getElementById('btn-next4').disabled = false;
    } else {
        // Restore partial PW card answers (step1 done but not submitted)
        for (var idx in state.hypotheses) {
            if (!state.hypotheses.hasOwnProperty(idx)) continue;
            if (idx.indexOf('pw-step1-') !== 0) continue;
            var ci2 = parseInt(idx.replace('pw-step1-', ''));
            var card2 = document.getElementById('pw-card-' + ci2);
            if (!card2 || card2.classList.contains('answered')) continue;
            var isSecure = state.hypotheses[idx];
            var s1Btns = document.getElementById('pw-step1-' + ci2).querySelectorAll('.pw-btn');
            for (var b2 = 0; b2 < s1Btns.length; b2++) s1Btns[b2].classList.add('disabled');
            s1Btns[isSecure ? 0 : 1].classList.add('selected');
            document.getElementById('pw-step2-' + ci2).style.display = 'block';
        }
    }
    if (state.completed) { document.getElementById('lockedNotice').classList.add('visible'); showResults(); }
    else { goToPhase(state.currentPhase || 1); }
    sessionReady = true;
}

/* ── window.onload ── */
window.onload = function() {
    var hintBE = document.getElementById('hintBE');
    if (hintBE) hintBE.textContent = TOTAL_BE;
    var sel = document.getElementById('platzSelect');
    for (var i = 1; i <= 30; i++) { var opt = document.createElement('option'); opt.value = i; opt.textContent = 'P' + i; sel.appendChild(opt); }
    var urlPlatz = getPlatzFromURL();
    if (urlPlatz >= 1 && urlPlatz <= 30) sel.value = urlPlatz;
    if (loadState()) { try { initAudioContext(); } catch(e) {} restoreSession(); }
    initTabTracking();
};
</script>
</body>
</html>
