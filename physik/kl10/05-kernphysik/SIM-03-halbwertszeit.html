<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halbwertszeit – Simulation</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
            color: #222;
            font-size: 0.9em;
            line-height: 1.5;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            font-size: 1.4em;
            font-weight: 600;
            color: #2c5aa0;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #888;
            font-size: 0.85em;
            margin-bottom: 20px;
        }
        .sim-container {
            background: #fff;
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
        }
        .sim-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        canvas {
            display: block;
            background: #fff;
            border: 1px solid #ddd;
            width: 100%;
        }
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
            align-items: center;
        }
        button {
            background: #2c5aa0;
            color: #fff;
            border: none;
            padding: 8px 16px;
            font-size: 0.85em;
            cursor: pointer;
        }
        button:hover {
            background: #1e4080;
        }
        select {
            padding: 8px 12px;
            font-size: 0.85em;
            border: 1px solid #ddd;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        .stat {
            background: #f0f0f0;
            padding: 10px;
            text-align: center;
        }
        .stat-label {
            font-size: 0.8em;
            color: #555;
        }
        .stat-value {
            font-size: 1.4em;
            font-weight: 600;
            color: #2c5aa0;
        }
        .atom-grid {
            display: grid;
            grid-template-columns: repeat(20, 1fr);
            gap: 2px;
            padding: 10px;
            background: #1a1a2e;
        }
        .atom {
            aspect-ratio: 1;
            border-radius: 50%;
            transition: background 0.3s, transform 0.3s;
        }
        .atom.active {
            background: #c62828;
        }
        .atom.decayed {
            background: #2a7a4b;
            transform: scale(0.7);
        }
        .legend {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            font-size: 0.8em;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .info-box {
            background: #fff;
            border: 1px solid #ddd;
            padding: 15px;
            margin-top: 15px;
        }
        .info-box h3 {
            font-size: 1em;
            color: #2c5aa0;
            margin-bottom: 8px;
        }
        .formula {
            font-family: serif;
            font-size: 1.2em;
            text-align: center;
            padding: 15px;
            background: #f5f5f5;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Radioaktiver Zerfall & Halbwertszeit</h1>
        <p class="subtitle">Beobachte, wie radioaktive Kerne statistisch zerfallen</p>

        <div class="sim-container">
            <div class="controls">
                <button id="btnStart">▶ Starten</button>
                <button id="btnReset">↺ Reset</button>
                <select id="hwz">
                    <option value="1">T½ = 1 Sekunde</option>
                    <option value="2" selected>T½ = 2 Sekunden</option>
                    <option value="5">T½ = 5 Sekunden</option>
                </select>
                <select id="atoms">
                    <option value="100">100 Atome</option>
                    <option value="200" selected>200 Atome</option>
                    <option value="400">400 Atome</option>
                </select>
            </div>

            <div class="sim-grid">
                <div>
                    <div class="atom-grid" id="atomGrid"></div>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #c62828;"></div>
                            <span>Noch nicht zerfallen</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #2a7a4b;"></div>
                            <span>Zerfallen</span>
                        </div>
                    </div>
                </div>
                <div>
                    <canvas id="chart" width="400" height="280"></canvas>
                </div>
            </div>

            <div class="stats">
                <div class="stat">
                    <div class="stat-label">Zeit</div>
                    <div class="stat-value"><span id="time">0.0</span> s</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Noch aktiv</div>
                    <div class="stat-value"><span id="remaining">200</span></div>
                </div>
                <div class="stat">
                    <div class="stat-label">Zerfallen</div>
                    <div class="stat-value"><span id="decayed">0</span></div>
                </div>
                <div class="stat">
                    <div class="stat-label">Halbwertszeiten</div>
                    <div class="stat-value"><span id="hwzCount">0</span></div>
                </div>
            </div>
        </div>

        <div class="info-box">
            <h3>Das Zerfallsgesetz</h3>
            <div class="formula">
                N(t) = N₀ · (½)<sup>t/T½</sup>
            </div>
            <p>
                <strong>N(t)</strong> = Anzahl der Kerne zur Zeit t<br>
                <strong>N₀</strong> = Anfangsanzahl<br>
                <strong>T½</strong> = Halbwertszeit (stoffspezifisch)
            </p>
            <p style="margin-top: 10px;">
                <strong>Wichtig:</strong> Der Zerfall einzelner Kerne ist zufällig! Nur bei vielen Kernen sieht man das statistische Gesetz.
            </p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('chart');
        const ctx = canvas.getContext('2d');

        // State
        let atoms = [];
        let running = false;
        let time = 0;
        let dataPoints = [];
        let animationId = null;
        let lastUpdate = 0;

        // Settings
        let hwz = 2;
        let totalAtoms = 200;

        // Initialize atoms
        function initAtoms() {
            atoms = [];
            const grid = document.getElementById('atomGrid');
            grid.innerHTML = '';

            for (let i = 0; i < totalAtoms; i++) {
                const atom = document.createElement('div');
                atom.className = 'atom active';
                atom.dataset.index = i;
                grid.appendChild(atom);
                atoms.push({ element: atom, decayed: false });
            }
        }

        // Decay probability per frame (based on half-life)
        function getDecayProbability(dt) {
            // λ = ln(2) / T½
            const lambda = Math.log(2) / hwz;
            // Probability to decay in time dt: 1 - e^(-λ·dt)
            return 1 - Math.exp(-lambda * dt);
        }

        // Update simulation
        function update(timestamp) {
            if (!running) return;

            const dt = (timestamp - lastUpdate) / 1000;
            lastUpdate = timestamp;

            if (dt > 0 && dt < 1) { // Sanity check
                time += dt;

                // Decay atoms
                const prob = getDecayProbability(dt);
                atoms.forEach(atom => {
                    if (!atom.decayed && Math.random() < prob) {
                        atom.decayed = true;
                        atom.element.classList.remove('active');
                        atom.element.classList.add('decayed');
                    }
                });

                // Record data point
                const remaining = atoms.filter(a => !a.decayed).length;
                if (dataPoints.length === 0 || time - dataPoints[dataPoints.length-1].t > 0.1) {
                    dataPoints.push({ t: time, n: remaining });
                }

                updateStats();
                drawChart();
            }

            animationId = requestAnimationFrame(update);
        }

        // Update statistics display
        function updateStats() {
            const remaining = atoms.filter(a => !a.decayed).length;
            const decayed = totalAtoms - remaining;

            document.getElementById('time').textContent = time.toFixed(1);
            document.getElementById('remaining').textContent = remaining;
            document.getElementById('decayed').textContent = decayed;
            document.getElementById('hwzCount').textContent = (time / hwz).toFixed(1);
        }

        // Draw chart
        function drawChart() {
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, 400, 280);

            // Axes
            const margin = { left: 50, right: 20, top: 20, bottom: 40 };
            const chartW = 400 - margin.left - margin.right;
            const chartH = 280 - margin.top - margin.bottom;

            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;

            // Grid lines
            for (let i = 0; i <= 4; i++) {
                const y = margin.top + (i * chartH / 4);
                ctx.beginPath();
                ctx.moveTo(margin.left, y);
                ctx.lineTo(margin.left + chartW, y);
                ctx.stroke();
            }

            // Axes
            ctx.strokeStyle = '#222';
            ctx.beginPath();
            ctx.moveTo(margin.left, margin.top);
            ctx.lineTo(margin.left, margin.top + chartH);
            ctx.lineTo(margin.left + chartW, margin.top + chartH);
            ctx.stroke();

            // Labels
            ctx.fillStyle = '#555';
            ctx.font = '11px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Zeit (s)', margin.left + chartW / 2, 275);

            ctx.save();
            ctx.translate(15, margin.top + chartH / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Anzahl N', 0, 0);
            ctx.restore();

            // Y-axis labels
            ctx.textAlign = 'right';
            for (let i = 0; i <= 4; i++) {
                const val = totalAtoms * (4 - i) / 4;
                const y = margin.top + (i * chartH / 4);
                ctx.fillText(val.toString(), margin.left - 5, y + 4);
            }

            // Theoretical curve (dashed)
            const maxTime = Math.max(10, time + 2);
            ctx.strokeStyle = '#888';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            for (let t = 0; t <= maxTime; t += 0.1) {
                const n = totalAtoms * Math.pow(0.5, t / hwz);
                const x = margin.left + (t / maxTime) * chartW;
                const y = margin.top + (1 - n / totalAtoms) * chartH;
                if (t === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            ctx.setLineDash([]);

            // Data points
            if (dataPoints.length > 1) {
                ctx.strokeStyle = '#2c5aa0';
                ctx.lineWidth = 2;
                ctx.beginPath();
                dataPoints.forEach((p, i) => {
                    const x = margin.left + (p.t / maxTime) * chartW;
                    const y = margin.top + (1 - p.n / totalAtoms) * chartH;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                ctx.stroke();

                // Current point
                const last = dataPoints[dataPoints.length - 1];
                const x = margin.left + (last.t / maxTime) * chartW;
                const y = margin.top + (1 - last.n / totalAtoms) * chartH;
                ctx.fillStyle = '#c62828';
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fill();
            }

            // Legend
            ctx.font = '10px sans-serif';
            ctx.fillStyle = '#888';
            ctx.textAlign = 'left';
            ctx.fillText('--- Theorie', margin.left + 10, margin.top + 15);
            ctx.fillStyle = '#2c5aa0';
            ctx.fillText('— Messung', margin.left + 10, margin.top + 30);
        }

        // Event listeners
        document.getElementById('btnStart').addEventListener('click', function() {
            running = !running;
            this.textContent = running ? '⏸ Pause' : '▶ Starten';

            if (running) {
                lastUpdate = performance.now();
                animationId = requestAnimationFrame(update);
            } else if (animationId) {
                cancelAnimationFrame(animationId);
            }
        });

        document.getElementById('btnReset').addEventListener('click', function() {
            running = false;
            document.getElementById('btnStart').textContent = '▶ Starten';
            if (animationId) cancelAnimationFrame(animationId);

            time = 0;
            dataPoints = [{ t: 0, n: totalAtoms }];
            initAtoms();
            updateStats();
            drawChart();
        });

        document.getElementById('hwz').addEventListener('change', function() {
            hwz = parseFloat(this.value);
        });

        document.getElementById('atoms').addEventListener('change', function() {
            totalAtoms = parseInt(this.value);
            document.getElementById('btnReset').click();
        });

        // Initialize
        initAtoms();
        dataPoints = [{ t: 0, n: totalAtoms }];
        updateStats();
        drawChart();
    </script>
</body>
</html>
