<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waagerechter Wurf – Simulation</title>
    <style>
        :root {
            --bg: #f5f5f5;
            --white: #ffffff;
            --border: #dddddd;
            --text-primary: #222222;
            --text-secondary: #555555;
            --text-muted: #888888;
            --physik: #2c5aa0;
            --physik-light: #e8f0fa;
            --ball-fall: #1565c0;
            --ball-wurf: #c62828;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 0.9em;
            background: var(--bg);
            color: var(--text-primary);
            line-height: 1.5;
        }

        .container {
            max-width: 750px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--physik);
        }

        .sim-wrapper {
            background: var(--white);
            border: 1px solid var(--border);
            padding: 15px;
        }

        canvas {
            display: block;
            width: 100%;
            background: #fafafa;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .control-group {
            flex: 1;
            min-width: 140px;
        }

        .control-group label {
            display: block;
            font-size: 0.8em;
            color: var(--text-secondary);
            margin-bottom: 3px;
        }

        .control-group .value {
            font-family: "SF Mono", Monaco, monospace;
            font-size: 1em;
            color: var(--physik);
            font-weight: 600;
        }

        input[type="range"] {
            width: 100%;
            margin: 5px 0;
        }

        .btn-group {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }

        .btn {
            padding: 8px 16px;
            background: var(--physik);
            color: white;
            border: none;
            font-size: 0.85em;
            cursor: pointer;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn-secondary {
            background: var(--white);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .info-bar {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding: 10px;
            background: var(--physik-light);
            border: 1px solid var(--physik);
            font-size: 0.85em;
        }

        .info-item {
            text-align: center;
        }

        .info-item .label {
            color: var(--text-secondary);
            font-size: 0.8em;
        }

        .info-item .value {
            font-family: "SF Mono", Monaco, monospace;
            font-weight: 600;
            font-size: 1.1em;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            font-size: 0.8em;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .result-message {
            margin-top: 15px;
            padding: 12px;
            background: #e8f5e9;
            border: 1px solid #4caf50;
            font-size: 0.9em;
            display: none;
        }

        .result-message.show {
            display: block;
        }

        .checkbox-row {
            margin-top: 10px;
            font-size: 0.85em;
        }

        .checkbox-row label {
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Waagerechter Wurf</h1>

        <div class="sim-wrapper">
            <canvas id="canvas" width="700" height="400"></canvas>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-dot" style="background: var(--ball-fall);"></div>
                    <span>Fallball (fällt senkrecht)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: var(--ball-wurf);"></div>
                    <span>Wurfball (waagerecht geworfen)</span>
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>Höhe h₀</label>
                    <span class="value" id="heightValue">20 m</span>
                    <input type="range" id="heightSlider" min="5" max="80" value="20" step="5">
                </div>

                <div class="control-group">
                    <label>Geschwindigkeit v₀</label>
                    <span class="value" id="velocityValue">15 m/s</span>
                    <input type="range" id="velocitySlider" min="5" max="30" value="15" step="5">
                </div>

                <div class="btn-group">
                    <button class="btn" id="startBtn">▶ Start</button>
                    <button class="btn btn-secondary" id="resetBtn">↺ Reset</button>
                </div>
            </div>

            <div class="checkbox-row">
                <label>
                    <input type="checkbox" id="showStroboscope">
                    Stroboskop-Effekt (Positionen alle 0,5 s)
                </label>
            </div>

            <div class="info-bar">
                <div class="info-item">
                    <div class="label">Zeit</div>
                    <div class="value" id="timeDisplay">0,00 s</div>
                </div>
                <div class="info-item">
                    <div class="label">Fallzeit</div>
                    <div class="value" id="fallTimeDisplay">– s</div>
                </div>
                <div class="info-item">
                    <div class="label">Wurfweite</div>
                    <div class="value" id="rangeDisplay">– m</div>
                </div>
            </div>

            <div class="result-message" id="resultMessage">
                <strong>Beobachtung:</strong> Beide Bälle landen <strong>gleichzeitig</strong>!<br>
                Die horizontale Geschwindigkeit beeinflusst die Fallzeit nicht.
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Physics
        const g = 10; // m/s²

        // State
        let h0 = 20;
        let v0 = 15;
        let isRunning = false;
        let animationId = null;
        let currentTime = 0;
        let stroboscopePositions = [];

        // Scale
        const scale = 4.5;
        const originX = 80;
        const groundY = 380;

        // Elements
        const heightSlider = document.getElementById('heightSlider');
        const velocitySlider = document.getElementById('velocitySlider');
        const heightValue = document.getElementById('heightValue');
        const velocityValue = document.getElementById('velocityValue');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const showStroboscope = document.getElementById('showStroboscope');
        const timeDisplay = document.getElementById('timeDisplay');
        const fallTimeDisplay = document.getElementById('fallTimeDisplay');
        const rangeDisplay = document.getElementById('rangeDisplay');
        const resultMessage = document.getElementById('resultMessage');

        function worldToCanvas(x, y) {
            return {
                cx: originX + x * scale,
                cy: groundY - y * scale
            };
        }

        function drawBackground() {
            // Sky
            ctx.fillStyle = '#fafafa';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Ground
            ctx.fillStyle = '#e0e0e0';
            ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);

            // Ground line
            ctx.strokeStyle = '#888';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, groundY);
            ctx.lineTo(canvas.width, groundY);
            ctx.stroke();

            // Platform
            const platformY = worldToCanvas(0, h0).cy;
            ctx.fillStyle = '#555';
            ctx.fillRect(0, platformY - 4, originX + 10, 8);

            // Height indicator
            ctx.strokeStyle = '#aaa';
            ctx.lineWidth = 1;
            ctx.setLineDash([4, 4]);
            ctx.beginPath();
            ctx.moveTo(40, platformY);
            ctx.lineTo(40, groundY);
            ctx.stroke();
            ctx.setLineDash([]);

            // Height label
            ctx.fillStyle = '#555';
            ctx.font = '12px -apple-system, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('h = ' + h0 + ' m', 40, (platformY + groundY) / 2 + 4);

            // Scale markers
            ctx.fillStyle = '#888';
            ctx.font = '10px -apple-system, sans-serif';
            ctx.textAlign = 'center';
            for (let x = 0; x <= 120; x += 20) {
                const pos = worldToCanvas(x, 0);
                if (pos.cx < canvas.width - 20) {
                    ctx.beginPath();
                    ctx.moveTo(pos.cx, groundY);
                    ctx.lineTo(pos.cx, groundY + 5);
                    ctx.stroke();
                    ctx.fillText(x + ' m', pos.cx, groundY + 16);
                }
            }
        }

        function drawStroboscope() {
            if (!showStroboscope.checked) return;

            stroboscopePositions.forEach((pos, i) => {
                const alpha = 0.3 + (i / stroboscopePositions.length) * 0.4;

                // Fall ball
                const fallPos = worldToCanvas(0, h0 - pos.y);
                ctx.fillStyle = `rgba(21, 101, 192, ${alpha})`;
                ctx.beginPath();
                ctx.arc(originX, fallPos.cy, 8, 0, Math.PI * 2);
                ctx.fill();

                // Throw ball
                const throwPos = worldToCanvas(pos.x, h0 - pos.y);
                ctx.fillStyle = `rgba(198, 40, 40, ${alpha})`;
                ctx.beginPath();
                ctx.arc(throwPos.cx, throwPos.cy, 8, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function drawBalls(t) {
            const fallTime = Math.sqrt(2 * h0 / g);
            const clampedT = Math.min(t, fallTime);

            const y = 0.5 * g * clampedT * clampedT;
            const x = v0 * clampedT;

            // Traces
            ctx.strokeStyle = 'rgba(21, 101, 192, 0.3)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(originX, worldToCanvas(0, h0).cy);
            ctx.lineTo(originX, worldToCanvas(0, h0 - y).cy);
            ctx.stroke();

            ctx.strokeStyle = 'rgba(198, 40, 40, 0.3)';
            ctx.beginPath();
            const steps = 50;
            for (let i = 0; i <= steps; i++) {
                const tt = (clampedT * i) / steps;
                const xx = v0 * tt;
                const yy = 0.5 * g * tt * tt;
                const pos = worldToCanvas(xx, h0 - yy);
                if (i === 0) ctx.moveTo(pos.cx, pos.cy);
                else ctx.lineTo(pos.cx, pos.cy);
            }
            ctx.stroke();

            // Fall ball (blue)
            const fallPos = worldToCanvas(0, h0 - y);
            ctx.fillStyle = '#1565c0';
            ctx.beginPath();
            ctx.arc(originX, fallPos.cy, 12, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = 'rgba(255,255,255,0.3)';
            ctx.beginPath();
            ctx.arc(originX - 4, fallPos.cy - 4, 4, 0, Math.PI * 2);
            ctx.fill();

            // Throw ball (red)
            const throwPos = worldToCanvas(x, h0 - y);
            ctx.fillStyle = '#c62828';
            ctx.beginPath();
            ctx.arc(throwPos.cx, throwPos.cy, 12, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = 'rgba(255,255,255,0.3)';
            ctx.beginPath();
            ctx.arc(throwPos.cx - 4, throwPos.cy - 4, 4, 0, Math.PI * 2);
            ctx.fill();

            // Horizontal dashed line connecting both
            if (t < fallTime) {
                ctx.strokeStyle = '#aaa';
                ctx.lineWidth = 1;
                ctx.setLineDash([4, 4]);
                ctx.beginPath();
                ctx.moveTo(originX, fallPos.cy);
                ctx.lineTo(throwPos.cx, throwPos.cy);
                ctx.stroke();
                ctx.setLineDash([]);
            }
        }

        function draw() {
            drawBackground();
            drawStroboscope();
            drawBalls(currentTime);

            // Update time display
            timeDisplay.textContent = currentTime.toFixed(2).replace('.', ',') + ' s';
        }

        function animate() {
            const fallTime = Math.sqrt(2 * h0 / g);

            if (currentTime < fallTime) {
                currentTime += 0.02;

                // Stroboscope: save position every 0.5s
                if (showStroboscope.checked) {
                    const lastStrobeTime = stroboscopePositions.length * 0.5;
                    if (currentTime >= lastStrobeTime + 0.5) {
                        const t = lastStrobeTime + 0.5;
                        stroboscopePositions.push({
                            x: v0 * t,
                            y: 0.5 * g * t * t
                        });
                    }
                }

                draw();
                animationId = requestAnimationFrame(animate);
            } else {
                currentTime = fallTime;
                draw();
                isRunning = false;
                startBtn.textContent = '▶ Start';

                // Show results
                const range = v0 * fallTime;
                fallTimeDisplay.textContent = fallTime.toFixed(1).replace('.', ',') + ' s';
                rangeDisplay.textContent = range.toFixed(0) + ' m';
                resultMessage.classList.add('show');
            }
        }

        function start() {
            if (isRunning) {
                isRunning = false;
                cancelAnimationFrame(animationId);
                startBtn.textContent = '▶ Start';
            } else {
                const fallTime = Math.sqrt(2 * h0 / g);
                if (currentTime >= fallTime) {
                    reset();
                }
                isRunning = true;
                startBtn.textContent = '⏸ Pause';
                animate();
            }
        }

        function reset() {
            isRunning = false;
            cancelAnimationFrame(animationId);
            currentTime = 0;
            stroboscopePositions = [];
            startBtn.textContent = '▶ Start';
            timeDisplay.textContent = '0,00 s';
            fallTimeDisplay.textContent = '– s';
            rangeDisplay.textContent = '– m';
            resultMessage.classList.remove('show');
            draw();
        }

        // Events
        heightSlider.addEventListener('input', function() {
            h0 = parseInt(this.value);
            heightValue.textContent = h0 + ' m';
            reset();
        });

        velocitySlider.addEventListener('input', function() {
            v0 = parseInt(this.value);
            velocityValue.textContent = v0 + ' m/s';
            reset();
        });

        startBtn.addEventListener('click', start);
        resetBtn.addEventListener('click', reset);
        showStroboscope.addEventListener('change', draw);

        // Init
        draw();
    </script>
</body>
</html>
