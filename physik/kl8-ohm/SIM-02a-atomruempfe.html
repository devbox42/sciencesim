<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atomrümpfe im Metalldraht – Teufelskreis</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --physik: #2c5aa0;
            --positive: #c62828;
            --negative: #1565c0;
            --success: #2a7a4b;
            --warning: #b35c00;
            --bg: #f5f5f5;
            --white: #ffffff;
            --border: #dddddd;
            --text: #222222;
            --text-muted: #666666;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            font-size: 15px;
            line-height: 1.5;
        }

        .container {
            max-width: 950px;
            margin: 0 auto;
            padding: 15px;
        }

        h1 {
            font-size: 1.3em;
            font-weight: 600;
            color: var(--warning);
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--warning);
        }

        .main-layout {
            display: flex;
            gap: 15px;
        }

        .sim-area {
            flex: 1;
            background: var(--white);
            border: 1px solid var(--border);
            padding: 15px;
        }

        canvas {
            display: block;
            width: 100%;
            background: #1a1a2e;
            border: 1px solid var(--border);
        }

        .sidebar {
            width: 300px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .panel {
            background: var(--white);
            border: 1px solid var(--border);
            padding: 12px;
        }

        .panel h2 {
            font-size: 0.9em;
            font-weight: 600;
            color: var(--warning);
            margin-bottom: 8px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 5px;
        }

        .control-group {
            margin-bottom: 12px;
        }

        .control-group label {
            display: block;
            font-size: 0.85em;
            margin-bottom: 4px;
        }

        input[type="range"] {
            width: 100%;
            margin: 5px 0;
        }

        .value-box {
            background: var(--bg);
            border: 1px solid var(--border);
            padding: 8px;
            text-align: center;
            font-size: 1.2em;
            font-weight: 600;
            color: var(--warning);
        }

        .meters {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .meter {
            background: var(--bg);
            border: 1px solid var(--border);
            padding: 8px;
            text-align: center;
        }

        .meter .label {
            font-size: 0.7em;
            color: var(--text-muted);
        }

        .meter .value {
            font-size: 1.1em;
            font-weight: 600;
        }

        .meter.temp .value { color: #e65100; }
        .meter.collisions .value { color: var(--positive); }
        .meter.current .value { color: var(--negative); }
        .meter.resistance .value { color: var(--warning); }

        /* Teufelskreis-Diagramm */
        .teufelskreis {
            background: #fff3e0;
            border: 2px solid var(--warning);
            padding: 12px;
            text-align: center;
        }

        .teufelskreis h3 {
            font-size: 0.95em;
            color: var(--warning);
            margin-bottom: 10px;
        }

        .cycle-diagram {
            display: flex;
            flex-direction: column;
            gap: 4px;
            font-size: 0.8em;
        }

        .cycle-step {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 8px;
            background: var(--white);
            border: 1px solid var(--border);
            transition: background 0.3s, border-color 0.3s;
        }

        .cycle-step.active {
            background: #ffcc80;
            border-color: var(--warning);
            font-weight: 600;
        }

        .cycle-arrow {
            text-align: center;
            color: var(--warning);
            font-size: 1.2em;
        }

        .legend {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            font-size: 0.8em;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
        }

        .info-box {
            background: #e8f5e9;
            border: 1px solid #a5d6a7;
            padding: 10px;
            font-size: 0.85em;
        }

        @media (max-width: 750px) {
            .main-layout { flex-direction: column; }
            .sidebar { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Atomrümpfe im Metalldraht – Der Teufelskreis</h1>

        <div class="main-layout">
            <div class="sim-area">
                <canvas id="sim" width="520" height="340"></canvas>
            </div>

            <div class="sidebar">
                <div class="panel">
                    <h2>Steuerung</h2>
                    <div class="control-group">
                        <label>Spannung U einstellen:</label>
                        <input type="range" id="voltage-slider" min="0" max="12" step="1" value="0">
                        <div class="value-box" id="voltage-value">0 V</div>
                    </div>

                    <div class="meters">
                        <div class="meter temp">
                            <div class="label">Temperatur</div>
                            <div class="value" id="temp-value">20 °C</div>
                        </div>
                        <div class="meter collisions">
                            <div class="label">Kollisionen/s</div>
                            <div class="value" id="collision-value">0</div>
                        </div>
                        <div class="meter current">
                            <div class="label">Stromstärke</div>
                            <div class="value" id="current-value">0,00 A</div>
                        </div>
                        <div class="meter resistance">
                            <div class="label">Widerstand</div>
                            <div class="value" id="resistance-value">— Ω</div>
                        </div>
                    </div>
                </div>

                <div class="teufelskreis">
                    <h3>Der Teufelskreis</h3>
                    <div class="cycle-diagram">
                        <div class="cycle-step" id="step-1">1. Spannung U ↑</div>
                        <div class="cycle-arrow">↓</div>
                        <div class="cycle-step" id="step-2">2. → größerer Strom I</div>
                        <div class="cycle-arrow">↓</div>
                        <div class="cycle-step" id="step-3">3. → mehr Zusammenstöße</div>
                        <div class="cycle-arrow">↓</div>
                        <div class="cycle-step" id="step-4">4. → Rümpfe schwingen stärker (T ↑)</div>
                        <div class="cycle-arrow">↓</div>
                        <div class="cycle-step" id="step-5">5. → noch mehr Stöße → R ↑</div>
                        <div class="cycle-arrow">↺</div>
                    </div>
                </div>

                <div class="panel">
                    <h2>Legende</h2>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #ff6b35;"></div>
                            <span>Atomrumpf (+)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #1976d2;"></div>
                            <span>Elektron (−)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: rgba(100,100,100,0.5);"></div>
                            <span>Gitterplatz</span>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <strong>Erklärung:</strong> Höhere Spannung → mehr Strom → mehr Stöße mit Atomrümpfen → die schwingen stärker (Temperatur steigt) → noch mehr Kollisionen → Widerstand steigt!
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // ATOMRÜMPFE-SIMULATION (ES5)
        // Visualisiert den "Teufelskreis"
        // ============================================

        var canvas = document.getElementById('sim');
        var ctx = canvas.getContext('2d');
        var slider = document.getElementById('voltage-slider');

        // Physikalische Größen
        var U = 0;
        var I = 0;
        var R = 5; // Kaltwiderstand
        var T = 20;

        // Atomgitter
        var atoms = [];
        var atomBasePos = [];
        var atomRadius = 16;
        var gridCols = 8;
        var gridRows = 5;
        var gridSpacingX = 52;
        var gridSpacingY = 48;

        // Elektronen
        var electrons = [];
        var electronCount = 18;

        // Kollisionen zählen
        var collisionCount = 0;
        var collisionRate = 0;
        var lastRateUpdate = Date.now();

        // ============================================
        // INIT
        // ============================================

        function initAtoms() {
            atoms = [];
            atomBasePos = [];
            var startX = 55;
            var startY = 60;

            for (var row = 0; row < gridRows; row++) {
                for (var col = 0; col < gridCols; col++) {
                    var offsetX = (row % 2) * (gridSpacingX / 2);
                    var x = startX + col * gridSpacingX + offsetX;
                    var y = startY + row * gridSpacingY;
                    atoms.push({
                        x: x,
                        y: y,
                        phase: Math.random() * Math.PI * 2
                    });
                    atomBasePos.push({ x: x, y: y });
                }
            }
        }

        function initElectrons() {
            electrons = [];
            for (var i = 0; i < electronCount; i++) {
                electrons.push({
                    x: Math.random() * canvas.width,
                    y: 50 + Math.random() * 220,
                    vx: 0.3,
                    vy: (Math.random() - 0.5) * 2
                });
            }
        }

        // ============================================
        // PHYSICS UPDATE
        // ============================================

        function update() {
            var now = Date.now();

            // Kollisionsrate pro Sekunde
            if (now - lastRateUpdate > 1000) {
                collisionRate = collisionCount;
                collisionCount = 0;
                lastRateUpdate = now;
            }

            // Physikalisches Modell
            updatePhysics();

            // Atomschwingung um feste Gitterposition (thermische Schwingung)
            // Amplitude: max ~6 Pixel bei 2900°C (dezent, nicht "schmelzend")
            var amplitude = Math.min(6, Math.max(0, (T - 20) / 500) * 6);
            var freq = 0.02 + T / 5000; // Schnellere Schwingung bei höherer T

            for (var i = 0; i < atoms.length; i++) {
                atoms[i].phase += freq;
                // Kleine, schnelle Schwingung um Gitterplatz
                atoms[i].x = atomBasePos[i].x + Math.sin(atoms[i].phase) * amplitude;
                atoms[i].y = atomBasePos[i].y + Math.sin(atoms[i].phase * 1.7 + i) * amplitude;
            }

            // Elektronen bewegen
            var driftForce = U * 0.06;

            for (var i = 0; i < electrons.length; i++) {
                var e = electrons[i];

                // Antrieb durch Spannung (von − links nach + rechts)
                e.vx += driftForce;

                // Position aktualisieren
                e.x += e.vx;
                e.y += e.vy;

                // Grenzen
                if (e.y < 45) { e.y = 45; e.vy = Math.abs(e.vy); }
                if (e.y > 295) { e.y = 295; e.vy = -Math.abs(e.vy); }

                // Kollisionen mit Atomen
                for (var j = 0; j < atoms.length; j++) {
                    var a = atoms[j];
                    var dx = e.x - a.x;
                    var dy = e.y - a.y;
                    var dist = Math.sqrt(dx * dx + dy * dy);
                    var minDist = atomRadius + 5;

                    if (dist < minDist && dist > 0) {
                        collisionCount++;

                        // Elektron zurückstoßen
                        var nx = dx / dist;
                        var ny = dy / dist;
                        e.x = a.x + nx * (minDist + 1);
                        e.y = a.y + ny * (minDist + 1);

                        // Reflexion
                        var dot = e.vx * nx + e.vy * ny;
                        e.vx = e.vx - 2 * dot * nx;
                        e.vy = e.vy - 2 * dot * ny;
                        e.vx *= 0.7;
                        e.vy *= 0.7;
                    }
                }

                // Geschwindigkeitslimit
                var speed = Math.sqrt(e.vx * e.vx + e.vy * e.vy);
                if (speed > 6) {
                    e.vx = (e.vx / speed) * 6;
                    e.vy = (e.vy / speed) * 6;
                }

                // Recycling am rechten Rand
                if (e.x > canvas.width + 5) {
                    e.x = -5;
                    e.y = 50 + Math.random() * 220;
                    e.vx = 0.3;
                    e.vy = (Math.random() - 0.5) * 2;
                }
            }

        }

        function updatePhysics() {
            // Temperaturtabelle basierend auf Spannung (empirisch)
            var tempTable = {
                0: 20, 1: 80, 2: 180, 3: 320, 4: 500,
                5: 720, 6: 980, 7: 1280, 8: 1600,
                9: 1950, 10: 2300, 11: 2600, 12: 2900
            };
            T = tempTable[U] || 20;

            // Widerstand steigt mit Temperatur (Wolfram: alpha ≈ 0.0045)
            var R0 = 5;
            var alpha = 0.0045;
            R = R0 * (1 + alpha * (T - 20));

            // Strom berechnen
            I = U > 0 ? U / R : 0;

            // UI aktualisieren
            document.getElementById('voltage-value').textContent = U + ' V';
            document.getElementById('temp-value').textContent = T + ' °C';
            document.getElementById('collision-value').textContent = collisionRate;
            document.getElementById('current-value').textContent = I.toFixed(2).replace('.', ',') + ' A';
            document.getElementById('resistance-value').textContent = U > 0 ? R.toFixed(1).replace('.', ',') + ' Ω' : '— Ω';

            // Teufelskreis-Schritte aktivieren
            updateCycleSteps();
        }

        function updateCycleSteps() {
            for (var i = 1; i <= 5; i++) {
                document.getElementById('step-' + i).classList.remove('active');
            }

            if (U >= 1) document.getElementById('step-1').classList.add('active');
            if (U >= 2) document.getElementById('step-2').classList.add('active');
            if (U >= 4) document.getElementById('step-3').classList.add('active');
            if (U >= 6) document.getElementById('step-4').classList.add('active');
            if (U >= 8) document.getElementById('step-5').classList.add('active');
        }

        // ============================================
        // DRAWING
        // ============================================

        function draw() {
            // Hintergrund
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draht-Bereich
            var wireY = 35;
            var wireH = 270;
            ctx.fillStyle = '#2a2a44';
            ctx.fillRect(0, wireY, canvas.width, wireH);
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 2;
            ctx.strokeRect(0, wireY, canvas.width, wireH);

            // Pole
            ctx.fillStyle = '#6699ff';
            ctx.font = 'bold 18px sans-serif';
            ctx.fillText('−', 8, 175);
            ctx.fillStyle = '#ff6666';
            ctx.fillText('+', canvas.width - 20, 175);

            // Atome zeichnen
            drawAtoms();

            // Elektronen
            drawElectrons();

            // Info-Text
            if (U === 0) {
                ctx.fillStyle = 'rgba(255,255,255,0.6)';
                ctx.font = '13px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Erhöhe die Spannung → Beobachte den Teufelskreis!', canvas.width / 2, canvas.height / 2);
                ctx.textAlign = 'left';
            }

            // Legende unten
            ctx.fillStyle = '#6699ff';
            ctx.font = '10px sans-serif';
            ctx.fillText('e⁻ von − nach +', 10, canvas.height - 8);
            ctx.fillStyle = '#ff6666';
            ctx.fillText('I (techn.) von + nach −', canvas.width - 130, canvas.height - 8);
        }

        function drawAtoms() {
            // Zuerst: Gitterpunkte zeigen (feste Positionen)
            ctx.fillStyle = 'rgba(100, 100, 100, 0.3)';
            for (var i = 0; i < atomBasePos.length; i++) {
                ctx.beginPath();
                ctx.arc(atomBasePos[i].x, atomBasePos[i].y, 3, 0, Math.PI * 2);
                ctx.fill();
            }

            // Dann: Atome (schwingen um Gitterpunkte)
            for (var i = 0; i < atoms.length; i++) {
                var a = atoms[i];

                // Glow bei hoher Temperatur
                if (T > 400) {
                    var glowSize = atomRadius + 3 + (T / 800) * 5;
                    var glowAlpha = Math.min(0.4, (T - 400) / 4000);
                    var grad = ctx.createRadialGradient(a.x, a.y, atomRadius, a.x, a.y, glowSize);
                    grad.addColorStop(0, 'rgba(255, 120, 50, ' + glowAlpha + ')');
                    grad.addColorStop(1, 'rgba(255, 80, 0, 0)');
                    ctx.fillStyle = grad;
                    ctx.beginPath();
                    ctx.arc(a.x, a.y, glowSize, 0, Math.PI * 2);
                    ctx.fill();
                }

                // Atom-Farbe konstant orange (Atomrümpfe schmelzen NICHT!)
                ctx.fillStyle = '#ff6b35';

                ctx.beginPath();
                ctx.arc(a.x, a.y, atomRadius, 0, Math.PI * 2);
                ctx.fill();

                // Rand
                ctx.strokeStyle = 'rgba(255,255,255,0.25)';
                ctx.lineWidth = 1;
                ctx.stroke();

                // + Symbol
                ctx.fillStyle = 'rgba(255,255,255,0.5)';
                ctx.font = 'bold 11px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('+', a.x, a.y);
            }
            ctx.textAlign = 'left';
            ctx.textBaseline = 'alphabetic';
        }

        function drawElectrons() {
            for (var i = 0; i < electrons.length; i++) {
                var e = electrons[i];

                // Elektron
                ctx.fillStyle = '#1976d2';
                ctx.beginPath();
                ctx.arc(e.x, e.y, 5, 0, Math.PI * 2);
                ctx.fill();

                // Glanz
                ctx.fillStyle = 'rgba(255,255,255,0.35)';
                ctx.beginPath();
                ctx.arc(e.x - 1, e.y - 1, 2, 0, Math.PI * 2);
                ctx.fill();

                // Minus
                ctx.fillStyle = 'white';
                ctx.font = 'bold 7px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('−', e.x, e.y + 0.5);
            }
            ctx.textAlign = 'left';
            ctx.textBaseline = 'alphabetic';
        }

        // ============================================
        // ANIMATION LOOP
        // ============================================

        function animate() {
            update();
            draw();
            requestAnimationFrame(animate);
        }

        // ============================================
        // EVENTS
        // ============================================

        slider.addEventListener('input', function() {
            U = parseInt(this.value);
        });

        // ============================================
        // START
        // ============================================

        initAtoms();
        initElectrons();
        animate();
    </script>
</body>
</html>
