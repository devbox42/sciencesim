<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>De-Broglie-Wellenlänge</title>
    <style>
        :root {
            --physik: #2c5aa0;
            --physik-light: #e3f2fd;
            --bg: #f5f5f5;
            --white: #ffffff;
            --border: #dddddd;
            --text: #222222;
            --text-secondary: #555555;
            --success: #2a7a4b;
            --warning: #b35c00;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 10px;
            font-size: 16px;
            line-height: 1.4;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: var(--white);
            border: 1px solid var(--border);
            padding: 15px;
        }

        h1 {
            font-size: 1.3em;
            font-weight: 600;
            color: var(--physik);
            margin: 0 0 5px 0;
            text-align: center;
        }

        .subtitle {
            font-size: 0.9em;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 15px;
            font-family: "Times New Roman", Times, serif;
            font-style: italic;
        }

        .section {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .section-title {
            font-size: 0.85em;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }

        .preset-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }

        .preset-btn {
            flex: 1 1 calc(50% - 4px);
            min-width: 120px;
            padding: 12px 10px;
            font-size: 0.95em;
            border: 2px solid var(--border);
            background: var(--white);
            cursor: pointer;
            text-align: center;
            transition: border-color 0.15s, background 0.15s;
        }

        .preset-btn:hover {
            border-color: var(--physik);
        }

        .preset-btn.active {
            border-color: var(--physik);
            background: var(--physik-light);
            font-weight: 600;
        }

        .input-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .input-label {
            flex: 0 0 100px;
            font-size: 0.9em;
        }

        .input-field {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 10px;
            font-size: 1em;
            border: 1px solid var(--border);
            background: var(--white);
        }

        input:focus {
            outline: 2px solid var(--physik);
            outline-offset: -2px;
        }

        .unit {
            font-size: 0.85em;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .slider-container {
            margin: 10px 0;
        }

        input[type="range"] {
            width: 100%;
            height: 30px;
            cursor: pointer;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.75em;
            color: var(--text-secondary);
            margin-top: -5px;
        }

        .voltage-section {
            background: var(--physik-light);
            padding: 12px;
            margin-top: 10px;
        }

        .voltage-section .section-title {
            margin-bottom: 8px;
            font-size: 0.8em;
        }

        .result-box {
            background: var(--physik);
            color: var(--white);
            padding: 15px;
            text-align: center;
        }

        .result-main {
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .result-alt {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .comparison {
            background: var(--white);
            border: 1px solid var(--border);
            padding: 12px;
        }

        .comparison-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .comparison-item:last-child {
            margin-bottom: 0;
        }

        .comparison-label {
            flex: 0 0 140px;
        }

        .comparison-bar-container {
            flex: 1;
            height: 20px;
            background: #eee;
            position: relative;
            margin-right: 10px;
        }

        .comparison-bar {
            height: 100%;
            background: var(--physik);
            transition: width 0.3s;
        }

        .comparison-bar.result {
            background: var(--success);
        }

        .comparison-value {
            flex: 0 0 80px;
            text-align: right;
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .verdict {
            margin-top: 12px;
            padding: 10px;
            font-size: 0.9em;
            text-align: center;
            font-weight: 500;
        }

        .verdict.possible {
            background: #e8f5e9;
            color: var(--success);
            border: 1px solid var(--success);
        }

        .verdict.impossible {
            background: #fff3e0;
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .quick-buttons {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .quick-btn {
            flex: 1;
            padding: 10px;
            font-size: 0.85em;
            border: 1px solid var(--border);
            background: var(--white);
            cursor: pointer;
        }

        .quick-btn:hover {
            background: var(--physik-light);
        }

        .formula-display {
            font-family: "Times New Roman", Times, serif;
            font-style: italic;
            background: #f9f9f9;
            padding: 8px;
            text-align: center;
            font-size: 0.95em;
            margin-bottom: 10px;
            border: 1px solid var(--border);
        }

        .help-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            border: 1px solid var(--border);
            background: var(--white);
            font-size: 1em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header {
            position: relative;
        }

        @media (max-width: 500px) {
            .preset-btn {
                flex: 1 1 100%;
            }

            .input-row {
                flex-wrap: wrap;
            }

            .input-label {
                flex: 1 1 100%;
                margin-bottom: 5px;
            }

            .comparison-label {
                flex: 0 0 100px;
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>De-Broglie-Wellenl&auml;nge</h1>
            <div class="subtitle">&lambda; = h / p = h / (m &middot; v)</div>
        </div>

        <div class="section">
            <div class="section-title">Objekt w&auml;hlen</div>
            <div class="preset-buttons">
                <button class="preset-btn active" onclick="selectPreset('elektron')">Elektron</button>
                <button class="preset-btn" onclick="selectPreset('proton')">Proton</button>
                <button class="preset-btn" onclick="selectPreset('fussball')">Fu&szlig;ball</button>
                <button class="preset-btn" onclick="selectPreset('auto')">Auto</button>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Parameter</div>

            <div class="input-row">
                <span class="input-label">Masse <i>m</i>:</span>
                <div class="input-field">
                    <input type="text" id="massInput" value="9,1e-31" oninput="onMassChange()" inputmode="decimal">
                    <span class="unit">kg</span>
                </div>
            </div>

            <div class="input-row">
                <span class="input-label">Geschwindigkeit <i>v</i>:</span>
                <div class="input-field">
                    <input type="text" id="velocityInput" value="4,2e6" oninput="onVelocityChange()" inputmode="decimal">
                    <span class="unit">m/s</span>
                </div>
            </div>

            <div class="slider-container">
                <input type="range" id="velocitySlider" min="0" max="8" step="0.1" value="6.62" oninput="onSliderChange()">
                <div class="slider-labels">
                    <span>1 m/s</span>
                    <span>10&sup3;</span>
                    <span>10&sup6;</span>
                    <span>10&sup8; m/s</span>
                </div>
            </div>

            <div class="voltage-section">
                <div class="section-title">Oder: Beschleunigungsspannung (f&uuml;r Elektronen)</div>
                <div class="input-row">
                    <span class="input-label">Spannung <i>U</i>:</span>
                    <div class="input-field">
                        <input type="text" id="voltageInput" value="50" oninput="onVoltageChange()" inputmode="decimal">
                        <span class="unit">V</span>
                    </div>
                </div>
                <div class="formula-display">
                    v = &radic;(2&middot;e&middot;U / m<sub>e</sub>) = <span id="calculatedV">4,19 &middot; 10&sup6;</span> m/s
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Ergebnis</div>

            <div class="result-box">
                <div class="result-main">&lambda; = <span id="resultLambda">1,74 &middot; 10&supmin;&sup1;&sup0;</span> m</div>
                <div class="result-alt">= <span id="resultPm">174</span> pm = <span id="resultNm">0,174</span> nm</div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Gr&ouml;&szlig;envergleich</div>

            <div class="comparison">
                <div class="comparison-item">
                    <span class="comparison-label">Dein &lambda;:</span>
                    <div class="comparison-bar-container">
                        <div class="comparison-bar result" id="resultBar" style="width: 80%;"></div>
                    </div>
                    <span class="comparison-value" id="resultCompare">174 pm</span>
                </div>
                <div class="comparison-item">
                    <span class="comparison-label">Atomradius:</span>
                    <div class="comparison-bar-container">
                        <div class="comparison-bar" style="width: 57%;"></div>
                    </div>
                    <span class="comparison-value">~100 pm</span>
                </div>
                <div class="comparison-item">
                    <span class="comparison-label">Gitterkonstante:</span>
                    <div class="comparison-bar-container">
                        <div class="comparison-bar" style="width: 70%;"></div>
                    </div>
                    <span class="comparison-value">~200 pm</span>
                </div>
                <div class="comparison-item">
                    <span class="comparison-label">Atomkern:</span>
                    <div class="comparison-bar-container">
                        <div class="comparison-bar" style="width: 3%;"></div>
                    </div>
                    <span class="comparison-value">~1 fm</span>
                </div>
            </div>

            <div class="verdict" id="verdict">
                Bei dieser Wellenl&auml;nge ist Beugung an Kristallgittern messbar.
            </div>
        </div>

        <div class="quick-buttons">
            <button class="quick-btn" onclick="setExample('elektron50')">Elektron bei 50 V</button>
            <button class="quick-btn" onclick="setExample('fussball30')">Fu&szlig;ball 30 m/s</button>
            <button class="quick-btn" onclick="resetAll()">Zur&uuml;cksetzen</button>
        </div>
    </div>

    <script>
        // Konstanten
        var H = 6.62607015e-34;  // Plancksches Wirkungsquantum in J*s
        var E_CHARGE = 1.602176634e-19;  // Elementarladung in C
        var M_ELEKTRON = 9.1093837e-31;  // Elektronenmasse in kg
        var M_PROTON = 1.67262192e-27;   // Protonenmasse in kg

        // Presets
        var presets = {
            elektron: { mass: 9.1e-31, velocity: 4.2e6, name: 'Elektron' },
            proton: { mass: 1.67e-27, velocity: 5e6, name: 'Proton' },
            fussball: { mass: 0.43, velocity: 30, name: 'Fussball' },
            auto: { mass: 1500, velocity: 30, name: 'Auto' }
        };

        var currentPreset = 'elektron';

        // Hilfsfunktion: Dezimalkomma akzeptieren
        function parseGermanNumber(value) {
            if (value === '' || value === null || value === undefined) return NaN;
            var str = String(value).replace(',', '.');
            return parseFloat(str);
        }

        // Hilfsfunktion: Zahl formatieren mit Dezimalkomma
        function formatNumber(num, decimals) {
            if (isNaN(num) || !isFinite(num)) return '---';
            return num.toFixed(decimals).replace('.', ',');
        }

        // Hilfsfunktion: Wissenschaftliche Notation
        function formatScientific(num) {
            if (isNaN(num) || !isFinite(num) || num === 0) return '---';

            var exponent = Math.floor(Math.log10(Math.abs(num)));
            var mantissa = num / Math.pow(10, exponent);

            // Runden auf 2 Dezimalstellen
            mantissa = Math.round(mantissa * 100) / 100;

            if (exponent === 0) {
                return formatNumber(mantissa, 2);
            }

            return formatNumber(mantissa, 2) + ' \u00b7 10' + formatExponent(exponent);
        }

        // Hilfsfunktion: Exponent als Hochzahl
        function formatExponent(exp) {
            var superscripts = {
                '0': '\u2070', '1': '\u00b9', '2': '\u00b2', '3': '\u00b3',
                '4': '\u2074', '5': '\u2075', '6': '\u2076', '7': '\u2077',
                '8': '\u2078', '9': '\u2079', '-': '\u207b'
            };
            var result = '';
            var expStr = String(exp);
            for (var i = 0; i < expStr.length; i++) {
                result += superscripts[expStr[i]] || expStr[i];
            }
            return result;
        }

        // De-Broglie-Wellenlänge berechnen
        function calculateLambda(mass, velocity) {
            if (mass <= 0 || velocity <= 0) return NaN;
            var p = mass * velocity;
            return H / p;
        }

        // Geschwindigkeit aus Beschleunigungsspannung
        function velocityFromVoltage(U, mass) {
            if (U <= 0 || mass <= 0) return NaN;
            return Math.sqrt(2 * E_CHARGE * U / mass);
        }

        // UI aktualisieren
        function updateResults() {
            var mass = parseGermanNumber(document.getElementById('massInput').value);
            var velocity = parseGermanNumber(document.getElementById('velocityInput').value);

            var lambda = calculateLambda(mass, velocity);

            // Hauptergebnis
            document.getElementById('resultLambda').textContent = formatScientific(lambda);

            // Alternative Einheiten
            var lambdaPm = lambda * 1e12;
            var lambdaNm = lambda * 1e9;

            if (lambdaPm < 0.01) {
                document.getElementById('resultPm').textContent = formatScientific(lambdaPm);
            } else if (lambdaPm < 1000) {
                document.getElementById('resultPm').textContent = formatNumber(lambdaPm, 1);
            } else {
                document.getElementById('resultPm').textContent = formatScientific(lambdaPm);
            }

            if (lambdaNm < 0.001) {
                document.getElementById('resultNm').textContent = formatScientific(lambdaNm);
            } else if (lambdaNm < 1000) {
                document.getElementById('resultNm').textContent = formatNumber(lambdaNm, 3);
            } else {
                document.getElementById('resultNm').textContent = formatScientific(lambdaNm);
            }

            // Vergleichsbalken
            updateComparison(lambda);

            // Verdict
            updateVerdict(lambda);
        }

        function updateComparison(lambda) {
            var lambdaPm = lambda * 1e12;
            var maxPm = 300; // Skalierung für Balken

            var barWidth = Math.min(100, Math.max(1, (Math.log10(lambdaPm + 1) / Math.log10(maxPm + 1)) * 100));

            // Spezialfall: sehr kleine Wellenlängen
            if (lambdaPm < 1e-20) {
                barWidth = 0.5;
            }

            document.getElementById('resultBar').style.width = barWidth + '%';

            // Vergleichswert anzeigen
            if (lambdaPm < 0.01) {
                document.getElementById('resultCompare').textContent = formatScientific(lambdaPm) + ' pm';
            } else if (lambdaPm < 1000) {
                document.getElementById('resultCompare').textContent = formatNumber(lambdaPm, 1) + ' pm';
            } else {
                document.getElementById('resultCompare').textContent = formatScientific(lambdaPm) + ' pm';
            }
        }

        function updateVerdict(lambda) {
            var verdictEl = document.getElementById('verdict');
            var lambdaPm = lambda * 1e12;

            if (isNaN(lambda) || !isFinite(lambda)) {
                verdictEl.textContent = 'Bitte g\u00fcltige Werte eingeben.';
                verdictEl.className = 'verdict';
                return;
            }

            // Gitterkonstante typisch ~200 pm
            if (lambdaPm >= 1 && lambdaPm <= 1000) {
                verdictEl.innerHTML = '\u2713 Bei dieser Wellenl\u00e4nge ist Beugung an Kristallgittern <strong>messbar</strong>.';
                verdictEl.className = 'verdict possible';
            } else if (lambdaPm < 1) {
                verdictEl.innerHTML = '\u2717 Diese Wellenl\u00e4nge ist <strong>viel kleiner</strong> als Atomabst\u00e4nde \u2013 keine Beugung beobachtbar.';
                verdictEl.className = 'verdict impossible';
            } else {
                verdictEl.innerHTML = '\u2717 Diese Wellenl\u00e4nge ist <strong>viel gr\u00f6\u00dfer</strong> als Atomabst\u00e4nde \u2013 andere Beugungsgitter n\u00f6tig.';
                verdictEl.className = 'verdict impossible';
            }
        }

        // Event Handler
        function selectPreset(preset) {
            currentPreset = preset;

            // Buttons aktualisieren
            var buttons = document.querySelectorAll('.preset-btn');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            event.target.classList.add('active');

            // Werte setzen
            var p = presets[preset];
            document.getElementById('massInput').value = formatScientific(p.mass).replace('\u00b7', 'e').replace(/[\u2070\u00b9\u00b2\u00b3\u2074\u2075\u2076\u2077\u2078\u2079\u207b]/g, function(c) {
                var map = {'\u2070':'0','\u00b9':'1','\u00b2':'2','\u00b3':'3','\u2074':'4','\u2075':'5','\u2076':'6','\u2077':'7','\u2078':'8','\u2079':'9','\u207b':'-'};
                return map[c] || c;
            }).replace(' ', '');

            // Einfacher: direkt den Preset-Wert formatieren
            if (p.mass < 0.001) {
                var exp = Math.floor(Math.log10(p.mass));
                var mant = p.mass / Math.pow(10, exp);
                document.getElementById('massInput').value = formatNumber(mant, 1) + 'e' + exp;
            } else {
                document.getElementById('massInput').value = formatNumber(p.mass, 2);
            }

            if (p.velocity < 0.001 || p.velocity >= 10000) {
                var expV = Math.floor(Math.log10(p.velocity));
                var mantV = p.velocity / Math.pow(10, expV);
                document.getElementById('velocityInput').value = formatNumber(mantV, 1) + 'e' + expV;
            } else {
                document.getElementById('velocityInput').value = formatNumber(p.velocity, 0);
            }

            updateSliderFromVelocity(p.velocity);
            updateResults();
        }

        function onMassChange() {
            updateResults();
        }

        function onVelocityChange() {
            var v = parseGermanNumber(document.getElementById('velocityInput').value);
            updateSliderFromVelocity(v);
            updateResults();
        }

        function onSliderChange() {
            var sliderValue = parseFloat(document.getElementById('velocitySlider').value);
            var velocity = Math.pow(10, sliderValue);

            // Velocity-Feld aktualisieren
            if (velocity >= 1000) {
                var exp = Math.floor(Math.log10(velocity));
                var mant = velocity / Math.pow(10, exp);
                document.getElementById('velocityInput').value = formatNumber(mant, 1) + 'e' + exp;
            } else {
                document.getElementById('velocityInput').value = formatNumber(velocity, 1);
            }

            updateResults();
        }

        function updateSliderFromVelocity(v) {
            if (v > 0) {
                var logV = Math.log10(v);
                logV = Math.max(0, Math.min(8, logV));
                document.getElementById('velocitySlider').value = logV;
            }
        }

        function onVoltageChange() {
            var U = parseGermanNumber(document.getElementById('voltageInput').value);
            var mass = parseGermanNumber(document.getElementById('massInput').value);

            // Nur für Elektronen sinnvoll
            if (mass < 1e-29 && mass > 1e-32) {
                var v = velocityFromVoltage(U, M_ELEKTRON);

                if (!isNaN(v) && isFinite(v)) {
                    document.getElementById('calculatedV').textContent = formatScientific(v);

                    // Velocity-Feld aktualisieren
                    var exp = Math.floor(Math.log10(v));
                    var mant = v / Math.pow(10, exp);
                    document.getElementById('velocityInput').value = formatNumber(mant, 2) + 'e' + exp;

                    updateSliderFromVelocity(v);
                    updateResults();
                }
            }
        }

        function setExample(example) {
            if (example === 'elektron50') {
                selectPresetByName('elektron');
                document.getElementById('voltageInput').value = '50';
                onVoltageChange();
            } else if (example === 'fussball30') {
                selectPresetByName('fussball');
                document.getElementById('velocityInput').value = '30';
                onVelocityChange();
            }
        }

        function selectPresetByName(name) {
            var buttons = document.querySelectorAll('.preset-btn');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
                if (buttons[i].textContent.toLowerCase().indexOf(name) >= 0 ||
                    (name === 'fussball' && buttons[i].textContent.indexOf('ball') >= 0)) {
                    buttons[i].classList.add('active');
                }
            }

            var p = presets[name];
            if (p) {
                if (p.mass < 0.001) {
                    var exp = Math.floor(Math.log10(p.mass));
                    var mant = p.mass / Math.pow(10, exp);
                    document.getElementById('massInput').value = formatNumber(mant, 1) + 'e' + exp;
                } else {
                    document.getElementById('massInput').value = formatNumber(p.mass, 2);
                }
            }
        }

        function resetAll() {
            selectPresetByName('elektron');
            document.getElementById('massInput').value = '9,1e-31';
            document.getElementById('velocityInput').value = '4,2e6';
            document.getElementById('voltageInput').value = '50';
            document.getElementById('velocitySlider').value = 6.62;
            document.getElementById('calculatedV').textContent = '4,19 \u00b7 10\u2076';

            var buttons = document.querySelectorAll('.preset-btn');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            buttons[0].classList.add('active');

            updateResults();
        }

        // Initialisierung
        document.addEventListener('DOMContentLoaded', function() {
            updateResults();
        });

        // Falls DOMContentLoaded schon vorbei
        if (document.readyState !== 'loading') {
            updateResults();
        }
    </script>
</body>
</html>
