<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lernpfad: Photoeffekt Vertiefung + De-Broglie</title>
    <style>
/* ═══════════════════════════════════════════════════════════════
   MINT LERNPFAD - De-Broglie-Wellenlänge (ES5)
   sciencesim Design System - Step-Navigation mit visitedSteps
═══════════════════════════════════════════════════════════════ */

* { box-sizing: border-box; margin: 0; padding: 0; }

:root {
    --bg: #f5f5f5;
    --white: #ffffff;
    --border: #dddddd;
    --text-primary: #222222;
    --text-secondary: #555555;
    --text-muted: #888888;
    --accent: #2c5aa0;
    --accent-light: #e8f0fa;
    --accent-dark: #1e3d6b;
    --success: #2a7a4b;
    --success-bg: #e8f5e9;
    --warning: #b35c00;
    --warning-bg: #fff3e0;
    --error: #c62828;
    --error-bg: #ffebee;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: var(--bg);
    font-size: 16px;
    color: var(--text-primary);
    line-height: 1.5;
}

.container {
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
    transition: max-width 0.3s ease;
}

.container.wide-mode {
    max-width: 1100px;
}

/* ═══════════════════════════════════════════════════════════════
   HEADER
═══════════════════════════════════════════════════════════════ */

header {
    background: var(--white);
    border: 1px solid var(--border);
    padding: 15px 20px;
    margin-bottom: 20px;
}

header h1 {
    color: var(--accent);
    font-size: 1.4em;
    font-weight: 600;
}

header .meta {
    color: var(--text-muted);
    font-size: 0.9em;
    margin-top: 5px;
}

.progress-bar {
    background: #e0e0e0;
    height: 8px;
    margin-top: 10px;
}

.progress-fill {
    background: var(--accent);
    height: 100%;
    width: 0%;
    transition: width 0.3s;
}

/* Step-Indicators */
.step-indicators {
    display: flex;
    gap: 4px;
    margin-top: 10px;
    flex-wrap: wrap;
}

.step-dot {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7em;
    font-weight: 600;
    border: 2px solid var(--border);
    background: var(--white);
    cursor: pointer;
    transition: all 0.15s;
    color: var(--text-secondary);
}

.step-dot:hover {
    border-color: var(--accent);
}

.step-dot.completed {
    background: var(--success);
    border-color: var(--success);
    color: var(--white);
}

.step-dot.current {
    border-color: var(--accent);
    border-width: 3px;
    color: var(--accent);
}

/* ═══════════════════════════════════════════════════════════════
   STEP CONTENT
═══════════════════════════════════════════════════════════════ */

.step {
    background: var(--white);
    border: 1px solid var(--border);
    margin-bottom: 15px;
    display: none;
}

.step.active { display: block; }

.step-header {
    background: var(--accent);
    color: var(--white);
    padding: 10px 15px;
    font-weight: 600;
}

.step-content {
    padding: 20px;
}

.step-content p { margin-bottom: 12px; }
.step-content ul, .step-content ol { margin: 10px 0 15px 25px; }
.step-content li { margin-bottom: 8px; }
.step-content h3 { font-size: 1em; margin: 15px 0 10px 0; }

/* ═══════════════════════════════════════════════════════════════
   CONTENT BOXES
═══════════════════════════════════════════════════════════════ */

.info-box {
    background: var(--accent-light);
    border: 1px solid var(--accent);
    padding: 12px 15px;
    margin: 15px 0;
}

.info-box strong { color: var(--accent); }

.hefter-hinweis {
    background: var(--warning-bg);
    border: 2px solid var(--warning);
    padding: 12px 15px;
    margin: 20px 0;
    font-size: 0.9em;
}

.hefter-hinweis::before {
    content: "Arbeitsblatt";
    display: inline-block;
    background: var(--warning);
    color: var(--white);
    font-size: 0.75em;
    font-weight: 600;
    padding: 2px 8px;
    margin-bottom: 8px;
}

.formula-box {
    background: var(--bg);
    border: 2px solid var(--accent);
    padding: 15px;
    margin: 15px 0;
    text-align: center;
    font-size: 1.1em;
}

/* ═══════════════════════════════════════════════════════════════
   EXERCISES
═══════════════════════════════════════════════════════════════ */

.exercise {
    background: var(--bg);
    border: 1px solid var(--border);
    padding: 15px;
    margin: 15px 0;
}

.exercise-title {
    font-weight: 600;
    color: var(--accent);
    margin-bottom: 10px;
}

.input-group {
    margin: 10px 0;
}

.input-group label {
    display: inline;
    font-size: 0.95em;
}

input[type="text"], input[type="number"] {
    padding: 8px 12px;
    border: 1px solid var(--border);
    font-size: 1em;
    width: 100px;
}

input:focus { outline: 2px solid var(--accent); }

.btn {
    display: inline-block;
    padding: 10px 20px;
    background: var(--accent);
    color: var(--white);
    border: none;
    cursor: pointer;
    font-size: 1em;
    margin: 5px 5px 5px 0;
}

.btn:hover { background: var(--accent-dark); }
.btn-success { background: var(--success); }
.btn-success:hover { background: #1e5a35; }
.btn-secondary { background: var(--white); color: var(--accent); border: 2px solid var(--accent); }
.btn-secondary:hover { background: var(--accent-light); }

.nav-buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid var(--border);
}

.feedback {
    padding: 10px 15px;
    margin: 10px 0;
    display: none;
}

.feedback.correct {
    background: var(--success-bg);
    border: 1px solid var(--success);
    color: #1b5e20;
    display: block;
}

.feedback.incorrect {
    background: var(--error-bg);
    border: 1px solid var(--error);
    color: #b71c1c;
    display: block;
}

/* ═══════════════════════════════════════════════════════════════
   SIMULATION
═══════════════════════════════════════════════════════════════ */

.sim-link {
    display: inline-block;
    background: var(--accent);
    color: white;
    padding: 12px 20px;
    text-decoration: none;
    margin: 10px 0;
}

.sim-link:hover { background: var(--accent-dark); }

@media (max-width: 600px) {
    .container { padding: 10px; }
    .step-content { padding: 15px; }
    input[type="text"], input[type="number"] { width: 100%; }
}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Photoeffekt Vertiefung + De-Broglie-Wellenlänge</h1>
            <div class="meta">Physik 12 GK | Fr 16.01.2026</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="step-indicators" id="stepIndicators"></div>
        </header>

        <!-- ========== SCHRITT 1: Wiederholung ========== -->
        <div class="step active" id="step1">
            <div class="step-header">Schritt 1: Wiederholung Photoeffekt</div>
            <div class="step-content">
                <p>In der letzten Stunde habt ihr die <strong>Einsteinsche Gerade</strong> gemessen und das Plancksche Wirkungsquantum bestimmt.</p>

                <div class="info-box">
                    <strong>Die Photogleichung:</strong><br>
                    <em>E</em><sub>kin</sub> = <em>h</em> · <em>f</em> − <em>W</em><sub>A</sub>
                </div>

                <p>Heute vertiefen wir den Photoeffekt mit einer Abituraufgabe und lernen dann die <strong>De-Broglie-Hypothese</strong> kennen.</p>

                <div class="hefter-hinweis">
                    <strong>Prüfe die Konstanten</strong> auf dem Arbeitsblatt (oberer Kasten).
                </div>

                <div class="nav-buttons">
                    <span></span>
                    <button class="btn btn-success" onclick="nextStep(2)">Weiter</button>
                </div>
            </div>
        </div>

        <!-- ========== SCHRITT 2: Aufgabe 1a ========== -->
        <div class="step" id="step2">
            <div class="step-header">Schritt 2: Aufgabe 1a – Grenzfrequenz ablesen</div>
            <div class="step-content">
                <p>Das Diagramm auf deinem Arbeitsblatt zeigt Messdaten zum Photoeffekt an <strong>Cäsium</strong> (W<sub>A</sub> = 1,9 eV).</p>

                <div class="info-box">
                    <strong>Erinnerung:</strong> Die Grenzfrequenz <em>f</em><sub>G</sub> ist die Frequenz, bei der <em>E</em><sub>kin</sub> = 0 wird (x-Achsenabschnitt der Geraden).
                </div>

                <div class="exercise">
                    <div class="exercise-title">Aufgabe 1a (2 BE)</div>
                    <p>Lies die Grenzfrequenz aus dem Diagramm ab.</p>
                    <div class="input-group">
                        <label><em>f</em><sub>G</sub> = </label>
                        <input type="text" id="ex1a" inputmode="decimal" placeholder="z.B. 4,6"> · 10<sup>14</sup> Hz
                    </div>
                    <button class="btn" onclick="checkEx1a()">Prüfen</button>
                    <div class="feedback" id="fb1a"></div>
                </div>

                <div class="hefter-hinweis">
                    <strong>Aufgabe 1a:</strong> Notiere deinen Wert für <em>f</em><sub>G</sub> auf dem Arbeitsblatt.
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="prevStep(1)">Zurück</button>
                    <button class="btn btn-success" onclick="nextStep(3)">Weiter</button>
                </div>
            </div>
        </div>

        <!-- ========== SCHRITT 3: Aufgabe 1b ========== -->
        <div class="step" id="step3">
            <div class="step-header">Schritt 3: Aufgabe 1b – Berechnung</div>
            <div class="step-content">
                <p>Berechne die kinetische Energie bei UV-Licht mit <em>f</em> = 7 · 10<sup>14</sup> Hz.</p>

                <div class="info-box">
                    <strong>Gegeben:</strong> W<sub>A</sub> = 1,9 eV (Cäsium)<br>
                    Nutze die Photogleichung und die Konstanten vom Arbeitsblatt.
                </div>

                <div class="exercise">
                    <div class="exercise-title">Aufgabe 1b (3 BE)</div>
                    <div class="input-group">
                        <label><em>E</em><sub>kin</sub> = </label>
                        <input type="text" id="ex1b" inputmode="decimal" placeholder="z.B. 1,0"> eV
                    </div>
                    <button class="btn" onclick="checkEx1b()">Prüfen</button>
                    <div class="feedback" id="fb1b"></div>
                </div>

                <div class="hefter-hinweis">
                    <strong>Aufgabe 1b:</strong> Schreibe den vollständigen Rechenweg auf dem Arbeitsblatt.
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="prevStep(2)">Zurück</button>
                    <button class="btn btn-success" onclick="nextStep(4)">Weiter</button>
                </div>
            </div>
        </div>

        <!-- ========== SCHRITT 4: Aufgabe 1c+d ========== -->
        <div class="step" id="step4">
            <div class="step-header">Schritt 4: Aufgabe 1c+d – Verständnisfragen</div>
            <div class="step-content">
                <h3>Aufgabe 1c: y-Achsenabschnitt</h3>
                <p>Warum ist der y-Achsenabschnitt der Einstein-Geraden negativ?</p>

                <div class="info-box">
                    <strong>Hinweis:</strong> Überlege, was <em>E</em><sub>kin</sub> = <em>h</em> · <em>f</em> − <em>W</em><sub>A</sub> bei <em>f</em> = 0 ergibt.
                </div>

                <h3>Aufgabe 1d: Intensität</h3>
                <p>Warum erzeugt mehr Lichtintensität bei <em>f</em> = 3 · 10<sup>14</sup> Hz keinen Photostrom?</p>

                <div class="info-box">
                    <strong>Schlüsselgedanke:</strong> Ein Photon überträgt seine Energie auf ein Elektron. Mehr Photonen = mehr Versuche, aber jedes einzelne Photon muss genug Energie haben.
                </div>

                <div class="hefter-hinweis">
                    <strong>Aufgabe 1c+d:</strong> Formuliere deine Antworten in ganzen Sätzen auf dem Arbeitsblatt.
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="prevStep(3)">Zurück</button>
                    <button class="btn btn-success" onclick="nextStep(5)">Weiter</button>
                </div>
            </div>
        </div>

        <!-- ========== SCHRITT 5: Kasten 1 ========== -->
        <div class="step" id="step5">
            <div class="step-header">Schritt 5: Merksatz Photoeffekt</div>
            <div class="step-content">
                <div class="formula-box">
                    <p>Beim Photoeffekt gilt:</p>
                    <p><strong>Ein Photon</strong> überträgt seine gesamte Energie auf <strong>ein Elektron</strong>.</p>
                    <p style="margin-top: 15px;">Unterhalb der <strong>Grenzfrequenz</strong> (<em>f</em> &lt; <em>f</em><sub>G</sub>) findet kein Photoeffekt statt – unabhängig von der <strong>Intensität</strong> des Lichts.</p>
                </div>

                <div class="hefter-hinweis">
                    <strong>Kasten 1:</strong> Ergänze die Lücken im Merksatz auf dem Arbeitsblatt.
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="prevStep(4)">Zurück</button>
                    <button class="btn btn-success" onclick="nextStep(6)">Weiter zu Block 2</button>
                </div>
            </div>
        </div>

        <!-- ========== SCHRITT 6: De-Broglie-Hypothese ========== -->
        <div class="step" id="step6">
            <div class="step-header">Schritt 6: De-Broglie-Hypothese (1924)</div>
            <div class="step-content">
                <div class="info-box">
                    <strong>Symmetrieargument:</strong><br>
                    Licht zeigt Teilcheneigenschaften (Photonen beim Photoeffekt).<br>
                    <strong>→ Haben Teilchen auch Welleneigenschaften?</strong>
                </div>

                <p>Louis de Broglie stellte 1924 die Hypothese auf:</p>

                <div class="formula-box">
                    <strong>Jedes bewegte Teilchen hat eine Wellenlänge:</strong><br><br>
                    λ = <em>h</em> / <em>p</em> = <em>h</em> / (<em>m</em> · <em>v</em>)
                </div>

                <p>Diese Wellenlänge heißt <strong>De-Broglie-Wellenlänge</strong>.</p>

                <div class="hefter-hinweis">
                    <strong>Kasten 2:</strong> Lies die De-Broglie-Hypothese auf dem Arbeitsblatt. Der Energiesatz für beschleunigte Elektronen steht dort.
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="prevStep(5)">Zurück</button>
                    <button class="btn btn-success" onclick="nextStep(7)">Weiter</button>
                </div>
            </div>
        </div>

        <!-- ========== SCHRITT 7: Simulation ========== -->
        <div class="step" id="step7">
            <div class="step-header">Schritt 7: Simulation – Wellenlängenrechner</div>
            <div class="step-content">
                <p>Experimentiere mit der Simulation, um ein Gefühl für die Größenordnungen zu bekommen.</p>

                <a class="sim-link" href="SIM-03-de-broglie.html" target="_blank">Simulation öffnen</a>

                <div class="exercise">
                    <div class="exercise-title">Beobachtungsaufgaben</div>
                    <ol>
                        <li>Wähle <strong>Elektron</strong> und stelle verschiedene Spannungen ein. Bei welcher Spannung ist λ ≈ 100 pm?</li>
                        <li>Wähle ein makroskopisches Objekt. Ist dessen Wellenlänge messbar?</li>
                        <li>Was passiert mit λ, wenn die Masse größer wird?</li>
                    </ol>
                </div>

                <div class="info-box">
                    <strong>Erkenntnis:</strong> Je größer Masse oder Geschwindigkeit, desto kleiner die Wellenlänge. Bei makroskopischen Objekten ist λ so winzig, dass keine Beugung beobachtbar ist.
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="prevStep(6)">Zurück</button>
                    <button class="btn btn-success" onclick="nextStep(8)">Weiter</button>
                </div>
            </div>
        </div>

        <!-- ========== SCHRITT 8: Aufgabe 2 ========== -->
        <div class="step" id="step8">
            <div class="step-header">Schritt 8: Aufgabe 2 – Beschleunigtes Elektron</div>
            <div class="step-content">
                <p>Ein Elektron wird aus der Ruhe durch <em>U</em> = 150 V beschleunigt.</p>

                <div class="info-box">
                    <strong>Vorgehen:</strong><br>
                    1. Geschwindigkeit aus dem Energiesatz berechnen<br>
                    2. De-Broglie-Wellenlänge berechnen
                </div>

                <div class="exercise">
                    <div class="exercise-title">Aufgabe 2a (2 BE)</div>
                    <div class="input-group">
                        <label><em>v</em> = </label>
                        <input type="text" id="ex2a" inputmode="decimal" placeholder="z.B. 7,3"> · 10<sup>6</sup> m/s
                    </div>
                    <button class="btn" onclick="checkEx2a()">Prüfen</button>
                    <div class="feedback" id="fb2a"></div>
                </div>

                <div class="exercise">
                    <div class="exercise-title">Aufgabe 2b (2 BE)</div>
                    <div class="input-group">
                        <label>λ = </label>
                        <input type="text" id="ex2b" inputmode="decimal" placeholder="z.B. 100"> pm
                    </div>
                    <button class="btn" onclick="checkEx2b()">Prüfen</button>
                    <div class="feedback" id="fb2b"></div>
                </div>

                <div class="hefter-hinweis">
                    <strong>Aufgabe 2a+b:</strong> Schreibe den vollständigen Rechenweg auf dem Arbeitsblatt.
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="prevStep(7)">Zurück</button>
                    <button class="btn btn-success" onclick="nextStep(9)">Weiter</button>
                </div>
            </div>
        </div>

        <!-- ========== SCHRITT 9: Aufgabe 3 ========== -->
        <div class="step" id="step9">
            <div class="step-header">Schritt 9: Aufgabe 3 – Tennisball</div>
            <div class="step-content">
                <p>Ein Tennisball (<em>m</em> = 58 g) wird mit <em>v</em> = 50 m/s geschlagen.</p>

                <div class="exercise">
                    <div class="exercise-title">Aufgabe 3a (3 BE)</div>
                    <p>Berechne zuerst den Impuls, dann die Wellenlänge.</p>
                    <div class="input-group">
                        <label><em>p</em> = </label>
                        <input type="text" id="ex3a_p" inputmode="decimal" placeholder="z.B. 2,9"> kg·m/s
                    </div>
                    <div class="input-group">
                        <label>λ = </label>
                        <input type="text" id="ex3a_l" inputmode="decimal" placeholder="z.B. 2,3"> · 10<sup>-34</sup> m
                    </div>
                    <button class="btn" onclick="checkEx3a()">Prüfen</button>
                    <div class="feedback" id="fb3a"></div>
                </div>

                <h3>Aufgabe 3b (4 BE)</h3>
                <p>Warum beobachten wir bei Tennisbällen keine Beugung?</p>

                <div class="info-box">
                    <strong>Vergleich:</strong> Atomabstände ≈ 10<sup>-10</sup> m, Tennisball-Wellenlänge ≈ 10<sup>-34</sup> m.<br>
                    Das ist ein Faktor von 10<sup>24</sup> kleiner!
                </div>

                <div class="hefter-hinweis">
                    <strong>Aufgabe 3:</strong> Schreibe Rechnung und Begründung auf dem Arbeitsblatt.
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="prevStep(8)">Zurück</button>
                    <button class="btn btn-success" onclick="nextStep(10)">Weiter</button>
                </div>
            </div>
        </div>

        <!-- ========== SCHRITT 10: Zusammenfassung ========== -->
        <div class="step" id="step10">
            <div class="step-header">Schritt 10: Zusammenfassung</div>
            <div class="step-content">
                <div class="formula-box">
                    <strong>De-Broglie-Wellenlänge:</strong><br><br>
                    λ = <em>h</em> / <em>p</em><br><br>
                    Je größer die <strong>Masse</strong> oder der <strong>Impuls</strong>, desto kleiner λ.
                </div>

                <div class="info-box">
                    <strong>Wichtige Erkenntnis:</strong><br>
                    Bei makroskopischen Objekten ist λ so winzig (z.B. 10<sup>-34</sup> m), dass keine Beugungserscheinungen beobachtbar sind. Nur bei Elektronen, Neutronen etc. sind Welleneffekte messbar.
                </div>

                <div class="hefter-hinweis">
                    <strong>Kasten 3:</strong> Ergänze den Merksatz zur De-Broglie-Wellenlänge auf dem Arbeitsblatt.
                </div>

                <h3 style="margin-top: 20px;">Zusatzaufgaben</h3>
                <p>Wenn du fertig bist: Bearbeite die Zusatzaufgaben Z1–Z3 auf der letzten Seite des Arbeitsblatts.</p>

                <div style="text-align: center; margin-top: 30px; padding: 20px; background: var(--success-bg); border: 2px solid var(--success);">
                    <strong>Geschafft!</strong><br>
                    Kontrolliere, ob alle Lücken und Aufgaben auf dem Arbeitsblatt ausgefüllt sind.
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="prevStep(9)">Zurück</button>
                    <span></span>
                </div>
            </div>
        </div>
    </div>

    <script>
    // ════════════════════════════════════════════════════════════════
    // LERNPFAD LOGIK (ES5 - KEINE let/const/arrow functions!)
    // ════════════════════════════════════════════════════════════════

    var TOTAL_STEPS = 10;
    var STORAGE_KEY = 'lp-physik-12gk-de-broglie';

    var currentStep = 1;
    var visitedSteps = [];

    // ───────────────────────────────────────────────────────────────
    // PROGRESS & STEP-INDICATORS
    // ───────────────────────────────────────────────────────────────
    function updateProgress() {
        var percent = ((currentStep - 1) / (TOTAL_STEPS - 1)) * 100;
        document.getElementById('progressFill').style.width = percent + '%';
    }

    function generateStepIndicators() {
        var container = document.getElementById('stepIndicators');
        container.innerHTML = '';
        for (var i = 1; i <= TOTAL_STEPS; i++) {
            var dot = document.createElement('div');
            dot.className = 'step-dot';
            if (i === currentStep) dot.classList.add('current');
            if (visitedSteps.indexOf(i) !== -1) dot.classList.add('completed');
            dot.textContent = i;
            dot.setAttribute('data-step', i);
            dot.onclick = function() {
                var stepIndex = parseInt(this.getAttribute('data-step'));
                showStep(stepIndex);
            };
            container.appendChild(dot);
        }
    }

    function updateStepIndicators() {
        var dots = document.querySelectorAll('.step-dot');
        for (var i = 0; i < dots.length; i++) {
            var stepNum = i + 1;
            dots[i].classList.remove('current');
            if (stepNum === currentStep) {
                dots[i].classList.add('current');
            }
            if (visitedSteps.indexOf(stepNum) !== -1) {
                dots[i].classList.add('completed');
            }
        }
    }

    // ───────────────────────────────────────────────────────────────
    // NAVIGATION
    // ───────────────────────────────────────────────────────────────
    function showStep(n) {
        if (visitedSteps.indexOf(currentStep) === -1) {
            visitedSteps.push(currentStep);
        }

        for (var i = 1; i <= TOTAL_STEPS; i++) {
            var step = document.getElementById('step' + i);
            if (step) {
                step.classList.remove('active');
            }
        }
        var targetStep = document.getElementById('step' + n);
        if (targetStep) {
            targetStep.classList.add('active');
            currentStep = n;
            updateProgress();
            updateStepIndicators();
            saveProgress();
            window.scrollTo(0, 0);
        }
    }

    function nextStep(n) {
        showStep(n);
    }

    function prevStep(n) {
        showStep(n);
    }

    // ───────────────────────────────────────────────────────────────
    // ÜBUNGEN PRÜFEN
    // ───────────────────────────────────────────────────────────────
    function parseNumber(val) {
        if (!val) return NaN;
        var normalized = String(val).replace(',', '.').trim();
        return parseFloat(normalized);
    }

    function showFeedback(id, correct, message) {
        var fb = document.getElementById(id);
        fb.textContent = message;
        fb.className = 'feedback ' + (correct ? 'correct' : 'incorrect');
    }

    // Aufgabe 1a: f_G für Cäsium = 4,6·10^14 Hz
    function checkEx1a() {
        var val = parseNumber(document.getElementById('ex1a').value);
        var correct = Math.abs(val - 4.6) < 0.3;
        if (correct) {
            showFeedback('fb1a', true, '✓ Richtig! Die Grenzfrequenz liegt bei etwa 4,6 · 10¹⁴ Hz.');
        } else {
            showFeedback('fb1a', false, '✗ Nicht ganz. Lies den x-Achsenabschnitt ab (wo die Gerade die x-Achse schneidet).');
        }
    }

    // Aufgabe 1b: E_kin = h·f - W_A = 2,9 - 1,9 = 1,0 eV
    function checkEx1b() {
        var val = parseNumber(document.getElementById('ex1b').value);
        var correct = Math.abs(val - 1.0) < 0.15;
        if (correct) {
            showFeedback('fb1b', true, '✓ Richtig! E_kin = h·f - W_A = 2,9 - 1,9 = 1,0 eV');
        } else {
            showFeedback('fb1b', false, '✗ Prüfe deine Rechnung: h·f = 4,14·10⁻¹⁵ · 7·10¹⁴ ≈ 2,9 eV. Dann minus 1,9 eV.');
        }
    }

    // Aufgabe 2a: v ≈ 7,3·10^6 m/s
    function checkEx2a() {
        var val = parseNumber(document.getElementById('ex2a').value);
        var correct = Math.abs(val - 7.3) < 0.4;
        if (correct) {
            showFeedback('fb2a', true, '✓ Richtig! v ≈ 7,3 · 10⁶ m/s');
        } else {
            showFeedback('fb2a', false, '✗ Prüfe: v = √(2·1,6·10⁻¹⁹·150 / 9,1·10⁻³¹) ≈ 7,3·10⁶ m/s');
        }
    }

    // Aufgabe 2b: λ ≈ 100 pm
    function checkEx2b() {
        var val = parseNumber(document.getElementById('ex2b').value);
        var correct = Math.abs(val - 100) < 10;
        if (correct) {
            showFeedback('fb2b', true, '✓ Richtig! λ ≈ 100 pm = 1,0 · 10⁻¹⁰ m');
        } else {
            showFeedback('fb2b', false, '✗ Prüfe: λ = h/(m·v) = 6,63·10⁻³⁴/(9,1·10⁻³¹·7,3·10⁶) ≈ 100 pm');
        }
    }

    // Aufgabe 3a: Tennisball p = 2,9 kg·m/s, λ = 2,3·10^-34 m
    function checkEx3a() {
        var p = parseNumber(document.getElementById('ex3a_p').value);
        var l = parseNumber(document.getElementById('ex3a_l').value);
        var pCorrect = Math.abs(p - 2.9) < 0.3;
        var lCorrect = Math.abs(l - 2.3) < 0.3;

        if (pCorrect && lCorrect) {
            showFeedback('fb3a', true, '✓ Richtig! p = 2,9 kg·m/s, λ ≈ 2,3 · 10⁻³⁴ m');
        } else if (pCorrect) {
            showFeedback('fb3a', false, '✗ Impuls richtig! Prüfe die Wellenlänge: λ = h/p');
        } else if (lCorrect) {
            showFeedback('fb3a', false, '✗ Wellenlänge richtig! Prüfe den Impuls: p = m·v (Achtung: 58 g = 0,058 kg)');
        } else {
            showFeedback('fb3a', false, '✗ Prüfe: p = 0,058 · 50 = 2,9 kg·m/s. Dann λ = h/p.');
        }
    }

    // ───────────────────────────────────────────────────────────────
    // PERSISTENZ (localStorage)
    // ───────────────────────────────────────────────────────────────
    function saveProgress() {
        try {
            localStorage.setItem(STORAGE_KEY + '-step', currentStep);
            localStorage.setItem(STORAGE_KEY + '-visited', JSON.stringify(visitedSteps));
            var inputs = document.querySelectorAll('input');
            for (var i = 0; i < inputs.length; i++) {
                var el = inputs[i];
                if (el.id) {
                    localStorage.setItem(STORAGE_KEY + '-' + el.id, el.value);
                }
            }
        } catch (e) {}
    }

    function loadProgress() {
        try {
            var savedVisited = localStorage.getItem(STORAGE_KEY + '-visited');
            if (savedVisited) {
                visitedSteps = JSON.parse(savedVisited);
            }
            var savedStep = localStorage.getItem(STORAGE_KEY + '-step');
            if (savedStep) {
                currentStep = parseInt(savedStep);
            }
            var inputs = document.querySelectorAll('input');
            for (var i = 0; i < inputs.length; i++) {
                var el = inputs[i];
                if (el.id) {
                    var saved = localStorage.getItem(STORAGE_KEY + '-' + el.id);
                    if (saved) {
                        el.value = saved;
                    }
                }
            }
        } catch (e) {}
    }

    document.addEventListener('change', saveProgress);

    // ───────────────────────────────────────────────────────────────
    // INIT
    // ───────────────────────────────────────────────────────────────
    loadProgress();
    generateStepIndicators();
    updateProgress();

    if (currentStep > 1) {
        for (var i = 1; i <= TOTAL_STEPS; i++) {
            var step = document.getElementById('step' + i);
            if (step) step.classList.remove('active');
        }
        var targetStep = document.getElementById('step' + currentStep);
        if (targetStep) {
            targetStep.classList.add('active');
            updateStepIndicators();
        }
    }
    </script>
</body>
</html>
