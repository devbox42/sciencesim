<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Simulation: Generator</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
            padding: 10px;
            font-size: 14px;
        }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { color: #2c5aa0; font-size: 1.2em; margin-bottom: 10px; text-align: center; }
        .sim-area {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
        }
        canvas {
            display: block;
            margin: 0 auto;
            background: #fafafa;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #eee;
            justify-content: center;
            align-items: center;
        }
        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .control-group label { font-size: 0.85em; color: #555; }
        button {
            padding: 10px 20px;
            border: 1px solid #2c5aa0;
            background: #2c5aa0;
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            min-height: 44px;
        }
        button:hover { background: #1e4a8a; }
        button.secondary { background: #fff; color: #2c5aa0; }
        button.secondary:hover { background: #e3f2fd; }
        input[type="range"] {
            width: 100px;
            height: 20px;
        }
        .meters {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }
        .meter {
            text-align: center;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 8px 15px;
            min-width: 100px;
        }
        .meter-value {
            font-size: 1.4em;
            font-weight: 600;
            font-family: "Courier New", monospace;
        }
        .meter-label { font-size: 0.75em; color: #666; margin-top: 2px; }
        .positive { color: #c62828; }
        .negative { color: #1565c0; }
        .info {
            background: #e3f2fd;
            border-left: 3px solid #2c5aa0;
            padding: 10px 12px;
            margin-top: 12px;
            font-size: 0.85em;
            border-radius: 0 6px 6px 0;
        }
        .graph-container {
            margin-top: 10px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Generator: Rotierende Spule im Magnetfeld</h1>

        <div class="sim-area">
            <canvas id="generatorCanvas" width="380" height="280"></canvas>

            <div class="meters">
                <div class="meter">
                    <div class="meter-value" id="voltageDisplay">0,0 V</div>
                    <div class="meter-label">Spannung U</div>
                </div>
                <div class="meter">
                    <div class="meter-value" id="angleDisplay">0°</div>
                    <div class="meter-label">Winkel</div>
                </div>
                <div class="meter">
                    <div class="meter-value" id="rpmDisplay">0</div>
                    <div class="meter-label">U/min</div>
                </div>
            </div>

            <div class="graph-container">
                <canvas id="graphCanvas" width="370" height="100"></canvas>
            </div>

            <div class="controls">
                <button id="btnStart">▶ Start</button>
                <button id="btnStep" class="secondary">Einzelschritt</button>
                <div class="control-group">
                    <label>Drehzahl:</label>
                    <input type="range" id="speedSlider" min="10" max="120" value="60">
                </div>
            </div>
        </div>

        <div class="info">
            <strong>Beobachte genau:</strong> Bei welchem Winkel ist die Spannung maximal? Bei welchem Winkel ist U = 0? Notiere deine Beobachtungen im Arbeitsblatt!
        </div>
    </div>

    <script>
        var canvas = document.getElementById('generatorCanvas');
        var ctx = canvas.getContext('2d');
        var graphCanvas = document.getElementById('graphCanvas');
        var graphCtx = graphCanvas.getContext('2d');

        var state = {
            angle: 0,
            running: false,
            speed: 60,
            history: []
        };

        var voltageDisplay = document.getElementById('voltageDisplay');
        var angleDisplay = document.getElementById('angleDisplay');
        var rpmDisplay = document.getElementById('rpmDisplay');
        var btnStart = document.getElementById('btnStart');
        var btnStep = document.getElementById('btnStep');
        var speedSlider = document.getElementById('speedSlider');

        btnStart.addEventListener('click', function() {
            state.running = !state.running;
            btnStart.textContent = state.running ? '⏸ Pause' : '▶ Start';
        });

        btnStep.addEventListener('click', function() {
            state.running = false;
            btnStart.textContent = '▶ Start';
            state.angle += 15;
            if (state.angle >= 360) state.angle -= 360;
        });

        speedSlider.addEventListener('input', function() {
            state.speed = parseInt(this.value);
        });

        function drawGenerator() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            var cx = 190;
            var cy = 140;

            // Magnet links (N)
            ctx.fillStyle = '#c62828';
            ctx.fillRect(30, 70, 40, 140);
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 20px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('N', 50, 145);

            // Magnet rechts (S)
            ctx.fillStyle = '#1565c0';
            ctx.fillRect(310, 70, 40, 140);
            ctx.fillStyle = '#fff';
            ctx.fillText('S', 330, 145);

            // Feldlinien
            ctx.strokeStyle = '#4caf50';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            for (var i = 0; i < 5; i++) {
                var y = 90 + i * 25;
                ctx.beginPath();
                ctx.moveTo(70, y);
                ctx.lineTo(310, y);
                ctx.stroke();

                // Pfeil
                ctx.beginPath();
                ctx.moveTo(190, y);
                ctx.lineTo(183, y - 4);
                ctx.lineTo(183, y + 4);
                ctx.closePath();
                ctx.fillStyle = '#4caf50';
                ctx.fill();
            }
            ctx.setLineDash([]);

            // Spule (rotierend)
            var rad = state.angle * Math.PI / 180;
            var spuleWidth = 80;
            var spuleHeight = 60;

            // Projektion der Spule
            var projectedWidth = spuleWidth * Math.cos(rad);

            ctx.save();
            ctx.translate(cx, cy);

            // Spulenrahmen
            ctx.strokeStyle = '#b35c00';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(-projectedWidth/2, -spuleHeight/2);
            ctx.lineTo(projectedWidth/2, -spuleHeight/2);
            ctx.lineTo(projectedWidth/2, spuleHeight/2);
            ctx.lineTo(-projectedWidth/2, spuleHeight/2);
            ctx.closePath();
            ctx.stroke();

            // Achse
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(0, -spuleHeight/2 - 20);
            ctx.lineTo(0, -spuleHeight/2);
            ctx.moveTo(0, spuleHeight/2);
            ctx.lineTo(0, spuleHeight/2 + 20);
            ctx.stroke();

            // Stromrichtungspfeile auf der Spule (wenn Spannung vorhanden)
            var voltage = Math.cos(rad); // cos, weil U ∝ dΦ/dt
            if (Math.abs(voltage) > 0.1) {
                ctx.fillStyle = voltage > 0 ? '#c62828' : '#1565c0';
                var arrowDir = voltage > 0 ? 1 : -1;

                // Oberer Teil
                ctx.beginPath();
                ctx.moveTo(0, -spuleHeight/2 + 10);
                ctx.lineTo(-6 * arrowDir, -spuleHeight/2 + 16);
                ctx.lineTo(6 * arrowDir, -spuleHeight/2 + 16);
                ctx.closePath();
                ctx.fill();
            }

            ctx.restore();

            // Winkelanzeige
            ctx.strokeStyle = '#999';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.arc(cx, cy, 40, 0, rad, rad < 0);
            ctx.stroke();

            // Schleifkontakte / Bürsten
            ctx.fillStyle = '#555';
            ctx.fillRect(cx - 5, cy + spuleHeight/2 + 20, 10, 15);
            ctx.fillRect(cx - 5, cy - spuleHeight/2 - 35, 10, 15);

            // Anschlüsse
            ctx.strokeStyle = '#b35c00';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(cx, cy + spuleHeight/2 + 35);
            ctx.lineTo(cx, cy + spuleHeight/2 + 50);
            ctx.lineTo(cx + 60, cy + spuleHeight/2 + 50);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(cx, cy - spuleHeight/2 - 35);
            ctx.lineTo(cx, cy - spuleHeight/2 - 50);
            ctx.lineTo(cx + 60, cy - spuleHeight/2 - 50);
            ctx.stroke();

            // Voltmeter-Symbol
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(cx + 80, cy, 18, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.fillStyle = '#333';
            ctx.font = 'bold 14px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('V', cx + 80, cy + 5);

            // Verbindung zum Voltmeter
            ctx.strokeStyle = '#b35c00';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(cx + 60, cy - spuleHeight/2 - 50);
            ctx.lineTo(cx + 80, cy - spuleHeight/2 - 50);
            ctx.lineTo(cx + 80, cy - 18);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(cx + 60, cy + spuleHeight/2 + 50);
            ctx.lineTo(cx + 80, cy + spuleHeight/2 + 50);
            ctx.lineTo(cx + 80, cy + 18);
            ctx.stroke();
        }

        function drawGraph() {
            graphCtx.fillStyle = '#fff';
            graphCtx.fillRect(0, 0, graphCanvas.width, graphCanvas.height);

            // Achsen
            graphCtx.strokeStyle = '#ccc';
            graphCtx.lineWidth = 1;

            // Horizontale Mittellinie (U = 0)
            graphCtx.beginPath();
            graphCtx.moveTo(30, 50);
            graphCtx.lineTo(graphCanvas.width - 10, 50);
            graphCtx.stroke();

            // Vertikale Achse
            graphCtx.beginPath();
            graphCtx.moveTo(30, 10);
            graphCtx.lineTo(30, 90);
            graphCtx.stroke();

            // Beschriftung
            graphCtx.fillStyle = '#666';
            graphCtx.font = '10px sans-serif';
            graphCtx.textAlign = 'right';
            graphCtx.fillText('+U', 25, 15);
            graphCtx.fillText('0', 25, 53);
            graphCtx.fillText('-U', 25, 93);
            graphCtx.textAlign = 'center';
            graphCtx.fillText('Zeit t', graphCanvas.width - 30, 95);

            // Spannungskurve
            if (state.history.length > 1) {
                graphCtx.strokeStyle = '#2c5aa0';
                graphCtx.lineWidth = 2;
                graphCtx.beginPath();

                var xScale = (graphCanvas.width - 50) / 200;
                var startIdx = Math.max(0, state.history.length - 200);

                for (var i = startIdx; i < state.history.length; i++) {
                    var x = 35 + (i - startIdx) * xScale;
                    var y = 50 - state.history[i] * 35;

                    if (i === startIdx) {
                        graphCtx.moveTo(x, y);
                    } else {
                        graphCtx.lineTo(x, y);
                    }
                }
                graphCtx.stroke();
            }

            // Aktuelle Position markieren
            if (state.history.length > 0) {
                var lastV = state.history[state.history.length - 1];
                var x = 35 + Math.min(state.history.length - 1, 199) * ((graphCanvas.width - 50) / 200);
                var y = 50 - lastV * 35;

                graphCtx.fillStyle = lastV >= 0 ? '#c62828' : '#1565c0';
                graphCtx.beginPath();
                graphCtx.arc(x, y, 5, 0, Math.PI * 2);
                graphCtx.fill();
            }
        }

        function updateDisplays() {
            var rad = state.angle * Math.PI / 180;
            var voltage = Math.cos(rad) * 3; // Max 3V - cos weil U ∝ -dΦ/dt, Φ ∝ sin(θ)

            // Spannung
            var sign = voltage >= 0 ? '+' : '−';
            var absV = Math.abs(voltage);
            voltageDisplay.textContent = (absV < 0.05 ? '0,0' : sign + absV.toFixed(1).replace('.', ',')) + ' V';
            voltageDisplay.className = 'meter-value' + (voltage > 0.1 ? ' positive' : (voltage < -0.1 ? ' negative' : ''));

            // Winkel
            angleDisplay.textContent = Math.round(state.angle) + '°';

            // Drehzahl
            rpmDisplay.textContent = state.speed;

            // History für Graph
            state.history.push(voltage / 3); // Normiert auf -1 bis 1
            if (state.history.length > 400) {
                state.history.shift();
            }
        }

        function animate() {
            if (state.running) {
                state.angle += state.speed / 60;
                if (state.angle >= 360) state.angle -= 360;
            }

            updateDisplays();
            drawGenerator();
            drawGraph();

            requestAnimationFrame(animate);
        }

        animate();
    </script>
</body>
</html>
