<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Lernpfad: Reibungskr√§fte (komplett)</title>
    <style>
        :root {
            --physik: #2c5aa0;
            --physik-light: #e8f0f8;
            --success: #2a7a4b;
            --success-bg: #e8f5e9;
            --warning: #b35c00;
            --warning-bg: #fff3e0;
            --error: #c62828;
            --error-bg: #ffebee;
            --bg: #f5f5f5;
            --white: #ffffff;
            --border: #dddddd;
            --text: #222222;
            --text-secondary: #555555;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { -webkit-text-size-adjust: 100%; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            font-size: 16px;
            line-height: 1.6;
            -webkit-user-select: none;
            user-select: none;
        }

        .container { max-width: 800px; margin: 0 auto; padding: 20px; }

        header {
            background: var(--physik);
            color: white;
            padding: 20px;
            margin: -20px -20px 20px -20px;
            position: relative;
        }
        header h1 { font-size: 1.4em; font-weight: 600; }
        header .meta { font-size: 0.85em; opacity: 0.9; margin-top: 5px; }

        .btn-reset {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.4);
            font-size: 0.8em;
            padding: 8px 12px;
            position: absolute;
            top: 15px;
            right: 15px;
            cursor: pointer;
            min-width: 44px;
            min-height: 44px;
            touch-action: manipulation;
        }

        .progress-bar { background: var(--border); height: 6px; }
        .progress-fill { background: var(--physik); height: 100%; width: 0%; transition: width 0.3s; }

        .step-indicators {
            display: flex;
            justify-content: center;
            gap: 4px;
            padding: 12px;
            flex-wrap: wrap;
        }

        .step-dot {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85em;
            font-weight: 600;
            border: 2px solid var(--border);
            background: var(--white);
            cursor: pointer;
            color: var(--text-secondary);
            border-radius: 4px;
            touch-action: manipulation;
        }
        .step-dot.current { background: var(--physik); border-color: var(--physik); color: white; }
        .step-dot.completed { background: var(--success); border-color: var(--success); color: white; }

        .step {
            background: var(--white);
            border: 1px solid var(--border);
            padding: 20px;
            margin-bottom: 15px;
            display: none;
        }
        .step.active { display: block; }

        .step-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }
        .step-number {
            background: var(--physik);
            color: white;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9em;
        }
        .step-title { font-weight: 600; color: var(--physik); }

        .stern { color: var(--warning); font-weight: bold; }

        h2 { font-size: 1.1em; font-weight: 600; margin: 20px 0 10px 0; color: var(--text); }
        p { margin-bottom: 12px; }
        ul, ol { margin: 10px 0 10px 20px; }
        li { margin-bottom: 5px; }

        .info-box {
            background: var(--physik-light);
            border-left: 4px solid var(--physik);
            padding: 12px 15px;
            margin: 15px 0;
            font-size: 0.95em;
            -webkit-user-select: text;
            user-select: text;
        }

        .merksatz {
            background: var(--success-bg);
            border: 2px solid var(--success);
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }
        .merksatz strong { color: var(--success); }

        .alltagsbezug {
            background: #f3e5f5;
            border-left: 4px solid #7b1fa2;
            padding: 12px 15px;
            margin: 15px 0;
            font-size: 0.9em;
        }
        .alltagsbezug strong { color: #7b1fa2; }

        .hefter-hinweis {
            background: var(--warning-bg);
            border: 2px solid var(--warning);
            padding: 12px 15px;
            margin: 15px 0;
            font-size: 0.9em;
        }
        .hefter-hinweis::before {
            content: "Arbeitsblatt";
            display: inline-block;
            background: var(--warning);
            color: white;
            font-size: 0.75em;
            font-weight: 600;
            padding: 2px 8px;
            margin-bottom: 8px;
        }

        .animation-container {
            background: #f8f9fa;
            border: 2px solid var(--physik);
            border-radius: 4px;
            padding: 20px;
            margin: 15px 0;
            min-height: 200px;
        }

        .ani-title { font-size: 0.8em; color: #666; margin-bottom: 10px; }

        .ani-canvas {
            background: #ffffff;
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
            min-height: 150px;
            position: relative;
            overflow: hidden;
        }

        .ani-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .ani-btn {
            background: var(--physik);
            color: white;
            border: none;
            padding: 10px 18px;
            cursor: pointer;
            font-size: 0.9em;
            border-radius: 4px;
            min-width: 44px;
            min-height: 44px;
            touch-action: manipulation;
        }
        .ani-btn:hover { background: #1e4a8a; }
        .ani-btn:disabled { background: #aaa; cursor: not-allowed; }

        .ani-display {
            background: var(--physik-light);
            border: 1px solid var(--physik);
            padding: 8px 12px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
        }

        .ani-info {
            background: var(--physik-light);
            border-left: 3px solid var(--physik);
            padding: 8px 12px;
            margin-top: 10px;
            font-size: 0.85em;
        }

        .ani-slider-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .ani-slider-group label { font-size: 0.85em; color: #555; }
        .ani-slider { width: 120px; height: 44px; }

        .klotz {
            width: 80px;
            height: 50px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border: 2px solid #922b21;
            position: absolute;
            bottom: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8em;
            color: white;
        }

        .tisch {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(0deg, #5d4e37, #8b7355);
            border-top: 3px solid #3d3225;
        }

        .kraftpfeil {
            position: absolute;
            height: 4px;
            background: #f39c12;
            top: 50%;
            transform: translateY(-50%);
        }
        .kraftpfeil::after {
            content: '';
            position: absolute;
            right: -10px;
            top: -6px;
            border: 8px solid transparent;
            border-left: 12px solid #f39c12;
        }

        .strasse {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: #333;
        }
        .strasse-markierung {
            position: absolute;
            bottom: 22px;
            height: 6px;
            background: white;
        }

        .auto {
            position: absolute;
            bottom: 50px;
            width: 100px;
            height: 40px;
        }
        .auto-body {
            width: 100%;
            height: 25px;
            background: linear-gradient(0deg, #2980b9, #3498db);
            border-radius: 5px 5px 0 0;
            position: absolute;
            bottom: 15px;
        }
        .auto-wheel {
            width: 20px;
            height: 20px;
            background: #222;
            border-radius: 50%;
            position: absolute;
            bottom: 0;
            border: 3px solid #444;
        }
        .auto-wheel.left { left: 10px; }
        .auto-wheel.right { right: 10px; }

        .vergleich-tabelle {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9em;
        }
        .vergleich-tabelle th, .vergleich-tabelle td {
            border: 1px solid var(--border);
            padding: 10px;
            text-align: center;
        }
        .vergleich-tabelle th { background: var(--physik); color: white; }

        .formel-box {
            background: var(--physik-light);
            border: 2px solid var(--physik);
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }
        .formel {
            font-family: "Times New Roman", Times, serif;
            font-size: 1.6em;
            font-style: italic;
        }
        .formel sub { font-size: 0.65em; }

        .formel-dreieck-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .dreieck-cell {
            cursor: pointer;
            transition: all 0.2s;
            touch-action: manipulation;
        }
        .dreieck-cell:hover { filter: brightness(1.1); }
        .dreieck-cell.hidden { opacity: 0.15; }

        .formel-result {
            text-align: center;
            padding: 20px;
            background: var(--success-bg);
            border: 2px solid var(--success);
            min-width: 250px;
        }
        .formel-result h4 { color: var(--success); margin-bottom: 10px; }
        .formel-big {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--success);
            font-family: "Times New Roman", serif;
        }
        .formel-big sub { font-size: 0.6em; }

        .frac {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            vertical-align: middle;
            margin: 0 0.2em;
        }
        .frac-num {
            border-bottom: 2px solid currentColor;
            padding: 0 0.3em 0.1em 0.3em;
            line-height: 1.2;
        }
        .frac-den {
            padding: 0.1em 0.3em 0 0.3em;
            line-height: 1.2;
        }
        .formel-big .frac { font-size: 0.7em; }

        .quiz-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        .quiz-option {
            padding: 12px 20px;
            border: 2px solid var(--border);
            background: white;
            cursor: pointer;
            font-size: 1em;
            min-width: 44px;
            min-height: 44px;
            touch-action: manipulation;
        }
        .quiz-option:hover { border-color: var(--physik); background: var(--physik-light); }
        .quiz-option.correct { border-color: var(--success); background: var(--success-bg); }
        .quiz-option.incorrect { border-color: var(--error); background: var(--error-bg); }

        .beispiel-liste {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }
        .beispiel-chip {
            background: var(--physik-light);
            border: 1px solid var(--physik);
            padding: 5px 12px;
            font-size: 0.9em;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }
        .btn {
            padding: 12px 24px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            font-weight: 600;
            min-width: 44px;
            min-height: 44px;
            touch-action: manipulation;
        }
        .btn-primary { background: var(--physik); color: white; }
        .btn-secondary { background: var(--border); color: var(--text); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .pause-hinweis {
            background: #e3f2fd;
            border: 2px dashed #1976d2;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            color: #1565c0;
        }

        /* ABS Diagramm */
        .abs-diagram {
            display: flex;
            align-items: center;
            gap: 5px;
            height: 40px;
            margin: 10px 0;
        }
        .abs-bar {
            height: 100%;
            min-width: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            color: white;
            font-weight: bold;
        }
        .abs-bar.haft { background: var(--success); }
        .abs-bar.gleit { background: var(--error); }

        /* Klickbare L√ºcken */
        .luecke-klick {
            border-bottom: 2px dashed var(--physik);
            padding: 10px 16px;
            cursor: pointer;
            color: var(--physik);
            font-weight: bold;
            transition: all 0.2s;
            display: inline-block;
            min-height: 44px;
            line-height: 24px;
            touch-action: manipulation;
        }
        .luecke-klick:hover { background: var(--physik-light); }
        .luecke-klick.geloest {
            border-bottom: 2px solid var(--success);
            color: var(--success);
            cursor: default;
            background: var(--success-bg);
        }

        /* Memory */
        .memory-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-width: 400px;
            margin: 20px auto;
        }
        .memory-card {
            aspect-ratio: 1;
            min-height: 70px;
            background: var(--physik);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75em;
            font-weight: bold;
            color: white;
            text-align: center;
            padding: 5px;
            transition: all 0.3s;
            touch-action: manipulation;
        }
        .memory-card:hover { transform: scale(1.05); }
        .memory-card.flipped {
            background: var(--white);
            color: var(--text);
            border: 2px solid var(--physik);
        }
        .memory-card.matched {
            background: var(--success-bg);
            color: var(--success);
            border: 2px solid var(--success);
            cursor: default;
        }
        .memory-card.matched:hover { transform: none; }
        .memory-stats {
            text-align: center;
            margin: 15px 0;
            font-size: 0.9em;
        }

        /* Zusatz-Hinweis */
        .zusatz-hinweis {
            background: #f3e5f5;
            border: 2px solid #7b1fa2;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }
        .zusatz-hinweis strong { color: #7b1fa2; }

        @media (max-width: 600px) {
            .container { padding: 10px; }
            header { margin: -10px -10px 15px -10px; padding: 15px; }
            .step { padding: 15px; }
            .formel-dreieck-container { flex-direction: column; }
            .step-dot { width: 44px; height: 44px; font-size: 0.75em; }
            .memory-container { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Lernpfad: Reibungskr√§fte</h1>
            <div class="meta">Physik Klasse 7 ‚Äì Doppelstunde</div>
            <button class="btn-reset" onclick="resetLernpfad()">Neu starten</button>
        </header>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="step-indicators" id="stepIndicators"></div>

        <!-- SCHRITT 1: Einstieg -->
        <div class="step active" id="step1">
            <div class="step-header">
                <span class="step-number">1</span>
                <span class="step-title">Reibung im Alltag</span>
            </div>

            <p>Stell dir vor: Du schiebst einen schweren Schrank √ºber den Boden. Warum ist das so anstrengend?</p>

            <div class="alltagsbezug">
                <strong>Reibung begegnet dir √ºberall:</strong>
                <div class="beispiel-liste">
                    <span class="beispiel-chip">Bremsen am Fahrrad</span>
                    <span class="beispiel-chip">Schuhe auf dem Boden</span>
                    <span class="beispiel-chip">Autoreifen auf Stra√üe</span>
                    <span class="beispiel-chip">H√§nde aneinander reiben</span>
                    <span class="beispiel-chip">Streichholz anz√ºnden</span>
                </div>
            </div>

            <div class="info-box">
                <strong>Was ist Reibung?</strong><br>
                Reibung ist eine <strong>Kraft</strong>, die einer Bewegung entgegenwirkt. Sie entsteht, wenn zwei Oberfl√§chen aneinander vorbeigleiten oder gleiten wollen.
            </div>

            <div class="hefter-hinweis">
                <strong>K1 lesen:</strong> Lies den Infokasten auf dem Arbeitsblatt. Schreibe deinen Namen und das Datum!
            </div>

            <div class="nav-buttons">
                <span></span>
                <button class="btn btn-primary" onclick="nextStep()">Weiter</button>
            </div>
        </div>

        <!-- SCHRITT 2: Animation Haftreibung -->
        <div class="step" id="step2">
            <div class="step-header">
                <span class="step-number">2</span>
                <span class="step-title">Ph√§nomen: Klotz anschieben</span>
            </div>

            <p>Beobachte genau, was passiert, wenn du versuchst einen Klotz zu schieben:</p>

            <div class="animation-container" id="ani1-container">
                <div class="ani-title">Animation: Haftreibung und Gleitreibung</div>
                <div class="ani-canvas" id="ani1-canvas" style="height: 150px;">
                    <div class="tisch"></div>
                    <div class="klotz" id="ani1-klotz" style="left: 50px;">Klotz</div>
                    <div class="kraftpfeil" id="ani1-pfeil" style="left: 130px; width: 0px;"></div>
                </div>
                <div class="ani-controls">
                    <button class="ani-btn" id="ani1-play" onclick="playAni1()">Play</button>
                    <button class="ani-btn" onclick="resetAni1()">Reset</button>
                    <div class="ani-display" id="ani1-kraft">Kraft: 0 N</div>
                    <div class="ani-display" id="ani1-status">Zustand: Ruhe</div>
                </div>
                <div class="ani-info" id="ani1-info">
                    Dr√ºcke Play und beobachte: Wann beginnt der Klotz zu gleiten?
                </div>
            </div>

            <div class="hefter-hinweis">
                <strong>B1 ausf√ºllen:</strong> Erg√§nze: ‚ÄûUm den Klotz zu bewegen, muss die Kraft erst..."
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zur√ºck</button>
                <button class="btn btn-primary" onclick="nextStep()">Weiter</button>
            </div>
        </div>


        <!-- SCHRITT 3: Hypothese -->
        <div class="step" id="step3">
            <div class="step-header">
                <span class="step-number">3</span>
                <span class="step-title">Hypothese: Was vermutest du?</span>
            </div>

            <p>Bevor du ein Experiment machst, solltest du eine <strong>Vermutung</strong> (Hypothese) aufstellen.</p>

            <div class="info-box">
                <strong>Nachdenken:</strong> Es gibt drei Reibungsarten ‚Äì <em>Haftreibung</em> (Klotz klebt fest), <em>Gleitreibung</em> (Klotz rutscht) und <em>Rollreibung</em> (Rad rollt). Welche Kraft ist wohl am gr√∂√üten?
            </div>

            <h2>Meine Vermutung:</h2>
            <p>Was glaubst du ‚Äì welche Reihenfolge stimmt?</p>
            <div class="quiz-options" id="hypothese-options">
                <div class="quiz-option" style="flex: 1; text-align: center;" onclick="selectHypothese(this)">Haftreibung &gt; Gleitreibung &gt; Rollreibung</div>
                <div class="quiz-option" style="flex: 1; text-align: center;" onclick="selectHypothese(this)">Rollreibung &gt; Gleitreibung &gt; Haftreibung</div>
                <div class="quiz-option" style="flex: 1; text-align: center;" onclick="selectHypothese(this)">Gleitreibung &gt; Haftreibung &gt; Rollreibung</div>
            </div>
            <div id="hypothese-feedback" style="display:none;" class="ani-info">
                <strong>Gut!</strong> Deine Vermutung ist notiert. Ob sie stimmt, pr√ºfst du im n√§chsten Schritt mit einem Experiment!
            </div>

            <div class="hefter-hinweis">
                <strong>H1 ausf√ºllen:</strong> Kreuze auf dem Arbeitsblatt an, welche Reihenfolge du vermutest.
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zur√ºck</button>
                <button class="btn btn-primary" onclick="nextStep()">Weiter zum Experiment</button>
            </div>
        </div>

        <!-- SCHRITT 4: Simulation Kraftmesser -->
        <div class="step" id="step4">
            <div class="step-header">
                <span class="step-number">4</span>
                <span class="step-title">Experiment: Drei Reibungsarten messen</span>
            </div>

            <p>Jetzt misst du die Reibungskraft f√ºr drei verschiedene F√§lle:</p>

            <div class="animation-container" id="sim-container">
                <div class="ani-title">Simulation: Federkraftmesser</div>
                <div class="ani-canvas" id="sim-canvas" style="height: 180px; position: relative;">
                    <div class="tisch"></div>
                    <div class="klotz" id="sim-klotz" style="left: 30px; width: 70px; height: 45px;">
                        <span id="sim-klotz-icon">Klotz</span>
                    </div>
                    <svg id="sim-feder-svg" style="position: absolute; left: 100px; bottom: 52px; overflow: visible;" width="80" height="30">
                        <path id="sim-feder-path" d="M0,15 L8,5 L16,25 L24,5 L32,25 L40,5 L48,25 L56,5 L64,25 L72,15 L80,15"
                              stroke="#f39c12" stroke-width="3" fill="none"/>
                    </svg>
                    <div id="sim-kraftmesser" style="position: absolute; left: 180px; bottom: 42px; background: linear-gradient(180deg, #e0e0e0 0%, #c0c0c0 100%); border: 2px solid #888; border-radius: 6px; padding: 8px 12px; text-align: center;">
                        <div style="font-size: 0.65em; color: #555; margin-bottom: 2px;">KRAFTMESSER</div>
                        <div style="background: #f0f0f0; padding: 4px 8px; border-radius: 3px; border: 1px solid #ccc;">
                            <span style="font-size: 1.4em; font-weight: bold; color: #b35c00; font-family: monospace;" id="sim-wert">0.0 N</span>
                        </div>
                    </div>
                    <div id="sim-hand" style="position: absolute; left: 280px; bottom: 48px; font-size: 2em;">‚úã</div>
                    <div id="sim-pfeil" style="position: absolute; left: 310px; bottom: 55px; color: #27ae60; font-size: 1.5em; opacity: 0;">‚Üí‚Üí</div>
                </div>
                <div class="ani-controls">
                    <div class="ani-slider-group">
                        <label>Modus:</label>
                        <select id="sim-modus" onchange="resetSim()" style="padding: 8px; min-height: 44px;">
                            <option value="haft">Haftreibung (Losbrechkraft)</option>
                            <option value="gleit">Gleitreibung</option>
                            <option value="roll">Rollreibung</option>
                        </select>
                    </div>
                    <button class="ani-btn" id="sim-btn" onclick="messenSim()">Messen</button>
                    <button class="ani-btn" onclick="resetSim()">Reset</button>
                </div>
                <div class="ani-info" id="sim-info">
                    W√§hle einen Modus und dr√ºcke ‚ÄûMessen". Trage die Werte in Tabelle T1 ein!
                </div>
            </div>

            <div class="hefter-hinweis">
                <strong>T1 ausf√ºllen:</strong>
                <ul>
                    <li><strong>Haftreibung</strong> (Losbrechkraft): ___ N</li>
                    <li><strong>Gleitreibung</strong>: ___ N</li>
                    <li><strong>Rollreibung</strong>: ___ N</li>
                </ul>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zur√ºck</button>
                <button class="btn btn-primary" onclick="nextStep()">Weiter</button>
            </div>
        </div>

        <!-- SCHRITT 5: Erkenntnis Reihenfolge -->
        <div class="step" id="step5">
            <div class="step-header">
                <span class="step-number">5</span>
                <span class="step-title">Erkenntnis: Die Reihenfolge</span>
            </div>

            <p>Vergleiche deine Messwerte aus Tabelle T1. Welche Reibungsart ist am st√§rksten?</p>

            <h2>Ordne die Reibungsarten nach Gr√∂√üe:</h2>
            <div class="quiz-options" id="order-quiz">
                <div class="quiz-option" onclick="checkOrdering(this, 'haft')" style="flex:1; text-align:center;">F<sub>Haft</sub> &gt; F<sub>Gleit</sub> &gt; F<sub>Roll</sub></div>
                <div class="quiz-option" onclick="checkOrdering(this, 'gleit')" style="flex:1; text-align:center;">F<sub>Gleit</sub> &gt; F<sub>Haft</sub> &gt; F<sub>Roll</sub></div>
                <div class="quiz-option" onclick="checkOrdering(this, 'roll')" style="flex:1; text-align:center;">F<sub>Roll</sub> &gt; F<sub>Gleit</sub> &gt; F<sub>Haft</sub></div>
            </div>
            <div class="ani-info" id="ordering-fb" style="display:none;"></div>

            <div id="ordering-merksatz" style="display:none;">
                <div class="merksatz">
                    <strong>Merksatz ‚Äì Die drei Reibungsarten:</strong><br>
                    F<sub>Haft</sub> &gt; F<sub>Gleit</sub> &gt; F<sub>Roll</sub><br><br>
                    <em>Die Haftreibung ist am gr√∂√üten, die Rollreibung am kleinsten!</em><br>
                    Deshalb ist das Erfinden des <strong>Rades</strong> so wichtig: Rollreibung statt Gleitreibung!
                </div>
            </div>

            <div class="hefter-hinweis">
                <strong>B2 und K2 ausf√ºllen:</strong>
                <ul>
                    <li>Setze die Zeichen &gt; oder &lt; ein</li>
                    <li>Erg√§nze den Merkkasten zu den drei Reibungsarten</li>
                </ul>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zur√ºck</button>
                <button class="btn btn-primary" onclick="nextStep()">Weiter</button>
            </div>
        </div>

        <!-- SCHRITT 6: Einflussfaktoren -->
        <div class="step" id="step6">
            <div class="step-header">
                <span class="step-number">6</span>
                <span class="step-title">Experiment: Einflussfaktoren</span>
            </div>

            <p>Wovon h√§ngt die Reibungskraft ab? Probiere es aus!</p>

            <div class="animation-container" id="sim5b-container">
                <div class="ani-title">Simulation: Einflussfaktoren der Reibung</div>
                <div class="ani-canvas" id="sim5b-canvas" style="height: 140px;">
                    <div id="sim5b-oberflaeche" style="position: absolute; bottom: 0; left: 0; right: 0; height: 40px; background: #8b7355;"></div>
                    <div class="klotz" id="sim5b-klotz" style="left: 100px; width: 60px; height: 40px;">
                        <span id="sim5b-gewicht-text" style="font-size: 0.7em;">5 N</span>
                    </div>
                </div>
                <div class="ani-controls" style="flex-direction: column; align-items: flex-start; gap: 12px;">
                    <div class="ani-slider-group">
                        <label style="width: 100px;">Gewichtskraft:</label>
                        <input type="range" class="ani-slider" id="sim5b-gewicht" min="2" max="20" value="5" oninput="updateSim5b()">
                        <span id="sim5b-gewicht-val">5 N</span>
                    </div>
                    <div class="ani-slider-group">
                        <label style="width: 100px;">Oberfl√§che:</label>
                        <input type="range" class="ani-slider" id="sim5b-rauheit" min="1" max="3" value="2" oninput="updateSim5b()">
                        <span id="sim5b-rauheit-val">mittel</span>
                    </div>
                    <div class="ani-display" style="font-size: 1.1em;">
                        Reibungskraft: <strong id="sim5b-reibung">2.5 N</strong>
                    </div>
                </div>
            </div>

            <h2>Messwerte aufnehmen</h2>
            <p>Stelle die Oberfl√§che auf <strong>mittel</strong>. Miss die Reibungskraft f√ºr verschiedene Gewichte:</p>

            <table class="vergleich-tabelle" id="messwert-tabelle">
                <tr>
                    <th>F<sub>N</sub> (Gewichtskraft)</th>
                    <th>F<sub>R</sub> (Reibungskraft)</th>
                    <th>F<sub>R</sub> √∑ F<sub>N</sub></th>
                </tr>
                <tr>
                    <td>5 N</td>
                    <td><button class="ani-btn" style="font-size:0.8em; padding:6px 12px;" onclick="recordMesswert(5)">√úbernehmen</button> <span id="mess-5">‚Äî</span></td>
                    <td id="quot-5">‚Äî</td>
                </tr>
                <tr>
                    <td>10 N</td>
                    <td><button class="ani-btn" style="font-size:0.8em; padding:6px 12px;" onclick="recordMesswert(10)">√úbernehmen</button> <span id="mess-10">‚Äî</span></td>
                    <td id="quot-10">‚Äî</td>
                </tr>
                <tr>
                    <td>15 N</td>
                    <td><button class="ani-btn" style="font-size:0.8em; padding:6px 12px;" onclick="recordMesswert(15)">√úbernehmen</button> <span id="mess-15">‚Äî</span></td>
                    <td id="quot-15">‚Äî</td>
                </tr>
            </table>

            <div id="mess-erkenntnis" style="display:none;">
                <div class="merksatz">
                    <strong>Erkenntnis:</strong> Der Quotient F<sub>R</sub> √∑ F<sub>N</sub> ist immer gleich!<br>
                    Das ist die <strong>Reibungszahl Œº</strong> (gesprochen: ‚Äûm√º"). Mehr dazu im Formel-Schritt!
                </div>
            </div>

            <div id="merksatz-einflussfaktoren" style="display:none;">
                <div class="merksatz">
                    <strong>Merksatz ‚Äì Einflussfaktoren:</strong><br>
                    Die Reibungskraft h√§ngt ab von:<br>
                    1. der <strong>Normalkraft</strong> (= Gewichtskraft auf ebener Fl√§che)<br>
                    2. der <strong>Oberfl√§chenbeschaffenheit</strong> (rau/glatt ‚Üí Reibungszahl Œº)
                </div>
            </div>

            <div class="hefter-hinweis">
                <strong>B3/B4 und K4 ausf√ºllen:</strong>
                <ul>
                    <li>B3: Mehr Gewichtskraft = <strong>___</strong> Reibung</li>
                    <li>B4: Rauere Oberfl√§che = <strong>___</strong> Reibung</li>
                    <li>K4: √úbertrage Messwerte in die Tabelle und erg√§nze den Merksatz</li>
                </ul>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zur√ºck</button>
                <button class="btn btn-primary" onclick="nextStep()">Weiter</button>
            </div>
        </div>

        <!-- SCHRITT 7: Erw√ºnscht/Unerw√ºnscht -->
        <div class="step" id="step7">
            <div class="step-header">
                <span class="step-number">7</span>
                <span class="step-title">Erw√ºnschte und unerw√ºnschte Reibung</span>
            </div>

            <p>Reibung kann n√ºtzlich oder st√∂rend sein. <strong>√úberlege zuerst selbst</strong>, bevor du die Beispiele aufdeckst!</p>

            <div class="hefter-hinweis">
                <strong>T2, A1 und K5 ausf√ºllen!</strong>
                <ul>
                    <li>Finde eigene Beispiele f√ºr erw√ºnschte und unerw√ºnschte Reibung</li>
                    <li>Aufgabe A1: Wo ist beim Fahrrad Reibung erw√ºnscht/unerw√ºnscht?</li>
                    <li>K5: Erg√§nze den Merksatz ‚ÄûReibung verringern"</li>
                </ul>
            </div>

            <button class="ani-btn" id="btn-alltag-reveal" onclick="document.getElementById('alltag-reveal').style.display='block'; this.style.display='none';" style="margin: 15px 0;">Beispiele aufdecken</button>

            <div id="alltag-reveal" style="display:none;">
                <table class="vergleich-tabelle">
                    <tr>
                        <th style="background: var(--success);">Erw√ºnscht</th>
                        <th style="background: var(--error);">Unerw√ºnscht</th>
                    </tr>
                    <tr>
                        <td>Bremsen funktionieren</td>
                        <td>Motor verschlei√üt</td>
                    </tr>
                    <tr>
                        <td>Schuhe rutschen nicht</td>
                        <td>Energie geht verloren</td>
                    </tr>
                    <tr>
                        <td>Schrauben halten</td>
                        <td>Gelenke nutzen ab</td>
                    </tr>
                </table>

                <div class="merksatz">
                    <strong>Merksatz ‚Äì Reibung verringern:</strong><br>
                    Reibung kann verringert werden durch:<br>
                    <strong>Schmiermittel</strong> (√ñl, Fett), <strong>glatte Oberfl√§chen</strong> und <strong>Kugellager</strong> (Rollreibung statt Gleitreibung).
                </div>
            </div>

            <div class="pause-hinweis">
                ‚òï PAUSE ‚òï<br>
                <span style="font-weight: normal; font-size: 0.9em;">Kurze Pause ‚Äì dann geht es mit der Formel weiter!</span>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zur√ºck</button>
                <button class="btn btn-primary" onclick="nextStep()">Weiter zur Formel</button>
            </div>
        </div>

        <!-- SCHRITT 8: Formel -->
        <div class="step" id="step8">
            <div class="step-header">
                <span class="step-number">8</span>
                <span class="step-title">Die Reibungsformel</span>
            </div>

            <p>Die Zusammenh√§nge lassen sich auch als Formel ausdr√ºcken:</p>

            <div class="formel-box">
                <div class="formel">F<sub>R</sub> = Œº ¬∑ F<sub>N</sub></div>
                <p style="margin-top: 10px; font-size: 0.9em;">
                    F<sub>R</sub> = Reibungskraft in N<br>
                    Œº = Reibungszahl (griechisch ‚Äûm√º", keine Einheit)<br>
                    F<sub>N</sub> = Normalkraft in N<br>
                    <em style="font-size: 0.85em; color: var(--text-secondary);">Die Normalkraft ist die Kraft, mit der ein Gegenstand auf die Unterlage dr√ºckt. Auf waagerechter Fl√§che ist sie gleich der Gewichtskraft.</em>
                </p>
            </div>

            <h2>Das Formel-Dreieck</h2>
            <p>Klicke auf die Gr√∂√üe, die du berechnen willst:</p>

            <div class="animation-container">
                <div class="formel-dreieck-container">
                    <svg width="200" height="180" viewBox="0 0 200 180">
                        <polygon points="100,10 20,160 180,160" fill="none" stroke="#2c5aa0" stroke-width="3"/>
                        <line x1="40" y1="85" x2="160" y2="85" stroke="#2c5aa0" stroke-width="2"/>
                        <line x1="100" y1="85" x2="100" y2="160" stroke="#2c5aa0" stroke-width="2"/>

                        <g class="dreieck-cell" id="cell-fr" onclick="selectFormel('fr')">
                            <polygon points="100,15 45,80 155,80" fill="#ffebee"/>
                            <text x="100" y="58" text-anchor="middle" font-size="24" font-weight="bold" fill="#c62828">F<tspan baseline-shift="sub" font-size="14">R</tspan></text>
                        </g>

                        <g class="dreieck-cell" id="cell-mu" onclick="selectFormel('mu')">
                            <polygon points="42,90 25,155 95,155 95,90" fill="#e3f2fd"/>
                            <text x="65" y="130" text-anchor="middle" font-size="28" font-weight="bold" fill="#1565c0">Œº</text>
                        </g>

                        <g class="dreieck-cell" id="cell-fn" onclick="selectFormel('fn')">
                            <polygon points="105,90 105,155 175,155 158,90" fill="#e8f5e9"/>
                            <text x="135" y="128" text-anchor="middle" font-size="20" font-weight="bold" fill="#2a7a4b">F<tspan baseline-shift="sub" font-size="12">N</tspan></text>
                        </g>

                        <text x="100" y="130" text-anchor="middle" font-size="20" fill="#555">¬∑</text>
                    </svg>

                    <div class="formel-result" id="formel-result">
                        <h4 id="formel-title">Klicke auf eine Gr√∂√üe!</h4>
                        <div class="formel-big" id="formel-display">? = ?</div>
                        <p id="formel-erklaerung" style="font-size: 0.85em; margin-top: 10px;">Das Formel-Dreieck zeigt dir die richtige Formel.</p>
                    </div>
                </div>
            </div>

            <div class="info-box">
                <strong>Reibungszahl-Tabelle:</strong>
                <table style="font-size: 0.9em; margin-top: 10px; width: 100%;">
                    <tr><td>Gummi ‚Äì Asphalt:</td><td><strong>Œº = 0,8</strong></td></tr>
                    <tr><td>Holz ‚Äì Holz:</td><td><strong>Œº = 0,5</strong></td></tr>
                    <tr><td>Stahl ‚Äì Eis:</td><td><strong>Œº = 0,03</strong></td></tr>
                </table>
            </div>

            <div class="hefter-hinweis">
                <strong>K3 ausf√ºllen:</strong> √úbertrage die Formel und das Dreieck. Notiere alle drei Formeln!
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zur√ºck</button>
                <button class="btn btn-primary" onclick="nextStep()">Weiter zum Rechnen</button>
            </div>
        </div>

        <!-- SCHRITT 9: Rechnen -->
        <div class="step" id="step9">
            <div class="step-header">
                <span class="step-number">9</span>
                <span class="step-title">Rechnen mit der Formel <span class="stern">‚òÖ‚òÖ‚òÖ</span></span>
            </div>

            <p>Jetzt wendest du die Formel an. Nutze das Formel-Dreieck als Hilfe!</p>

            <h2><span class="stern">‚òÖ</span> Beispiel (vorgerechnet)</h2>
            <div class="info-box">
                <strong>Gegeben:</strong> Œº = 0,5 (Holz auf Holz), F<sub>N</sub> = 10 N<br>
                <strong>Gesucht:</strong> F<sub>R</sub><br><br>
                <strong>Formel:</strong> F<sub>R</sub> = Œº ¬∑ F<sub>N</sub><br>
                <strong>Einsetzen:</strong> F<sub>R</sub> = 0,5 ¬∑ 10 N = <strong>5 N</strong>
            </div>

            <h2><span class="stern">‚òÖ</span> Aufgabe R1</h2>
            <p>Ein Klotz liegt auf dem Tisch. Œº = 0,4, F<sub>N</sub> = 20 N. Wie gro√ü ist F<sub>R</sub>?</p>
            <div class="quiz-options" id="quiz1">
                <div class="quiz-option" onclick="checkRechenaufgabe(1, 8, this)">8 N</div>
                <div class="quiz-option" onclick="checkRechenaufgabe(1, 50, this)">50 N</div>
                <div class="quiz-option" onclick="checkRechenaufgabe(1, 0.02, this)">0,02 N</div>
            </div>
            <div class="ani-info" id="quiz1-fb" style="display:none;"></div>

            <h2><span class="stern">‚òÖ‚òÖ</span> Aufgabe R2</h2>
            <p>Autoreifen auf trockener Stra√üe: Œº = 0,8, F<sub>N</sub> = 5000 N. Wie gro√ü ist F<sub>R</sub>?</p>
            <div class="quiz-options" id="quiz2">
                <div class="quiz-option" onclick="checkRechenaufgabe(2, 4000, this)">4000 N</div>
                <div class="quiz-option" onclick="checkRechenaufgabe(2, 6250, this)">6250 N</div>
                <div class="quiz-option" onclick="checkRechenaufgabe(2, 625, this)">625 N</div>
            </div>
            <div class="ani-info" id="quiz2-fb" style="display:none;"></div>

            <h2><span class="stern">‚òÖ‚òÖ‚òÖ</span> Aufgabe R3 (Umstellen!)</h2>
            <p>Die Reibungskraft betr√§gt F<sub>R</sub> = 12 N, die Normalkraft F<sub>N</sub> = 40 N. Wie gro√ü ist Œº?</p>
            <div class="quiz-options" id="quiz3">
                <div class="quiz-option" onclick="checkRechenaufgabe(3, 0.3, this)">Œº = 0,3</div>
                <div class="quiz-option" onclick="checkRechenaufgabe(3, 480, this)">Œº = 480</div>
                <div class="quiz-option" onclick="checkRechenaufgabe(3, 28, this)">Œº = 28</div>
            </div>
            <div class="ani-info" id="quiz3-fb" style="display:none;"></div>

            <div class="hefter-hinweis">
                <strong>R1, R2, R3 l√∂sen:</strong> Zeige den vollst√§ndigen Rechenweg auf deinem Arbeitsblatt!
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zur√ºck</button>
                <button class="btn btn-primary" onclick="nextStep()">Weiter zur Anwendung</button>
            </div>
        </div>

        <!-- SCHRITT 10: Bremsweg -->
        <div class="step" id="step10">
            <div class="step-header">
                <span class="step-number">10</span>
                <span class="step-title">Anwendung: Bremsweg</span>
            </div>

            <p>Warum ist Reibung beim Autofahren so wichtig?</p>

            <div class="animation-container" id="ani2-container">
                <div class="ani-title">Animation: Auto bremst ‚Äì Bremsweg vergleichen</div>
                <div class="ani-canvas" id="ani2-canvas" style="height: 140px;">
                    <div id="ani2-strasse" class="strasse" style="background: #333;">
                        <div class="strasse-markierung" style="left: 20px; width: 40px;"></div>
                        <div class="strasse-markierung" style="left: 80px; width: 40px;"></div>
                        <div class="strasse-markierung" style="left: 140px; width: 40px;"></div>
                        <div class="strasse-markierung" style="left: 200px; width: 40px;"></div>
                        <div class="strasse-markierung" style="left: 260px; width: 40px;"></div>
                        <div class="strasse-markierung" style="left: 320px; width: 40px;"></div>
                    </div>
                    <div id="ani2-bremsbalken" style="position: absolute; left: 20px; bottom: 50px; height: 8px; width: 0; background: #e74c3c; border-radius: 4px;"></div>
                    <div id="ani2-startmarke" style="position: absolute; left: 20px; bottom: 58px; width: 2px; height: 20px; background: #27ae60;"></div>
                    <div style="position: absolute; left: 8px; bottom: 80px; font-size: 0.6em; color: #27ae60;">START</div>
                    <div class="auto" id="ani2-auto" style="left: 20px;">
                        <div class="auto-body"></div>
                        <div class="auto-wheel left"></div>
                        <div class="auto-wheel right"></div>
                    </div>
                    <div id="ani2-bremsweg" style="position: absolute; left: 100px; bottom: 100px; display: none; background: rgba(255,255,255,0.9); border: 1px solid #ccc; padding: 4px 8px; border-radius: 4px; font-size: 0.9em; color: #222;">
                        Bremsweg: <strong id="ani2-meter">0</strong> m
                    </div>
                    <div id="ani2-zustand" style="position: absolute; right: 10px; top: 10px; font-size: 0.8em; color: #555;"></div>
                </div>
                <div class="ani-controls">
                    <button class="ani-btn" onclick="playAni2('trocken')">‚òÄÔ∏è Trocken</button>
                    <button class="ani-btn" onclick="playAni2('nass')">üåßÔ∏è Nass</button>
                    <button class="ani-btn" onclick="playAni2('eis')">‚ùÑÔ∏è Vereist</button>
                    <button class="ani-btn" onclick="resetAni2()">Reset</button>
                </div>
                <div class="ani-info" id="ani2-info">
                    Vergleiche: Wie unterscheidet sich der Bremsweg bei verschiedenen Stra√üenzust√§nden?
                </div>
            </div>

            <div class="merksatz">
                <strong>Merksatz ‚Äì Bremsweg und Reibung:</strong><br>
                Je geringer die Reibung, desto l√§nger der Bremsweg!<br>
                Trocken ‚Üí Nass ‚Üí Vereist = immer l√§ngerer Bremsweg!
            </div>

            <div class="hefter-hinweis">
                <strong>A2 und K6 ausf√ºllen:</strong> Welche Reibungsart ist beim Bremsen wichtig? Erg√§nze den Merksatz zum Bremsweg!
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zur√ºck</button>
                <button class="btn btn-primary" onclick="nextStep()">Zum Abschluss</button>
            </div>
        </div>

        <!-- SCHRITT 11: Pflicht geschafft -->
        <div class="step" id="step11">
            <div class="step-header">
                <span class="step-number">11</span>
                <span class="step-title">Pflicht geschafft!</span>
            </div>

            <p>Du hast die Reibungskr√§fte kennengelernt.</p>

            <div class="merksatz">
                <strong>Was du gelernt hast:</strong>
                <ul style="text-align: left; display: inline-block; margin-top: 10px;">
                    <li>Es gibt drei Reibungsarten: <strong>Haft-, Gleit-, Rollreibung</strong></li>
                    <li>Reihenfolge: F<sub>Haft</sub> &gt; F<sub>Gleit</sub> &gt; F<sub>Roll</sub></li>
                    <li>Reibung h√§ngt ab von <strong>Gewichtskraft</strong> und <strong>Oberfl√§che</strong></li>
                    <li>Reibung kann erw√ºnscht oder unerw√ºnscht sein</li>
                    <li><span class="stern">‚òÖ‚òÖ‚òÖ</span> Formel: F<sub>R</sub> = Œº ¬∑ F<sub>N</sub></li>
                </ul>
            </div>

            <div class="hefter-hinweis">
                <strong>Arbeitsblatt fertigstellen:</strong>
                <ul>
                    <li>Pr√ºfe: Sind alle Felder ausgef√ºllt?</li>
                    <li>Kontrolliere deine Rechnungen</li>
                    <li><strong>Gib dein Arbeitsblatt ab!</strong></li>
                </ul>
            </div>

            <div class="info-box">
                <strong>Selbstcheck ‚Äì Das kann ich jetzt:</strong>
                <ul>
                    <li>‚òê Ich kann die drei Reibungsarten nennen und ordnen.</li>
                    <li>‚òê Ich kann Einflussfaktoren der Reibung erkl√§ren.</li>
                    <li>‚òê Ich kann erw√ºnschte und unerw√ºnschte Reibung unterscheiden.</li>
                    <li>‚òê <span class="stern">‚òÖ‚òÖ‚òÖ</span> Ich kann mit der Formel rechnen.</li>
                </ul>
            </div>

            <div class="zusatz-hinweis">
                <strong>Fertig mit dem Arbeitsblatt?</strong><br>
                <span style="font-weight: normal; font-size: 0.9em;">Dann hole dir das Zusatz-Arbeitsblatt und mache weiter mit Rollreibung, Reifendruck und ABS!</span>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zur√ºck</button>
                <button class="btn btn-primary" onclick="nextStep()">Weiter zum Zusatz <span class="stern">‚òÖ‚òÖ‚òÖ</span></button>
            </div>
        </div>

        <!-- SCHRITT 12: Rollreibung (Zusatz) -->
        <div class="step" id="step12">
            <div class="step-header">
                <span class="step-number">12</span>
                <span class="step-title">Zusatz: Rollreibung im Detail <span class="stern">‚òÖ‚òÖ‚òÖ</span></span>
            </div>

            <p><strong>Ph√§nomen:</strong> Eisenbahnen haben R√§der aus Stahl, Autos haben Gummireifen. Welches Material rollt leichter?</p>

            <div class="info-box">
                <strong>Deine Aufgabe:</strong> Miss f√ºr jeden Radtyp, wie viel Kraft n√∂tig ist, um das Rad ins Rollen zu bringen. Beobachte dabei die <em>Aufstandsfl√§che</em> (gelb markiert).
            </div>

            <div class="animation-container" id="sim-roll">
                <div class="ani-title">Experiment: Rollreibung messen</div>
                <div class="ani-canvas" id="roll-canvas" style="height: 180px; position: relative; overflow: hidden;">
                    <div style="position: absolute; bottom: 0; left: 0; right: 0; height: 25px; background: linear-gradient(0deg, #444 0%, #666 100%);"></div>
                    <div id="roll-wagen" style="position: absolute; bottom: 25px; left: 60px; transition: left 0.1s linear;">
                        <svg id="roll-rad-svg" width="80" height="85" viewBox="0 0 80 85" style="display: block;">
                            <rect id="roll-kontakt" x="30" y="78" width="20" height="6" fill="#f1c40f" rx="2"/>
                            <g id="roll-rad-body">
                                <circle id="roll-rad-kreis" cx="40" cy="40" r="36" fill="#888" stroke="#333" stroke-width="4"/>
                                <path id="roll-rad-platt" d="M10,55 C10,70 20,78 40,78 C60,78 70,70 70,55" fill="#222" stroke="#111" stroke-width="4" style="display: none;"/>
                            </g>
                            <g id="roll-rad-speichen" style="transform-origin: 40px 40px;">
                                <circle cx="40" cy="40" r="10" fill="#555"/>
                                <line x1="40" y1="8" x2="40" y2="24" stroke="#555" stroke-width="3"/>
                                <line x1="40" y1="56" x2="40" y2="72" stroke="#555" stroke-width="3"/>
                                <line x1="8" y1="40" x2="24" y2="40" stroke="#555" stroke-width="3"/>
                                <line x1="56" y1="40" x2="72" y2="40" stroke="#555" stroke-width="3"/>
                            </g>
                        </svg>
                        <div id="roll-kontakt-label" style="position: absolute; bottom: -18px; left: 50%; transform: translateX(-50%); font-size: 0.65em; color: #b8860b; white-space: nowrap;">Aufstandsfl√§che: <span id="roll-kontakt-groesse">klein</span></div>
                    </div>
                    <svg id="roll-pfeil-svg" style="position: absolute; bottom: 60px; left: 145px;" width="120" height="30">
                        <defs>
                            <marker id="pfeilspitze" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#e74c3c"/>
                            </marker>
                        </defs>
                        <line id="roll-pfeil-linie" x1="0" y1="15" x2="10" y2="15" stroke="#e74c3c" stroke-width="4" marker-end="url(#pfeilspitze)"/>
                        <text id="roll-pfeil-text" x="5" y="28" font-size="11" fill="#c0392b" font-weight="bold">0,0 N</text>
                    </svg>
                    <div id="roll-status-box" style="position: absolute; top: 8px; right: 10px; padding: 6px 12px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; font-size: 0.85em;">
                        <span id="roll-status-icon">‚è∏</span> <span id="roll-status-text">Rad steht</span>
                    </div>
                </div>
                <div class="ani-controls" style="flex-wrap: wrap; gap: 15px;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label style="font-size: 0.9em;">Radtyp:</label>
                        <select id="roll-radtyp" style="padding: 8px 12px; min-height: 44px; font-size: 0.9em;" onchange="wechsleRadtyp()">
                            <option value="stahl">Stahlrad (Zug)</option>
                            <option value="gummi-prall">Gummireifen (prall)</option>
                            <option value="gummi-platt">Gummireifen (platt)</option>
                        </select>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px; flex: 1; min-width: 200px;">
                        <label style="font-size: 0.9em; white-space: nowrap;">Zugkraft:</label>
                        <input type="range" id="roll-kraft-slider" min="0" max="6" step="0.1" value="0" style="flex: 1; height: 44px;" oninput="updateRollKraft()">
                        <span id="roll-kraft-anzeige" style="min-width: 50px; font-family: monospace; font-weight: bold; color: var(--warning);">0,0 N</span>
                    </div>
                    <button class="ani-btn" onclick="speichereMessung()" id="roll-speichern-btn" disabled style="background: var(--success);">Wert speichern</button>
                </div>
                <div class="ani-info" id="roll-info">
                    <strong>Schritt 1:</strong> Erh√∂he die Zugkraft langsam mit dem Regler. Bei welcher Kraft beginnt das Rad zu rollen?
                </div>
            </div>

            <h2>Deine Messwerte</h2>
            <table class="vergleich-tabelle" id="roll-tabelle">
                <tr>
                    <th>Radtyp</th>
                    <th>Rollreibung <i>F</i><sub>Roll</sub></th>
                    <th>Aufstandsfl√§che</th>
                </tr>
                <tr id="roll-zeile-stahl">
                    <td>Stahlrad</td>
                    <td id="roll-erg-stahl">‚Äî</td>
                    <td id="roll-verf-stahl">‚Äî</td>
                </tr>
                <tr id="roll-zeile-gummi-prall">
                    <td>Gummi (prall)</td>
                    <td id="roll-erg-gummi-prall">‚Äî</td>
                    <td id="roll-verf-gummi-prall">‚Äî</td>
                </tr>
                <tr id="roll-zeile-gummi-platt">
                    <td>Gummi (platt)</td>
                    <td id="roll-erg-gummi-platt">‚Äî</td>
                    <td id="roll-verf-gummi-platt">‚Äî</td>
                </tr>
            </table>

            <div id="roll-erkenntnis" style="display: none;">
                <div class="merksatz">
                    <strong>Erkenntnisfrage:</strong><br>
                    Je <span id="roll-erk-1" class="luecke-klick" onclick="zeigeRollAntwort(1)">???</span> die Aufstandsfl√§che, desto <span id="roll-erk-2" class="luecke-klick" onclick="zeigeRollAntwort(2)">???</span> die Rollreibung!
                </div>
            </div>

            <div class="hefter-hinweis">
                <strong>Zusatz-AB B5 ausf√ºllen:</strong>
                <ul>
                    <li>√úbertrage deine Messwerte in die Tabelle</li>
                    <li>Erkl√§re: Warum haben Z√ºge Stahlr√§der, Autos aber Gummireifen?</li>
                </ul>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zur√ºck</button>
                <button class="btn btn-primary" onclick="nextStep()">Weiter zum Reifendruck</button>
            </div>
        </div>

        <!-- SCHRITT 13: Reifendruck (Zusatz) -->
        <div class="step" id="step13">
            <div class="step-header">
                <span class="step-number">13</span>
                <span class="step-title">Zusatz: Reifendruck und Haftung <span class="stern">‚òÖ‚òÖ‚òÖ</span></span>
            </div>

            <p>Ver√§ndere den Reifendruck und beobachte die Auswirkungen:</p>

            <div class="animation-container" id="sim-druck">
                <div class="ani-title">Simulation: Reifendruck variieren</div>
                <div class="ani-canvas" style="height: 200px; position: relative;">
                    <div style="display: flex; justify-content: center; align-items: flex-end; height: 140px; gap: 40px;">
                        <div style="text-align: center;">
                            <div id="reifen-svg-container"></div>
                            <div id="kontakt-anzeige" style="margin-top: 5px; font-size: 0.8em;">Kontaktfl√§che: <strong id="kontakt-wert">mittel</strong></div>
                        </div>
                        <div style="width: 150px;">
                            <div style="font-size: 0.85em; margin-bottom: 5px;">Bewertung:</div>
                            <div id="bewertung-roll" style="padding: 5px; margin: 3px 0; font-size: 0.8em; background: #f5f5f5;">Rollreibung: <span id="roll-wert">mittel</span></div>
                            <div id="bewertung-haft" style="padding: 5px; margin: 3px 0; font-size: 0.8em; background: #f5f5f5;">Haftung: <span id="haft-wert">gut</span></div>
                            <div id="bewertung-gesamt" style="padding: 8px; margin-top: 10px; font-size: 0.85em; font-weight: bold; background: var(--success-bg); color: var(--success);">Optimal!</div>
                        </div>
                    </div>
                    <div class="strasse" style="height: 25px;"></div>
                </div>
                <div class="ani-controls">
                    <label style="font-size: 0.9em;">Reifendruck:</label>
                    <input type="range" id="druck-slider" min="1" max="5" value="3" style="width: 150px; height: 44px;" oninput="updateReifendruck()">
                    <span id="druck-label" style="min-width: 80px;">optimal</span>
                </div>
                <div class="ani-info" id="druck-info">
                    Finde den optimalen Druck: Wenig Rollreibung UND gute Haftung!
                </div>
            </div>

            <div class="hefter-hinweis">
                <strong>Zusatz-AB B6 ausf√ºllen:</strong>
                <ul>
                    <li>Zu niedriger Druck: Rollreibung ___, Haftung ___</li>
                    <li>Zu hoher Druck: Rollreibung ___, Haftung ___</li>
                    <li>Fazit: Kompromiss zwischen ___ und ___</li>
                </ul>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zur√ºck</button>
                <button class="btn btn-primary" onclick="nextStep()">Weiter zu ABS <span class="stern">‚òÖ‚òÖ‚òÖ</span></button>
            </div>
        </div>

        <!-- SCHRITT 14: ABS (Zusatz) -->
        <div class="step" id="step14">
            <div class="step-header">
                <span class="step-number">14</span>
                <span class="step-title">Zusatz: ABS ‚Äì Das Antiblockiersystem <span class="stern">‚òÖ‚òÖ‚òÖ</span></span>
            </div>

            <p>Beim starken Bremsen k√∂nnen die R√§der blockieren. Was passiert dann?</p>

            <div class="info-box" style="background: var(--error-bg); border-color: var(--error);">
                <strong style="color: var(--error);">Problem: Blockiertes Rad</strong>
                <ol>
                    <li>Bremse zieht zu stark ‚Üí Rad steht still (blockiert)</li>
                    <li>Reifen <em>haftet</em> nicht mehr an der Stra√üe</li>
                    <li>Reifen <em>gleitet</em> √ºber die Stra√üe</li>
                    <li>F<sub>Gleit</sub> &lt; F<sub>Haft</sub> ‚Üí <strong>l√§ngerer Bremsweg!</strong></li>
                </ol>
            </div>

            <div class="info-box" style="background: var(--success-bg); border-color: var(--success);">
                <strong style="color: var(--success);">L√∂sung: ABS</strong>
                <ol>
                    <li>Sensoren erkennen: Rad blockiert!</li>
                    <li>ABS verringert sofort den Bremsdruck</li>
                    <li>Rad dreht sich wieder ‚Üí Haftreibung!</li>
                    <li>Bremsdruck wird wieder erh√∂ht</li>
                    <li>Wechsel Haft ‚Üî Gleit viele Male pro Sekunde</li>
                </ol>
            </div>

            <h2>ABS-Diagramm</h2>
            <p>So verhindert ABS das Blockieren ‚Äì das Rad rollt fast die ganze Zeit:</p>
            <div class="abs-diagram">
                <div class="abs-bar haft" style="flex: 1;">‚óØ</div>
                <div class="abs-bar gleit" style="flex: 0.3;">‚ñ™</div>
                <div class="abs-bar haft" style="flex: 1;">‚óØ</div>
                <div class="abs-bar gleit" style="flex: 0.3;">‚ñ™</div>
                <div class="abs-bar haft" style="flex: 1;">‚óØ</div>
                <div class="abs-bar gleit" style="flex: 0.3;">‚ñ™</div>
                <div class="abs-bar haft" style="flex: 1;">‚óØ</div>
            </div>
            <p style="font-size: 0.85em; color: #666; text-align: center;">‚óØ = Rad rollt (Haftreibung) &nbsp;|&nbsp; ‚ñ™ = Rad blockiert kurz (Gleitreibung)</p>

            <h2>Simulation: Bremsen mit und ohne ABS</h2>
            <p>Vergleiche das Bremsverhalten bei <strong>50 km/h</strong>:</p>

            <div class="animation-container" id="sim-abs">
                <div class="ani-title">Simulation: Auto bremst</div>
                <div class="ani-canvas" id="abs-canvas" style="height: 160px; position: relative; overflow: hidden;">
                    <div class="strasse" id="abs-strasse" style="height: 30px; background: #555;"></div>
                    <div id="abs-spur-container" style="position: absolute; bottom: 30px; left: 50px; height: 6px; display: flex;"></div>
                    <div id="abs-rad-container" style="position: absolute; left: 50px; bottom: 30px; width: 80px; height: 80px;">
                        <svg width="80" height="80" viewBox="0 0 80 80">
                            <circle id="abs-rad-ring" cx="40" cy="40" r="36" fill="none" stroke="#333" stroke-width="6"/>
                            <circle cx="40" cy="40" r="33" fill="#444"/>
                            <circle cx="40" cy="40" r="18" fill="#888" stroke="#666" stroke-width="2"/>
                            <g id="abs-rad-speichen" style="transform-origin: 40px 40px;">
                                <line x1="40" y1="12" x2="40" y2="28" stroke="#666" stroke-width="3"/>
                                <line x1="40" y1="52" x2="40" y2="68" stroke="#666" stroke-width="3"/>
                                <line x1="12" y1="40" x2="28" y2="40" stroke="#666" stroke-width="3"/>
                                <line x1="52" y1="40" x2="68" y2="40" stroke="#666" stroke-width="3"/>
                            </g>
                            <circle cx="40" cy="40" r="6" fill="#555"/>
                        </svg>
                    </div>
                    <div id="abs-bremsweg-label" style="position: absolute; top: 10px; right: 20px; font-size: 0.9em; display: none;">
                        Bremsweg: <strong id="abs-meter">0</strong> m
                    </div>
                    <div id="abs-status" style="position: absolute; top: 10px; left: 20px; font-size: 0.9em; padding: 5px 10px; background: white; border: 1px solid #ddd; border-radius: 4px;">
                        Bereit
                    </div>
                    <div style="position: absolute; bottom: 38px; right: 10px; font-size: 0.65em; display: flex; gap: 10px;">
                        <span><span style="display: inline-block; width: 10px; height: 10px; background: var(--success); vertical-align: middle; margin-right: 2px;"></span> Rad rollt</span>
                        <span><span style="display: inline-block; width: 10px; height: 10px; background: var(--error); vertical-align: middle; margin-right: 2px;"></span> Rad blockiert</span>
                    </div>
                </div>
                <div class="ani-controls">
                    <button class="ani-btn" id="btn-ohne-abs" onclick="starteBremstest('ohne')">Ohne ABS</button>
                    <button class="ani-btn" id="btn-mit-abs" onclick="starteBremstest('mit')">Mit ABS</button>
                    <button class="ani-btn" onclick="resetABS()">Reset</button>
                    <div style="margin-left: auto;">
                        <label style="font-size: 0.85em;">Stra√üe:</label>
                        <select id="abs-strasse-select" style="padding: 8px; min-height: 44px;" onchange="updateStrassentyp()">
                            <option value="trocken">Trocken</option>
                            <option value="nass">Nass</option>
                            <option value="eis">Vereist</option>
                        </select>
                    </div>
                </div>
                <div class="ani-info" id="abs-info">
                    Teste beide Varianten auf verschiedenen Stra√üen!
                </div>
            </div>

            <table class="vergleich-tabelle" id="abs-ergebnis-tabelle">
                <tr>
                    <th>Stra√üe</th>
                    <th>Ohne ABS</th>
                    <th>Mit ABS</th>
                </tr>
                <tr>
                    <td>Trocken</td>
                    <td id="erg-trocken-ohne">‚Äî</td>
                    <td id="erg-trocken-mit">‚Äî</td>
                </tr>
                <tr>
                    <td>Nass</td>
                    <td id="erg-nass-ohne">‚Äî</td>
                    <td id="erg-nass-mit">‚Äî</td>
                </tr>
                <tr>
                    <td>Vereist</td>
                    <td id="erg-eis-ohne">‚Äî</td>
                    <td id="erg-eis-mit">‚Äî</td>
                </tr>
            </table>

            <div class="hefter-hinweis">
                <strong>Zusatz-AB B7 + T3 ausf√ºllen:</strong>
                <ul>
                    <li>Erkl√§re, warum ABS den Bremsweg verk√ºrzt</li>
                    <li>√úbertrage die Messwerte in die Tabelle</li>
                </ul>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zur√ºck</button>
                <button class="btn btn-primary" onclick="nextStep()">Zum Abschluss</button>
            </div>
        </div>

        <!-- SCHRITT 15: Abschluss + Memory -->
        <div class="step" id="step15">
            <div class="step-header">
                <span class="step-number">‚úì</span>
                <span class="step-title">Alles geschafft!</span>
            </div>

            <p>Du hast auch die Zusatzaufgaben bearbeitet!</p>

            <div class="merksatz">
                <strong>Zus√§tzlich gelernt:</strong>
                <ul style="text-align: left; display: inline-block; margin-top: 10px;">
                    <li>Rollreibung h√§ngt von der Rad-Verformung ab</li>
                    <li>Optimaler Reifendruck = wenig Rollreibung + gute Haftung</li>
                    <li><span class="stern">‚òÖ‚òÖ‚òÖ</span> ABS nutzt: F<sub>Haft</sub> &gt; F<sub>Gleit</sub></li>
                </ul>
            </div>

            <div class="hefter-hinweis">
                <strong>Zusatz-Arbeitsblatt abgeben!</strong>
                <ul>
                    <li>Pr√ºfe: Sind alle Felder ausgef√ºllt?</li>
                    <li>Kontrolliere deine Erkl√§rungen</li>
                </ul>
            </div>

            <h2 style="margin-top: 30px;">Bonus: Reibungs-Memory</h2>
            <p>Teste dein Wissen mit dem Memory-Spiel!</p>

            <div class="animation-container" id="memory-game">
                <div class="ani-title">Finde die passenden Paare!</div>
                <div class="memory-stats">
                    Versuche: <strong id="memory-tries">0</strong> | Paare: <strong id="memory-pairs">0</strong>/6
                </div>
                <div class="memory-container" id="memory-grid"></div>
                <div class="ani-controls" style="justify-content: center; margin-top: 15px;">
                    <button class="ani-btn" onclick="initMemory()">Neues Spiel</button>
                </div>
                <div class="ani-info" id="memory-info">
                    Klicke zwei Karten auf, um ein Paar zu finden. Fachbegriff + passende Erkl√§rung!
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zur√ºck</button>
                <span></span>
            </div>
        </div>
    </div>

    <script>
        var STORAGE_KEY = 'lp-05-komplett-v3';
        var totalSteps = 15;
        var currentStep = 1;

        function init() {
            var saved = localStorage.getItem(STORAGE_KEY + '-step');
            if (saved) currentStep = parseInt(saved) || 1;
            createStepIndicators();
            showStep(currentStep);
            updateSim5b();
            initReifendruck();
            initRollSim();
        }

        function createStepIndicators() {
            var container = document.getElementById('stepIndicators');
            container.innerHTML = '';
            for (var i = 1; i <= totalSteps; i++) {
                var dot = document.createElement('div');
                dot.className = 'step-dot';
                dot.textContent = i === totalSteps ? '‚úì' : i;
                dot.setAttribute('data-step', i);
                dot.onclick = (function(step) {
                    return function() {
                        if (step <= getMaxStep() + 1) showStep(step);
                    };
                })(i);
                container.appendChild(dot);
            }
        }

        function getMaxStep() {
            return parseInt(localStorage.getItem(STORAGE_KEY + '-maxStep')) || 1;
        }

        function updateStepIndicators() {
            var dots = document.querySelectorAll('.step-dot');
            var maxCompleted = getMaxStep();
            for (var j = 0; j < dots.length; j++) {
                var num = j + 1;
                dots[j].classList.remove('current', 'completed');
                if (num === currentStep) dots[j].classList.add('current');
                else if (num <= maxCompleted) dots[j].classList.add('completed');
            }
        }

        function showStep(n) {
            var steps = document.querySelectorAll('.step');
            for (var i = 0; i < steps.length; i++) steps[i].classList.remove('active');
            var step = document.getElementById('step' + n);
            if (step) step.classList.add('active');
            currentStep = n;
            localStorage.setItem(STORAGE_KEY + '-step', n);
            var maxStep = getMaxStep();
            if (n > maxStep) localStorage.setItem(STORAGE_KEY + '-maxStep', n);
            document.getElementById('progressFill').style.width = ((n - 1) / (totalSteps - 1) * 100) + '%';
            updateStepIndicators();
            window.scrollTo(0, 0);
        }

        function nextStep() { if (currentStep < totalSteps) showStep(currentStep + 1); }
        function prevStep() { if (currentStep > 1) showStep(currentStep - 1); }
        function resetLernpfad() {
            if (confirm('Lernpfad wirklich neu starten?')) {
                localStorage.removeItem(STORAGE_KEY + '-step');
                localStorage.removeItem(STORAGE_KEY + '-maxStep');
                location.reload();
            }
        }

        var ani1Running = false, ani1Interval = null, ani1Kraft = 0, ani1KlotzPos = 50, ani1Gleitet = false;

        function playAni1() {
            if (ani1Running) return;
            ani1Running = true;
            document.getElementById('ani1-play').disabled = true;
            ani1Kraft = 0; ani1KlotzPos = 50; ani1Gleitet = false;

            ani1Interval = setInterval(function() {
                if (!ani1Gleitet) {
                    ani1Kraft += 0.5;
                    if (ani1Kraft >= 8) {
                        ani1Gleitet = true;
                        ani1Kraft = 5;
                        document.getElementById('ani1-status').textContent = 'Zustand: Gleiten!';
                        document.getElementById('ani1-info').textContent = 'Der Klotz gleitet! Beachte: Die Kraft sinkt auf 5 N (Gleitreibung < Haftreibung)';
                    }
                } else {
                    ani1KlotzPos += 3;
                    if (ani1KlotzPos > 250) {
                        clearInterval(ani1Interval);
                        ani1Running = false;
                        document.getElementById('ani1-play').disabled = false;
                        document.getElementById('ani1-info').textContent = 'Fertig! Dr√ºcke Reset, um es nochmal zu sehen.';
                    }
                }
                document.getElementById('ani1-kraft').textContent = 'Kraft: ' + ani1Kraft.toFixed(1) + ' N';
                document.getElementById('ani1-klotz').style.left = ani1KlotzPos + 'px';
                var pfeilPos = ani1KlotzPos + 80;
                document.getElementById('ani1-pfeil').style.left = pfeilPos + 'px';
                document.getElementById('ani1-pfeil').style.width = (ani1Kraft * 8) + 'px';
                if (!ani1Gleitet) document.getElementById('ani1-status').textContent = 'Zustand: Haften (Kraft steigt...)';
            }, 100);
        }

        function resetAni1() {
            if (ani1Interval) clearInterval(ani1Interval);
            ani1Running = false; ani1Kraft = 0; ani1KlotzPos = 50; ani1Gleitet = false;
            document.getElementById('ani1-play').disabled = false;
            document.getElementById('ani1-kraft').textContent = 'Kraft: 0 N';
            document.getElementById('ani1-status').textContent = 'Zustand: Ruhe';
            document.getElementById('ani1-klotz').style.left = '50px';
            document.getElementById('ani1-pfeil').style.left = '130px';
            document.getElementById('ani1-pfeil').style.width = '0px';
            document.getElementById('ani1-info').textContent = 'Dr√ºcke Play und beobachte: Wann beginnt der Klotz zu gleiten?';
        }

        var simWerte = { haft: 8, gleit: 5, roll: 1 };
        var simRunning = false, simInterval = null;

        function resetSim() {
            if (simInterval) clearInterval(simInterval);
            simRunning = false;
            var modus = document.getElementById('sim-modus').value;
            var klotz = document.getElementById('sim-klotz');
            klotz.innerHTML = modus === 'roll' ? '<span style="font-size:1em;">‚öô‚öô</span>' : 'Klotz';
            klotz.style.left = '30px';
            document.getElementById('sim-feder-svg').style.left = '100px';
            document.getElementById('sim-feder-svg').setAttribute('width', '80');
            document.getElementById('sim-feder-path').setAttribute('d', 'M0,15 L8,5 L16,25 L24,5 L32,25 L40,5 L48,25 L56,5 L64,25 L72,15 L80,15');
            document.getElementById('sim-kraftmesser').style.left = '180px';
            document.getElementById('sim-hand').style.left = '280px';
            document.getElementById('sim-pfeil').style.opacity = '0';
            document.getElementById('sim-wert').textContent = '0.0 N';
            document.getElementById('sim-btn').disabled = false;
            document.getElementById('sim-info').textContent = 'W√§hle einen Modus und dr√ºcke ‚ÄûMessen". Trage die Werte in Tabelle T1 ein!';
        }

        function messenSim() {
            if (simRunning) return;
            simRunning = true;
            var modus = document.getElementById('sim-modus').value;
            var wert = simWerte[modus];
            var klotz = document.getElementById('sim-klotz');
            var federSvg = document.getElementById('sim-feder-svg');
            var federPath = document.getElementById('sim-feder-path');
            var kraftmesser = document.getElementById('sim-kraftmesser');
            var hand = document.getElementById('sim-hand');
            var pfeil = document.getElementById('sim-pfeil');
            var wertDisplay = document.getElementById('sim-wert');
            var info = document.getElementById('sim-info');
            var btn = document.getElementById('sim-btn');
            btn.disabled = true;
            pfeil.style.opacity = '1';

            var kraftAktuell = 0, federLaenge = 80, kraftmesserX = 180, handX = 280, klotzX = 30;

            simInterval = setInterval(function() {
                kraftAktuell += 0.5;
                federLaenge += 5; kraftmesserX += 5; handX += 5;

                var w = federLaenge, segments = 8, segW = w / (segments + 1);
                var path = 'M0,15 ';
                for (var i = 1; i <= segments; i++) {
                    var x = i * segW, y = (i % 2 === 1) ? 5 : 25;
                    path += 'L' + x.toFixed(0) + ',' + y + ' ';
                }
                path += 'L' + w + ',15';
                federSvg.setAttribute('width', w);
                federPath.setAttribute('d', path);
                kraftmesser.style.left = kraftmesserX + 'px';
                hand.style.left = handX + 'px';
                pfeil.style.left = (handX + 30) + 'px';
                wertDisplay.textContent = kraftAktuell.toFixed(1) + ' N';

                if (kraftAktuell >= wert) {
                    clearInterval(simInterval);
                    wertDisplay.textContent = wert.toFixed(1) + ' N';
                    if (modus === 'gleit' || modus === 'roll') {
                        var gleitInterval = setInterval(function() {
                            klotzX += 3;
                            klotz.style.left = klotzX + 'px';
                            federSvg.style.left = (klotzX + 70) + 'px';
                            if (klotzX >= 80) {
                                clearInterval(gleitInterval);
                                info.textContent = modus === 'gleit' ? 'Gleitreibung: ' + wert + ' N ‚Äì Der Klotz gleitet!' : 'Rollreibung: ' + wert + ' N ‚Äì Am kleinsten!';
                                btn.disabled = false;
                                simRunning = false;
                            }
                        }, 50);
                    } else {
                        info.textContent = 'Haftreibung: ' + wert + ' N ‚Äì Die Losbrechkraft ist am gr√∂√üten!';
                        btn.disabled = false;
                        simRunning = false;
                    }
                }
            }, 100);
        }

        function updateSim5b() {
            var gewicht = parseInt(document.getElementById('sim5b-gewicht').value);
            var rauheit = parseInt(document.getElementById('sim5b-rauheit').value);
            document.getElementById('sim5b-gewicht-val').textContent = gewicht + ' N';
            document.getElementById('sim5b-gewicht-text').textContent = gewicht + ' N';
            var rauheitText = ['glatt', 'mittel', 'rau'][rauheit - 1];
            document.getElementById('sim5b-rauheit-val').textContent = rauheitText;
            var mu = [0.3, 0.5, 0.8][rauheit - 1];
            var reibung = (mu * gewicht).toFixed(1);
            document.getElementById('sim5b-reibung').textContent = reibung + ' N';
            var klotz = document.getElementById('sim5b-klotz');
            klotz.style.height = (30 + (gewicht - 2) * 1.5) + 'px';
            var farben = ['#a5d6a7', '#8b7355', '#5d4037'];
            document.getElementById('sim5b-oberflaeche').style.background = farben[rauheit - 1];
        }

        var ani2Running = false, ani2Interval = null;

        function playAni2(typ) {
            if (ani2Running) return;
            ani2Running = true;
            var auto = document.getElementById('ani2-auto');
            var balken = document.getElementById('ani2-bremsbalken');
            var marker = document.getElementById('ani2-bremsweg');
            var meter = document.getElementById('ani2-meter');
            var info = document.getElementById('ani2-info');
            var strasse = document.getElementById('ani2-strasse');
            var zustand = document.getElementById('ani2-zustand');

            auto.style.left = '20px'; balken.style.width = '0';
            marker.style.display = 'block'; meter.textContent = '0';

            var bremswegData = {
                trocken: { dist: 120, meter: 12, color: '#333', label: 'Trocken', infoColor: '#27ae60' },
                nass: { dist: 200, meter: 24, color: '#4a6fa5', label: 'Nass', infoColor: '#f39c12' },
                eis: { dist: 320, meter: 48, color: '#a8d4e6', label: 'Vereist', infoColor: '#e74c3c' }
            };
            var data = bremswegData[typ];
            strasse.style.background = data.color;
            zustand.textContent = data.label;
            zustand.style.color = data.infoColor;

            var startPos = 20, totalDist = data.dist, bremsweg = data.meter;
            var v0 = 10, t = 0, a = (v0 * v0) / (2 * totalDist);

            ani2Interval = setInterval(function() {
                t += 1;
                var v = v0 - a * t;
                var s = v0 * t - 0.5 * a * t * t;
                var pos = startPos + s;
                balken.style.width = s + 'px';
                meter.textContent = Math.round((s / totalDist) * bremsweg);
                marker.style.left = (pos + 50) + 'px';

                if (v <= 0 || pos >= startPos + totalDist) {
                    clearInterval(ani2Interval);
                    auto.style.left = (startPos + totalDist) + 'px';
                    balken.style.width = totalDist + 'px';
                    meter.textContent = bremsweg;
                    var msgs = {
                        trocken: '<strong style="color:#27ae60">Trockene Stra√üe:</strong> Bremsweg nur ' + bremsweg + ' m!',
                        nass: '<strong style="color:#f39c12">Nasse Stra√üe:</strong> Bremsweg ' + bremsweg + ' m ‚Äì Weniger Reibung!',
                        eis: '<strong style="color:#e74c3c">Vereiste Stra√üe:</strong> Bremsweg ' + bremsweg + ' m ‚Äì Gef√§hrlich!'
                    };
                    info.innerHTML = msgs[typ];
                    ani2Running = false;
                } else {
                    auto.style.left = pos + 'px';
                }
            }, 40);
        }

        function resetAni2() {
            if (ani2Interval) clearInterval(ani2Interval);
            ani2Running = false;
            document.getElementById('ani2-auto').style.left = '20px';
            document.getElementById('ani2-bremsbalken').style.width = '0';
            document.getElementById('ani2-bremsweg').style.display = 'none';
            document.getElementById('ani2-strasse').style.background = '#333';
            document.getElementById('ani2-zustand').textContent = '';
            document.getElementById('ani2-info').innerHTML = 'Vergleiche: Wie unterscheidet sich der Bremsweg?';
        }

        var formeln = {
            fr: { title: 'Gesucht: F_R', formel: '<i>F</i><sub>R</sub> = Œº ¬∑ <i>F</i><sub>N</sub>', erkl: 'Œº und F_N nebeneinander ‚Üí multiplizieren!' },
            mu: { title: 'Gesucht: Œº', formel: 'Œº = <span class="frac"><span class="frac-num"><i>F</i><sub>R</sub></span><span class="frac-den"><i>F</i><sub>N</sub></span></span>', erkl: 'F_R √∑ F_N' },
            fn: { title: 'Gesucht: F_N', formel: '<i>F</i><sub>N</sub> = <span class="frac"><span class="frac-num"><i>F</i><sub>R</sub></span><span class="frac-den">Œº</span></span>', erkl: 'F_R √∑ Œº' }
        };

        function selectFormel(v) {
            document.querySelectorAll('.dreieck-cell').forEach(function(c) { c.classList.remove('hidden'); });
            document.getElementById('cell-' + v).classList.add('hidden');
            var f = formeln[v];
            document.getElementById('formel-title').textContent = f.title;
            document.getElementById('formel-display').innerHTML = f.formel;
            document.getElementById('formel-erklaerung').textContent = f.erkl;
        }

        var rechenLoesungen = { 1: 8, 2: 4000, 3: 0.3 };
        function checkRechenaufgabe(nr, antwort, el) {
            var opts = el.parentNode.querySelectorAll('.quiz-option');
            opts.forEach(function(o) { o.style.pointerEvents = 'none'; o.classList.remove('correct', 'incorrect'); });
            var fb = document.getElementById('quiz' + nr + '-fb');
            fb.style.display = 'block';
            if (antwort === rechenLoesungen[nr]) {
                el.classList.add('correct');
                fb.innerHTML = '<strong style="color: var(--success);">Richtig!</strong>';
                fb.style.borderColor = 'var(--success)';
            } else {
                el.classList.add('incorrect');
                opts.forEach(function(o) {
                    var val = parseFloat(o.textContent.replace('Œº = ', '').replace(' N', '').replace(',', '.'));
                    if (val === rechenLoesungen[nr]) o.classList.add('correct');
                });
                fb.innerHTML = '<strong style="color: var(--error);">Leider falsch.</strong> Richtig: ' + rechenLoesungen[nr] + (nr < 3 ? ' N' : '');
                fb.style.borderColor = 'var(--error)';
            }
        }

        // =======================================
        // ROLLREIBUNGS-SIMULATION (Zusatz Schritt 12)
        // =======================================
        var rollDaten = {
            'stahl': { schwelle: 0.5, kontakt: 'sehr klein', kontaktBreite: 10, istPlatt: false, radFarbe: '#aaa', radStroke: '#777' },
            'gummi-prall': { schwelle: 2.0, kontakt: 'mittel', kontaktBreite: 22, istPlatt: false, radFarbe: '#333', radStroke: '#111' },
            'gummi-platt': { schwelle: 5.0, kontakt: 'gro√ü', kontaktBreite: 50, istPlatt: true, radFarbe: '#222', radStroke: '#111' }
        };
        var rollMessungen = {};
        var rollWagenPos = 60;
        var rollRotation = 0;
        var rollInterval = null;
        var rollRollt = false;

        function wechsleRadtyp() {
            var typ = document.getElementById('roll-radtyp').value;
            var daten = rollDaten[typ];
            var radKreis = document.getElementById('roll-rad-kreis');
            var radPlatt = document.getElementById('roll-rad-platt');
            var kontakt = document.getElementById('roll-kontakt');

            radKreis.setAttribute('r', '36');
            radKreis.setAttribute('cy', '40');
            radKreis.setAttribute('fill', daten.radFarbe);
            radKreis.setAttribute('stroke', daten.radStroke);

            if (daten.istPlatt) {
                radPlatt.style.display = 'block';
                radPlatt.setAttribute('fill', daten.radFarbe);
                radPlatt.setAttribute('stroke', daten.radStroke);
                radKreis.setAttribute('cy', '38');
            } else {
                radPlatt.style.display = 'none';
            }

            kontakt.setAttribute('width', daten.kontaktBreite);
            kontakt.setAttribute('x', 40 - daten.kontaktBreite / 2);
            document.getElementById('roll-kontakt-groesse').textContent = daten.kontakt;

            document.getElementById('roll-kraft-slider').value = 0;
            updateRollKraft();
            rollWagenPos = 60;
            rollRotation = 0;
            document.getElementById('roll-wagen').style.left = '60px';
            var speichen = document.getElementById('roll-rad-speichen');
            if (speichen) speichen.style.transform = 'rotate(0deg)';

            document.querySelectorAll('#roll-tabelle tr').forEach(function(tr) { tr.style.background = ''; });
            var zeile = document.getElementById('roll-zeile-' + typ);
            if (zeile && !rollMessungen[typ]) zeile.style.background = 'var(--physik-light)';
            updateRollInfo();
        }

        function updateRollKraft() {
            var kraft = parseFloat(document.getElementById('roll-kraft-slider').value);
            var typ = document.getElementById('roll-radtyp').value;
            var daten = rollDaten[typ];

            document.getElementById('roll-kraft-anzeige').textContent = kraft.toFixed(1).replace('.', ',') + ' N';
            var pfeilLaenge = Math.max(10, kraft * 15);
            document.getElementById('roll-pfeil-linie').setAttribute('x2', pfeilLaenge);
            document.getElementById('roll-pfeil-text').textContent = kraft.toFixed(1).replace('.', ',') + ' N';
            document.getElementById('roll-pfeil-text').setAttribute('x', pfeilLaenge / 2 - 15);

            if (kraft >= daten.schwelle) {
                if (!rollRollt) {
                    rollRollt = true;
                    document.getElementById('roll-status-icon').textContent = '‚ñ∂';
                    document.getElementById('roll-status-text').textContent = 'Rad rollt!';
                    document.getElementById('roll-status-box').style.background = 'var(--success-bg)';
                    document.getElementById('roll-status-box').style.borderColor = 'var(--success)';
                    document.getElementById('roll-speichern-btn').disabled = false;
                    starteRollAnimation();
                }
            } else {
                if (rollRollt) {
                    rollRollt = false;
                    document.getElementById('roll-status-icon').textContent = '‚è∏';
                    document.getElementById('roll-status-text').textContent = 'Rad steht';
                    document.getElementById('roll-status-box').style.background = '#f5f5f5';
                    document.getElementById('roll-status-box').style.borderColor = '#ddd';
                    stoppeRollAnimation();
                }
                document.getElementById('roll-speichern-btn').disabled = true;
            }
        }

        function starteRollAnimation() {
            if (rollInterval) return;
            rollInterval = setInterval(function() {
                rollWagenPos += 2;
                if (rollWagenPos > 280) rollWagenPos = 60;
                document.getElementById('roll-wagen').style.left = rollWagenPos + 'px';
                rollRotation += 8;
                var speichen = document.getElementById('roll-rad-speichen');
                if (speichen) speichen.style.transform = 'rotate(' + rollRotation + 'deg)';
            }, 50);
        }

        function stoppeRollAnimation() {
            if (rollInterval) { clearInterval(rollInterval); rollInterval = null; }
        }

        function speichereMessung() {
            var typ = document.getElementById('roll-radtyp').value;
            var daten = rollDaten[typ];
            document.getElementById('roll-erg-' + typ).textContent = daten.schwelle.toFixed(1).replace('.', ',') + ' N';
            document.getElementById('roll-verf-' + typ).textContent = daten.kontakt;
            rollMessungen[typ] = daten.schwelle;

            var zeile = document.getElementById('roll-zeile-' + typ);
            if (zeile) zeile.style.background = 'var(--success-bg)';
            updateRollInfo();

            var typen = ['stahl', 'gummi-prall', 'gummi-platt'];
            var naechster = typen.find(function(t) { return !rollMessungen[t]; });
            if (naechster) {
                document.getElementById('roll-radtyp').value = naechster;
                wechsleRadtyp();
            } else {
                document.getElementById('roll-erkenntnis').style.display = 'block';
                document.getElementById('roll-info').innerHTML = '<strong style="color: var(--success);">Alle Messungen abgeschlossen!</strong> Beantworte die Erkenntnisfrage.';
            }
        }

        function updateRollInfo() {
            var anzahl = Object.keys(rollMessungen).length;
            var info = document.getElementById('roll-info');
            if (anzahl === 0) info.innerHTML = '<strong>Schritt 1:</strong> Erh√∂he die Zugkraft langsam. Bei welcher Kraft beginnt das Stahlrad zu rollen?';
            else if (anzahl === 1) info.innerHTML = '<strong>Schritt 2:</strong> Wechsle zum Gummireifen (prall). Wie viel Kraft brauchst du jetzt?';
            else if (anzahl === 2) info.innerHTML = '<strong>Schritt 3:</strong> Jetzt der platte Reifen. Beobachte die gro√üe Aufstandsfl√§che!';
        }

        function zeigeRollAntwort(nr) {
            var el = document.getElementById('roll-erk-' + nr);
            el.textContent = nr === 1 ? 'gr√∂√üer' : 'gr√∂√üer';
            el.classList.add('geloest');
        }

        function initRollSim() { wechsleRadtyp(); }

        // =======================================
        // REIFENDRUCK-SIMULATION (Zusatz Schritt 13)
        // =======================================
        function initReifendruck() { updateReifendruck(); }

        function updateReifendruck() {
            var druck = parseInt(document.getElementById('druck-slider').value);
            var labels = ['sehr niedrig', 'niedrig', 'optimal', 'hoch', 'sehr hoch'];
            document.getElementById('druck-label').textContent = labels[druck - 1];

            var container = document.getElementById('reifen-svg-container');
            var breite, hoehe, kontakt, roll, haft, gesamt, gesamtClass;

            switch (druck) {
                case 1: breite = 90; hoehe = 50; kontakt = 'sehr gro√ü'; roll = 'hoch'; haft = 'gut'; gesamt = 'Schwer zu fahren!'; gesamtClass = 'error'; break;
                case 2: breite = 80; hoehe = 55; kontakt = 'gro√ü'; roll = 'erh√∂ht'; haft = 'sehr gut'; gesamt = 'Guter Grip, mehr Aufwand'; gesamtClass = 'warning'; break;
                case 3: breite = 70; hoehe = 60; kontakt = 'optimal'; roll = 'niedrig'; haft = 'gut'; gesamt = 'Optimal!'; gesamtClass = 'success'; break;
                case 4: breite = 65; hoehe = 65; kontakt = 'klein'; roll = 'sehr niedrig'; haft = 'm√§√üig'; gesamt = 'Weniger Grip in Kurven'; gesamtClass = 'warning'; break;
                case 5: breite = 60; hoehe = 68; kontakt = 'sehr klein'; roll = 'minimal'; haft = 'schlecht'; gesamt = 'Rutschgefahr!'; gesamtClass = 'error'; break;
            }

            var reifenMitteY = 45 + (70 - hoehe) / 2;
            container.innerHTML = '<svg width="100" height="90" viewBox="0 0 100 90">' +
                '<ellipse cx="50" cy="' + reifenMitteY + '" rx="' + (breite/2) + '" ry="' + (hoehe/2) + '" fill="#222" stroke="#111" stroke-width="3"/>' +
                '<ellipse cx="50" cy="' + reifenMitteY + '" rx="18" ry="18" fill="#888"/>' +
                '<rect x="' + (50 - breite/3) + '" y="80" width="' + (breite*2/3) + '" height="6" fill="#111" rx="2"/>' +
                '</svg>';

            document.getElementById('kontakt-wert').textContent = kontakt;
            document.getElementById('roll-wert').textContent = roll;
            document.getElementById('haft-wert').textContent = haft;
            var bew = document.getElementById('bewertung-gesamt');
            bew.textContent = gesamt;
            bew.style.background = gesamtClass === 'success' ? 'var(--success-bg)' : (gesamtClass === 'warning' ? 'var(--warning-bg)' : 'var(--error-bg)');
            bew.style.color = gesamtClass === 'success' ? 'var(--success)' : (gesamtClass === 'warning' ? 'var(--warning)' : 'var(--error)');
        }

        // =======================================
        // ABS-SIMULATION (Zusatz Schritt 14)
        // =======================================
        var absRunning = false;
        var absInterval = null;
        var absFlashInterval = null;
        var absErgebnisse = {};
        var absRotation = 0;
        var absHaftPhase = true;

        function updateStrassentyp() {
            var typ = document.getElementById('abs-strasse-select').value;
            var strasse = document.getElementById('abs-strasse');
            var farben = { trocken: '#555', nass: '#446', eis: '#aac' };
            strasse.style.background = farben[typ];
        }

        function starteBremstest(modus) {
            if (absRunning) return;
            absRunning = true;
            document.getElementById('btn-ohne-abs').disabled = true;
            document.getElementById('btn-mit-abs').disabled = true;

            var radContainer = document.getElementById('abs-rad-container');
            var radRing = document.getElementById('abs-rad-ring');
            var radSpeichen = document.getElementById('abs-rad-speichen');
            var spurContainer = document.getElementById('abs-spur-container');
            var status = document.getElementById('abs-status');
            var label = document.getElementById('abs-bremsweg-label');
            var meter = document.getElementById('abs-meter');
            var strTyp = document.getElementById('abs-strasse-select').value;

            spurContainer.innerHTML = '';
            var bremswege = {
                trocken: { ohne: 150, mit: 125 },
                nass: { ohne: 280, mit: 200 },
                eis: { ohne: 1100, mit: 950 }
            };

            var zielDist = bremswege[strTyp][modus === 'mit' ? 'mit' : 'ohne'];
            var pos = 50;
            var v = 8;
            var a = (v * v) / (2 * zielDist);
            var t = 0;
            var mitABS = modus === 'mit';
            var letzteSpurPos = 0;
            absHaftPhase = true;
            absRotation = 0;

            label.style.display = 'block';

            if (!mitABS) {
                setTimeout(function() {
                    radRing.setAttribute('stroke', 'var(--error)');
                    radRing.setAttribute('stroke-width', '8');
                    status.innerHTML = '<span style="color: var(--error);">‚ö† Rad blockiert ‚Äì gleitet!</span>';
                }, 300);
            } else {
                status.innerHTML = '<span style="color: var(--success);">‚úì ABS aktiv ‚Äì Rad rollt weiter!</span>';
                absFlashInterval = setInterval(function() {
                    absHaftPhase = !absHaftPhase;
                    radRing.setAttribute('stroke', absHaftPhase ? 'var(--success)' : 'var(--error)');
                }, 120);
            }

            absInterval = setInterval(function() {
                t++;
                var vAkt = v - a * t;
                var s = v * t - 0.5 * a * t * t;
                pos = 50 + s;

                radContainer.style.left = pos + 'px';
                meter.textContent = Math.round(s / 10);

                if (pos > 350 && !document.getElementById('abs-offscreen-hint')) {
                    var hint = document.createElement('div');
                    hint.id = 'abs-offscreen-hint';
                    hint.style.cssText = 'position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 4px; font-size: 0.9em; z-index: 10;';
                    hint.innerHTML = '‚Üí Rad bremst noch... <strong>' + Math.round(s/10) + ' m</strong>';
                    document.getElementById('abs-canvas').appendChild(hint);
                }
                var hint = document.getElementById('abs-offscreen-hint');
                if (hint) hint.innerHTML = '‚Üí Rad bremst noch... <strong>' + Math.round(s/10) + ' m</strong>';

                var spurBreite = s - letzteSpurPos;
                if (spurBreite >= 4) {
                    var segment = document.createElement('div');
                    segment.style.height = '6px';
                    segment.style.width = spurBreite + 'px';
                    segment.style.flexShrink = '0';
                    if (!mitABS) {
                        segment.style.background = 'var(--error)';
                        segment.style.opacity = '0.7';
                    } else {
                        segment.style.background = absHaftPhase ? 'var(--success)' : 'var(--error)';
                        segment.style.opacity = absHaftPhase ? '0.8' : '0.6';
                    }
                    spurContainer.appendChild(segment);
                    letzteSpurPos = s;
                }

                if (mitABS || t < 8) {
                    absRotation += mitABS ? 10 : 15;
                    radSpeichen.style.transform = 'rotate(' + absRotation + 'deg)';
                }

                if (vAkt <= 0 || s >= zielDist) {
                    clearInterval(absInterval);
                    if (absFlashInterval) { clearInterval(absFlashInterval); absFlashInterval = null; }
                    var hintEl = document.getElementById('abs-offscreen-hint');
                    if (hintEl) hintEl.remove();
                    radRing.setAttribute('stroke', '#333');
                    radRing.setAttribute('stroke-width', '6');
                    var bremsweg = Math.round(zielDist / 10);
                    meter.textContent = bremsweg;

                    if (mitABS) {
                        status.innerHTML = '‚úì Gestoppt! Bremsweg: <strong>' + bremsweg + ' m</strong>';
                        status.style.background = 'var(--success-bg)';
                    } else {
                        status.innerHTML = '‚ö† Gestoppt! Bremsweg: <strong>' + bremsweg + ' m</strong>';
                        status.style.background = 'var(--error-bg)';
                    }

                    var key = 'erg-' + strTyp + '-' + modus;
                    document.getElementById(key).textContent = bremsweg + ' m';
                    absErgebnisse[key] = bremsweg;

                    absRunning = false;
                    document.getElementById('btn-ohne-abs').disabled = false;
                    document.getElementById('btn-mit-abs').disabled = false;
                }
            }, 40);
        }

        function resetABS() {
            if (absInterval) clearInterval(absInterval);
            if (absFlashInterval) clearInterval(absFlashInterval);
            absRunning = false;
            absFlashInterval = null;

            document.getElementById('abs-rad-container').style.left = '50px';
            document.getElementById('abs-rad-ring').setAttribute('stroke', '#333');
            document.getElementById('abs-rad-ring').setAttribute('stroke-width', '6');
            document.getElementById('abs-rad-speichen').style.transform = 'rotate(0deg)';
            document.getElementById('abs-spur-container').innerHTML = '';
            var status = document.getElementById('abs-status');
            status.textContent = 'Bereit';
            status.style.background = 'white';
            document.getElementById('abs-bremsweg-label').style.display = 'none';
            document.getElementById('btn-ohne-abs').disabled = false;
            document.getElementById('btn-mit-abs').disabled = false;
            var hintEl = document.getElementById('abs-offscreen-hint');
            if (hintEl) hintEl.remove();
        }

        // =======================================
        // MEMORY-SPIEL (Zusatz Schritt 15)
        // =======================================
        var memoryPaare = [
            { begriff: 'Haftreibung', erklaerung: 'Gr√∂√üte Reibungsart' },
            { begriff: 'Gleitreibung', erklaerung: 'Reibung bei Bewegung' },
            { begriff: 'Rollreibung', erklaerung: 'Kleinste Reibungsart' },
            { begriff: 'ABS', erklaerung: 'Verhindert Blockieren' },
            { begriff: 'Œº (m√º)', erklaerung: 'Reibungszahl' },
            { begriff: 'Walkarbeit', erklaerung: 'Verformung beim Rollen' }
        ];
        var memoryKarten = [];
        var memoryOffen = [];
        var memoryTries = 0;
        var memoryPairsFound = 0;
        var memoryLocked = false;

        function initMemory() {
            memoryKarten = [];
            memoryOffen = [];
            memoryTries = 0;
            memoryPairsFound = 0;
            memoryLocked = false;

            memoryPaare.forEach(function(paar, idx) {
                memoryKarten.push({ id: idx, typ: 'begriff', text: paar.begriff, paarId: idx });
                memoryKarten.push({ id: idx, typ: 'erklaerung', text: paar.erklaerung, paarId: idx });
            });

            for (var i = memoryKarten.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = memoryKarten[i];
                memoryKarten[i] = memoryKarten[j];
                memoryKarten[j] = temp;
            }

            var grid = document.getElementById('memory-grid');
            grid.innerHTML = '';
            memoryKarten.forEach(function(karte, idx) {
                var div = document.createElement('div');
                div.className = 'memory-card';
                div.setAttribute('data-idx', idx);
                div.textContent = '?';
                div.onclick = function() { clickMemoryCard(idx); };
                grid.appendChild(div);
            });

            updateMemoryStats();
            document.getElementById('memory-info').textContent = 'Klicke zwei Karten auf, um ein Paar zu finden!';
        }

        function clickMemoryCard(idx) {
            if (memoryLocked) return;
            var karte = memoryKarten[idx];
            var cards = document.querySelectorAll('.memory-card');
            var card = cards[idx];
            if (card.classList.contains('flipped') || card.classList.contains('matched')) return;

            card.classList.add('flipped');
            card.textContent = karte.text;
            memoryOffen.push(idx);

            if (memoryOffen.length === 2) {
                memoryTries++;
                updateMemoryStats();
                memoryLocked = true;

                var k1 = memoryKarten[memoryOffen[0]];
                var k2 = memoryKarten[memoryOffen[1]];

                if (k1.paarId === k2.paarId && k1.typ !== k2.typ) {
                    setTimeout(function() {
                        cards[memoryOffen[0]].classList.add('matched');
                        cards[memoryOffen[1]].classList.add('matched');
                        memoryPairsFound++;
                        updateMemoryStats();
                        memoryOffen = [];
                        memoryLocked = false;
                        if (memoryPairsFound === memoryPaare.length) {
                            document.getElementById('memory-info').innerHTML = '<strong style="color: var(--success);">Gewonnen!</strong> Alle Paare in ' + memoryTries + ' Versuchen gefunden!';
                        }
                    }, 500);
                } else {
                    setTimeout(function() {
                        cards[memoryOffen[0]].classList.remove('flipped');
                        cards[memoryOffen[0]].textContent = '?';
                        cards[memoryOffen[1]].classList.remove('flipped');
                        cards[memoryOffen[1]].textContent = '?';
                        memoryOffen = [];
                        memoryLocked = false;
                    }, 1000);
                }
            }
        }

        function updateMemoryStats() {
            document.getElementById('memory-tries').textContent = memoryTries;
            document.getElementById('memory-pairs').textContent = memoryPairsFound;
        }


        // =======================================
        // HYPOTHESE (Schritt 3)
        // =======================================
        function selectHypothese(el) {
            document.querySelectorAll('#hypothese-options .quiz-option').forEach(function(o) {
                o.style.borderColor = '';
                o.style.background = '';
            });
            el.style.borderColor = 'var(--physik)';
            el.style.background = 'var(--physik-light)';
            document.getElementById('hypothese-feedback').style.display = 'block';
        }

        // =======================================
        // MESSWERT-TABELLE (Schritt 6)
        // =======================================
        var messRecorded = 0;
        function recordMesswert(fn) {
            var gewicht = parseInt(document.getElementById('sim5b-gewicht').value);
            if (gewicht !== fn) {
                alert('Stelle zuerst die Gewichtskraft auf ' + fn + ' N ein!');
                return;
            }
            var rauheit = parseInt(document.getElementById('sim5b-rauheit').value);
            if (rauheit !== 2) {
                alert('Stelle die Oberfl√§che auf ‚Äûmittel" ein!');
                return;
            }
            var mu = [0.3, 0.5, 0.8][rauheit - 1];
            var fr = (mu * fn).toFixed(1);
            var quot = mu.toFixed(2);
            document.getElementById('mess-' + fn).textContent = fr + ' N';
            document.getElementById('quot-' + fn).textContent = quot;
            messRecorded++;
            if (messRecorded >= 3) {
                document.getElementById('mess-erkenntnis').style.display = 'block';
                document.getElementById('merksatz-einflussfaktoren').style.display = 'block';
            }
        }

        // =======================================
        // ORDERING QUIZ (Schritt 5)
        // =======================================
        function checkOrdering(el, answer) {
            var opts = el.parentNode.querySelectorAll('.quiz-option');
            opts.forEach(function(o) { o.style.pointerEvents = 'none'; o.classList.remove('correct', 'incorrect'); });
            var fb = document.getElementById('ordering-fb');
            fb.style.display = 'block';
            if (answer === 'haft') {
                el.classList.add('correct');
                fb.innerHTML = '<strong style="color: var(--success);">Richtig!</strong> Die Haftreibung ist am gr√∂√üten, die Rollreibung am kleinsten.';
                fb.style.borderColor = 'var(--success)';
                document.getElementById('ordering-merksatz').style.display = 'block';
            } else {
                el.classList.add('incorrect');
                opts[0].classList.add('correct');
                fb.innerHTML = '<strong style="color: var(--error);">Nicht ganz.</strong> Schau dir deine Messwerte nochmal an!';
                fb.style.borderColor = 'var(--error)';
                setTimeout(function() { document.getElementById('ordering-merksatz').style.display = 'block'; }, 2000);
            }
        }

        init();
        initMemory();
    </script>
</body>
</html>
