<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Lernpfad: Reibungskräfte II</title>
    <style>
        :root {
            --physik: #2c5aa0;
            --physik-light: #e8f0f8;
            --success: #2a7a4b;
            --success-bg: #e8f5e9;
            --warning: #b35c00;
            --warning-bg: #fff3e0;
            --error: #c62828;
            --error-bg: #ffebee;
            --bg: #f5f5f5;
            --white: #ffffff;
            --border: #dddddd;
            --text: #222222;
            --text-secondary: #555555;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        /* iOS Touch-Optimierungen */
        html {
            -webkit-text-size-adjust: 100%;
            -webkit-touch-callout: none;
        }

        body {
            -webkit-user-select: none;
            user-select: none;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            font-size: 16px;
            line-height: 1.6;
        }

        .container { max-width: 800px; margin: 0 auto; padding: 20px; }

        header {
            background: var(--physik);
            color: white;
            padding: 20px;
            margin: -20px -20px 20px -20px;
            position: relative;
        }
        header h1 { font-size: 1.4em; font-weight: 600; }
        header .meta { font-size: 0.85em; opacity: 0.9; margin-top: 5px; }

        .btn-reset {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.4);
            font-size: 0.8em;
            padding: 5px 12px;
            position: absolute;
            top: 15px;
            right: 15px;
            cursor: pointer;
            min-width: 44px;
            min-height: 44px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        /* Touch-Optimierung für native Inputs */
        input[type="range"] {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        select {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            min-height: 44px;
        }

        .progress-bar { background: var(--border); height: 6px; }
        .progress-fill { background: var(--physik); height: 100%; width: 0%; transition: width 0.3s; }

        .step-indicators {
            display: flex;
            justify-content: center;
            gap: 4px;
            padding: 12px;
            flex-wrap: wrap;
        }

        .step-dot {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85em;
            font-weight: 600;
            border: 2px solid var(--border);
            background: var(--white);
            cursor: pointer;
            transition: all 0.15s;
            color: var(--text-secondary);
            border-radius: 4px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        .step-dot:hover { border-color: var(--physik); }
        .step-dot.current { background: var(--physik); border-color: var(--physik); color: white; }
        .step-dot.completed { background: var(--success); border-color: var(--success); color: white; }

        .step {
            background: var(--white);
            border: 1px solid var(--border);
            padding: 20px;
            margin-bottom: 15px;
            display: none;
        }
        .step.active { display: block; }

        .step-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }
        .step-number {
            background: var(--physik);
            color: white;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9em;
        }
        .step-title { font-weight: 600; color: var(--physik); }

        .stern { color: var(--warning); font-weight: bold; }

        h2 { font-size: 1.1em; font-weight: 600; margin: 20px 0 10px 0; color: var(--text); }
        p { margin-bottom: 12px; }
        ul, ol { margin: 10px 0 10px 20px; }
        li { margin-bottom: 5px; }

        .info-box {
            background: var(--physik-light);
            border-left: 4px solid var(--physik);
            padding: 12px 15px;
            margin: 15px 0;
            font-size: 0.95em;
            -webkit-user-select: text;
            user-select: text;
        }

        .merksatz {
            background: var(--success-bg);
            border: 2px solid var(--success);
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            -webkit-user-select: text;
            user-select: text;
        }
        .merksatz strong { color: var(--success); }

        .hefter-hinweis {
            background: var(--warning-bg);
            border: 2px solid var(--warning);
            padding: 12px 15px;
            margin: 15px 0;
            font-size: 0.9em;
        }
        .hefter-hinweis::before {
            content: "Arbeitsblatt";
            display: inline-block;
            background: var(--warning);
            color: white;
            font-size: 0.75em;
            font-weight: 600;
            padding: 2px 8px;
            margin-bottom: 8px;
        }

        .animation-container {
            background: #f8f9fa;
            border: 2px solid var(--physik);
            border-radius: 4px;
            padding: 20px;
            margin: 15px 0;
            min-height: 200px;
        }

        .ani-title {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 10px;
        }

        .ani-canvas {
            background: #ffffff;
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
            min-height: 150px;
            position: relative;
            overflow: hidden;
        }

        .ani-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .ani-btn {
            background: var(--physik);
            color: white;
            border: none;
            padding: 10px 18px;
            cursor: pointer;
            font-size: 0.9em;
            border-radius: 4px;
            min-width: 44px;
            min-height: 44px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        .ani-btn:hover { background: #1e4a8a; }
        .ani-btn:disabled { background: #aaa; cursor: not-allowed; }
        .ani-btn.active { background: var(--success); }

        .ani-display {
            background: var(--physik-light);
            border: 1px solid var(--physik);
            padding: 8px 12px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
        }

        .ani-info {
            background: var(--physik-light);
            border-left: 3px solid var(--physik);
            padding: 8px 12px;
            margin-top: 10px;
            font-size: 0.85em;
        }

        /* Formeldreieck */
        .formel-dreieck-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .dreieck-cell {
            cursor: pointer;
            transition: all 0.2s;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        .dreieck-cell:hover { filter: brightness(1.1); }
        .dreieck-cell.hidden { opacity: 0.15; }

        .formel-result {
            text-align: center;
            padding: 20px;
            background: var(--success-bg);
            border: 2px solid var(--success);
            min-width: 250px;
        }
        .formel-result h4 { color: var(--success); margin-bottom: 10px; }
        .formel-big {
            font-size: 2em;
            font-weight: bold;
            color: var(--success);
            font-family: "Times New Roman", serif;
        }
        .formel-big sub { font-size: 0.6em; }

        /* Bruchdarstellung ISO 80000 */
        .frac {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            vertical-align: middle;
            margin: 0 0.2em;
        }
        .frac-num {
            border-bottom: 2px solid currentColor;
            padding: 0 0.3em 0.1em 0.3em;
            line-height: 1.2;
        }
        .frac-den {
            padding: 0.1em 0.3em 0 0.3em;
            line-height: 1.2;
        }
        .formel-big .frac { font-size: 0.7em; }
        .formel-big .frac-num, .formel-big .frac-den { font-size: 1em; }

        /* Vergleichstabelle */
        .vergleich-tabelle {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9em;
        }
        .vergleich-tabelle th, .vergleich-tabelle td {
            border: 1px solid var(--border);
            padding: 10px;
            text-align: center;
        }
        .vergleich-tabelle th { background: var(--physik); color: white; }

        /* Rad-Animation */
        .rad {
            width: 80px;
            height: 80px;
            border: 6px solid #333;
            border-radius: 50%;
            position: absolute;
            background: radial-gradient(circle at center, #666 0%, #444 100%);
        }
        .rad::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 12px;
            height: 12px;
            background: #888;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        .rad.spinning {
            animation: spin 0.5s linear infinite;
        }
        .rad.blocked {
            border-color: var(--error);
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Strasse */
        .strasse {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: #444;
        }

        /* Reifen-Deformation */
        .reifen-vergleich {
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            height: 120px;
            gap: 20px;
        }
        .reifen-box {
            text-align: center;
            flex: 1;
        }
        .reifen-box .label { font-size: 0.8em; margin-bottom: 5px; }

        /* Quiz */
        .quiz-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        .quiz-option {
            padding: 12px 20px;
            border: 2px solid var(--border);
            background: white;
            cursor: pointer;
            font-size: 1em;
            min-width: 44px;
            min-height: 44px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        .quiz-option:hover { border-color: var(--physik); background: var(--physik-light); }
        .quiz-option.correct { border-color: var(--success); background: var(--success-bg); }
        .quiz-option.incorrect { border-color: var(--error); background: var(--error-bg); }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }
        .btn {
            padding: 12px 24px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            font-weight: 600;
            min-width: 44px;
            min-height: 44px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        .btn-primary { background: var(--physik); color: white; }
        .btn-secondary { background: var(--border); color: var(--text); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* ABS Diagramm */
        .abs-diagram {
            display: flex;
            align-items: center;
            gap: 5px;
            height: 40px;
            margin: 10px 0;
        }
        .abs-bar {
            height: 100%;
            min-width: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            color: white;
            font-weight: bold;
        }
        .abs-bar.haft { background: var(--success); }
        .abs-bar.gleit { background: var(--error); }

        /* Klickbare Lücken für Erkenntnisfragen */
        .luecke-klick {
            border-bottom: 2px dashed var(--physik);
            padding: 10px 16px;
            cursor: pointer;
            color: var(--physik);
            font-weight: bold;
            transition: all 0.2s;
            display: inline-block;
            min-height: 44px;
            line-height: 24px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        .luecke-klick:hover {
            background: var(--physik-light);
        }
        .luecke-klick.geloest {
            border-bottom: 2px solid var(--success);
            color: var(--success);
            cursor: default;
            background: var(--success-bg);
        }

        /* Memory-Spiel für Bonus */
        .memory-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-width: 400px;
            margin: 20px auto;
        }
        .memory-card {
            aspect-ratio: 1;
            min-height: 70px;
            background: var(--physik);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75em;
            font-weight: bold;
            color: white;
            text-align: center;
            padding: 5px;
            transition: all 0.3s;
            transform-style: preserve-3d;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        .memory-card:hover { transform: scale(1.05); }
        .memory-card.flipped {
            background: var(--white);
            color: var(--text);
            border: 2px solid var(--physik);
        }
        .memory-card.matched {
            background: var(--success-bg);
            color: var(--success);
            border: 2px solid var(--success);
            cursor: default;
        }
        .memory-card.matched:hover { transform: none; }
        .memory-stats {
            text-align: center;
            margin: 15px 0;
            font-size: 0.9em;
        }

        @media (max-width: 600px) {
            .container { padding: 10px; }
            header { margin: -10px -10px 15px -10px; padding: 15px; }
            .step { padding: 15px; }
            .formel-big { font-size: 1.5em; }
            .formel-dreieck-container { flex-direction: column; }
            .memory-container { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Lernpfad: Reibungskräfte II</h1>
            <div class="meta">Physik Klasse 7 – Kräfte (Vertiefung)</div>
            <button class="btn-reset" onclick="resetLernpfad()">Neu starten</button>
        </header>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="step-indicators" id="stepIndicators"></div>

        <!-- SCHRITT 1: Wiederholung -->
        <div class="step active" id="step1">
            <div class="step-header">
                <span class="step-number">1</span>
                <span class="step-title">Wiederholung: Die drei Reibungsarten</span>
            </div>

            <p>Erinnerst du dich an die letzte Stunde? Ordne die Reibungsarten nach ihrer Größe:</p>

            <div class="animation-container" id="sort-container">
                <div class="ani-title">Interaktiv: Sortiere die Reibungsarten (größte zuerst)</div>
                <div class="ani-canvas" id="sort-canvas" style="min-height: 100px; display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <div class="quiz-option sort-item" data-value="haft" onclick="selectSort(this)" style="font-size: 1.1em;">Haftreibung</div>
                    <div class="quiz-option sort-item" data-value="gleit" onclick="selectSort(this)" style="font-size: 1.1em;">Gleitreibung</div>
                    <div class="quiz-option sort-item" data-value="roll" onclick="selectSort(this)" style="font-size: 1.1em;">Rollreibung</div>
                </div>
                <div class="ani-info" id="sort-feedback">Klicke der Reihe nach: Welche ist am größten? Dann die mittlere, dann die kleinste.</div>
            </div>

            <div class="merksatz" id="merksatz1" style="display: none;">
                <strong>Merke:</strong><br>
                <i>F</i><sub>Haft</sub> &gt; <i>F</i><sub>Gleit</sub> &gt; <i>F</i><sub>Roll</sub><br>
                <em>Haftreibung ist am größten, Rollreibung am kleinsten!</em>
            </div>

            <div class="hefter-hinweis">
                <strong>W1 ausfüllen:</strong> Ergänze die Reihenfolge mit &gt; oder &lt; Zeichen.
            </div>

            <div class="nav-buttons">
                <span></span>
                <button class="btn btn-primary" onclick="nextStep()">Weiter zur Formel</button>
            </div>
        </div>

        <!-- SCHRITT 2: Formeldreieck -->
        <div class="step" id="step2">
            <div class="step-header">
                <span class="step-number">2</span>
                <span class="step-title">Die Reibungsformel</span>
            </div>

            <p>Die Reibungskraft lässt sich berechnen:</p>

            <div class="merksatz">
                <div class="formel-big"><i>F</i><sub>R</sub> = μ · <i>F</i><sub>N</sub></div>
                <p style="margin-top: 10px; font-size: 0.9em;">
                    <i>F</i><sub>R</sub> = Reibungskraft in N<br>
                    μ = Reibungszahl ("mü", keine Einheit)<br>
                    <i>F</i><sub>N</sub> = Normalkraft in N (≈ Gewichtskraft auf ebener Fläche)
                </p>
            </div>

            <div class="info-box">
                <strong>Was sagt die Formel?</strong>
                <ul>
                    <li>Mehr Gewicht (größere <i>F</i><sub>N</sub>) → mehr Reibung</li>
                    <li>Rauere Oberfläche (größeres μ) → mehr Reibung</li>
                </ul>
            </div>

            <h2>Das Formel-Dreieck</h2>
            <p>Klicke auf die Größe, die du berechnen willst – sie wird "abgedeckt":</p>

            <div class="animation-container">
                <div class="formel-dreieck-container">
                    <svg width="200" height="180" viewBox="0 0 200 180">
                        <!-- Dreieck Umriss -->
                        <polygon points="100,10 20,160 180,160" fill="none" stroke="#2c5aa0" stroke-width="3"/>
                        <!-- Horizontale Trennlinie -->
                        <line x1="40" y1="85" x2="160" y2="85" stroke="#2c5aa0" stroke-width="2"/>
                        <!-- Vertikale Trennlinie unten -->
                        <line x1="100" y1="85" x2="100" y2="160" stroke="#2c5aa0" stroke-width="2"/>

                        <!-- F_R (oben) -->
                        <g class="dreieck-cell" id="cell-fr" onclick="selectFormel('fr')">
                            <polygon points="100,15 45,80 155,80" fill="#ffebee"/>
                            <text x="100" y="58" text-anchor="middle" font-size="24" font-weight="bold" fill="#c62828">F<tspan baseline-shift="sub" font-size="14">R</tspan></text>
                        </g>

                        <!-- μ (unten links) -->
                        <g class="dreieck-cell" id="cell-mu" onclick="selectFormel('mu')">
                            <polygon points="42,90 25,155 95,155 95,90" fill="#e3f2fd"/>
                            <text x="65" y="130" text-anchor="middle" font-size="28" font-weight="bold" fill="#1565c0">μ</text>
                        </g>

                        <!-- F_N (unten rechts) -->
                        <g class="dreieck-cell" id="cell-fn" onclick="selectFormel('fn')">
                            <polygon points="105,90 105,155 175,155 158,90" fill="#e8f5e9"/>
                            <text x="135" y="128" text-anchor="middle" font-size="20" font-weight="bold" fill="#2a7a4b">F<tspan baseline-shift="sub" font-size="12">N</tspan></text>
                        </g>

                        <!-- Multiplikationszeichen -->
                        <text x="100" y="130" text-anchor="middle" font-size="20" fill="#555">·</text>
                    </svg>

                    <div class="formel-result" id="formel-result">
                        <h4 id="formel-title">Klicke auf eine Größe!</h4>
                        <div class="formel-big" id="formel-display">? = ?</div>
                        <p id="formel-erklaerung" style="font-size: 0.85em; margin-top: 10px;">Das Formel-Dreieck zeigt dir die richtige Formel.</p>
                    </div>
                </div>
            </div>

            <div class="hefter-hinweis">
                <strong>K1 ausfüllen:</strong> Zeichne das Formel-Dreieck ab und notiere alle drei Formeln.
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zurück</button>
                <button class="btn btn-primary" onclick="nextStep()">Weiter zum Rechnen</button>
            </div>
        </div>

        <!-- SCHRITT 3: Rechnen üben -->
        <div class="step" id="step3">
            <div class="step-header">
                <span class="step-number">3</span>
                <span class="step-title">Rechnen mit der Formel</span>
            </div>

            <p>Jetzt wendest du die Formel an. Nutze das Formel-Dreieck als Hilfe!</p>

            <h2>★ Beispiel (vorgerechnet)</h2>
            <div class="info-box">
                <strong>Gegeben:</strong> μ = 0,5 (Holz auf Holz), <i>F</i><sub>N</sub> = 10 N<br>
                <strong>Gesucht:</strong> <i>F</i><sub>R</sub><br><br>
                <strong>Formel:</strong> <i>F</i><sub>R</sub> = μ · <i>F</i><sub>N</sub><br>
                <strong>Einsetzen:</strong> <i>F</i><sub>R</sub> = 0,5 · 10 N = <strong>5 N</strong>
            </div>

            <h2>★ Aufgabe 1</h2>
            <p>Ein Klotz liegt auf dem Tisch. μ = 0,4, <i>F</i><sub>N</sub> = 20 N. Wie groß ist <i>F</i><sub>R</sub>?</p>
            <div class="quiz-options" id="quiz1">
                <div class="quiz-option" onclick="checkRechenaufgabe(1, 8, this)">8 N</div>
                <div class="quiz-option" onclick="checkRechenaufgabe(1, 50, this)">50 N</div>
                <div class="quiz-option" onclick="checkRechenaufgabe(1, 0.02, this)">0,02 N</div>
            </div>
            <div class="ani-info" id="quiz1-fb" style="display:none;"></div>

            <h2>★★ Aufgabe 2</h2>
            <p>Autoreifen auf trockener Straße: μ = 0,8, <i>F</i><sub>N</sub> = 5000 N. Wie groß ist <i>F</i><sub>R</sub>?</p>
            <div class="quiz-options" id="quiz2">
                <div class="quiz-option" onclick="checkRechenaufgabe(2, 4000, this)">4000 N</div>
                <div class="quiz-option" onclick="checkRechenaufgabe(2, 6250, this)">6250 N</div>
                <div class="quiz-option" onclick="checkRechenaufgabe(2, 625, this)">625 N</div>
            </div>
            <div class="ani-info" id="quiz2-fb" style="display:none;"></div>

            <h2>★★★ Aufgabe 3 (Umstellen!)</h2>
            <p>Die Reibungskraft beträgt <i>F</i><sub>R</sub> = 12 N, die Normalkraft <i>F</i><sub>N</sub> = 40 N. Wie groß ist μ?</p>
            <div class="quiz-options" id="quiz3">
                <div class="quiz-option" onclick="checkRechenaufgabe(3, 0.3, this)">μ = 0,3</div>
                <div class="quiz-option" onclick="checkRechenaufgabe(3, 480, this)">μ = 480</div>
                <div class="quiz-option" onclick="checkRechenaufgabe(3, 28, this)">μ = 28</div>
            </div>
            <div class="ani-info" id="quiz3-fb" style="display:none;"></div>

            <div class="hefter-hinweis">
                <strong>R1, R2, R3 lösen:</strong> Zeige den vollständigen Rechenweg auf deinem Arbeitsblatt!
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zurück</button>
                <button class="btn btn-primary" onclick="nextStep()">Weiter zur Rollreibung</button>
            </div>
        </div>

        <!-- SCHRITT 4: Rollreibung – Stahl vs. Gummi -->
        <div class="step" id="step4">
            <div class="step-header">
                <span class="step-number">4</span>
                <span class="step-title">Experiment: Rollreibung messen</span>
            </div>

            <p><strong>Phänomen:</strong> Eisenbahnen haben Räder aus Stahl, Autos haben Gummireifen. Welches Material rollt leichter?</p>

            <div class="info-box">
                <strong>Deine Aufgabe:</strong> Miss für jeden Radtyp, wie viel Kraft nötig ist, um das Rad ins Rollen zu bringen. Beobachte dabei die <em>Aufstandsfläche</em> (gelb markiert) – sie zeigt, wo das Rad den Boden berührt.
            </div>

            <div class="animation-container" id="sim-roll">
                <div class="ani-title">Experiment: Rollreibung messen</div>
                <div class="ani-canvas" id="roll-canvas" style="height: 180px; position: relative; overflow: hidden;">
                    <!-- Boden -->
                    <div style="position: absolute; bottom: 0; left: 0; right: 0; height: 25px; background: linear-gradient(0deg, #444 0%, #666 100%);"></div>

                    <!-- Rad-Container (bewegt sich) -->
                    <div id="roll-wagen" style="position: absolute; bottom: 25px; left: 60px; transition: left 0.1s linear;">
                        <svg id="roll-rad-svg" width="80" height="85" viewBox="0 0 80 85" style="display: block;">
                            <!-- Aufstandsfläche (Kontaktpatch) - gelb hervorgehoben -->
                            <rect id="roll-kontakt" x="30" y="78" width="20" height="6" fill="#f1c40f" rx="2"/>
                            <!-- Rad-Körper (rotiert NICHT bei plattem Reifen) -->
                            <g id="roll-rad-body">
                                <circle id="roll-rad-kreis" cx="40" cy="40" r="36" fill="#888" stroke="#333" stroke-width="4"/>
                                <!-- Für platten Reifen: Ausbuchtung unten (bleibt statisch am Boden) -->
                                <path id="roll-rad-platt" d="M10,55 C10,70 20,78 40,78 C60,78 70,70 70,55" fill="#222" stroke="#111" stroke-width="4" style="display: none;"/>
                            </g>
                            <!-- Speichen (rotieren immer) -->
                            <g id="roll-rad-speichen" style="transform-origin: 40px 40px;">
                                <circle cx="40" cy="40" r="10" fill="#555"/>
                                <line x1="40" y1="8" x2="40" y2="24" stroke="#555" stroke-width="3"/>
                                <line x1="40" y1="56" x2="40" y2="72" stroke="#555" stroke-width="3"/>
                                <line x1="8" y1="40" x2="24" y2="40" stroke="#555" stroke-width="3"/>
                                <line x1="56" y1="40" x2="72" y2="40" stroke="#555" stroke-width="3"/>
                            </g>
                        </svg>
                        <!-- Beschriftung Aufstandsfläche -->
                        <div id="roll-kontakt-label" style="position: absolute; bottom: -18px; left: 50%; transform: translateX(-50%); font-size: 0.65em; color: #b8860b; white-space: nowrap;">Aufstandsfläche: <span id="roll-kontakt-groesse">klein</span></div>
                    </div>

                    <!-- Kraftpfeil -->
                    <svg id="roll-pfeil-svg" style="position: absolute; bottom: 60px; left: 145px;" width="120" height="30">
                        <defs>
                            <marker id="pfeilspitze" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#e74c3c"/>
                            </marker>
                        </defs>
                        <line id="roll-pfeil-linie" x1="0" y1="15" x2="10" y2="15" stroke="#e74c3c" stroke-width="4" marker-end="url(#pfeilspitze)"/>
                        <text id="roll-pfeil-text" x="5" y="28" font-size="11" fill="#c0392b" font-weight="bold">0,0 N</text>
                    </svg>

                    <!-- Status-Anzeige -->
                    <div id="roll-status-box" style="position: absolute; top: 8px; right: 10px; padding: 6px 12px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; font-size: 0.85em;">
                        <span id="roll-status-icon">⏸</span> <span id="roll-status-text">Rad steht</span>
                    </div>
                </div>

                <div class="ani-controls" style="flex-wrap: wrap; gap: 15px;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label style="font-size: 0.9em;">Radtyp:</label>
                        <select id="roll-radtyp" style="padding: 8px 12px; min-height: 44px; font-size: 0.9em;" onchange="wechsleRadtyp()">
                            <option value="stahl">Stahlrad (Zug)</option>
                            <option value="gummi-prall">Gummireifen (prall)</option>
                            <option value="gummi-platt">Gummireifen (platt)</option>
                        </select>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px; flex: 1; min-width: 200px;">
                        <label style="font-size: 0.9em; white-space: nowrap;">Zugkraft:</label>
                        <input type="range" id="roll-kraft-slider" min="0" max="6" step="0.1" value="0" style="flex: 1; height: 44px;" oninput="updateRollKraft()">
                        <span id="roll-kraft-anzeige" style="min-width: 50px; font-family: monospace; font-weight: bold; color: var(--warning);">0,0 N</span>
                    </div>
                    <button class="ani-btn" onclick="speichereMessung()" id="roll-speichern-btn" disabled style="background: var(--success);">Wert speichern</button>
                </div>

                <div class="ani-info" id="roll-info">
                    <strong>Schritt 1:</strong> Erhöhe die Zugkraft langsam mit dem Regler. Bei welcher Kraft beginnt das Rad zu rollen?
                </div>
            </div>

            <h2>Deine Messwerte</h2>
            <table class="vergleich-tabelle" id="roll-tabelle">
                <tr>
                    <th>Radtyp</th>
                    <th>Rollreibung <i>F</i><sub>Roll</sub></th>
                    <th>Aufstandsfläche</th>
                </tr>
                <tr id="roll-zeile-stahl">
                    <td>Stahlrad</td>
                    <td id="roll-erg-stahl">—</td>
                    <td id="roll-verf-stahl">—</td>
                </tr>
                <tr id="roll-zeile-gummi-prall">
                    <td>Gummi (prall)</td>
                    <td id="roll-erg-gummi-prall">—</td>
                    <td id="roll-verf-gummi-prall">—</td>
                </tr>
                <tr id="roll-zeile-gummi-platt">
                    <td>Gummi (platt)</td>
                    <td id="roll-erg-gummi-platt">—</td>
                    <td id="roll-verf-gummi-platt">—</td>
                </tr>
            </table>

            <div id="roll-erkenntnis" style="display: none;">
                <div class="merksatz">
                    <strong>Erkenntnisfrage:</strong><br>
                    Vergleiche deine Messwerte: Welchen Zusammenhang siehst du zwischen Aufstandsfläche und Rollreibung?<br><br>
                    Je <span id="roll-erk-1" class="luecke-klick" onclick="zeigeRollAntwort(1)">???</span> die Aufstandsfläche, desto <span id="roll-erk-2" class="luecke-klick" onclick="zeigeRollAntwort(2)">???</span> die Rollreibung!
                </div>
            </div>

            <div class="hefter-hinweis">
                <strong>B1 ausfüllen:</strong>
                <ul>
                    <li>Übertrage deine Messwerte in die Tabelle auf dem AB</li>
                    <li>Erkläre: Warum haben Züge Stahlräder, Autos aber Gummireifen?</li>
                </ul>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zurück</button>
                <button class="btn btn-primary" onclick="nextStep()">Weiter zum Reifendruck</button>
            </div>
        </div>

        <!-- SCHRITT 5: Reifendruck und Grip -->
        <div class="step" id="step5">
            <div class="step-header">
                <span class="step-number">5</span>
                <span class="step-title">Reifendruck und Haftung</span>
            </div>

            <p>Verändere den Reifendruck und beobachte die Auswirkungen:</p>

            <div class="animation-container" id="sim-druck">
                <div class="ani-title">Simulation: Reifendruck variieren</div>
                <div class="ani-canvas" style="height: 200px; position: relative;">
                    <div style="display: flex; justify-content: center; align-items: flex-end; height: 140px; gap: 40px;">
                        <div style="text-align: center;">
                            <div id="reifen-svg-container">
                                <!-- Reifen wird per JS gezeichnet -->
                            </div>
                            <div id="kontakt-anzeige" style="margin-top: 5px; font-size: 0.8em;">Kontaktfläche: <strong id="kontakt-wert">mittel</strong></div>
                        </div>
                        <div style="width: 150px;">
                            <div style="font-size: 0.85em; margin-bottom: 5px;">Bewertung:</div>
                            <div id="bewertung-roll" style="padding: 5px; margin: 3px 0; font-size: 0.8em; background: #f5f5f5;">Rollreibung: <span id="roll-wert">mittel</span></div>
                            <div id="bewertung-haft" style="padding: 5px; margin: 3px 0; font-size: 0.8em; background: #f5f5f5;">Haftung: <span id="haft-wert">gut</span></div>
                            <div id="bewertung-gesamt" style="padding: 8px; margin-top: 10px; font-size: 0.85em; font-weight: bold; background: var(--success-bg); color: var(--success);">Optimal!</div>
                        </div>
                    </div>
                    <div class="strasse" style="height: 25px;"></div>
                </div>
                <div class="ani-controls">
                    <label style="font-size: 0.9em;">Reifendruck:</label>
                    <input type="range" id="druck-slider" min="1" max="5" value="3" style="width: 150px; height: 44px;" oninput="updateReifendruck()">
                    <span id="druck-label" style="min-width: 80px;">optimal</span>
                </div>
                <div class="ani-info" id="druck-info">
                    Finde den optimalen Druck: Wenig Rollreibung UND gute Haftung!
                </div>
            </div>

            <div class="hefter-hinweis">
                <strong>B2 ausfüllen:</strong>
                <ul>
                    <li>Zu niedriger Druck: Rollreibung ___, Haftung ___</li>
                    <li>Zu hoher Druck: Rollreibung ___, Haftung ___</li>
                </ul>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zurück</button>
                <button class="btn btn-primary" onclick="nextStep()">Weiter zu <span class="stern">★★★</span> ABS</button>
            </div>
        </div>

        <!-- SCHRITT 6: ABS-System -->
        <div class="step" id="step6">
            <div class="step-header">
                <span class="step-number">6</span>
                <span class="step-title">ABS – Das Antiblockiersystem <span class="stern">★★★</span></span>
            </div>

            <p>Beim starken Bremsen können die Räder blockieren. Was passiert dann?</p>

            <div class="info-box" style="background: var(--error-bg); border-color: var(--error);">
                <strong style="color: var(--error);">Problem: Blockiertes Rad</strong>
                <ol>
                    <li>Bremse zieht zu stark → Rad steht still (blockiert)</li>
                    <li>Reifen <em>haftet</em> nicht mehr an der Straße</li>
                    <li>Reifen <em>gleitet</em> über die Straße</li>
                    <li><i>F</i><sub>Gleit</sub> &lt; <i>F</i><sub>Haft</sub> → <strong>längerer Bremsweg!</strong></li>
                </ol>
            </div>

            <div class="info-box" style="background: var(--success-bg); border-color: var(--success);">
                <strong style="color: var(--success);">Lösung: ABS</strong>
                <ol>
                    <li>Sensoren erkennen: Rad blockiert!</li>
                    <li>ABS verringert sofort den Bremsdruck</li>
                    <li>Rad dreht sich wieder → Haftreibung!</li>
                    <li>Bremsdruck wird wieder erhöht</li>
                    <li>Wechsel Haft ↔ Gleit viele Male pro Sekunde</li>
                </ol>
            </div>

            <h2>ABS-Diagramm</h2>
            <p>So verhindert ABS das Blockieren – das Rad rollt fast die ganze Zeit:</p>
            <div class="abs-diagram" id="abs-diagram">
                <div class="abs-bar haft" style="flex: 1;">◯</div>
                <div class="abs-bar gleit" style="flex: 0.3;">▪</div>
                <div class="abs-bar haft" style="flex: 1;">◯</div>
                <div class="abs-bar gleit" style="flex: 0.3;">▪</div>
                <div class="abs-bar haft" style="flex: 1;">◯</div>
                <div class="abs-bar gleit" style="flex: 0.3;">▪</div>
                <div class="abs-bar haft" style="flex: 1;">◯</div>
            </div>
            <p style="font-size: 0.85em; color: #666; text-align: center;">◯ = Rad rollt (Haftreibung) &nbsp;|&nbsp; ▪ = Rad blockiert kurz (Gleitreibung)</p>

            <div class="hefter-hinweis">
                <strong>B3 beantworten:</strong> Warum ist <i>F</i><sub>Haft</sub> &gt; <i>F</i><sub>Gleit</sub> wichtig für ABS?
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zurück</button>
                <button class="btn btn-primary" onclick="nextStep()">Weiter zur Simulation</button>
            </div>
        </div>

        <!-- SCHRITT 7: ABS-Simulation -->
        <div class="step" id="step7">
            <div class="step-header">
                <span class="step-number">7</span>
                <span class="step-title">Simulation: Bremsen mit und ohne ABS <span class="stern">★★★</span></span>
            </div>

            <p>Vergleiche das Bremsverhalten bei <strong>50 km/h</strong>. Beobachte das Rad und den Bremsweg!</p>

            <div class="animation-container" id="sim-abs">
                <div class="ani-title">Simulation: Auto bremst</div>
                <div class="ani-canvas" id="abs-canvas" style="height: 160px; position: relative; overflow: hidden;">
                    <!-- Straße -->
                    <div class="strasse" id="abs-strasse" style="height: 30px; background: #555;"></div>
                    <!-- Bremsspur-Container (für farbige Segmente) -->
                    <div id="abs-spur-container" style="position: absolute; bottom: 30px; left: 50px; height: 6px; display: flex;"></div>
                    <!-- Rad mit SVG für Rand-Effekte -->
                    <div id="abs-rad-container" style="position: absolute; left: 50px; bottom: 30px; width: 80px; height: 80px;">
                        <svg width="80" height="80" viewBox="0 0 80 80">
                            <!-- Äußerer Ring (für Farbwechsel) -->
                            <circle id="abs-rad-ring" cx="40" cy="40" r="36" fill="none" stroke="#333" stroke-width="6"/>
                            <!-- Reifen-Füllung -->
                            <circle cx="40" cy="40" r="33" fill="#444"/>
                            <!-- Felge -->
                            <circle cx="40" cy="40" r="18" fill="#888" stroke="#666" stroke-width="2"/>
                            <!-- Speichen (rotieren) -->
                            <g id="abs-rad-speichen" style="transform-origin: 40px 40px;">
                                <line x1="40" y1="12" x2="40" y2="28" stroke="#666" stroke-width="3"/>
                                <line x1="40" y1="52" x2="40" y2="68" stroke="#666" stroke-width="3"/>
                                <line x1="12" y1="40" x2="28" y2="40" stroke="#666" stroke-width="3"/>
                                <line x1="52" y1="40" x2="68" y2="40" stroke="#666" stroke-width="3"/>
                            </g>
                            <!-- Nabe -->
                            <circle cx="40" cy="40" r="6" fill="#555"/>
                        </svg>
                    </div>
                    <!-- Bremsweg-Anzeige -->
                    <div id="abs-bremsweg-label" style="position: absolute; top: 10px; right: 20px; font-size: 0.9em; display: none;">
                        Bremsweg: <strong id="abs-meter">0</strong> m
                    </div>
                    <!-- Status -->
                    <div id="abs-status" style="position: absolute; top: 10px; left: 20px; font-size: 0.9em; padding: 5px 10px; background: white; border: 1px solid #ddd; border-radius: 4px;">
                        Bereit
                    </div>
                    <!-- Legende -->
                    <div style="position: absolute; bottom: 38px; right: 10px; font-size: 0.65em; display: flex; gap: 10px;">
                        <span><span style="display: inline-block; width: 10px; height: 10px; background: var(--success); vertical-align: middle; margin-right: 2px;"></span> Rad rollt</span>
                        <span><span style="display: inline-block; width: 10px; height: 10px; background: var(--error); vertical-align: middle; margin-right: 2px;"></span> Rad blockiert</span>
                    </div>
                </div>
                <div class="ani-controls">
                    <button class="ani-btn" id="btn-ohne-abs" onclick="starteBremstest('ohne')">Ohne ABS</button>
                    <button class="ani-btn" id="btn-mit-abs" onclick="starteBremstest('mit')">Mit ABS</button>
                    <button class="ani-btn" onclick="resetABS()">Reset</button>
                    <div style="margin-left: auto;">
                        <label style="font-size: 0.85em;">Straße:</label>
                        <select id="abs-strasse-select" style="padding: 8px; min-height: 44px;" onchange="updateStrassentyp()">
                            <option value="trocken">Trocken</option>
                            <option value="nass">Nass</option>
                            <option value="eis">Vereist</option>
                        </select>
                    </div>
                </div>
                <div class="ani-info" id="abs-info">
                    Teste beide Varianten auf verschiedenen Straßen. <strong>Achtung bei Eis:</strong> Der Bremsweg ist extrem lang – das Rad fährt aus dem Bild!
                </div>
            </div>

            <table class="vergleich-tabelle" id="abs-ergebnis-tabelle">
                <tr>
                    <th>Straße</th>
                    <th>Ohne ABS</th>
                    <th>Mit ABS</th>
                </tr>
                <tr>
                    <td>Trocken</td>
                    <td id="erg-trocken-ohne">—</td>
                    <td id="erg-trocken-mit">—</td>
                </tr>
                <tr>
                    <td>Nass</td>
                    <td id="erg-nass-ohne">—</td>
                    <td id="erg-nass-mit">—</td>
                </tr>
                <tr>
                    <td>Vereist</td>
                    <td id="erg-eis-ohne">—</td>
                    <td id="erg-eis-mit">—</td>
                </tr>
            </table>

            <div class="hefter-hinweis">
                <strong>T1 ausfüllen:</strong> Übertrage die Messwerte in die Tabelle auf deinem Arbeitsblatt.
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zurück</button>
                <button class="btn btn-primary" onclick="nextStep()">Zum Abschluss</button>
            </div>
        </div>

        <!-- SCHRITT 8: Abschluss -->
        <div class="step" id="step8">
            <div class="step-header">
                <span class="step-number">✓</span>
                <span class="step-title">Geschafft!</span>
            </div>

            <p>Du hast die Reibungskräfte vertieft.</p>

            <div class="merksatz">
                <strong>Was du gelernt hast:</strong>
                <ul style="text-align: left; display: inline-block; margin-top: 10px;">
                    <li>Formel: <i>F</i><sub>R</sub> = μ · <i>F</i><sub>N</sub></li>
                    <li>Rollreibung hängt von der Rad-Deformation ab</li>
                    <li>Optimaler Reifendruck = wenig Rollreibung + gute Haftung</li>
                    <li><span class="stern">★★★</span> ABS nutzt: <i>F</i><sub>Haft</sub> &gt; <i>F</i><sub>Gleit</sub></li>
                </ul>
            </div>

            <div class="hefter-hinweis">
                <strong>Arbeitsblatt fertigstellen:</strong>
                <ul>
                    <li>Prüfe: Sind alle Felder ausgefüllt?</li>
                    <li>Kontrolliere deine Rechnungen</li>
                    <li><strong>Gib dein Arbeitsblatt ab!</strong></li>
                </ul>
            </div>

            <h2 style="margin-top: 30px;">Bonus: Reibungs-Memory</h2>
            <p>Fertig mit dem Arbeitsblatt? Teste dein Wissen mit dem Memory-Spiel!</p>

            <div class="animation-container" id="memory-game">
                <div class="ani-title">Finde die passenden Paare!</div>
                <div class="memory-stats">
                    Versuche: <strong id="memory-tries">0</strong> | Paare: <strong id="memory-pairs">0</strong>/6
                </div>
                <div class="memory-container" id="memory-grid">
                    <!-- Karten werden per JS erstellt -->
                </div>
                <div class="ani-controls" style="justify-content: center; margin-top: 15px;">
                    <button class="ani-btn" onclick="initMemory()">Neues Spiel</button>
                </div>
                <div class="ani-info" id="memory-info">
                    Klicke zwei Karten auf, um ein Paar zu finden. Fachbegriff + passende Erklärung!
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Zurück</button>
                <span></span>
            </div>
        </div>
    </div>

    <script>
        // Lernpfad-Steuerung
        var STORAGE_KEY = 'lp-05b-reibung2-v1';
        var totalSteps = 8;
        var currentStep = 1;

        function init() {
            var saved = localStorage.getItem(STORAGE_KEY + '-step');
            if (saved) currentStep = parseInt(saved) || 1;
            createStepIndicators();
            showStep(currentStep);
            initReifendruck();
        }

        function createStepIndicators() {
            var container = document.getElementById('stepIndicators');
            container.innerHTML = '';
            for (var i = 1; i <= totalSteps; i++) {
                var dot = document.createElement('div');
                dot.className = 'step-dot';
                dot.textContent = i === totalSteps ? '✓' : i;
                dot.setAttribute('data-step', i);
                dot.onclick = (function(step) {
                    return function() {
                        if (step <= getMaxStep() + 1) showStep(step);
                    };
                })(i);
                container.appendChild(dot);
            }
        }

        function getMaxStep() {
            return parseInt(localStorage.getItem(STORAGE_KEY + '-maxStep')) || 1;
        }

        function updateStepIndicators() {
            var dots = document.querySelectorAll('.step-dot');
            var maxCompleted = getMaxStep();
            dots.forEach(function(dot, i) {
                var num = i + 1;
                dot.classList.remove('current', 'completed');
                if (num === currentStep) dot.classList.add('current');
                else if (num <= maxCompleted) dot.classList.add('completed');
            });
        }

        function showStep(n) {
            document.querySelectorAll('.step').forEach(function(s) { s.classList.remove('active'); });
            var step = document.getElementById('step' + n);
            if (step) step.classList.add('active');
            currentStep = n;
            localStorage.setItem(STORAGE_KEY + '-step', n);
            var maxStep = getMaxStep();
            if (n > maxStep) localStorage.setItem(STORAGE_KEY + '-maxStep', n);
            document.getElementById('progressFill').style.width = ((n - 1) / (totalSteps - 1) * 100) + '%';
            updateStepIndicators();
            window.scrollTo(0, 0);
        }

        function nextStep() { if (currentStep < totalSteps) showStep(currentStep + 1); }
        function prevStep() { if (currentStep > 1) showStep(currentStep - 1); }
        function resetLernpfad() {
            if (confirm('Lernpfad wirklich neu starten?')) {
                localStorage.removeItem(STORAGE_KEY + '-step');
                localStorage.removeItem(STORAGE_KEY + '-maxStep');
                location.reload();
            }
        }

        // Sortier-Übung Schritt 1
        var sortOrder = [];
        var correctOrder = ['haft', 'gleit', 'roll'];
        function selectSort(el) {
            if (sortOrder.length >= 3) return;
            var val = el.getAttribute('data-value');
            if (sortOrder.indexOf(val) >= 0) return;
            sortOrder.push(val);
            el.style.opacity = '0.5';
            el.style.order = sortOrder.length;

            if (sortOrder.length === 3) {
                var correct = sortOrder[0] === 'haft' && sortOrder[1] === 'gleit' && sortOrder[2] === 'roll';
                var fb = document.getElementById('sort-feedback');
                if (correct) {
                    fb.innerHTML = '<strong style="color: var(--success);">Richtig!</strong> Haftreibung > Gleitreibung > Rollreibung';
                    fb.style.borderColor = 'var(--success)';
                    document.getElementById('merksatz1').style.display = 'block';
                } else {
                    fb.innerHTML = '<strong style="color: var(--error);">Nicht ganz.</strong> Die richtige Reihenfolge ist: Haftreibung > Gleitreibung > Rollreibung';
                    fb.style.borderColor = 'var(--error)';
                    document.getElementById('merksatz1').style.display = 'block';
                }
            }
        }

        // Formeldreieck
        var formeln = {
            fr: { title: 'Gesucht: F_R', formel: '<i>F</i><sub>R</sub> = μ · <i>F</i><sub>N</sub>', erkl: 'μ und F_N nebeneinander → multiplizieren!' },
            mu: { title: 'Gesucht: μ', formel: 'μ = <span class="frac"><span class="frac-num"><i>F</i><sub>R</sub></span><span class="frac-den"><i>F</i><sub>N</sub></span></span>', erkl: 'F_R über F_N → dividieren!' },
            fn: { title: 'Gesucht: F_N', formel: '<i>F</i><sub>N</sub> = <span class="frac"><span class="frac-num"><i>F</i><sub>R</sub></span><span class="frac-den">μ</span></span>', erkl: 'F_R über μ → dividieren!' }
        };

        function selectFormel(v) {
            document.querySelectorAll('.dreieck-cell').forEach(function(c) { c.classList.remove('hidden'); });
            document.getElementById('cell-' + v).classList.add('hidden');
            var f = formeln[v];
            document.getElementById('formel-title').textContent = f.title;
            document.getElementById('formel-display').innerHTML = f.formel;
            document.getElementById('formel-erklaerung').textContent = f.erkl;
        }

        // Rechenaufgaben
        var rechenLoesungen = { 1: 8, 2: 4000, 3: 0.3 };
        function checkRechenaufgabe(nr, antwort, el) {
            var opts = el.parentNode.querySelectorAll('.quiz-option');
            opts.forEach(function(o) { o.style.pointerEvents = 'none'; o.classList.remove('correct', 'incorrect'); });
            var fb = document.getElementById('quiz' + nr + '-fb');
            fb.style.display = 'block';
            if (antwort === rechenLoesungen[nr]) {
                el.classList.add('correct');
                fb.innerHTML = '<strong style="color: var(--success);">Richtig!</strong>';
                fb.style.borderColor = 'var(--success)';
            } else {
                el.classList.add('incorrect');
                opts.forEach(function(o) {
                    var val = parseFloat(o.textContent.replace('μ = ', '').replace(' N', '').replace(',', '.'));
                    if (val === rechenLoesungen[nr]) o.classList.add('correct');
                });
                fb.innerHTML = '<strong style="color: var(--error);">Leider falsch.</strong> Richtig: ' + rechenLoesungen[nr] + (nr < 3 ? ' N' : '');
                fb.style.borderColor = 'var(--error)';
            }
        }

        // Rollreibungs-Simulation (Schritt 4) - Slider-basiert
        var rollDaten = {
            'stahl': {
                schwelle: 0.5,
                kontakt: 'sehr klein',
                kontaktBreite: 10,
                istPlatt: false,
                radFarbe: '#aaa',
                radStroke: '#777'
            },
            'gummi-prall': {
                schwelle: 2.0,
                kontakt: 'mittel',
                kontaktBreite: 22,
                istPlatt: false,
                radFarbe: '#333',
                radStroke: '#111'
            },
            'gummi-platt': {
                schwelle: 5.0,
                kontakt: 'groß',
                kontaktBreite: 50,
                istPlatt: true,
                radFarbe: '#222',
                radStroke: '#111'
            }
        };
        var rollMessungen = {};
        var rollWagenPos = 60;
        var rollRotation = 0;
        var rollInterval = null;
        var rollRollt = false;

        function wechsleRadtyp() {
            var typ = document.getElementById('roll-radtyp').value;
            var daten = rollDaten[typ];

            var radKreis = document.getElementById('roll-rad-kreis');
            var radPlatt = document.getElementById('roll-rad-platt');
            var kontakt = document.getElementById('roll-kontakt');

            // Kreis immer als Basis (auch für platten Reifen)
            radKreis.setAttribute('r', '36');
            radKreis.removeAttribute('rx');
            radKreis.removeAttribute('ry');
            radKreis.setAttribute('cy', '40');
            radKreis.setAttribute('fill', daten.radFarbe);
            radKreis.setAttribute('stroke', daten.radStroke);

            // Platter Reifen: zusätzliche abgeflachte Unterseite zeigen
            if (daten.istPlatt) {
                radPlatt.style.display = 'block';
                radPlatt.setAttribute('fill', daten.radFarbe);
                radPlatt.setAttribute('stroke', daten.radStroke);
                // Kreis oben abschneiden (mit clipPath simuliert durch Überdeckung)
                radKreis.setAttribute('cy', '38'); // leicht nach oben
            } else {
                radPlatt.style.display = 'none';
            }

            // Kontaktfläche anpassen
            kontakt.setAttribute('width', daten.kontaktBreite);
            kontakt.setAttribute('x', 40 - daten.kontaktBreite / 2);

            // Beschriftung
            document.getElementById('roll-kontakt-groesse').textContent = daten.kontakt;

            // Slider und Position zurücksetzen
            document.getElementById('roll-kraft-slider').value = 0;
            updateRollKraft();
            rollWagenPos = 60;
            rollRotation = 0;
            document.getElementById('roll-wagen').style.left = '60px';
            var speichen = document.getElementById('roll-rad-speichen');
            if (speichen) speichen.style.transform = 'rotate(0deg)';

            // Zeile hervorheben
            document.querySelectorAll('#roll-tabelle tr').forEach(function(tr) { tr.style.background = ''; });
            var zeile = document.getElementById('roll-zeile-' + typ);
            if (zeile && !rollMessungen[typ]) zeile.style.background = 'var(--physik-light)';

            // Info aktualisieren
            updateRollInfo();
        }

        function updateRollKraft() {
            var kraft = parseFloat(document.getElementById('roll-kraft-slider').value);
            var typ = document.getElementById('roll-radtyp').value;
            var daten = rollDaten[typ];

            // Anzeige aktualisieren
            document.getElementById('roll-kraft-anzeige').textContent = kraft.toFixed(1).replace('.', ',') + ' N';

            // Kraftpfeil aktualisieren
            var pfeilLaenge = Math.max(10, kraft * 15);
            document.getElementById('roll-pfeil-linie').setAttribute('x2', pfeilLaenge);
            document.getElementById('roll-pfeil-text').textContent = kraft.toFixed(1).replace('.', ',') + ' N';
            document.getElementById('roll-pfeil-text').setAttribute('x', pfeilLaenge / 2 - 15);

            // Status prüfen
            if (kraft >= daten.schwelle) {
                // Rad rollt
                if (!rollRollt) {
                    rollRollt = true;
                    document.getElementById('roll-status-icon').textContent = '▶';
                    document.getElementById('roll-status-text').textContent = 'Rad rollt!';
                    document.getElementById('roll-status-box').style.background = 'var(--success-bg)';
                    document.getElementById('roll-status-box').style.borderColor = 'var(--success)';
                    document.getElementById('roll-speichern-btn').disabled = false;
                    starteRollAnimation();
                }
            } else {
                // Rad steht
                if (rollRollt) {
                    rollRollt = false;
                    document.getElementById('roll-status-icon').textContent = '⏸';
                    document.getElementById('roll-status-text').textContent = 'Rad steht';
                    document.getElementById('roll-status-box').style.background = '#f5f5f5';
                    document.getElementById('roll-status-box').style.borderColor = '#ddd';
                    stoppeRollAnimation();
                }
                document.getElementById('roll-speichern-btn').disabled = true;
            }
        }

        function starteRollAnimation() {
            if (rollInterval) return;
            rollInterval = setInterval(function() {
                rollWagenPos += 2;
                if (rollWagenPos > 280) rollWagenPos = 60; // Reset wenn am Rand
                document.getElementById('roll-wagen').style.left = rollWagenPos + 'px';

                // Nur Speichen rotieren (nicht den Radkörper - wichtig für platten Reifen!)
                rollRotation += 8;
                var speichen = document.getElementById('roll-rad-speichen');
                if (speichen) {
                    speichen.style.transform = 'rotate(' + rollRotation + 'deg)';
                }
            }, 50);
        }

        function stoppeRollAnimation() {
            if (rollInterval) {
                clearInterval(rollInterval);
                rollInterval = null;
            }
        }

        function speichereMessung() {
            var typ = document.getElementById('roll-radtyp').value;
            var daten = rollDaten[typ];

            // In Tabelle eintragen
            document.getElementById('roll-erg-' + typ).textContent = daten.schwelle.toFixed(1).replace('.', ',') + ' N';
            document.getElementById('roll-verf-' + typ).textContent = daten.kontakt;
            rollMessungen[typ] = daten.schwelle;

            // Zeile grün markieren
            var zeile = document.getElementById('roll-zeile-' + typ);
            if (zeile) zeile.style.background = 'var(--success-bg)';

            // Feedback
            updateRollInfo();

            // Nächsten Radtyp vorschlagen
            var typen = ['stahl', 'gummi-prall', 'gummi-platt'];
            var naechster = typen.find(function(t) { return !rollMessungen[t]; });

            if (naechster) {
                document.getElementById('roll-radtyp').value = naechster;
                wechsleRadtyp();
            } else {
                // Alle gemessen - Erkenntnis zeigen
                document.getElementById('roll-erkenntnis').style.display = 'block';
                document.getElementById('roll-info').innerHTML = '<strong style="color: var(--success);">Alle Messungen abgeschlossen!</strong> Vergleiche die Werte in der Tabelle und beantworte die Erkenntnisfrage.';
            }
        }

        function updateRollInfo() {
            var anzahl = Object.keys(rollMessungen).length;
            var info = document.getElementById('roll-info');

            if (anzahl === 0) {
                info.innerHTML = '<strong>Schritt 1:</strong> Erhöhe die Zugkraft langsam. Bei welcher Kraft beginnt das Stahlrad zu rollen? Dann klicke "Wert speichern".';
            } else if (anzahl === 1) {
                info.innerHTML = '<strong>Schritt 2:</strong> Wechsle zum Gummireifen (prall). Wie viel Kraft brauchst du jetzt?';
            } else if (anzahl === 2) {
                info.innerHTML = '<strong>Schritt 3:</strong> Jetzt der platte Reifen. Beobachte die große Aufstandsfläche!';
            }
        }

        function zeigeRollAntwort(nr) {
            if (nr === 1) {
                var el = document.getElementById('roll-erk-1');
                el.textContent = 'größer';
                el.classList.add('geloest');
            } else if (nr === 2) {
                var el = document.getElementById('roll-erk-2');
                el.textContent = 'größer';
                el.classList.add('geloest');
            }
        }

        function initRollSim() {
            wechsleRadtyp();
        }

        // Reifendruck-Simulation
        function initReifendruck() {
            updateReifendruck();
            initRollSim();
        }

        function updateReifendruck() {
            var druck = parseInt(document.getElementById('druck-slider').value);
            var labels = ['sehr niedrig', 'niedrig', 'optimal', 'hoch', 'sehr hoch'];
            document.getElementById('druck-label').textContent = labels[druck - 1];

            // Reifen zeichnen
            var container = document.getElementById('reifen-svg-container');
            var breite, hoehe, kontakt, roll, haft, gesamt, gesamtClass;

            switch (druck) {
                case 1: breite = 90; hoehe = 50; kontakt = 'sehr groß'; roll = 'hoch'; haft = 'gut'; gesamt = 'Schwer zu fahren!'; gesamtClass = 'error'; break;
                case 2: breite = 80; hoehe = 55; kontakt = 'groß'; roll = 'erhöht'; haft = 'sehr gut'; gesamt = 'Guter Grip, mehr Aufwand'; gesamtClass = 'warning'; break;
                case 3: breite = 70; hoehe = 60; kontakt = 'optimal'; roll = 'niedrig'; haft = 'gut'; gesamt = 'Optimal!'; gesamtClass = 'success'; break;
                case 4: breite = 65; hoehe = 65; kontakt = 'klein'; roll = 'sehr niedrig'; haft = 'mäßig'; gesamt = 'Weniger Grip in Kurven'; gesamtClass = 'warning'; break;
                case 5: breite = 60; hoehe = 68; kontakt = 'sehr klein'; roll = 'minimal'; haft = 'schlecht'; gesamt = 'Rutschgefahr!'; gesamtClass = 'error'; break;
            }

            var reifenMitteY = 45 + (70 - hoehe) / 2;
            container.innerHTML = '<svg width="100" height="90" viewBox="0 0 100 90">' +
                '<ellipse cx="50" cy="' + reifenMitteY + '" rx="' + (breite/2) + '" ry="' + (hoehe/2) + '" fill="#222" stroke="#111" stroke-width="3"/>' +
                '<ellipse cx="50" cy="' + reifenMitteY + '" rx="18" ry="18" fill="#888"/>' +
                '<rect x="' + (50 - breite/3) + '" y="80" width="' + (breite*2/3) + '" height="6" fill="#111" rx="2"/>' +
                '</svg>';

            document.getElementById('kontakt-wert').textContent = kontakt;
            document.getElementById('roll-wert').textContent = roll;
            document.getElementById('haft-wert').textContent = haft;
            var bew = document.getElementById('bewertung-gesamt');
            bew.textContent = gesamt;
            bew.className = '';
            bew.style.background = gesamtClass === 'success' ? 'var(--success-bg)' : (gesamtClass === 'warning' ? 'var(--warning-bg)' : 'var(--error-bg)');
            bew.style.color = gesamtClass === 'success' ? 'var(--success)' : (gesamtClass === 'warning' ? 'var(--warning)' : 'var(--error)');
        }

        // ABS-Simulation
        var absRunning = false;
        var absInterval = null;
        var absFlashInterval = null;
        var absErgebnisse = {};
        var absRotation = 0;
        var absHaftPhase = true; // Für ABS-Wechsel

        function updateStrassentyp() {
            var typ = document.getElementById('abs-strasse-select').value;
            var strasse = document.getElementById('abs-strasse');
            var farben = { trocken: '#555', nass: '#446', eis: '#aac' };
            strasse.style.background = farben[typ];
        }

        function starteBremstest(modus) {
            if (absRunning) return;
            absRunning = true;
            document.getElementById('btn-ohne-abs').disabled = true;
            document.getElementById('btn-mit-abs').disabled = true;

            var radContainer = document.getElementById('abs-rad-container');
            var radRing = document.getElementById('abs-rad-ring');
            var radSpeichen = document.getElementById('abs-rad-speichen');
            var spurContainer = document.getElementById('abs-spur-container');
            var status = document.getElementById('abs-status');
            var label = document.getElementById('abs-bremsweg-label');
            var meter = document.getElementById('abs-meter');
            var strTyp = document.getElementById('abs-strasse-select').value;

            // Bremsspur leeren
            spurContainer.innerHTML = '';

            // Bremswege bei 50 km/h (REALISTISCH!)
            // Berechnung: s = v² / (2·μ·g) mit v=13.89 m/s
            // ABS hilft am meisten auf NASSER Straße (größter μ-Unterschied rollend vs blockiert)
            // Pixel = Meter × 10 für Darstellung
            var bremswege = {
                trocken: { ohne: 150, mit: 125 },  // 15m vs 12.5m, Diff 2.5m (17%)
                nass: { ohne: 450, mit: 200 },     // 45m vs 20m, Diff 25m (56%) ← größter Unterschied!
                eis: { ohne: 1100, mit: 950 }      // 110m vs 95m, Diff 15m (14%)
            };

            var zielDist = bremswege[strTyp][modus === 'mit' ? 'mit' : 'ohne'];
            var pos = 50;
            var v = 8;
            var a = (v * v) / (2 * zielDist);
            var t = 0;
            var mitABS = modus === 'mit';
            var letzteSpurPos = 0;
            absHaftPhase = true;
            absRotation = 0;

            label.style.display = 'block';

            if (!mitABS) {
                // OHNE ABS: Rad blockiert nach kurzer Zeit
                setTimeout(function() {
                    radRing.setAttribute('stroke', 'var(--error)');
                    radRing.setAttribute('stroke-width', '8');
                    status.innerHTML = '<span style="color: var(--error);">⚠ Rad blockiert – gleitet!</span>';
                }, 300);
            } else {
                // MIT ABS: Flashing-Effekt starten
                status.innerHTML = '<span style="color: var(--success);">✓ ABS aktiv – Rad rollt weiter!</span>';
                absFlashInterval = setInterval(function() {
                    absHaftPhase = !absHaftPhase;
                    if (absHaftPhase) {
                        radRing.setAttribute('stroke', 'var(--success)');
                    } else {
                        radRing.setAttribute('stroke', 'var(--error)');
                    }
                }, 120); // ~8x pro Sekunde
            }

            absInterval = setInterval(function() {
                t++;
                var vAkt = v - a * t;
                var s = v * t - 0.5 * a * t * t;
                pos = 50 + s;

                radContainer.style.left = pos + 'px';
                meter.textContent = Math.round(s / 10);

                // Wenn Rad aus dem Bild fährt: Hinweis zeigen
                if (pos > 350 && !document.getElementById('abs-offscreen-hint')) {
                    var hint = document.createElement('div');
                    hint.id = 'abs-offscreen-hint';
                    hint.style.cssText = 'position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 4px; font-size: 0.9em; z-index: 10;';
                    hint.innerHTML = '→ Rad fährt weiter... <strong>' + Math.round(s/10) + ' m</strong>';
                    document.getElementById('abs-canvas').appendChild(hint);
                }
                // Hint aktualisieren
                var hint = document.getElementById('abs-offscreen-hint');
                if (hint) {
                    hint.innerHTML = '→ Rad bremst noch... <strong>' + Math.round(s/10) + ' m</strong>';
                }

                // Bremsspur aufbauen
                var spurBreite = s - letzteSpurPos;
                if (spurBreite >= 4) {
                    var segment = document.createElement('div');
                    segment.style.height = '6px';
                    segment.style.width = spurBreite + 'px';
                    segment.style.flexShrink = '0';

                    if (!mitABS) {
                        // Ohne ABS: Durchgehend rot (Gleitreibung)
                        segment.style.background = 'var(--error)';
                        segment.style.opacity = '0.7';
                    } else {
                        // Mit ABS: Wechselnde Farben
                        if (absHaftPhase) {
                            segment.style.background = 'var(--success)';
                            segment.style.opacity = '0.8';
                        } else {
                            segment.style.background = 'var(--error)';
                            segment.style.opacity = '0.6';
                        }
                    }
                    spurContainer.appendChild(segment);
                    letzteSpurPos = s;
                }

                // Rad-Rotation
                if (mitABS || t < 8) {
                    // Mit ABS dreht sich das Rad immer, ohne ABS nur am Anfang
                    absRotation += mitABS ? 10 : 15;
                    radSpeichen.style.transform = 'rotate(' + absRotation + 'deg)';
                }

                if (vAkt <= 0 || s >= zielDist) {
                    clearInterval(absInterval);
                    if (absFlashInterval) {
                        clearInterval(absFlashInterval);
                        absFlashInterval = null;
                    }

                    // Offscreen-Hinweis entfernen/aktualisieren
                    var hint = document.getElementById('abs-offscreen-hint');
                    if (hint) hint.remove();

                    // Rad-Ring zurücksetzen
                    radRing.setAttribute('stroke', '#333');
                    radRing.setAttribute('stroke-width', '6');

                    var bremsweg = Math.round(zielDist / 10);
                    meter.textContent = bremsweg;

                    if (mitABS) {
                        status.innerHTML = '✓ Gestoppt! Bremsweg: <strong>' + bremsweg + ' m</strong>';
                        status.style.background = 'var(--success-bg)';
                    } else {
                        status.innerHTML = '⚠ Gestoppt! Bremsweg: <strong>' + bremsweg + ' m</strong>';
                        status.style.background = 'var(--error-bg)';
                    }

                    // Ergebnis speichern
                    var key = 'erg-' + strTyp + '-' + modus;
                    document.getElementById(key).textContent = bremsweg + ' m';
                    absErgebnisse[key] = bremsweg;

                    absRunning = false;
                    document.getElementById('btn-ohne-abs').disabled = false;
                    document.getElementById('btn-mit-abs').disabled = false;
                }
            }, 40);
        }

        function resetABS() {
            if (absInterval) clearInterval(absInterval);
            if (absFlashInterval) clearInterval(absFlashInterval);
            absRunning = false;
            absFlashInterval = null;

            var radContainer = document.getElementById('abs-rad-container');
            var radRing = document.getElementById('abs-rad-ring');
            var radSpeichen = document.getElementById('abs-rad-speichen');
            var spurContainer = document.getElementById('abs-spur-container');
            var status = document.getElementById('abs-status');

            radContainer.style.left = '50px';
            radRing.setAttribute('stroke', '#333');
            radRing.setAttribute('stroke-width', '6');
            radSpeichen.style.transform = 'rotate(0deg)';
            spurContainer.innerHTML = '';
            status.textContent = 'Bereit';
            status.style.background = 'white';
            document.getElementById('abs-bremsweg-label').style.display = 'none';
            document.getElementById('btn-ohne-abs').disabled = false;
            document.getElementById('btn-mit-abs').disabled = false;

            // Offscreen-Hinweis entfernen
            var hint = document.getElementById('abs-offscreen-hint');
            if (hint) hint.remove();
        }

        // Memory-Spiel
        var memoryPaare = [
            { begriff: 'Haftreibung', erklaerung: 'Größte Reibungsart' },
            { begriff: 'Gleitreibung', erklaerung: 'Reibung bei Bewegung' },
            { begriff: 'Rollreibung', erklaerung: 'Kleinste Reibungsart' },
            { begriff: 'ABS', erklaerung: 'Verhindert Blockieren' },
            { begriff: 'μ (mü)', erklaerung: 'Reibungszahl' },
            { begriff: 'Walkarbeit', erklaerung: 'Verformung beim Rollen' }
        ];
        var memoryKarten = [];
        var memoryOffen = [];
        var memoryTries = 0;
        var memoryPairsFound = 0;
        var memoryLocked = false;

        function initMemory() {
            memoryKarten = [];
            memoryOffen = [];
            memoryTries = 0;
            memoryPairsFound = 0;
            memoryLocked = false;

            // Karten erstellen (Begriff + Erklärung für jedes Paar)
            memoryPaare.forEach(function(paar, idx) {
                memoryKarten.push({ id: idx, typ: 'begriff', text: paar.begriff, paarId: idx });
                memoryKarten.push({ id: idx, typ: 'erklaerung', text: paar.erklaerung, paarId: idx });
            });

            // Mischen
            for (var i = memoryKarten.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = memoryKarten[i];
                memoryKarten[i] = memoryKarten[j];
                memoryKarten[j] = temp;
            }

            // Grid erstellen
            var grid = document.getElementById('memory-grid');
            grid.innerHTML = '';
            memoryKarten.forEach(function(karte, idx) {
                var div = document.createElement('div');
                div.className = 'memory-card';
                div.setAttribute('data-idx', idx);
                div.textContent = '?';
                div.onclick = function() { clickMemoryCard(idx); };
                grid.appendChild(div);
            });

            updateMemoryStats();
            document.getElementById('memory-info').textContent = 'Klicke zwei Karten auf, um ein Paar zu finden!';
        }

        function clickMemoryCard(idx) {
            if (memoryLocked) return;
            var karte = memoryKarten[idx];
            var cards = document.querySelectorAll('.memory-card');
            var card = cards[idx];

            // Schon offen oder gefunden?
            if (card.classList.contains('flipped') || card.classList.contains('matched')) return;

            // Aufdecken
            card.classList.add('flipped');
            card.textContent = karte.text;
            memoryOffen.push(idx);

            // Zwei offen?
            if (memoryOffen.length === 2) {
                memoryTries++;
                updateMemoryStats();
                memoryLocked = true;

                var k1 = memoryKarten[memoryOffen[0]];
                var k2 = memoryKarten[memoryOffen[1]];

                if (k1.paarId === k2.paarId && k1.typ !== k2.typ) {
                    // Paar gefunden!
                    setTimeout(function() {
                        cards[memoryOffen[0]].classList.add('matched');
                        cards[memoryOffen[1]].classList.add('matched');
                        memoryPairsFound++;
                        updateMemoryStats();
                        memoryOffen = [];
                        memoryLocked = false;

                        if (memoryPairsFound === memoryPaare.length) {
                            document.getElementById('memory-info').innerHTML = '<strong style="color: var(--success);">Gewonnen!</strong> Alle Paare in ' + memoryTries + ' Versuchen gefunden!';
                        }
                    }, 500);
                } else {
                    // Kein Paar
                    setTimeout(function() {
                        cards[memoryOffen[0]].classList.remove('flipped');
                        cards[memoryOffen[0]].textContent = '?';
                        cards[memoryOffen[1]].classList.remove('flipped');
                        cards[memoryOffen[1]].textContent = '?';
                        memoryOffen = [];
                        memoryLocked = false;
                    }, 1000);
                }
            }
        }

        function updateMemoryStats() {
            document.getElementById('memory-tries').textContent = memoryTries;
            document.getElementById('memory-pairs').textContent = memoryPairsFound;
        }

        init();
        initMemory();
    </script>
</body>
</html>
