<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stundenleistung: Die Federspannkraft</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
            font-size: 16px;
            color: #222;
            line-height: 1.5;
            padding-top: 55px;
        }
        .container {
            max-width: 850px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background: #fff;
            border: 1px solid #ddd;
            padding: 15px 20px;
            margin-bottom: 20px;
        }
        header h1 {
            color: #2c5aa0;
            font-size: 1.3em;
            font-weight: 600;
        }
        header .meta {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        /* Timer-Leiste */
        .timer-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #2a7a4b;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            font-weight: 600;
            transition: background 0.5s;
        }
        .timer-bar.warning { background: #b35c00; }
        .timer-bar.danger { background: #c62828; animation: pulse 1s ease-in-out infinite; }
        .timer-bar.expired { background: #c62828; animation: pulse 0.5s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        .timer-display { font-size: 1.4em; font-family: monospace; letter-spacing: 2px; }
        .timer-label { font-size: 0.95em; }

        /* Auswahl-Bereich */
        .selection-section {
            background: #fff;
            border: 2px solid #2c5aa0;
            padding: 20px;
            margin-bottom: 20px;
        }
        .selection-section h2 {
            color: #2c5aa0;
            font-size: 1.1em;
            margin-bottom: 15px;
        }
        .selection-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .selection-row label {
            font-weight: 600;
            min-width: 120px;
        }
        .selection-row select {
            padding: 10px 15px;
            font-size: 1em;
            border: 1px solid #ddd;
            min-width: 200px;
        }
        .selection-row .btn {
            padding: 10px 20px;
        }
        .locked-display {
            background: #e8f5e9;
            border: 2px solid #2a7a4b;
            padding: 12px 20px;
            font-weight: 600;
            color: #2a7a4b;
        }
        .locked-display.niveau-1 { background: #e8f5e9; border-color: #2a7a4b; color: #2a7a4b; }
        .locked-display.niveau-2 { background: #e3f2fd; border-color: #2c5aa0; color: #2c5aa0; }
        .locked-display.niveau-3 { background: #f3e5f5; border-color: #7b1fa2; color: #7b1fa2; }

        /* Progress */
        .progress-container {
            background: #fff;
            border: 1px solid #ddd;
            padding: 15px 20px;
            margin-bottom: 20px;
        }
        .progress-bar {
            background: #e0e0e0;
            height: 10px;
            margin-top: 10px;
        }
        .progress-fill {
            background: #2c5aa0;
            height: 100%;
            width: 0%;
            transition: width 0.3s;
        }
        .progress-text {
            font-size: 0.9em;
            color: #666;
        }

        /* Fragen */
        .question {
            background: #fff;
            border: 1px solid #ddd;
            margin-bottom: 15px;
            padding: 15px 20px;
            display: none;
        }
        .question.visible { display: block; }
        .question.unanswered { background: #fff3e0 !important; }
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 8px;
        }
        .question-title {
            color: #2c5aa0;
            font-weight: 600;
        }
        .question-meta {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .question-niveau {
            padding: 2px 8px;
            font-size: 0.8em;
            font-weight: 600;
        }
        .niveau-1 { background: #e8f5e9; color: #2a7a4b; }
        .niveau-2 { background: #e3f2fd; color: #2c5aa0; }
        .niveau-3 { background: #f3e5f5; color: #7b1fa2; }
        .question-points {
            color: #888;
            font-size: 0.85em;
        }
        .question-text { margin-bottom: 12px; }
        .question-result {
            padding: 3px 8px;
            font-size: 0.85em;
            font-weight: 600;
        }
        .question-result.full { background: #e8f5e9; color: #2a7a4b; }
        .question-result.partial { background: #fff3e0; color: #b35c00; }
        .question-result.zero { background: #ffebee; color: #c62828; }

        /* Optionen */
        .options label {
            display: block;
            padding: 10px 12px;
            margin: 4px 0;
            background: #f5f5f5;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: all 0.15s;
        }
        .options label:hover { background: #e8f4fd; }
        .options label.selected { background: #e3f2fd; border-color: #2c5aa0; }
        .options label.correct { background: #e8f5e9 !important; border-color: #2a7a4b !important; }
        .options label.incorrect { background: #ffebee !important; border-color: #c62828 !important; }
        .options input[type="radio"] { margin-right: 10px; }

        /* Inputs */
        input[type="number"], input[type="text"] {
            padding: 8px 12px;
            font-size: 1em;
            border: 1px solid #ddd;
            width: 100px;
            margin: 0 5px;
        }
        select {
            padding: 8px 12px;
            font-size: 1em;
            border: 1px solid #ddd;
        }
        select.correct { border: 2px solid #2a7a4b !important; background: #e8f5e9; }
        select.incorrect { border: 2px solid #c62828 !important; background: #ffebee; }
        select.unanswered { border: 2px solid #b35c00 !important; }
        .inline-answer {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 5px;
            margin: 10px 0;
        }

        /* Buttons */
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: #2c5aa0;
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 1em;
            margin: 5px 5px 5px 0;
        }
        .btn:hover { background: #1e4a8a; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .btn-success { background: #2a7a4b; }
        .btn-success:hover { background: #1e5a35; }
        .btn-small { padding: 6px 12px; font-size: 0.85em; }

        /* Feedback */
        .feedback-box {
            padding: 12px 15px;
            margin: 10px 0;
            display: none;
        }
        .feedback-box.correct { background: #e8f5e9; border: 1px solid #2a7a4b; color: #1b5e20; }
        .feedback-box.incorrect { background: #ffebee; border: 1px solid #c62828; color: #b71c1c; }
        .feedback-box.show { display: block; }

        /* Ergebnisse */
        .results {
            background: #fff;
            border: 2px solid #2c5aa0;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }
        .results h2 {
            color: #2c5aa0;
            margin-bottom: 15px;
        }
        .results-score {
            font-size: 1.8em;
            font-weight: 600;
            color: #2c5aa0;
            margin: 15px 0;
        }
        .results-np {
            font-size: 1.3em;
            font-weight: 600;
            margin: 10px 0;
            padding: 10px 15px;
            display: inline-block;
        }
        .results-np.good { background: #e8f5e9; color: #2a7a4b; }
        .results-np.ok { background: #fff3e0; color: #b35c00; }
        .results-np.weak { background: #ffebee; color: #c62828; }

        /* Notentabelle */
        .grade-table {
            margin: 15px 0;
            border-collapse: collapse;
            width: 100%;
            font-size: 0.85em;
        }
        .grade-table th, .grade-table td {
            border: 1px solid #ddd;
            padding: 4px 6px;
            text-align: center;
        }
        .grade-table th { background: #f5f5f5; }
        .current-grade { background: #e3f2fd !important; font-weight: bold; }

        /* ISO 80000 */
        .fz { font-family: "Times New Roman", Times, serif; font-style: italic; }
        .einheit { font-family: sans-serif; font-style: normal; }
        .bruch-inline {
            display: inline-block;
            vertical-align: middle;
            text-align: center;
            font-size: 0.85em;
            line-height: 1.1;
        }
        .bruch-inline .zi {
            display: block;
            border-bottom: 1px solid currentColor;
            padding: 0 2px 1px;
        }
        .bruch-inline .ni {
            display: block;
            padding: 1px 2px 0;
        }

        /* Lehrer-Bereich */
        .teacher-section {
            margin-top: 40px;
            padding: 15px;
            background: #f5f5f5;
            border: 1px dashed #999;
        }
        .teacher-section summary {
            cursor: pointer;
            color: #666;
            font-size: 0.9em;
        }

        /* === FRAGEN AUSBLENDEN BIS FREIGABE === */
        #questionsContainer { display: none; }
        #questionsContainer.unlocked { display: block; }
        .unlock-hint {
            background: #fff3e0;
            border: 2px solid #b35c00;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            color: #b35c00;
        }

        @media print {
            .timer-bar, .selection-section, .progress-container, button, .teacher-section { display: none; }
            body { padding-top: 0; }
            .question { page-break-inside: avoid; display: block !important; }
        }
    </style>
</head>
<body>
    <!-- Timer-Leiste -->
    <div class="timer-bar" id="timerBar">
        <span class="timer-label">Stundenleistung: Die Federspannkraft</span>
        <span class="timer-display" id="timerDisplay">15:00</span>
    </div>

    <div class="container">
        <header>
            <h1>Stundenleistung: Die Federspannkraft</h1>
            <div class="meta">Physik Klasse 7 | Differenziert (&#9733;/&#9733;&#9733;/&#9733;&#9733;&#9733;) | 15 Minuten</div>
        </header>

        <!-- AUSWAHL: Platz + Niveau -->
        <div class="selection-section" id="selectionSection">
            <h2>Vor dem Start</h2>

            <div class="selection-row" id="seatRow">
                <label>Platznummer:</label>
                <select id="seatSelect">
                    <option value="">-- Platz wählen --</option>
                    <script>for(var i=1;i<=30;i++){document.write('<option value="'+i+'">P'+i+'</option>');}</script>
                </select>
                <button class="btn btn-small" onclick="confirmSeat()">Bestätigen</button>
            </div>
            <div id="seatLocked" style="display:none;"></div>

            <div class="selection-row" id="niveauRow">
                <label>Niveau:</label>
                <select id="niveauSelect">
                    <option value="">-- Niveau wählen --</option>
                    <option value="1">&#9733; Basis (23 BE)</option>
                    <option value="2">&#9733;&#9733; Standard (28 BE)</option>
                    <option value="3">&#9733;&#9733;&#9733; Erweitert (29 BE)</option>
                </select>
                <button class="btn btn-small" onclick="confirmNiveau()">Bestätigen</button>
            </div>
            <div id="niveauLocked" style="display:none;"></div>
        </div>

        <!-- FORTSCHRITT -->
        <div class="progress-container" id="progressContainer" style="display:none;">
            <div class="progress-text" id="progressText">0 / 0 beantwortet</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <!-- UNLOCK-HINWEIS -->
        <div class="unlock-hint" id="unlockHint">
            <strong>Bitte bestätige zuerst:</strong><br>
            1. Deine Platznummer (mit OK)<br>
            2. Dein Niveau (mit OK)<br><br>
            Danach werden die Aufgaben angezeigt.
        </div>

        <!-- FRAGEN-CONTAINER -->
        <div id="questionsContainer">

            <!-- ═══════════════════════════════════════════════════════════ -->
            <!-- ★ NIVEAU 1: BASISAUFGABEN (23 BE) -->
            <!-- ═══════════════════════════════════════════════════════════ -->

            <!-- F1: Definition Dehnung (1 BE) -->
            <div class="question" id="q1" data-niveau="1" data-points="1">
                <div class="question-header">
                    <div class="question-title">Frage 1: Definition Dehnung</div>
                    <div class="question-meta">
                        <span class="question-niveau niveau-1">&#9733;</span>
                        <span class="question-points">1 BE</span>
                    </div>
                </div>
                <div class="question-text">
                    Die <strong>Dehnung</strong> einer Feder gibt an, ...
                </div>
                <div class="options" id="q1-options">
                    <label class="option" data-value="a"><input type="radio" name="q1" value="a"> wie lang die Feder ist</label>
                    <label class="option" data-value="b"><input type="radio" name="q1" value="b"> um wie viel sich die Feder verlängert hat</label>
                    <label class="option" data-value="c"><input type="radio" name="q1" value="c"> wie schwer die Feder ist</label>
                    <label class="option" data-value="d"><input type="radio" name="q1" value="d"> wie hart die Feder ist</label>
                </div>
                <div class="feedback-box correct" id="q1-fb-correct">Richtig! Die Dehnung ist die Verlängerung gegenüber der Ruhelage.</div>
                <div class="feedback-box incorrect" id="q1-fb-incorrect">Die Dehnung gibt an, <strong>um wie viel sich die Feder verlängert hat</strong>.</div>
            </div>

            <!-- F2: Definition Federkonstante (1 BE) -->
            <div class="question" id="q2" data-niveau="1" data-points="1">
                <div class="question-header">
                    <div class="question-title">Frage 2: Definition Federkonstante</div>
                    <div class="question-meta">
                        <span class="question-niveau niveau-1">&#9733;</span>
                        <span class="question-points">1 BE</span>
                    </div>
                </div>
                <div class="question-text">
                    Die <strong>Federkonstante D</strong> gibt an, ...
                </div>
                <div class="options" id="q2-options">
                    <label class="option" data-value="a"><input type="radio" name="q2" value="a"> wie viel Kraft nötig ist, um die Feder um 1 cm zu dehnen</label>
                    <label class="option" data-value="b"><input type="radio" name="q2" value="b"> wie lang die Feder ist</label>
                    <label class="option" data-value="c"><input type="radio" name="q2" value="c"> wie viel die Feder wiegt</label>
                    <label class="option" data-value="d"><input type="radio" name="q2" value="d"> wie schnell die Feder schwingt</label>
                </div>
                <div class="feedback-box correct" id="q2-fb-correct">Richtig! D gibt an, wie viel Newton nötig sind, um die Feder um 1 cm zu dehnen.</div>
                <div class="feedback-box incorrect" id="q2-fb-incorrect">Die Federkonstante D gibt an, <strong>wie viel Kraft nötig ist, um die Feder um 1 cm zu dehnen</strong>.</div>
            </div>

            <!-- F3: Einheiten zuordnen (3 BE) -->
            <div class="question" id="q3" data-niveau="1" data-points="3">
                <div class="question-header">
                    <div class="question-title">Frage 3: Einheiten zuordnen</div>
                    <div class="question-meta">
                        <span class="question-niveau niveau-1">&#9733;</span>
                        <span class="question-points">3 BE</span>
                    </div>
                </div>
                <div class="question-text">
                    <strong>Ordne zu:</strong> Welche Einheit gehört zu welcher Größe?
                </div>
                <div style="margin: 15px 0;">
                    <div class="inline-answer">
                        <span style="min-width:180px;">Kraft <span class="fz">F</span>:</span>
                        <select id="q3a">
                            <option value="">-- wählen --</option>
                            <option value="N">N (Newton)</option>
                            <option value="cm">cm (Zentimeter)</option>
                            <option value="N/cm">N/cm</option>
                        </select>
                    </div>
                    <div class="inline-answer">
                        <span style="min-width:180px;">Dehnung <span class="fz">s</span>:</span>
                        <select id="q3b">
                            <option value="">-- wählen --</option>
                            <option value="N">N (Newton)</option>
                            <option value="cm">cm (Zentimeter)</option>
                            <option value="N/cm">N/cm</option>
                        </select>
                    </div>
                    <div class="inline-answer">
                        <span style="min-width:180px;">Federkonstante <span class="fz">D</span>:</span>
                        <select id="q3c">
                            <option value="">-- wählen --</option>
                            <option value="N">N (Newton)</option>
                            <option value="cm">cm (Zentimeter)</option>
                            <option value="N/cm">N/cm</option>
                        </select>
                    </div>
                </div>
                <div class="feedback-box correct" id="q3-fb-correct">Alle richtig! <span class="fz">F</span> in N, <span class="fz">s</span> in cm, <span class="fz">D</span> in N/cm.</div>
                <div class="feedback-box incorrect" id="q3-fb-incorrect"><span class="fz">F</span> = Newton (N), <span class="fz">s</span> = Zentimeter (cm), <span class="fz">D</span> = N/cm</div>
            </div>

            <!-- F4: F berechnen D=0,5 s=4 (2 BE) -->
            <div class="question" id="q4" data-niveau="1" data-points="2">
                <div class="question-header">
                    <div class="question-title">Frage 4: Kraft berechnen</div>
                    <div class="question-meta">
                        <span class="question-niveau niveau-1">&#9733;</span>
                        <span class="question-points">2 BE</span>
                    </div>
                </div>
                <div class="question-text">
                    <strong>Berechne</strong> die Kraft mit <span class="fz">F</span> = <span class="fz">D</span> · <span class="fz">s</span>:<br>
                    <span class="fz">D</span> = 0,5 <span class="einheit"><span class="bruch-inline"><span class="zi">N</span><span class="ni">cm</span></span></span>, &nbsp; <span class="fz">s</span> = 4 <span class="einheit">cm</span>
                </div>
                <div class="inline-answer">
                    <span class="fz">F</span> =
                    <input type="text" inputmode="decimal" id="q4v" style="width:80px;">
                    <span class="einheit">N</span>
                </div>
                <div class="feedback-box correct" id="q4-fb-correct">Richtig! 0,5 · 4 = 2 N</div>
                <div class="feedback-box incorrect" id="q4-fb-incorrect"><span class="fz">F</span> = 0,5 · 4 = <strong>2 N</strong></div>
            </div>

            <!-- F5: F berechnen D=0,5 s=8 (2 BE) -->
            <div class="question" id="q5" data-niveau="1" data-points="2">
                <div class="question-header">
                    <div class="question-title">Frage 5: Kraft berechnen</div>
                    <div class="question-meta">
                        <span class="question-niveau niveau-1">&#9733;</span>
                        <span class="question-points">2 BE</span>
                    </div>
                </div>
                <div class="question-text">
                    <strong>Berechne</strong> die Kraft:<br>
                    <span class="fz">D</span> = 0,5 <span class="einheit"><span class="bruch-inline"><span class="zi">N</span><span class="ni">cm</span></span></span>, &nbsp; <span class="fz">s</span> = 8 <span class="einheit">cm</span>
                </div>
                <div class="inline-answer">
                    <span class="fz">F</span> =
                    <input type="text" inputmode="decimal" id="q5v" style="width:80px;">
                    <span class="einheit">N</span>
                </div>
                <div class="feedback-box correct" id="q5-fb-correct">Richtig! 0,5 · 8 = 4 N</div>
                <div class="feedback-box incorrect" id="q5-fb-incorrect"><span class="fz">F</span> = 0,5 · 8 = <strong>4 N</strong></div>
            </div>

            <!-- F6: F berechnen D=1 s=3 (2 BE) -->
            <div class="question" id="q6" data-niveau="1" data-points="2">
                <div class="question-header">
                    <div class="question-title">Frage 6: Kraft berechnen</div>
                    <div class="question-meta">
                        <span class="question-niveau niveau-1">&#9733;</span>
                        <span class="question-points">2 BE</span>
                    </div>
                </div>
                <div class="question-text">
                    <strong>Berechne</strong> die Kraft:<br>
                    <span class="fz">D</span> = 1 <span class="einheit"><span class="bruch-inline"><span class="zi">N</span><span class="ni">cm</span></span></span>, &nbsp; <span class="fz">s</span> = 3 <span class="einheit">cm</span>
                </div>
                <div class="inline-answer">
                    <span class="fz">F</span> =
                    <input type="text" inputmode="decimal" id="q6v" style="width:80px;">
                    <span class="einheit">N</span>
                </div>
                <div class="feedback-box correct" id="q6-fb-correct">Richtig! 1 · 3 = 3 N</div>
                <div class="feedback-box incorrect" id="q6-fb-incorrect"><span class="fz">F</span> = 1 · 3 = <strong>3 N</strong></div>
            </div>

            <!-- F7: s berechnen F=4 D=0,5 (2 BE) -->
            <div class="question" id="q7" data-niveau="1" data-points="2">
                <div class="question-header">
                    <div class="question-title">Frage 7: Dehnung berechnen</div>
                    <div class="question-meta">
                        <span class="question-niveau niveau-1">&#9733;</span>
                        <span class="question-points">2 BE</span>
                    </div>
                </div>
                <div class="question-text">
                    <strong>Berechne</strong> die Dehnung. Formel: <span class="fz">s</span> = <span class="fz">F</span> / <span class="fz">D</span><br>
                    <span class="fz">F</span> = 4 <span class="einheit">N</span>, &nbsp; <span class="fz">D</span> = 0,5 <span class="einheit"><span class="bruch-inline"><span class="zi">N</span><span class="ni">cm</span></span></span>
                </div>
                <div class="inline-answer">
                    <span class="fz">s</span> =
                    <input type="text" inputmode="decimal" id="q7v" style="width:80px;">
                    <span class="einheit">cm</span>
                </div>
                <div class="feedback-box correct" id="q7-fb-correct">Richtig! 4 / 0,5 = 8 cm</div>
                <div class="feedback-box incorrect" id="q7-fb-incorrect"><span class="fz">s</span> = 4 / 0,5 = <strong>8 cm</strong></div>
            </div>

            <!-- F8: s berechnen F=6 D=1 (2 BE) -->
            <div class="question" id="q8" data-niveau="1" data-points="2">
                <div class="question-header">
                    <div class="question-title">Frage 8: Dehnung berechnen</div>
                    <div class="question-meta">
                        <span class="question-niveau niveau-1">&#9733;</span>
                        <span class="question-points">2 BE</span>
                    </div>
                </div>
                <div class="question-text">
                    <strong>Berechne</strong> die Dehnung:<br>
                    <span class="fz">F</span> = 6 <span class="einheit">N</span>, &nbsp; <span class="fz">D</span> = 1 <span class="einheit"><span class="bruch-inline"><span class="zi">N</span><span class="ni">cm</span></span></span>
                </div>
                <div class="inline-answer">
                    <span class="fz">s</span> =
                    <input type="text" inputmode="decimal" id="q8v" style="width:80px;">
                    <span class="einheit">cm</span>
                </div>
                <div class="feedback-box correct" id="q8-fb-correct">Richtig! 6 / 1 = 6 cm</div>
                <div class="feedback-box incorrect" id="q8-fb-incorrect"><span class="fz">s</span> = 6 / 1 = <strong>6 cm</strong></div>
            </div>

            <!-- F9: Proportionalität (2 BE) -->
            <div class="question" id="q9" data-niveau="1" data-points="2">
                <div class="question-header">
                    <div class="question-title">Frage 9: Proportionalität</div>
                    <div class="question-meta">
                        <span class="question-niveau niveau-1">&#9733;</span>
                        <span class="question-points">2 BE</span>
                    </div>
                </div>
                <div class="question-text">
                    Eine Feder wird mit 2 N um 4 cm gedehnt.<br>
                    <strong>Wie weit</strong> dehnt sie sich bei 4 N?
                </div>
                <div class="inline-answer">
                    <span class="fz">s</span> =
                    <input type="text" inputmode="decimal" id="q9v" style="width:80px;">
                    <span class="einheit">cm</span>
                </div>
                <div class="feedback-box correct" id="q9-fb-correct">Richtig! Doppelte Kraft → doppelte Dehnung: 8 cm</div>
                <div class="feedback-box incorrect" id="q9-fb-incorrect">Doppelte Kraft → doppelte Dehnung: 2 · 4 cm = <strong>8 cm</strong></div>
            </div>

            <!-- F10: Welche Feder ist härter? (2 BE) -->
            <div class="question" id="q10" data-niveau="1" data-points="2">
                <div class="question-header">
                    <div class="question-title">Frage 10: Harte vs. weiche Feder</div>
                    <div class="question-meta">
                        <span class="question-niveau niveau-1">&#9733;</span>
                        <span class="question-points">2 BE</span>
                    </div>
                </div>
                <div class="question-text">
                    Feder A hat <span class="fz">D</span> = 0,5 N/cm, Feder B hat <span class="fz">D</span> = 2 N/cm.<br>
                    <strong>Welche Feder ist härter?</strong>
                </div>
                <div class="options" id="q10-options">
                    <label class="option" data-value="a"><input type="radio" name="q10" value="a"> Feder A (D = 0,5 N/cm)</label>
                    <label class="option" data-value="b"><input type="radio" name="q10" value="b"> Feder B (D = 2 N/cm)</label>
                    <label class="option" data-value="c"><input type="radio" name="q10" value="c"> Beide gleich hart</label>
                    <label class="option" data-value="d"><input type="radio" name="q10" value="d"> Kann man nicht vergleichen</label>
                </div>
                <div class="feedback-box correct" id="q10-fb-correct">Richtig! Größeres D = härtere Feder (mehr Kraft für gleiche Dehnung).</div>
                <div class="feedback-box incorrect" id="q10-fb-incorrect"><strong>Feder B</strong> ist härter: Größeres D = mehr Kraft nötig für gleiche Dehnung.</div>
            </div>

            <!-- F11: Hooke'sches Gesetz (2 BE) -->
            <div class="question" id="q11" data-niveau="1" data-points="2">
                <div class="question-header">
                    <div class="question-title">Frage 11: Hooke'sches Gesetz</div>
                    <div class="question-meta">
                        <span class="question-niveau niveau-1">&#9733;</span>
                        <span class="question-points">2 BE</span>
                    </div>
                </div>
                <div class="question-text">
                    Welche Aussage beschreibt das <strong>Hooke'sche Gesetz</strong> richtig?
                </div>
                <div class="options" id="q11-options">
                    <label class="option" data-value="a"><input type="radio" name="q11" value="a"> Die Dehnung ist proportional zur Kraft</label>
                    <label class="option" data-value="b"><input type="radio" name="q11" value="b"> Die Dehnung ist umgekehrt proportional zur Kraft</label>
                    <label class="option" data-value="c"><input type="radio" name="q11" value="c"> Die Federkonstante ändert sich mit der Kraft</label>
                    <label class="option" data-value="d"><input type="radio" name="q11" value="d"> Die Feder wird bei doppelter Kraft halb so lang</label>
                </div>
                <div class="feedback-box correct" id="q11-fb-correct">Richtig! F = D · s → Dehnung und Kraft sind proportional.</div>
                <div class="feedback-box incorrect" id="q11-fb-incorrect">Das Hooke'sche Gesetz sagt: <strong>Die Dehnung ist proportional zur Kraft.</strong></div>
            </div>

            <!-- ═══════════════════════════════════════════════════════════ -->
            <!-- ★★ NIVEAU 2: STANDARD (+5 BE = 28 BE) -->
            <!-- ═══════════════════════════════════════════════════════════ -->

            <!-- F12: F berechnen D=0,5 s=12 (2 BE) -->
            <div class="question" id="q12" data-niveau="2" data-points="2">
                <div class="question-header">
                    <div class="question-title">Frage 12: Kraft berechnen</div>
                    <div class="question-meta">
                        <span class="question-niveau niveau-2">&#9733;&#9733;</span>
                        <span class="question-points">2 BE</span>
                    </div>
                </div>
                <div class="question-text">
                    <strong>Berechne</strong> die Kraft:<br>
                    <span class="fz">D</span> = 0,5 <span class="einheit"><span class="bruch-inline"><span class="zi">N</span><span class="ni">cm</span></span></span>, &nbsp; <span class="fz">s</span> = 12 <span class="einheit">cm</span>
                </div>
                <div class="inline-answer">
                    <span class="fz">F</span> =
                    <input type="text" inputmode="decimal" id="q12v" style="width:80px;">
                    <span class="einheit">N</span>
                </div>
                <div class="feedback-box correct" id="q12-fb-correct">Richtig! 0,5 · 12 = 6 N</div>
                <div class="feedback-box incorrect" id="q12-fb-incorrect"><span class="fz">F</span> = 0,5 · 12 = <strong>6 N</strong></div>
            </div>

            <!-- F13: s berechnen D=2 F=8 (3 BE) -->
            <div class="question" id="q13" data-niveau="2" data-points="3">
                <div class="question-header">
                    <div class="question-title">Frage 13: Dehnung berechnen</div>
                    <div class="question-meta">
                        <span class="question-niveau niveau-2">&#9733;&#9733;</span>
                        <span class="question-points">3 BE</span>
                    </div>
                </div>
                <div class="question-text">
                    Eine harte Feder (<span class="fz">D</span> = 2 <span class="einheit"><span class="bruch-inline"><span class="zi">N</span><span class="ni">cm</span></span></span>) wird mit <span class="fz">F</span> = 8 <span class="einheit">N</span> belastet.<br>
                    <strong>Berechne</strong> die Dehnung.
                </div>
                <div class="inline-answer">
                    <span class="fz">s</span> =
                    <input type="text" inputmode="decimal" id="q13v" style="width:80px;">
                    <span class="einheit">cm</span>
                </div>
                <div class="feedback-box correct" id="q13-fb-correct">Richtig! s = F / D = 8 / 2 = 4 cm</div>
                <div class="feedback-box incorrect" id="q13-fb-incorrect"><span class="fz">s</span> = <span class="fz">F</span> / <span class="fz">D</span> = 8 / 2 = <strong>4 cm</strong></div>
            </div>

            <!-- ═══════════════════════════════════════════════════════════ -->
            <!-- ★★★ NIVEAU 3: ERWEITERT (+1 BE = 29 BE) -->
            <!-- ═══════════════════════════════════════════════════════════ -->

            <!-- F14: Transfer - Feder identifizieren (1 BE) -->
            <div class="question" id="q14" data-niveau="3" data-points="1">
                <div class="question-header">
                    <div class="question-title">Frage 14: Welche Feder?</div>
                    <div class="question-meta">
                        <span class="question-niveau niveau-3">&#9733;&#9733;&#9733;</span>
                        <span class="question-points">1 BE</span>
                    </div>
                </div>
                <div class="question-text">
                    Ein Schüler misst: Bei <span class="fz">F</span> = 3 <span class="einheit">N</span> dehnt sich eine Feder um <span class="fz">s</span> = 6 <span class="einheit">cm</span>.<br>
                    <strong>Welche Feder</strong> hat er benutzt?
                    <table style="margin: 10px 0; font-size: 0.9em; border-collapse: collapse;">
                        <tr style="background:#f5f5f5;"><th style="padding:5px 10px; border:1px solid #ddd;">Feder</th><th style="padding:5px 10px; border:1px solid #ddd;"><span class="fz">D</span> in <span class="bruch-inline"><span class="zi">N</span><span class="ni">cm</span></span></th></tr>
                        <tr><td style="padding:5px 10px; border:1px solid #ddd;">Feder 1 (weich)</td><td style="padding:5px 10px; border:1px solid #ddd;">0,5</td></tr>
                        <tr><td style="padding:5px 10px; border:1px solid #ddd;">Feder 2 (hart)</td><td style="padding:5px 10px; border:1px solid #ddd;">1,0</td></tr>
                    </table>
                </div>
                <div class="inline-answer">
                    Feder:
                    <select id="q14b">
                        <option value="">-- wählen --</option>
                        <option value="feder1">Feder 1 (weich)</option>
                        <option value="feder2">Feder 2 (hart)</option>
                    </select>
                </div>
                <div class="feedback-box correct" id="q14-fb-correct">Richtig! D = 3 N / 6 cm = 0,5 N/cm → Feder 1 (weich)</div>
                <div class="feedback-box incorrect" id="q14-fb-incorrect"><span class="fz">D</span> = 3 / 6 = 0,5 N/cm → Das ist <strong>Feder 1 (weich)</strong>.</div>
            </div>

        </div><!-- /questionsContainer -->

        <!-- SUBMIT -->
        <div id="submitSection" style="display:none; margin: 20px 0;">
            <button class="btn btn-success" onclick="submitTest()">Auswerten</button>
        </div>

        <!-- ERGEBNISSE -->
        <div class="results" id="results">
            <h2>Ergebnis</h2>
            <div class="results-score" id="scoreDisplay"></div>
            <div id="npDisplay"></div>

            <h3 style="margin-top: 20px; color: #2c5aa0;">Bewertung (14-NP)</h3>
            <table class="grade-table" id="gradeTable">
                <tr>
                    <th>NP</th>
                    <th>14</th><th>13</th><th>12</th><th>11</th><th>10</th><th>9</th><th>8</th>
                    <th>7</th><th>6</th><th>5</th><th>4</th><th>3</th><th>2</th><th>1</th><th>0</th>
                </tr>
                <tr id="gradeRow">
                    <td>%</td>
                    <td>100</td><td>96</td><td>91</td><td>86</td><td>80</td><td>73</td><td>67</td>
                    <td>60</td><td>53</td><td>47</td><td>40</td><td>33</td><td>27</td><td>20</td><td>&lt;20</td>
                </tr>
            </table>
        </div>

        <!-- LEHRER-BEREICH -->
        <details class="teacher-section">
            <summary>Lehrerbereich</summary>
            <button class="btn btn-small" onclick="teacherReset()">Platz zurücksetzen</button>
        </details>

    </div><!-- /container -->

    <script>
        // ============================================================
        // KONFIGURATION
        // ============================================================

        var STORAGE_KEY = 'mt-physik-kl7-04-federspannkraft-v1';
        var TIME_LIMIT = 15 * 60;
        var timeRemaining = TIME_LIMIT;
        var timerInterval = null;
        var selectedNiveau = 0;
        var testSubmitted = false;

        // Tab-Wechsel-Protokoll (Anti-Betrug)
        var tabSwitchCount = 0;
        var tabSwitchStart = 0;
        var tabSwitchSeconds = 0;

        function formatTimestamp(ts) {
            if (!ts) return '—';
            var d = new Date(parseInt(ts));
            var day = d.getDate();
            var month = d.getMonth() + 1;
            var year = d.getFullYear();
            var hours = d.getHours();
            var minutes = d.getMinutes();
            return (day < 10 ? '0' : '') + day + '.' +
                   (month < 10 ? '0' : '') + month + '.' + year + ' ' +
                   (hours < 10 ? '0' : '') + hours + ':' +
                   (minutes < 10 ? '0' : '') + minutes + ' Uhr';
        }

        function initTabSwitchTracking() {
            var savedCount = localStorage.getItem(STORAGE_KEY + '-tabswitches');
            var savedSeconds = localStorage.getItem(STORAGE_KEY + '-tabseconds');
            if (savedCount) tabSwitchCount = parseInt(savedCount);
            if (savedSeconds) tabSwitchSeconds = parseInt(savedSeconds);

            document.addEventListener('visibilitychange', function() {
                if (testSubmitted) return;

                if (document.hidden) {
                    tabSwitchStart = Date.now();
                    tabSwitchCount++;
                    localStorage.setItem(STORAGE_KEY + '-tabswitches', tabSwitchCount);
                } else {
                    if (tabSwitchStart > 0) {
                        var duration = Math.round((Date.now() - tabSwitchStart) / 1000);
                        tabSwitchSeconds += duration;
                        localStorage.setItem(STORAGE_KEY + '-tabseconds', tabSwitchSeconds);
                        tabSwitchStart = 0;
                    }
                }
            });
        }

        function formatDuration(seconds) {
            if (seconds < 60) return seconds + ' Sek.';
            var min = Math.floor(seconds / 60);
            var sec = seconds % 60;
            return min + ':' + (sec < 10 ? '0' : '') + sec + ' Min.';
        }

        var niveauPoints = {
            1: 23,  // ★ Basis
            2: 28,  // ★★ Standard
            3: 29   // ★★★ Erweitert
        };

        var answers = {
            q1: 'b', q2: 'a',
            q3a: 'N', q3b: 'cm', q3c: 'N/cm',
            q4: 2, q5: 4, q6: 3,
            q7: 8, q8: 6, q9: 8,
            q10: 'b', q11: 'a',
            q12: 6, q13: 4,
            q14b: 'feder1'
        };

        function parseNumber(val) {
            if (val === '' || val === null || val === undefined) return NaN;
            return parseFloat(String(val).replace(',', '.'));
        }

        // ============================================================
        // TIMER
        // ============================================================

        function startTimer() {
            var savedTime = localStorage.getItem(STORAGE_KEY + '-time');
            if (savedTime) timeRemaining = parseInt(savedTime);
            updateTimerDisplay();
            timerInterval = setInterval(function() {
                if (testSubmitted) { clearInterval(timerInterval); return; }
                timeRemaining--;
                if (timeRemaining < 0) timeRemaining = 0;
                localStorage.setItem(STORAGE_KEY + '-time', timeRemaining);
                updateTimerDisplay();
            }, 1000);
        }

        function updateTimerDisplay() {
            var timerBar = document.getElementById('timerBar');
            var timerDisplay = document.getElementById('timerDisplay');
            if (timeRemaining <= 0) {
                timerDisplay.textContent = 'Zeit zum Abgeben!';
                timerBar.className = 'timer-bar expired';
                return;
            }
            var m = Math.floor(timeRemaining / 60);
            var s = timeRemaining % 60;
            timerDisplay.textContent = m + ':' + (s < 10 ? '0' : '') + s;
            timerBar.classList.remove('warning', 'danger', 'expired');
            if (timeRemaining <= 120) timerBar.classList.add('danger');
            else if (timeRemaining <= 300) timerBar.classList.add('warning');
        }

        // ============================================================
        // PLATZ + NIVEAU SPERRUNG
        // ============================================================

        function confirmSeat() {
            var sel = document.getElementById('seatSelect');
            var num = sel.value;
            if (!num) { alert('Bitte Platznummer wählen!'); return; }
            var ok = confirm('Platznummer P' + num + ' bestätigen?\n\nKann NICHT mehr geändert werden!');
            if (!ok) return;
            localStorage.setItem(STORAGE_KEY + '-seat', num);
            localStorage.setItem(STORAGE_KEY + '-seat-locked', 'true');
            showLockedSeat(num);
            checkUnlocked();
        }

        function showLockedSeat(num) {
            document.getElementById('seatRow').style.display = 'none';
            var locked = document.getElementById('seatLocked');
            locked.innerHTML = '<div class="locked-display">Platz: <strong>P' + num + '</strong></div>';
            locked.style.display = 'block';
        }

        function confirmNiveau() {
            var sel = document.getElementById('niveauSelect');
            var val = sel.value;
            if (!val) { alert('Bitte Niveau wählen!'); return; }
            var stars = ['', '★ Basis (23 BE)', '★★ Standard (28 BE)', '★★★ Erweitert (29 BE)'][parseInt(val)];
            var ok = confirm('Niveau "' + stars + '" bestätigen?\n\nKann NICHT mehr geändert werden!');
            if (!ok) return;
            localStorage.setItem(STORAGE_KEY + '-niveau', val);
            localStorage.setItem(STORAGE_KEY + '-niveau-locked', 'true');
            selectedNiveau = parseInt(val);
            showLockedNiveau(val);
            activateNiveau(selectedNiveau);
            checkUnlocked();
        }

        function showLockedNiveau(val) {
            document.getElementById('niveauRow').style.display = 'none';
            var locked = document.getElementById('niveauLocked');
            var stars = ['', '★ Basis', '★★ Standard', '★★★ Erweitert'][parseInt(val)];
            locked.innerHTML = '<div class="locked-display niveau-' + val + '">Niveau: <strong>' + stars + '</strong> (' + niveauPoints[val] + ' BE)</div>';
            locked.style.display = 'block';
        }

        function checkUnlocked() {
            var seatLocked = localStorage.getItem(STORAGE_KEY + '-seat-locked') === 'true';
            var niveauLocked = localStorage.getItem(STORAGE_KEY + '-niveau-locked') === 'true';
            var container = document.getElementById('questionsContainer');
            var hint = document.getElementById('unlockHint');

            if (seatLocked && niveauLocked) {
                container.classList.add('unlocked');
                hint.style.display = 'none';
            } else {
                container.classList.remove('unlocked');
                hint.style.display = 'block';
            }
        }

        function activateNiveau(niveau) {
            var questions = document.querySelectorAll('.question');
            for (var i = 0; i < questions.length; i++) {
                var qNiveau = parseInt(questions[i].dataset.niveau);
                if (qNiveau <= niveau) {
                    questions[i].classList.add('visible');
                }
            }
            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('submitSection').style.display = 'block';
            updateProgress();
        }

        // ============================================================
        // FORTSCHRITT
        // ============================================================

        function isAnswered(qId) {
            switch(qId) {
                case 'q1': case 'q2': case 'q10': case 'q11':
                    return !!document.querySelector('input[name="' + qId + '"]:checked');
                case 'q3':
                    return document.getElementById('q3a').value && document.getElementById('q3b').value && document.getElementById('q3c').value;
                case 'q4': return document.getElementById('q4v').value !== '';
                case 'q5': return document.getElementById('q5v').value !== '';
                case 'q6': return document.getElementById('q6v').value !== '';
                case 'q7': return document.getElementById('q7v').value !== '';
                case 'q8': return document.getElementById('q8v').value !== '';
                case 'q9': return document.getElementById('q9v').value !== '';
                case 'q12': return document.getElementById('q12v').value !== '';
                case 'q13': return document.getElementById('q13v').value !== '';
                case 'q14': return document.getElementById('q14b').value !== '';
                default: return false;
            }
        }

        function updateProgress() {
            if (selectedNiveau === 0) return;
            var answered = 0, total = 0;
            var questions = document.querySelectorAll('.question');
            for (var i = 0; i < questions.length; i++) {
                var qNiveau = parseInt(questions[i].dataset.niveau);
                if (qNiveau <= selectedNiveau) {
                    total++;
                    if (isAnswered(questions[i].id)) answered++;
                }
            }
            var pct = total > 0 ? (answered / total) * 100 : 0;
            document.getElementById('progressFill').style.width = pct + '%';
            document.getElementById('progressText').textContent = answered + ' / ' + total + ' beantwortet (' + niveauPoints[selectedNiveau] + ' BE)';
        }

        // ============================================================
        // PERSISTENZ
        // ============================================================

        function saveProgress() {
            if (testSubmitted) return;
            var inputs = document.querySelectorAll('input, select');
            for (var i = 0; i < inputs.length; i++) {
                var el = inputs[i];
                if (el.type === 'radio') {
                    if (el.checked) localStorage.setItem(STORAGE_KEY + '-' + el.name, el.value);
                } else if (el.id) {
                    localStorage.setItem(STORAGE_KEY + '-' + el.id, el.value);
                }
            }
        }

        function loadProgress() {
            var wasSubmitted = localStorage.getItem(STORAGE_KEY + '-submitted') === 'true';

            if (localStorage.getItem(STORAGE_KEY + '-seat-locked') === 'true') {
                var seat = localStorage.getItem(STORAGE_KEY + '-seat');
                if (seat) showLockedSeat(seat);
            }

            if (localStorage.getItem(STORAGE_KEY + '-niveau-locked') === 'true') {
                var niveau = localStorage.getItem(STORAGE_KEY + '-niveau');
                if (niveau) {
                    selectedNiveau = parseInt(niveau);
                    showLockedNiveau(niveau);
                    activateNiveau(selectedNiveau);
                }
            }

            var inputs = document.querySelectorAll('input, select');
            for (var i = 0; i < inputs.length; i++) {
                var el = inputs[i];
                if (el.type === 'radio') {
                    var saved = localStorage.getItem(STORAGE_KEY + '-' + el.name);
                    if (saved && el.value === saved) el.checked = true;
                } else if (el.id) {
                    var saved = localStorage.getItem(STORAGE_KEY + '-' + el.id);
                    if (saved) el.value = saved;
                }
            }

            if (wasSubmitted) {
                testSubmitted = true;
                displayResults();
            }
        }

        document.addEventListener('change', function() {
            saveProgress();
            updateProgress();
        });

        // ============================================================
        // AUSWERTUNG
        // ============================================================

        function submitTest() {
            if (testSubmitted) return;
            if (selectedNiveau === 0) { alert('Bitte erst Niveau wählen!'); return; }

            var seatLocked = localStorage.getItem(STORAGE_KEY + '-seat-locked');
            if (seatLocked !== 'true') { alert('Bitte erst Platznummer bestätigen!'); return; }

            testSubmitted = true;
            localStorage.setItem(STORAGE_KEY + '-submitted', 'true');
            localStorage.setItem(STORAGE_KEY + '-submit-time', Date.now());
            clearInterval(timerInterval);
            displayResults();
        }

        function displayResults() {
            var score = 0;
            var maxPts = niveauPoints[selectedNiveau];

            // ★ NIVEAU 1
            if (selectedNiveau >= 1) {
                score += evalRadio('q1', 'b', 1);
                score += evalRadio('q2', 'a', 1);
                score += evalDropdowns();
                score += evalNumeric('q4v', 2, 2);
                score += evalNumeric('q5v', 4, 2);
                score += evalNumeric('q6v', 3, 2);
                score += evalNumeric('q7v', 8, 2);
                score += evalNumeric('q8v', 6, 2);
                score += evalNumeric('q9v', 8, 2);
                score += evalRadio('q10', 'b', 2);
                score += evalRadio('q11', 'a', 2);
            }

            // ★★ NIVEAU 2
            if (selectedNiveau >= 2) {
                score += evalNumeric('q12v', 6, 2);
                score += evalNumeric('q13v', 4, 3);
            }

            // ★★★ NIVEAU 3
            if (selectedNiveau >= 3) {
                score += evalQ14();
            }

            document.getElementById('scoreDisplay').textContent = score + ' / ' + maxPts + ' BE';

            var pct = (score / maxPts) * 100;
            var np = calcNP(pct);
            var npClass = np >= 10 ? 'good' : (np >= 5 ? 'ok' : 'weak');
            document.getElementById('npDisplay').innerHTML = '<div class="results-np ' + npClass + '">' + np + ' Notenpunkte (' + Math.round(pct) + '%)</div>';

            markGradeTable(np);

            document.getElementById('results').style.display = 'block';
            document.getElementById('submitSection').style.display = 'none';

            var startTS = localStorage.getItem(STORAGE_KEY + '-start');
            var submitTS = localStorage.getItem(STORAGE_KEY + '-submit-time');
            var switches = localStorage.getItem(STORAGE_KEY + '-tabswitches') || '0';
            var switchSec = localStorage.getItem(STORAGE_KEY + '-tabseconds') || '0';
            var timestampHtml = '<div style="margin-top:20px; padding:12px; background:#f5f5f5; border:1px solid #ddd; text-align:left; font-size:0.85em;">' +
                '<div><strong>Aufruf:</strong> ' + formatTimestamp(startTS) + '</div>' +
                '<div><strong>Abgabe:</strong> ' + formatTimestamp(submitTS) + '</div>' +
                '<div><strong>Tab-Wechsel:</strong> ' + switches + '× (' + formatDuration(parseInt(switchSec)) + ')</div>' +
                '</div>';
            var resultsEl = document.getElementById('results');
            if (resultsEl) resultsEl.insertAdjacentHTML('beforeend', timestampHtml);

            disableAllInputs();
        }

        function evalRadio(name, correct, pts) {
            var sel = document.querySelector('input[name="' + name + '"]:checked');
            var val = sel ? sel.value : '';
            var isCorrect = val === correct;
            markRadioOptions(name, correct, val);
            showFeedback(name, isCorrect);
            showResult(name, isCorrect ? pts : 0, pts);
            return isCorrect ? pts : 0;
        }

        function evalNumeric(id, correct, pts) {
            var el = document.getElementById(id);
            var val = parseNumber(el.value);
            var isCorrect = val === correct;
            el.style.border = isCorrect ? '2px solid #2a7a4b' : '2px solid #c62828';
            el.style.background = isCorrect ? '#e8f5e9' : '#ffebee';
            var qId = id.replace('v', '');
            showFeedback(qId, isCorrect);
            showResult(qId, isCorrect ? pts : 0, pts);
            return isCorrect ? pts : 0;
        }

        function evalDropdowns() {
            var score = 0;
            var q3a = document.getElementById('q3a');
            var q3b = document.getElementById('q3b');
            var q3c = document.getElementById('q3c');

            if (q3a.value === 'N') { score++; q3a.classList.add('correct'); }
            else { q3a.classList.add('incorrect'); }

            if (q3b.value === 'cm') { score++; q3b.classList.add('correct'); }
            else { q3b.classList.add('incorrect'); }

            if (q3c.value === 'N/cm') { score++; q3c.classList.add('correct'); }
            else { q3c.classList.add('incorrect'); }

            showFeedback('q3', score === 3);
            showResult('q3', score, 3);
            return score;
        }

        function evalQ14() {
            var q14b = document.getElementById('q14b');
            var isCorrect = q14b.value === 'feder1';

            if (isCorrect) {
                q14b.classList.add('correct');
            } else {
                q14b.classList.add('incorrect');
            }

            showFeedback('q14', isCorrect);
            showResult('q14', isCorrect ? 1 : 0, 1);
            return isCorrect ? 1 : 0;
        }

        function markRadioOptions(name, correct, selected) {
            var opts = document.querySelectorAll('#' + name + '-options .option');
            for (var i = 0; i < opts.length; i++) {
                var val = opts[i].dataset.value;
                if (val === correct) opts[i].classList.add('correct');
                else if (val === selected && val !== correct) opts[i].classList.add('incorrect');
            }
        }

        function showFeedback(qId, isCorrect) {
            var fbC = document.getElementById(qId + '-fb-correct');
            var fbI = document.getElementById(qId + '-fb-incorrect');
            if (isCorrect && fbC) fbC.classList.add('show');
            else if (!isCorrect && fbI) fbI.classList.add('show');
        }

        function showResult(qId, achieved, maxPts) {
            var q = document.getElementById(qId);
            var meta = q.querySelector('.question-meta');
            var res = document.createElement('span');
            res.className = 'question-result';
            if (achieved === maxPts) res.classList.add('full');
            else if (achieved > 0) res.classList.add('partial');
            else res.classList.add('zero');
            res.textContent = achieved + '/' + maxPts + ' BE';
            meta.appendChild(res);
        }

        function calcNP(pct) {
            var thresholds = [100, 96, 90.67, 86, 80, 73.33, 66.67, 60, 53.33, 46.67, 40, 33.33, 26.67, 20];
            for (var i = 0; i < thresholds.length; i++) {
                if (pct >= thresholds[i]) return 14 - i;
            }
            return 0;
        }

        function markGradeTable(np) {
            var cells = document.getElementById('gradeRow').cells;
            var idx = 15 - np;
            if (idx >= 1 && idx < cells.length) {
                cells[idx].classList.add('current-grade');
            }
        }

        function disableAllInputs() {
            var inputs = document.querySelectorAll('input, select');
            for (var i = 0; i < inputs.length; i++) {
                inputs[i].disabled = true;
            }
        }

        // ============================================================
        // LEHRER-RESET
        // ============================================================

        function teacherReset() {
            var code = prompt('Lehrer-Code eingeben:');
            if (code === '2024') {
                var keys = [];
                for (var i = 0; i < localStorage.length; i++) {
                    var key = localStorage.key(i);
                    if (key && key.indexOf(STORAGE_KEY) === 0) keys.push(key);
                }
                for (var j = 0; j < keys.length; j++) {
                    localStorage.removeItem(keys[j]);
                }
                alert('Platz zurückgesetzt. Seite wird neu geladen.');
                location.reload();
            } else if (code !== null) {
                alert('Falscher Code!');
            }
        }

        // ============================================================
        // PERSISTENZ-ABLAUF (16 Stunden)
        // ============================================================

        var EXPIRY_MS = 16 * 60 * 60 * 1000;

        function checkExpiry() {
            var startTime = localStorage.getItem(STORAGE_KEY + '-start');
            if (startTime) {
                var elapsed = Date.now() - parseInt(startTime);
                if (elapsed > EXPIRY_MS) {
                    clearAllData();
                    return true;
                }
            } else {
                localStorage.setItem(STORAGE_KEY + '-start', Date.now());
            }
            return false;
        }

        function clearAllData() {
            var keys = [];
            for (var i = 0; i < localStorage.length; i++) {
                var key = localStorage.key(i);
                if (key && key.indexOf(STORAGE_KEY) === 0) keys.push(key);
            }
            for (var j = 0; j < keys.length; j++) {
                localStorage.removeItem(keys[j]);
            }
        }

        // ============================================================
        // INIT
        // ============================================================

        initTabSwitchTracking();

        if (checkExpiry()) {
            location.reload();
        } else {
            loadProgress();
            if (!testSubmitted) {
                startTimer();
            }
            checkUnlocked();
        }
    </script>
</body>
</html>
