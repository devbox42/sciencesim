<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glühlampen-Kennlinie</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --physik: #2c5aa0;
            --positive: #c62828;
            --negative: #1565c0;
            --success: #2a7a4b;
            --warning: #b35c00;
            --bg: #f5f5f5;
            --white: #ffffff;
            --border: #dddddd;
            --text: #222222;
            --text-muted: #666666;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            font-size: 15px;
            line-height: 1.5;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 15px;
        }

        h1 {
            font-size: 1.3em;
            font-weight: 600;
            color: var(--warning);
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--warning);
        }

        .main-layout {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .circuit-area {
            flex: 1;
            background: var(--white);
            border: 1px solid var(--border);
            padding: 15px;
        }

        canvas {
            display: block;
            width: 100%;
            background: #1a1a2e;
            border: 1px solid var(--border);
        }

        .sidebar {
            width: 280px;
            background: var(--white);
            border: 1px solid var(--border);
            padding: 15px;
        }

        .control-group {
            margin-bottom: 18px;
        }

        .control-group label {
            display: block;
            font-weight: 600;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        input[type="range"] {
            width: 100%;
            margin: 8px 0;
        }

        .value-box {
            background: var(--bg);
            border: 1px solid var(--border);
            padding: 10px;
            text-align: center;
            font-size: 1.3em;
            font-weight: 600;
            color: var(--warning);
        }

        .displays {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .display {
            background: var(--bg);
            border: 1px solid var(--border);
            padding: 10px;
            text-align: center;
        }

        .display .label {
            font-size: 0.75em;
            color: var(--text-muted);
            margin-bottom: 3px;
        }

        .display .value {
            font-size: 1.2em;
            font-weight: 600;
        }

        .display.current .value { color: var(--negative); }
        .display.voltage .value { color: var(--positive); }

        .temp-bar {
            height: 20px;
            background: linear-gradient(to right, #333 0%, #8b0000 25%, #ff4500 50%, #ffd700 75%, #ffffcc 100%);
            border: 1px solid var(--border);
            position: relative;
            margin: 10px 0;
        }

        .temp-marker {
            position: absolute;
            top: -4px;
            width: 3px;
            height: 28px;
            background: white;
            border: 1px solid #333;
            transform: translateX(-50%);
            transition: left 0.3s;
        }

        .temp-value {
            text-align: center;
            font-size: 0.9em;
            color: var(--text-muted);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85em;
            margin-bottom: 15px;
        }

        .data-table th, .data-table td {
            border: 1px solid var(--border);
            padding: 6px 8px;
            text-align: center;
        }

        .data-table th {
            background: var(--warning);
            color: var(--white);
            font-weight: 600;
        }

        .data-table tr.recorded {
            background: #fff3e0;
        }

        .data-table tr.current-row {
            background: #ffe0b2;
        }

        .record-btn {
            width: 100%;
            padding: 10px;
            background: var(--success);
            color: var(--white);
            border: none;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .record-btn:hover { background: #1b5e20; }
        .record-btn:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
        }

        .progress-info {
            font-size: 0.85em;
            color: var(--text-muted);
            text-align: center;
        }

        .hint-box {
            background: #fff3e0;
            border: 1px solid var(--warning);
            padding: 10px;
            font-size: 0.85em;
            margin-top: 15px;
        }

        .comparison-box {
            background: #e3f2fd;
            border: 1px solid var(--physik);
            padding: 10px;
            font-size: 0.85em;
            margin-top: 10px;
        }

        @media (max-width: 700px) {
            .main-layout { flex-direction: column; }
            .sidebar { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Glühlampen-Kennlinie</h1>

        <div class="main-layout">
            <div class="circuit-area">
                <canvas id="circuit" width="480" height="360"></canvas>
            </div>

            <div class="sidebar">
                <div class="displays">
                    <div class="display voltage">
                        <div class="label">Spannung U</div>
                        <div class="value" id="disp-u" style="color: #c62828;">0 V</div>
                    </div>
                    <div class="display current">
                        <div class="label">Stromstärke I</div>
                        <div class="value" id="disp-i">0,00 A</div>
                    </div>
                </div>

                <div class="control-group">
                    <label>Spannung U einstellen</label>
                    <input type="range" id="voltage-slider" min="0" max="12" step="2" value="0">
                    <div class="value-box" id="voltage-value">0 V</div>
                </div>

                <div class="control-group">
                    <label>Glühfaden-Temperatur</label>
                    <div class="temp-bar">
                        <div class="temp-marker" id="temp-marker"></div>
                    </div>
                    <div class="temp-value" id="temp-value">20 °C (kalt)</div>
                </div>

                <button class="record-btn" id="record-btn" onclick="recordValue()">Messwert aufnehmen</button>

                <table class="data-table">
                    <tr>
                        <th>U in V</th>
                        <th>I in A</th>
                    </tr>
                    <tr id="row-2"><td>2</td><td id="i-2">–</td></tr>
                    <tr id="row-4"><td>4</td><td id="i-4">–</td></tr>
                    <tr id="row-6"><td>6</td><td id="i-6">–</td></tr>
                    <tr id="row-8"><td>8</td><td id="i-8">–</td></tr>
                    <tr id="row-10"><td>10</td><td id="i-10">–</td></tr>
                    <tr id="row-12"><td>12</td><td id="i-12">–</td></tr>
                </table>

                <div class="progress-info" id="progress">0 von 6 Messwerten</div>

                <div class="hint-box">
                    <strong>Beobachte:</strong> Wie verändert sich die Stromstärke I bei steigender Spannung? Ist das Verhältnis U/I konstant?
                </div>

                <div class="comparison-box">
                    <strong>Vergleich:</strong> Zeichne diese Kennlinie zusätzlich in dein Diagramm – in einer anderen Farbe!
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // GLÜHLAMPEN-SIMULATION (ES5)
        // Nicht-linearer Widerstand: R steigt mit T
        // ============================================

        var canvas = document.getElementById('circuit');
        var ctx = canvas.getContext('2d');
        var slider = document.getElementById('voltage-slider');

        // Physikalisches Modell: Wolfram-Glühwendel
        // R(T) = R0 * (1 + alpha * (T - T0))
        // Empirische Werte für realistische Darstellung
        var lampData = {
            0:  { I: 0.00, T: 20 },
            2:  { I: 0.32, T: 300 },
            4:  { I: 0.50, T: 700 },
            6:  { I: 0.62, T: 1100 },
            8:  { I: 0.72, T: 1600 },
            10: { I: 0.80, T: 2100 },
            12: { I: 0.86, T: 2600 }
        };

        var U = 0;
        var I = 0;
        var T = 20;
        var R = 0;

        var recorded = {};
        var recordCount = 0;

        // Glüh-Animation
        var glowPhase = 0;
        var particles = [];

        // ============================================
        // DRAWING
        // ============================================

        function draw() {
            // Dunkler Hintergrund für Glüheffekt
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            drawWires();
            drawSource();
            drawBulb();
            drawAmmeter();
            drawLabels();
        }

        function drawWires() {
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 3;

            // Obere Leitung
            ctx.beginPath();
            ctx.moveTo(80, 80);
            ctx.lineTo(400, 80);
            ctx.stroke();

            // Rechte Leitung
            ctx.beginPath();
            ctx.moveTo(400, 80);
            ctx.lineTo(400, 280);
            ctx.stroke();

            // Untere Leitung
            ctx.beginPath();
            ctx.moveTo(400, 280);
            ctx.lineTo(80, 280);
            ctx.stroke();

            // Linke Leitung - ZWEI Segmente mit Lücke für Spannungsquelle!
            // Oberes Segment (von oben bis zum + Pol)
            ctx.beginPath();
            ctx.moveTo(80, 80);
            ctx.lineTo(80, 145);
            ctx.stroke();

            // Unteres Segment (vom - Pol nach unten)
            ctx.beginPath();
            ctx.moveTo(80, 215);
            ctx.lineTo(80, 280);
            ctx.stroke();
        }

        function drawSource() {
            var cx = 80;
            var cy = 180;

            // Hintergrund
            ctx.fillStyle = '#2a2a4a';
            ctx.fillRect(cx - 20, cy - 30, 40, 60);

            // DIN: Lange Linie = + (oben)
            ctx.strokeStyle = '#ff6666';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(cx - 15, cy - 12);
            ctx.lineTo(cx + 15, cy - 12);
            ctx.stroke();

            // DIN: Kurze dicke Linie = - (unten)
            ctx.strokeStyle = '#6699ff';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(cx - 8, cy + 12);
            ctx.lineTo(cx + 8, cy + 12);
            ctx.stroke();

            // Pole beschriften
            ctx.fillStyle = '#ff6666';
            ctx.font = 'bold 14px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('+', cx, cy - 20);

            ctx.fillStyle = '#6699ff';
            ctx.fillText('−', cx, cy + 30);

            // U-Wert
            ctx.fillStyle = '#fff';
            ctx.font = '12px sans-serif';
            ctx.fillText('U = ' + U + ' V', cx, cy + 50);
        }

        function drawBulb() {
            var cx = 240;
            var cy = 80;
            var bulbRadius = 35;

            // Glüh-Intensität basierend auf Temperatur
            var glowIntensity = Math.max(0, (T - 200) / 2400);

            // Äußerer Glow (wenn heiß)
            if (glowIntensity > 0) {
                glowPhase += 0.05;
                var pulse = 1 + Math.sin(glowPhase) * 0.1 * glowIntensity;

                // Mehrere Glow-Schichten
                for (var layer = 3; layer > 0; layer--) {
                    var radius = bulbRadius + layer * 15 * glowIntensity * pulse;
                    var alpha = glowIntensity * 0.15 / layer;
                    var grad = ctx.createRadialGradient(cx, cy, 0, cx, cy, radius);
                    grad.addColorStop(0, getGlowColor(T, alpha));
                    grad.addColorStop(1, 'rgba(0,0,0,0)');
                    ctx.fillStyle = grad;
                    ctx.beginPath();
                    ctx.arc(cx, cy, radius, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            // Glaskolben
            ctx.beginPath();
            ctx.arc(cx, cy, bulbRadius, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(40, 40, 60, 0.8)';
            ctx.fill();
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Glühwendel
            ctx.beginPath();
            ctx.moveTo(cx - 15, cy + 5);
            ctx.lineTo(cx - 10, cy - 12);
            ctx.lineTo(cx - 3, cy + 8);
            ctx.lineTo(cx + 3, cy - 10);
            ctx.lineTo(cx + 10, cy + 6);
            ctx.lineTo(cx + 15, cy - 8);
            ctx.strokeStyle = getFilamentColor(T);
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.stroke();

            // Innerer Glow um Wendel
            if (glowIntensity > 0.2) {
                ctx.shadowColor = getGlowColor(T, 1);
                ctx.shadowBlur = 20 * glowIntensity;
                ctx.beginPath();
                ctx.moveTo(cx - 15, cy + 5);
                ctx.lineTo(cx + 15, cy - 8);
                ctx.strokeStyle = getFilamentColor(T);
                ctx.lineWidth = 5;
                ctx.stroke();
                ctx.shadowBlur = 0;
            }

            // Sockel
            ctx.fillStyle = '#444';
            ctx.fillRect(cx - 12, cy + bulbRadius - 5, 24, 15);

            // Anschlüsse
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(cx - 8, cy + bulbRadius + 10);
            ctx.lineTo(cx - 8, cy + bulbRadius + 25);
            ctx.moveTo(cx + 8, cy + bulbRadius + 10);
            ctx.lineTo(cx + 8, cy + bulbRadius + 25);
            ctx.stroke();
        }

        function getFilamentColor(temp) {
            if (temp < 200) return '#333';
            if (temp < 500) return '#660000';
            if (temp < 800) return '#aa2200';
            if (temp < 1200) return '#dd4400';
            if (temp < 1800) return '#ff6600';
            if (temp < 2200) return '#ff9933';
            if (temp < 2500) return '#ffcc66';
            return '#ffffcc';
        }

        function getGlowColor(temp, alpha) {
            var r, g, b;
            if (temp < 800) {
                r = 180; g = 40; b = 20;
            } else if (temp < 1500) {
                r = 255; g = 100; b = 30;
            } else if (temp < 2200) {
                r = 255; g = 180; b = 80;
            } else {
                r = 255; g = 240; b = 200;
            }
            return 'rgba(' + r + ',' + g + ',' + b + ',' + alpha + ')';
        }

        function drawAmmeter() {
            var cx = 240;
            var cy = 280;

            // Kreis
            ctx.beginPath();
            ctx.arc(cx, cy, 22, 0, Math.PI * 2);
            ctx.fillStyle = '#2a2a4a';
            ctx.fill();
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 2;
            ctx.stroke();

            // A
            ctx.fillStyle = '#6699ff';
            ctx.font = 'bold 16px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('A', cx, cy);

            // Wert
            ctx.fillStyle = '#fff';
            ctx.font = '11px sans-serif';
            ctx.fillText('I = ' + I.toFixed(2) + ' A', cx, cy + 38);
        }

        function drawLabels() {
            if (I > 0.01) {
                // Technische Stromrichtung (rot): + → −
                ctx.fillStyle = '#ff6666';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'left';
                ctx.fillText('I →', 320, 70);

                // Elektronenfluss (blau): − → +
                ctx.fillStyle = '#6699ff';
                ctx.fillText('← e⁻', 100, 70);
            }

            // Temperatur bei der Lampe
            if (T > 200) {
                ctx.fillStyle = getFilamentColor(T);
                ctx.font = '11px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(T + ' °C', 240, 150);
            }

            // Legende unten
            ctx.fillStyle = '#888';
            ctx.font = '9px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Rot: I (+ → −)  |  Blau: e⁻ (− → +)', 100, 350);
        }

        // ============================================
        // UPDATE
        // ============================================

        function update() {
            U = parseInt(slider.value);
            var data = lampData[U];
            I = data.I;
            T = data.T;
            R = U > 0 ? (U / I) : 0;

            draw();
            updateDisplays();
            updateTable();

            requestAnimationFrame(update);
        }

        function updateDisplays() {
            document.getElementById('voltage-value').textContent = U + ' V';
            document.getElementById('disp-u').textContent = U + ' V';
            document.getElementById('disp-i').textContent = I.toFixed(2).replace('.', ',') + ' A';

            // Temperatur
            var tempPercent = Math.min(100, (T / 2800) * 100);
            document.getElementById('temp-marker').style.left = tempPercent + '%';

            var tempLabel;
            if (T < 100) tempLabel = '(kalt)';
            else if (T < 500) tempLabel = '(dunkelrot)';
            else if (T < 1000) tempLabel = '(rot)';
            else if (T < 1800) tempLabel = '(orange)';
            else if (T < 2400) tempLabel = '(gelb)';
            else tempLabel = '(weißglühend)';

            document.getElementById('temp-value').textContent = T + ' °C ' + tempLabel;
        }

        function updateTable() {
            // Highlight current row
            var rows = document.querySelectorAll('.data-table tr');
            for (var i = 1; i < rows.length; i++) {
                rows[i].classList.remove('current-row');
            }

            var currentRow = document.getElementById('row-' + U);
            if (currentRow && !recorded[U] && U > 0) {
                currentRow.classList.add('current-row');
            }

            // Enable/disable button
            var btn = document.getElementById('record-btn');
            if (U === 0) {
                btn.disabled = true;
                btn.textContent = 'Erst Spannung einstellen';
            } else if (recorded[U]) {
                btn.disabled = true;
                btn.textContent = 'Bereits aufgenommen';
            } else {
                btn.disabled = false;
                btn.textContent = 'Messwert aufnehmen';
            }
        }

        // ============================================
        // RECORD VALUE
        // ============================================

        function recordValue() {
            if (U === 0 || recorded[U]) return;

            recorded[U] = { I: I };
            recordCount++;

            var cellI = document.getElementById('i-' + U);
            cellI.textContent = I.toFixed(2).replace('.', ',');

            var row = document.getElementById('row-' + U);
            row.classList.add('recorded');
            row.classList.remove('current-row');

            document.getElementById('progress').textContent = recordCount + ' von 6 Messwerten';

            if (recordCount >= 6) {
                document.getElementById('progress').innerHTML = '<strong style="color: #b35c00;">Fertig! Zeichne die Kennlinie!</strong>';
            }
        }

        // ============================================
        // INIT
        // ============================================

        update();
    </script>
</body>
</html>
