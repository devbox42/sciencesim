<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulation: Elektronen im Metalldraht</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --physik: #2c5aa0;
            --bg: #f5f5f5;
            --white: #ffffff;
            --border: #dddddd;
            --text-primary: #222222;
            --text-secondary: #555555;
            --text-muted: #888888;
            --positive: #c62828;
            --negative: #1565c0;
            --warning: #b35c00;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            color: var(--text-primary);
            font-size: 15px;
            line-height: 1.5;
        }

        .container { max-width: 900px; margin: 0 auto; padding: 20px; }

        .fullscreen .container {
            max-width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--warning);
        }

        h1 { font-size: 1.3em; font-weight: 600; color: var(--warning); }

        .fullscreen-btn {
            background: var(--warning);
            color: white;
            border: none;
            padding: 6px 12px;
            font-size: 0.85em;
            cursor: pointer;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 260px;
            gap: 20px;
        }

        .fullscreen .main-content {
            flex: 1;
            grid-template-columns: 1fr 300px;
        }

        .sim-area {
            background: var(--white);
            border: 1px solid var(--border);
            padding: 15px;
        }

        #canvas-container {
            position: relative;
            background: #1a1a2e;
            border: 2px solid #333;
        }

        canvas {
            display: block;
            width: 100%;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .panel {
            background: var(--white);
            border: 1px solid var(--border);
            padding: 12px;
        }

        .panel h2 {
            font-size: 0.9em;
            font-weight: 600;
            color: var(--warning);
            margin-bottom: 10px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 5px;
        }

        .control-group { margin-bottom: 12px; }

        .control-group label {
            display: block;
            font-size: 0.85em;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .slider-container input[type="range"] {
            flex: 1;
            height: 6px;
            -webkit-appearance: none;
            background: var(--border);
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--warning);
            cursor: pointer;
        }

        .value-display {
            font-family: monospace;
            font-size: 1.1em;
            font-weight: 600;
            min-width: 50px;
            text-align: right;
        }

        .meter {
            background: var(--bg);
            padding: 10px;
            text-align: center;
            margin-top: 8px;
        }

        .meter-label { font-size: 0.8em; color: var(--text-muted); }
        .meter-value { font-family: monospace; font-size: 1.3em; font-weight: 600; }
        .meter-unit { font-size: 0.85em; color: var(--text-secondary); }

        .temp-meter .meter-value { color: var(--warning); }
        .collision-meter .meter-value { color: var(--positive); }

        .legend {
            background: var(--bg);
            padding: 10px;
            font-size: 0.85em;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .info-box {
            background: #fff3e0;
            border-left: 3px solid var(--warning);
            padding: 10px;
            font-size: 0.85em;
            margin-top: 15px;
        }

        .explanation {
            background: #e8f5e9;
            border: 1px solid #a5d6a7;
            padding: 10px;
            font-size: 0.85em;
            margin-top: 10px;
        }

        .explanation strong { color: #2e7d32; }

        @media (max-width: 700px) {
            .main-content { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Elektronen im Metalldraht</h1>
            <button class="fullscreen-btn" onclick="toggleFullscreen()">Vollbild</button>
        </header>

        <div class="main-content">
            <div class="sim-area">
                <div id="canvas-container">
                    <canvas id="sim-canvas" width="600" height="350"></canvas>
                </div>

                <div class="info-box">
                    <strong>Beobachte:</strong> Die Elektronen (blau) driften bei Spannung von − nach +.
                    Je heißer der Draht, desto stärker schwingen die Atomrümpfe (orange) und behindern den Elektronenfluss.
                </div>
            </div>

            <div class="sidebar">
                <div class="panel">
                    <h2>Steuerung</h2>
                    <div class="control-group">
                        <label>Spannung U:</label>
                        <div class="slider-container">
                            <input type="range" id="voltage-slider" min="0" max="12" step="1" value="0">
                            <span class="value-display" id="voltage-display">0 V</span>
                        </div>
                    </div>

                    <div class="meter temp-meter">
                        <div class="meter-label">Temperatur:</div>
                        <div class="meter-value" id="temp-display">20</div>
                        <div class="meter-unit">°C</div>
                    </div>

                    <div class="meter collision-meter">
                        <div class="meter-label">Kollisionen/s:</div>
                        <div class="meter-value" id="collision-display">0</div>
                        <div class="meter-unit">(mehr = höherer R)</div>
                    </div>
                </div>

                <div class="panel">
                    <h2>Legende</h2>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #ff6b35;"></div>
                            <span>Atomrümpfe (Metallgitter)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #1565c0;"></div>
                            <span>Elektronen (e⁻)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #ffeb3b; border: 1px solid #f9a825;"></div>
                            <span>Kollision (Stoß)</span>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="explanation">
                        <strong>Erklärung:</strong><br>
                        Je heißer der Draht, desto stärker schwingen die Atomrümpfe.
                        Die Elektronen stoßen häufiger → der Widerstand steigt!
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var canvas = document.getElementById('sim-canvas');
        var ctx = canvas.getContext('2d');
        var voltageSlider = document.getElementById('voltage-slider');
        var voltageDisplay = document.getElementById('voltage-display');
        var tempDisplay = document.getElementById('temp-display');
        var collisionDisplay = document.getElementById('collision-display');

        // Physik-Parameter
        var voltage = 0;
        var temperature = 20;
        var collisionCount = 0;
        var collisionRate = 0;
        var lastCollisionReset = Date.now();

        // Atomrümpfe (Gitter)
        var atoms = [];
        var atomRadius = 18;
        var gridSpacingX = 55;
        var gridSpacingY = 50;
        var atomBaseX = [];
        var atomBaseY = [];

        // Elektronen (konstante Dichte)
        var electrons = [];
        var electronCount = 20;  // Konstante Anzahl

        // Kollisions-Blitze
        var flashes = [];

        // Initialisiere Atomgitter
        function initAtoms() {
            atoms = [];
            atomBaseX = [];
            atomBaseY = [];
            var startX = 60;
            var startY = 70;
            var rows = 5;
            var cols = 9;

            for (var row = 0; row < rows; row++) {
                for (var col = 0; col < cols; col++) {
                    var offsetX = (row % 2) * (gridSpacingX / 2);
                    var x = startX + col * gridSpacingX + offsetX;
                    var y = startY + row * gridSpacingY;
                    atoms.push({ x: x, y: y, phase: Math.random() * Math.PI * 2 });
                    atomBaseX.push(x);
                    atomBaseY.push(y);
                }
            }
        }

        // Erstelle Elektron an Position
        function createElectron(startX) {
            var x = (startX !== undefined) ? startX : Math.random() * canvas.width;
            return {
                x: x,
                y: 70 + Math.random() * 200,
                vx: 0,
                vy: (Math.random() - 0.5) * 0.5,
                radius: 5
            };
        }

        // Initialisiere Elektronen gleichmäßig verteilt
        function initElectrons() {
            electrons = [];
            for (var i = 0; i < electronCount; i++) {
                electrons.push(createElectron());
            }
        }

        // Update Simulation
        function update() {
            var now = Date.now();

            // Kollisionsrate berechnen (pro Sekunde)
            if (now - lastCollisionReset > 1000) {
                collisionRate = collisionCount;
                collisionCount = 0;
                lastCollisionReset = now;
                collisionDisplay.textContent = collisionRate;
            }

            // Atomschwingung basierend auf Temperatur
            var amplitude = Math.max(0, (temperature - 20) / 100) * 8;
            var freq = 0.005 + temperature / 5000;

            for (var i = 0; i < atoms.length; i++) {
                atoms[i].phase += freq;
                atoms[i].x = atomBaseX[i] + Math.sin(atoms[i].phase) * amplitude;
                atoms[i].y = atomBaseY[i] + Math.cos(atoms[i].phase * 1.3) * amplitude * 0.7;
            }

            // Elektronen bewegen (konstante Anzahl)
            // Drift-Geschwindigkeit basierend auf Spannung (von − nach +, also rechts)
            var driftSpeed = voltage * 0.25;

            for (var i = 0; i < electrons.length; i++) {
                var e = electrons[i];

                // Thermische Zufallsbewegung (immer vorhanden)
                e.vx += (Math.random() - 0.5) * 0.3;
                e.vy += (Math.random() - 0.5) * 0.3;

                // Drift nach rechts bei Spannung (Elektronen: − nach +)
                e.vx += driftSpeed * 0.1;

                // Dämpfung
                e.vx *= 0.95;
                e.vy *= 0.95;

                // Position aktualisieren
                e.x += e.vx;
                e.y += e.vy;

                // Grenzen oben/unten
                if (e.y < 55) { e.y = 55; e.vy *= -0.5; }
                if (e.y > 295) { e.y = 295; e.vy *= -0.5; }

                // Kollision mit Atomen (nur bei Spannung > 0)
                if (voltage > 0) {
                    for (var j = 0; j < atoms.length; j++) {
                        var a = atoms[j];
                        var dx = e.x - a.x;
                        var dy = e.y - a.y;
                        var dist = Math.sqrt(dx * dx + dy * dy);
                        var minDist = atomRadius + e.radius + 2;

                        if (dist < minDist && dist > 0) {
                            // Kollision!
                            collisionCount++;

                            // Blitz erstellen
                            flashes.push({
                                x: (e.x + a.x) / 2,
                                y: (e.y + a.y) / 2,
                                life: 10
                            });

                            // Elektron ablenken
                            var nx = dx / dist;
                            var ny = dy / dist;
                            e.x = a.x + nx * minDist;
                            e.y = a.y + ny * minDist;

                            // Streuung
                            e.vx = nx * 1.5 + (Math.random() - 0.5);
                            e.vy = ny * 1.5 + (Math.random() - 0.5) * 2;
                        }
                    }
                }

                // Elektron am rechten Rand: links wieder einsetzen
                if (e.x > canvas.width + 5) {
                    e.x = -5;
                    e.y = 70 + Math.random() * 200;
                }
                // Elektron am linken Rand: rechts wieder einsetzen
                if (e.x < -10) {
                    e.x = canvas.width + 5;
                    e.y = 70 + Math.random() * 200;
                }
            }

            // Blitze updaten
            for (var i = flashes.length - 1; i >= 0; i--) {
                flashes[i].life--;
                if (flashes[i].life <= 0) {
                    flashes.splice(i, 1);
                }
            }
        }

        // Zeichne Simulation
        function draw() {
            // Hintergrund
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draht-Hintergrund
            ctx.fillStyle = '#2d2d44';
            ctx.fillRect(0, 40, canvas.width, 270);

            // Draht-Rand
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 2;
            ctx.strokeRect(0, 40, canvas.width, 270);

            // Pol-Beschriftung links (−) und rechts (+)
            ctx.fillStyle = '#1565c0';
            ctx.font = 'bold 16px sans-serif';
            ctx.fillText('−', 8, 180);
            ctx.fillStyle = '#c62828';
            ctx.fillText('+', canvas.width - 18, 180);

            // Technische Stromrichtung: roter Pfeil von + nach − (rechts → links)
            ctx.strokeStyle = '#c62828';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(canvas.width - 40, 25);
            ctx.lineTo(80, 25);
            ctx.stroke();
            // Pfeilspitze links
            ctx.beginPath();
            ctx.moveTo(80, 25);
            ctx.lineTo(90, 18);
            ctx.moveTo(80, 25);
            ctx.lineTo(90, 32);
            ctx.stroke();
            ctx.fillStyle = '#c62828';
            ctx.font = '11px sans-serif';
            ctx.fillText('I (techn.)', canvas.width / 2 - 25, 20);

            // Elektronen-Bewegung: blauer Pfeil von − nach + (links → rechts)
            ctx.strokeStyle = '#1565c0';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(40, 330);
            ctx.lineTo(canvas.width - 80, 330);
            ctx.stroke();
            // Pfeilspitze rechts
            ctx.beginPath();
            ctx.moveTo(canvas.width - 80, 330);
            ctx.lineTo(canvas.width - 90, 323);
            ctx.moveTo(canvas.width - 80, 330);
            ctx.lineTo(canvas.width - 90, 337);
            ctx.stroke();
            ctx.fillStyle = '#1565c0';
            ctx.font = '11px sans-serif';
            ctx.fillText('e⁻ (Elektronenfluss)', canvas.width / 2 - 50, 327);

            // Atomrümpfe zeichnen
            for (var i = 0; i < atoms.length; i++) {
                var a = atoms[i];

                // Glow bei hoher Temperatur
                if (temperature > 500) {
                    var glowSize = atomRadius + 5 + (temperature / 500) * 3;
                    var gradient = ctx.createRadialGradient(a.x, a.y, atomRadius, a.x, a.y, glowSize);
                    gradient.addColorStop(0, 'rgba(255, 150, 50, 0.4)');
                    gradient.addColorStop(1, 'rgba(255, 100, 0, 0)');
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(a.x, a.y, glowSize, 0, Math.PI * 2);
                    ctx.fill();
                }

                // Atom-Farbe basierend auf Temperatur
                var r = Math.min(255, 200 + temperature / 15);
                var g = Math.max(50, 120 - temperature / 30);
                var b = Math.max(30, 80 - temperature / 40);
                ctx.fillStyle = 'rgb(' + Math.round(r) + ',' + Math.round(g) + ',' + Math.round(b) + ')';

                ctx.beginPath();
                ctx.arc(a.x, a.y, atomRadius, 0, Math.PI * 2);
                ctx.fill();

                // Atom-Rand
                ctx.strokeStyle = 'rgba(255,255,255,0.3)';
                ctx.lineWidth = 1;
                ctx.stroke();

                // + Symbol für Atomrumpf
                ctx.fillStyle = 'rgba(255,255,255,0.6)';
                ctx.font = 'bold 12px sans-serif';
                ctx.fillText('+', a.x - 4, a.y + 4);
            }

            // Kollisions-Blitze
            for (var i = 0; i < flashes.length; i++) {
                var f = flashes[i];
                var alpha = f.life / 10;
                var size = 8 + (10 - f.life) * 2;

                ctx.fillStyle = 'rgba(255, 235, 59, ' + alpha + ')';
                ctx.beginPath();
                ctx.arc(f.x, f.y, size, 0, Math.PI * 2);
                ctx.fill();

                // Stern-Form
                ctx.strokeStyle = 'rgba(255, 255, 200, ' + alpha + ')';
                ctx.lineWidth = 2;
                ctx.beginPath();
                for (var s = 0; s < 4; s++) {
                    var angle = s * Math.PI / 2;
                    ctx.moveTo(f.x, f.y);
                    ctx.lineTo(f.x + Math.cos(angle) * size * 1.5, f.y + Math.sin(angle) * size * 1.5);
                }
                ctx.stroke();
            }

            // Elektronen zeichnen
            for (var i = 0; i < electrons.length; i++) {
                var e = electrons[i];

                // Elektron
                ctx.fillStyle = '#1976d2';
                ctx.beginPath();
                ctx.arc(e.x, e.y, e.radius, 0, Math.PI * 2);
                ctx.fill();

                // Glanz
                ctx.fillStyle = 'rgba(255,255,255,0.4)';
                ctx.beginPath();
                ctx.arc(e.x - 1, e.y - 1, e.radius * 0.4, 0, Math.PI * 2);
                ctx.fill();

                // - Symbol
                ctx.fillStyle = 'white';
                ctx.font = 'bold 8px sans-serif';
                ctx.fillText('−', e.x - 3, e.y + 3);
            }

            // Info-Text
            if (voltage === 0) {
                ctx.fillStyle = 'rgba(255,255,255,0.7)';
                ctx.font = '14px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Erhöhe die Spannung → Elektronen driften von − nach +', canvas.width / 2, canvas.height / 2);
                ctx.textAlign = 'left';
            }
        }

        // Animation Loop
        function animate() {
            update();
            draw();
            requestAnimationFrame(animate);
        }

        // Spannung ändern
        voltageSlider.addEventListener('input', function() {
            voltage = parseInt(this.value);
            voltageDisplay.textContent = voltage + ' V';

            // Temperatur berechnen (vereinfacht)
            var temps = [20, 100, 250, 450, 700, 950, 1200, 1500, 1800, 2000, 2200, 2400, 2600];
            temperature = temps[voltage] || 20;
            tempDisplay.textContent = temperature;
        });

        // Vollbild
        function toggleFullscreen() {
            document.body.classList.toggle('fullscreen');
            var btn = document.querySelector('.fullscreen-btn');
            btn.textContent = document.body.classList.contains('fullscreen') ? 'Beenden' : 'Vollbild';
        }

        // Start
        initAtoms();
        initElectrons();
        animate();
    </script>
</body>
</html>
