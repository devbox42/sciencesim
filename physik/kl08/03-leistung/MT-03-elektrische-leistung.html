<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stundenleistung: Elektrische Leistung & Energie</title>
    <style>
        /* ═══════════════════════════════════════════════════════════════════════
           MT-03 Elektrische Leistung & Energie - Klasse 8
           BE: ★ 25 | ★★ 36 | ★★★ 44
           ═══════════════════════════════════════════════════════════════════════ */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
            color: #222;
            font-size: 16px;
            line-height: 1.5;
        }
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }

        header {
            background: #2c5aa0;
            color: white;
            padding: 15px 20px;
        }
        header h1 { font-size: 1.3em; font-weight: 600; }
        .header-info { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; margin-top: 8px; }
        .header-info .meta { font-size: 0.85em; opacity: 0.9; }

        .timer-container {
            background: white;
            padding: 8px 20px;
            border-bottom: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .timer-display {
            font-size: 1.4em;
            font-weight: 600;
            font-family: "Courier New", monospace;
            color: #2c5aa0;
            min-width: 80px;
            text-align: center;
        }
        .timer-display.warning { color: #b35c00; }
        .timer-display.critical { color: #c62828; animation: pulse 1s infinite; }
        .timer-label { font-size: 0.85em; color: #666; }
        .timer-note { font-size: 0.75em; color: #888; font-style: italic; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }

        .progress-container { background: white; padding: 10px 20px; border-bottom: 1px solid #ddd; display: flex; align-items: center; gap: 15px; }
        .progress-bar { flex: 1; background: #e0e0e0; height: 8px; }
        .progress-fill { background: #2c5aa0; height: 100%; width: 0%; transition: width 0.3s; }
        .progress-text { font-size: 0.85em; color: #666; min-width: 120px; }

        .teil-header {
            background: #e3f2fd;
            border: 1px solid #2c5aa0;
            padding: 12px 20px;
            margin: 20px 0 15px 0;
            font-weight: 600;
            color: #2c5aa0;
        }

        .question { background: white; border: 1px solid #ddd; margin: 15px 0; padding: 20px; }
        .question-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; flex-wrap: wrap; gap: 8px; }
        .question-title { color: #2c5aa0; font-weight: 600; font-size: 1em; }
        .question-meta { display: flex; gap: 8px; align-items: center; }
        .question-niveau { padding: 2px 8px; font-size: 0.8em; font-weight: 600; }
        .niveau-1 { background: #e8f5e9; color: #2a7a4b; }
        .niveau-2 { background: #e3f2fd; color: #2c5aa0; }
        .niveau-3 { background: #f3e5f5; color: #7b1fa2; }
        .question-points { background: #f0f0f0; padding: 3px 10px; font-size: 0.8em; color: #666; }
        .question-text { margin-bottom: 15px; }
        .question-result { display: inline-block; padding: 3px 10px; font-size: 0.8em; font-weight: 600; margin-left: 8px; }
        .question-result.full { background: #e8f5e9; color: #2a7a4b; }
        .question-result.partial { background: #fff3e0; color: #b35c00; }
        .question-result.zero { background: #ffebee; color: #c62828; }

        .operator { color: #2c5aa0; font-weight: 600; }

        /* ISO 80000 konforme Bruchdarstellung */
        .frac {
            display: inline-block;
            vertical-align: middle;
            text-align: center;
            font-size: 0.85em;
        }
        .frac-num {
            display: block;
            border-bottom: 1px solid currentColor;
            padding: 0 3px 2px 3px;
        }
        .frac-den {
            display: block;
            padding: 2px 3px 0 3px;
        }

        .dropdown-field { margin: 15px 0; }
        .dropdown-field select { padding: 10px 15px; font-size: 1em; border: 1px solid #ddd; min-width: 250px; }

        .calc-fields { margin: 15px 0; }
        .calc-row { display: flex; align-items: center; gap: 10px; margin: 8px 0; flex-wrap: wrap; }
        .calc-row label { min-width: 120px; font-weight: 500; }
        .calc-row input { padding: 8px 12px; border: 1px solid #ddd; width: 100px; font-size: 1em; }
        .calc-row .unit { color: #666; font-size: 0.9em; }

        .matching-fields { margin: 15px 0; }
        .matching-row { display: flex; align-items: center; gap: 15px; margin: 10px 0; flex-wrap: wrap; }
        .matching-row .left { min-width: 100px; font-weight: 500; }
        .matching-row select { padding: 8px 12px; font-size: 1em; border: 1px solid #ddd; min-width: 150px; }

        .feedback-box { padding: 12px 15px; margin: 10px 0; font-size: 0.9em; display: none; }
        .feedback-box.show { display: block; }
        .feedback-box.correct { background: #e8f5e9; border-left: 3px solid #2a7a4b; }
        .feedback-box.incorrect { background: #ffebee; border-left: 3px solid #c62828; }

        .solution-box {
            background: #f0f7ff;
            border: 1px solid #2c5aa0;
            border-left: 4px solid #2c5aa0;
            padding: 12px 15px;
            margin-top: 15px;
            font-size: 0.9em;
        }
        .solution-box .solution-header {
            font-weight: 600;
            color: #2c5aa0;
            margin-bottom: 8px;
        }
        .solution-box .calculation {
            background: #fff;
            padding: 8px 12px;
            margin-top: 8px;
            font-family: "Times New Roman", Times, serif;
            border: 1px dashed #ccc;
        }

        input.correct { border-color: #2a7a4b !important; background: #e8f5e9 !important; }
        input.incorrect { border-color: #c62828 !important; background: #ffebee !important; }
        select.correct { border-color: #2a7a4b !important; background: #e8f5e9 !important; }
        select.incorrect { border-color: #c62828 !important; background: #ffebee !important; }

        .submit-section { background: white; padding: 20px; border: 1px solid #ddd; margin: 20px 0; text-align: center; }
        button { background: #2c5aa0; color: white; border: none; padding: 12px 30px; font-size: 1em; cursor: pointer; margin: 5px; }
        button:hover { background: #1e4080; }
        button:disabled { background: #aaa; cursor: not-allowed; }
        .results { background: white; border: 2px solid #2c5aa0; padding: 25px; margin: 20px 0; text-align: center; }
        .results h2 { color: #2c5aa0; margin-bottom: 15px; }
        .results .score { font-size: 3em; font-weight: bold; color: #2c5aa0; }
        .results .grade { font-size: 1.5em; margin: 10px 0; }
        .grade-table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 0.8em; }
        .grade-table th, .grade-table td { border: 1px solid #ddd; padding: 5px 6px; text-align: center; }
        .grade-table th { background: #2c5aa0; color: white; }
        .grade-table .current { background: #e8f5e9; font-weight: bold; }

        .hidden { display: none; }

        .fz { font-family: "Times New Roman", Times, serif; font-style: italic; }
        .einheit { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; font-style: normal; }

        #questionsContainer { display: none; }
        #questionsContainer.unlocked { display: block; }
        .unlock-hint {
            background: #fff3e0;
            border: 2px solid #b35c00;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            color: #b35c00;
        }

        @media print {
            button, .progress-container, .selection-row { display: none; }
            .question { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Stundenleistung: Elektrische Leistung & Energie</h1>
        <div class="header-info">
            <div class="meta">Physik Klasse 8 | Differenziert | BE: (*) 25 | (**) 36 | (***) 44</div>
        </div>
    </header>

    <div class="timer-container" id="timerContainer">
        <span class="timer-label">Verbleibende Zeit:</span>
        <span class="timer-display" id="timerDisplay">20:00</span>
        <span class="timer-note">(nur zur Orientierung)</span>
    </div>

    <div class="selection-row" style="display: flex; gap: 20px; flex-wrap: wrap; margin: 15px 20px;">
        <div class="seat-field" style="flex: 1; min-width: 280px; padding: 15px; background: #fff; border: 1px solid #ddd;">
            <label style="font-weight: 600; font-size: 0.9em; color: #2c5aa0; display: block; margin-bottom: 8px;">Platznummer:</label>
            <div id="seatWarning" style="background: #fff3e0; border: 1px solid #b35c00; padding: 8px 10px; margin-bottom: 10px; font-size: 0.8em; color: #b35c00;">
                Kann nach OK <strong>nicht mehr geändert</strong> werden!
            </div>
            <div id="seatRow" style="display: flex; align-items: center; gap: 8px;">
                <select id="seatSelect" style="padding: 8px 12px; font-size: 1em; border: 1px solid #2c5aa0; min-width: 100px;">
                    <option value="">-- wählen --</option>
                </select>
                <button id="btnSeatOk" onclick="confirmSeat()" style="padding: 8px 15px; font-size: 0.9em;">OK</button>
            </div>
            <div id="seatConfirmed" style="display: none; font-size: 1em; color: #2a7a4b; font-weight: 600;"></div>
            <input type="hidden" id="seatNumber" value="">
        </div>

        <div class="niveau-field" style="flex: 1; min-width: 280px; padding: 15px; background: #fff; border: 1px solid #ddd;">
            <label style="font-weight: 600; font-size: 0.9em; color: #2c5aa0; display: block; margin-bottom: 8px;">Niveau:</label>
            <div id="niveauWarning" style="background: #fff3e0; border: 1px solid #b35c00; padding: 8px 10px; margin-bottom: 10px; font-size: 0.8em; color: #b35c00;">
                Kann nach OK <strong>nicht mehr geändert</strong> werden!
            </div>
            <div id="niveauRow" style="display: flex; align-items: center; gap: 8px;">
                <select id="niveauSelect" style="padding: 8px 12px; font-size: 1em; border: 1px solid #2c5aa0; min-width: 180px;">
                    <option value="">-- wählen --</option>
                    <option value="1">(*) Basis (25 BE)</option>
                    <option value="2">(**) Standard (36 BE)</option>
                    <option value="3">(***) Erweitert (44 BE)</option>
                </select>
                <button id="btnNiveauOk" onclick="confirmNiveau()" style="padding: 8px 15px; font-size: 0.9em;">OK</button>
            </div>
            <div id="niveauConfirmed" style="display: none; font-size: 1em; color: #2a7a4b; font-weight: 600;"></div>
        </div>
    </div>

    <div class="progress-container">
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        <div class="progress-text" id="progressText">Niveau wählen...</div>
    </div>

    <div class="container">

        <div class="unlock-hint" id="unlockHint">
            <strong>Bitte bestätige zuerst:</strong><br>
            1. Deine Platznummer (mit OK)<br>
            2. Dein Niveau (mit OK)<br><br>
            Danach werden die Aufgaben angezeigt.
        </div>

        <div id="questionsContainer">

        <!-- ═══════════════════════════════════════════════════════════════════
             TEIL I: GRUNDLAGEN (*) - 25 BE
             ═══════════════════════════════════════════════════════════════════ -->
        <div class="teil-header">Teil I: Grundlagen (*) – 25 BE</div>

        <!-- I.1 Definition Leistung (2 BE) -->
        <div class="question" id="qI1" data-niveau="1" data-points="2">
            <div class="question-header">
                <div class="question-title">I.1</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">2 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Ergänze</span> den Lückentext zur Definition:</div>
            <p style="margin: 10px 0;">
                Die elektrische Leistung gibt an, wie viel
                <select id="qI1-a" style="padding: 5px; min-width: 100px;">
                    <option value="">--</option>
                    <option value="energie">Energie</option>
                    <option value="ladung">Ladung</option>
                    <option value="strom">Strom</option>
                </select>
                pro
                <select id="qI1-b" style="padding: 5px; min-width: 100px;">
                    <option value="">--</option>
                    <option value="meter">Meter</option>
                    <option value="sekunde">Sekunde</option>
                    <option value="volt">Volt</option>
                </select>
                umgewandelt wird.
            </p>
        </div>

        <!-- I.2 Formel P (1 BE) -->
        <div class="question" id="qI2" data-niveau="1" data-points="1">
            <div class="question-header">
                <div class="question-title">I.2</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">1 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Gib an</span>, welche Formel für die Berechnung der elektrischen Leistung gilt.</div>
            <div class="dropdown-field">
                <select id="qI2-a">
                    <option value="">-- wählen --</option>
                    <option value="ui">P = U · I</option>
                    <option value="ur">P = U ÷ R</option>
                    <option value="ri">P = R · I</option>
                    <option value="et">P = E · t</option>
                </select>
            </div>
        </div>

        <!-- I.3 Einheit Watt (1 BE) -->
        <div class="question" id="qI3" data-niveau="1" data-points="1">
            <div class="question-header">
                <div class="question-title">I.3</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">1 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Gib an</span>, wie die Einheit der elektrischen Leistung heißt.</div>
            <div class="dropdown-field">
                <select id="qI3-a">
                    <option value="">-- wählen --</option>
                    <option value="ampere">Ampere (A)</option>
                    <option value="watt">Watt (W)</option>
                    <option value="ohm">Ohm (Ω)</option>
                    <option value="joule">Joule (J)</option>
                </select>
            </div>
        </div>

        <!-- I.4 Berechnung P einfach (1 BE) -->
        <div class="question" id="qI4" data-niveau="1" data-points="1">
            <div class="question-header">
                <div class="question-title">I.4</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">1 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Berechne</span> die Leistung eines Geräts mit <span class="fz">U</span> = 12 <span class="einheit">V</span> und <span class="fz">I</span> = 4 <span class="einheit">A</span>.</div>
            <div class="calc-fields">
                <div class="calc-row">
                    <label><span class="fz">P</span> =</label>
                    <input type="text" id="qI4-a" inputmode="decimal">
                    <span class="unit">W</span>
                </div>
            </div>
        </div>

        <!-- I.5 Berechnung P (1 BE) -->
        <div class="question" id="qI5" data-niveau="1" data-points="1">
            <div class="question-header">
                <div class="question-title">I.5</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">1 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Berechne</span> die Leistung eines Heizlüfters mit <span class="fz">U</span> = 230 <span class="einheit">V</span> und <span class="fz">I</span> = 8 <span class="einheit">A</span>.</div>
            <div class="calc-fields">
                <div class="calc-row">
                    <label><span class="fz">P</span> =</label>
                    <input type="text" id="qI5-a" inputmode="decimal">
                    <span class="unit">W</span>
                </div>
            </div>
        </div>

        <!-- I.6 Formel E (1 BE) -->
        <div class="question" id="qI6" data-niveau="1" data-points="1">
            <div class="question-header">
                <div class="question-title">I.6</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">1 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Gib an</span>, welche Formel für die elektrische Energie gilt.</div>
            <div class="dropdown-field">
                <select id="qI6-a">
                    <option value="">-- wählen --</option>
                    <option value="pt">E = P · t</option>
                    <option value="ui">E = U · I</option>
                    <option value="ut">E = U · t</option>
                    <option value="pi">E = P ÷ I</option>
                </select>
            </div>
        </div>

        <!-- I.7 SI-Einheit Energie (1 BE) -->
        <div class="question" id="qI7" data-niveau="1" data-points="1">
            <div class="question-header">
                <div class="question-title">I.7</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">1 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Gib an</span>, wie die SI-Einheit der Energie heißt.</div>
            <div class="dropdown-field">
                <select id="qI7-a">
                    <option value="">-- wählen --</option>
                    <option value="watt">Watt (W)</option>
                    <option value="joule">Joule (J)</option>
                    <option value="kwh">Kilowattstunde (kWh)</option>
                    <option value="volt">Volt (V)</option>
                </select>
            </div>
        </div>

        <!-- I.8 Berechnung E einfach (1 BE) -->
        <div class="question" id="qI8" data-niveau="1" data-points="1">
            <div class="question-header">
                <div class="question-title">I.8</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">1 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Berechne</span> die Energie einer Lampe mit <span class="fz">P</span> = 50 <span class="einheit">W</span>, die <span class="fz">t</span> = 4 <span class="einheit">h</span> brennt.</div>
            <div class="calc-fields">
                <div class="calc-row">
                    <label><span class="fz">E</span> =</label>
                    <input type="text" id="qI8-a" inputmode="decimal">
                    <span class="unit">Wh</span>
                </div>
            </div>
        </div>

        <!-- I.9 Umrechnung kWh (1 BE) -->
        <div class="question" id="qI9" data-niveau="1" data-points="1">
            <div class="question-header">
                <div class="question-title">I.9</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">1 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Gib an</span>, wie viel Wh genau 1 kWh entspricht.</div>
            <div class="dropdown-field">
                <select id="qI9-a">
                    <option value="">-- wählen --</option>
                    <option value="10">10 Wh</option>
                    <option value="100">100 Wh</option>
                    <option value="1000">1000 Wh</option>
                    <option value="10000">10.000 Wh</option>
                </select>
            </div>
        </div>

        <!-- I.10 Umrechnung Wh → kWh (1 BE) -->
        <div class="question" id="qI10" data-niveau="1" data-points="1">
            <div class="question-header">
                <div class="question-title">I.10</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">1 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Rechne um</span>: 2500 Wh = ? kWh</div>
            <div class="calc-fields">
                <div class="calc-row">
                    <label>2500 Wh =</label>
                    <input type="text" id="qI10-a" inputmode="decimal">
                    <span class="unit">kWh</span>
                </div>
            </div>
        </div>

        <!-- I.11 Umrechnung kW → W (1 BE) -->
        <div class="question" id="qI11" data-niveau="1" data-points="1">
            <div class="question-header">
                <div class="question-title">I.11</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">1 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Rechne um</span>: 2,5 kW = ? W</div>
            <div class="calc-fields">
                <div class="calc-row">
                    <label>2,5 kW =</label>
                    <input type="text" id="qI11-a" inputmode="decimal">
                    <span class="unit">W</span>
                </div>
            </div>
        </div>

        <!-- I.12 Stromkosten einfach (1 BE) -->
        <div class="question" id="qI12" data-niveau="1" data-points="1">
            <div class="question-header">
                <div class="question-title">I.12</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">1 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Berechne</span> die Stromkosten für 4 kWh bei einem Preis von 30 <span class="frac"><span class="frac-num">ct</span><span class="frac-den">kWh</span></span>.</div>
            <div class="calc-fields">
                <div class="calc-row">
                    <label>Kosten =</label>
                    <input type="text" id="qI12-a" inputmode="decimal">
                    <span class="unit">ct</span>
                </div>
            </div>
        </div>

        <!-- I.13 Zuordnung (4 BE) -->
        <div class="question" id="qI13" data-niveau="1" data-points="4">
            <div class="question-header">
                <div class="question-title">I.13</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">4 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Ordne zu</span>: Welche Einheit gehört zu welcher Größe?</div>
            <div class="matching-fields">
                <div class="matching-row">
                    <span class="left">Leistung:</span>
                    <select id="qI13-a">
                        <option value="">-- wählen --</option>
                        <option value="w">Watt (W)</option>
                        <option value="j">Joule (J)</option>
                        <option value="a">Ampere (A)</option>
                        <option value="v">Volt (V)</option>
                    </select>
                </div>
                <div class="matching-row">
                    <span class="left">Energie:</span>
                    <select id="qI13-b">
                        <option value="">-- wählen --</option>
                        <option value="w">Watt (W)</option>
                        <option value="j">Joule (J)</option>
                        <option value="a">Ampere (A)</option>
                        <option value="v">Volt (V)</option>
                    </select>
                </div>
                <div class="matching-row">
                    <span class="left">Stromstärke:</span>
                    <select id="qI13-c">
                        <option value="">-- wählen --</option>
                        <option value="w">Watt (W)</option>
                        <option value="j">Joule (J)</option>
                        <option value="a">Ampere (A)</option>
                        <option value="v">Volt (V)</option>
                    </select>
                </div>
                <div class="matching-row">
                    <span class="left">Spannung:</span>
                    <select id="qI13-d">
                        <option value="">-- wählen --</option>
                        <option value="w">Watt (W)</option>
                        <option value="j">Joule (J)</option>
                        <option value="a">Ampere (A)</option>
                        <option value="v">Volt (V)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- I.14 Berechnung P (1 BE) -->
        <div class="question" id="qI14" data-niveau="1" data-points="1">
            <div class="question-header">
                <div class="question-title">I.14</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">1 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Berechne</span> die Leistung eines Geräts mit <span class="fz">U</span> = 6 <span class="einheit">V</span> und <span class="fz">I</span> = 3 <span class="einheit">A</span>.</div>
            <div class="calc-fields">
                <div class="calc-row">
                    <label><span class="fz">P</span> =</label>
                    <input type="text" id="qI14-a" inputmode="decimal">
                    <span class="unit">W</span>
                </div>
            </div>
        </div>

        <!-- I.15 Berechnung P (1 BE) -->
        <div class="question" id="qI15" data-niveau="1" data-points="1">
            <div class="question-header">
                <div class="question-title">I.15</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">1 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Berechne</span> die Leistung eines Geräts mit <span class="fz">U</span> = 24 <span class="einheit">V</span> und <span class="fz">I</span> = 2 <span class="einheit">A</span>.</div>
            <div class="calc-fields">
                <div class="calc-row">
                    <label><span class="fz">P</span> =</label>
                    <input type="text" id="qI15-a" inputmode="decimal">
                    <span class="unit">W</span>
                </div>
            </div>
        </div>

        <!-- I.16 Berechnung E (1 BE) -->
        <div class="question" id="qI16" data-niveau="1" data-points="1">
            <div class="question-header">
                <div class="question-title">I.16</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">1 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Berechne</span> die Energie einer Lampe mit <span class="fz">P</span> = 40 <span class="einheit">W</span>, die <span class="fz">t</span> = 5 <span class="einheit">h</span> brennt.</div>
            <div class="calc-fields">
                <div class="calc-row">
                    <label><span class="fz">E</span> =</label>
                    <input type="text" id="qI16-a" inputmode="decimal">
                    <span class="unit">Wh</span>
                </div>
            </div>
        </div>

        <!-- I.17 Berechnung E (1 BE) -->
        <div class="question" id="qI17" data-niveau="1" data-points="1">
            <div class="question-header">
                <div class="question-title">I.17</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">1 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Berechne</span> die Energie eines Geräts mit <span class="fz">P</span> = 200 <span class="einheit">W</span>, das <span class="fz">t</span> = 2 <span class="einheit">h</span> läuft.</div>
            <div class="calc-fields">
                <div class="calc-row">
                    <label><span class="fz">E</span> =</label>
                    <input type="text" id="qI17-a" inputmode="decimal">
                    <span class="unit">Wh</span>
                </div>
            </div>
        </div>

        <!-- I.18 Umrechnung kW → W (1 BE) -->
        <div class="question" id="qI18" data-niveau="1" data-points="1">
            <div class="question-header">
                <div class="question-title">I.18</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">1 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Rechne um</span>: 3,5 kW = ? W</div>
            <div class="calc-fields">
                <div class="calc-row">
                    <label>3,5 kW =</label>
                    <input type="text" id="qI18-a" inputmode="decimal">
                    <span class="unit">W</span>
                </div>
            </div>
        </div>

        <!-- I.19 Umrechnung Wh → kWh (1 BE) -->
        <div class="question" id="qI19" data-niveau="1" data-points="1">
            <div class="question-header">
                <div class="question-title">I.19</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">1 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Rechne um</span>: 4000 Wh = ? kWh</div>
            <div class="calc-fields">
                <div class="calc-row">
                    <label>4000 Wh =</label>
                    <input type="text" id="qI19-a" inputmode="decimal">
                    <span class="unit">kWh</span>
                </div>
            </div>
        </div>

        <!-- I.20 Stromkosten (1 BE) -->
        <div class="question" id="qI20" data-niveau="1" data-points="1">
            <div class="question-header">
                <div class="question-title">I.20</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">1 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Berechne</span> die Stromkosten für 5 kWh bei einem Preis von 30 <span class="frac"><span class="frac-num">ct</span><span class="frac-den">kWh</span></span>.</div>
            <div class="calc-fields">
                <div class="calc-row">
                    <label>Kosten =</label>
                    <input type="text" id="qI20-a" inputmode="decimal">
                    <span class="unit">ct</span>
                </div>
            </div>
        </div>

        <!-- I.21 Haushaltseinheit (1 BE) -->
        <div class="question" id="qI21" data-niveau="1" data-points="1">
            <div class="question-header">
                <div class="question-title">I.21</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">1 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Gib an</span>, welche Einheit auf Stromrechnungen für den Energieverbrauch verwendet wird.</div>
            <div class="dropdown-field">
                <select id="qI21-a">
                    <option value="">-- wählen --</option>
                    <option value="w">Watt (W)</option>
                    <option value="j">Joule (J)</option>
                    <option value="kwh">Kilowattstunde (kWh)</option>
                    <option value="ws">Wattsekunde (Ws)</option>
                </select>
            </div>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════
             TEIL II: ANWENDUNG (**) - 11 BE (kumuliert: 36 BE)
             ═══════════════════════════════════════════════════════════════════ -->
        <div class="teil-header">Teil II: Anwendung (**) – 11 BE</div>

        <!-- II.1 Energie in kWh (3 BE) -->
        <div class="question" id="qII1" data-niveau="2" data-points="3">
            <div class="question-header">
                <div class="question-title">II.1</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-2">**</span>
                    <span class="question-points">3 BE</span>
                </div>
            </div>
            <div class="question-text"><span class="operator">Berechne</span> die Energie eines Staubsaugers (<span class="fz">P</span> = 1500 <span class="einheit">W</span>), der 2 Stunden läuft. Gib das Ergebnis in Wh und kWh an.</div>
            <div class="calc-fields">
                <div class="calc-row">
                    <label><span class="fz">E</span> =</label>
                    <input type="text" id="qII1-a" inputmode="decimal">
                    <span class="unit">Wh</span>
                </div>
                <div class="calc-row">
                    <label><span class="fz">E</span> =</label>
                    <input type="text" id="qII1-b" inputmode="decimal">
                    <span class="unit">kWh</span>
                </div>
            </div>
        </div>

        <!-- II.2 Stromkosten komplett (4 BE) -->
        <div class="question" id="qII2" data-niveau="2" data-points="4">
            <div class="question-header">
                <div class="question-title">II.2</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-2">**</span>
                    <span class="question-points">4 BE</span>
                </div>
            </div>
            <div class="question-text">
                <span class="operator">Berechne</span>: Eine Waschmaschine (<span class="fz">P</span> = 2 <span class="einheit">kW</span>) läuft 1,5 h.<br>
                Strompreis: 30 <span class="frac"><span class="frac-num">ct</span><span class="frac-den">kWh</span></span>.<br><br>
                a) Wie viel Energie verbraucht sie?<br>
                b) Was kostet ein Waschgang?
            </div>
            <div class="calc-fields">
                <div class="calc-row">
                    <label>a) <span class="fz">E</span> =</label>
                    <input type="text" id="qII2-a" inputmode="decimal">
                    <span class="unit">kWh</span>
                </div>
                <div class="calc-row">
                    <label>b) Kosten =</label>
                    <input type="text" id="qII2-b" inputmode="decimal">
                    <span class="unit">ct</span>
                </div>
            </div>
        </div>

        <!-- II.3 Stromstärke berechnen (2 BE) -->
        <div class="question" id="qII3" data-niveau="2" data-points="2">
            <div class="question-header">
                <div class="question-title">II.3</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-2">**</span>
                    <span class="question-points">2 BE</span>
                </div>
            </div>
            <div class="question-text">
                <span class="operator">Berechne</span> die Stromstärke eines Staubsaugers (<span class="fz">P</span> = 1840 <span class="einheit">W</span>) bei <span class="fz">U</span> = 230 <span class="einheit">V</span>.
            </div>
            <div class="calc-fields">
                <div class="calc-row">
                    <label><span class="fz">I</span> =</label>
                    <input type="text" id="qII3-a" inputmode="decimal">
                    <span class="unit">A</span>
                </div>
            </div>
        </div>

        <!-- II.4 Zeit berechnen (2 BE) -->
        <div class="question" id="qII4" data-niveau="2" data-points="2">
            <div class="question-header">
                <div class="question-title">II.4</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-2">**</span>
                    <span class="question-points">2 BE</span>
                </div>
            </div>
            <div class="question-text">
                <span class="operator">Berechne</span>: Ein Gerät mit <span class="fz">P</span> = 2 <span class="einheit">kW</span> verbraucht <span class="fz">E</span> = 6 <span class="einheit">kWh</span>. Wie lange lief es?
            </div>
            <div class="calc-fields">
                <div class="calc-row">
                    <label><span class="fz">t</span> =</label>
                    <input type="text" id="qII4-a" inputmode="decimal">
                    <span class="unit">h</span>
                </div>
            </div>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════
             TEIL III: TRANSFER (***) - 8 BE (kumuliert: 44 BE)
             ═══════════════════════════════════════════════════════════════════ -->
        <div class="teil-header">Teil III: Transfer (***) – 8 BE</div>

        <!-- III.1 Standby-Kosten Jahr (4 BE) -->
        <div class="question" id="qIII1" data-niveau="3" data-points="4">
            <div class="question-header">
                <div class="question-title">III.1</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-3">***</span>
                    <span class="question-points">4 BE</span>
                </div>
            </div>
            <div class="question-text">
                <span class="operator">Berechne</span>: Ein Fernseher im Standby (<span class="fz">P</span> = 8 <span class="einheit">W</span>) läuft 24 h am Tag, 365 Tage im Jahr.<br>
                Strompreis: 30 <span class="frac"><span class="frac-num">ct</span><span class="frac-den">kWh</span></span>.<br><br>
                a) Energie pro Jahr in kWh (auf ganze Zahl runden)<br>
                b) Kosten pro Jahr in Euro (auf ganze Zahl runden)
            </div>
            <div class="calc-fields">
                <div class="calc-row">
                    <label>a) <span class="fz">E</span> =</label>
                    <input type="text" id="qIII1-a" inputmode="decimal">
                    <span class="unit">kWh</span>
                </div>
                <div class="calc-row">
                    <label>b) Kosten =</label>
                    <input type="text" id="qIII1-b" inputmode="decimal">
                    <span class="unit">€</span>
                </div>
            </div>
        </div>

        <!-- III.2 Vergleich (2 BE) -->
        <div class="question" id="qIII2" data-niveau="3" data-points="2">
            <div class="question-header">
                <div class="question-title">III.2</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-3">***</span>
                    <span class="question-points">2 BE</span>
                </div>
            </div>
            <div class="question-text">
                <span class="operator">Entscheide</span>: Was verbraucht im Monat (30 Tage) mehr Energie?<br><br>
                <strong>A:</strong> LED-Lampe (10 W) für 6 h pro Tag<br>
                <strong>B:</strong> Router im Dauerbetrieb (8 W, 24 h pro Tag)
            </div>
            <div class="dropdown-field">
                <select id="qIII2-a">
                    <option value="">-- wählen --</option>
                    <option value="a">A (LED-Lampe)</option>
                    <option value="b">B (Router)</option>
                    <option value="gleich">Beide gleich viel</option>
                </select>
            </div>
        </div>

        <!-- III.3 Leistung rückwärts (2 BE) -->
        <div class="question" id="qIII3" data-niveau="3" data-points="2">
            <div class="question-header">
                <div class="question-title">III.3</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-3">***</span>
                    <span class="question-points">2 BE</span>
                </div>
            </div>
            <div class="question-text">
                <span class="operator">Berechne</span>: Ein Gerät verbraucht in 5 Stunden genau 15 kWh. Welche Leistung hat es?
            </div>
            <div class="calc-fields">
                <div class="calc-row">
                    <label><span class="fz">P</span> =</label>
                    <input type="text" id="qIII3-a" inputmode="decimal">
                    <span class="unit">kW</span>
                </div>
            </div>
        </div>

        </div><!-- questionsContainer -->

        <!-- SUBMIT -->
        <div class="submit-section" id="submitSection">
            <button id="btnSubmit" onclick="submitTest()">Abgeben</button>
        </div>

        <!-- RESULTS -->
        <div class="results hidden" id="resultsSection">
            <h2>Ergebnis</h2>
            <div class="score" id="scoreDisplay">0 / 40</div>
            <div class="grade" id="gradeDisplay"></div>
            <table class="grade-table">
                <thead>
                    <tr>
                        <th>NP</th>
                        <th>14</th><th>13</th><th>12</th><th>11</th><th>10</th><th>9</th><th>8</th><th>7</th><th>6</th><th>5</th><th>4</th><th>3</th><th>2</th><th>1</th>
                    </tr>
                </thead>
                <tbody id="gradeTableBody">
                    <tr>
                        <td>%</td>
                        <td>100</td><td>96</td><td>91</td><td>86</td><td>80</td><td>73</td><td>67</td><td>60</td><td>53</td><td>47</td><td>40</td><td>33</td><td>27</td><td>20</td>
                    </tr>
                    <tr id="gradeRowBE">
                        <td>BE</td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>

    <script>
        var QUIZ_ID = 'mt-03-leistung-v3';
        var TIMER_MINUTES = 20;

        var selectedNiveau = 0;
        var seatConfirmed = false;
        var niveauConfirmed = false;
        var submitted = false;
        var timerInterval = null;
        var timeRemaining = TIMER_MINUTES * 60;
        var tabSwitches = 0;

        // Tab-Wechsel-Tracking (Anti-Cheat)
        document.addEventListener('visibilitychange', function() {
            if (document.hidden && !submitted) {
                tabSwitches++;
                saveState();
            }
        });

        // BE per niveau
        var BE_NIVEAU = {1: 25, 2: 36, 3: 44};

        // Seats 1-30
        (function() {
            var sel = document.getElementById('seatSelect');
            for (var i = 1; i <= 30; i++) {
                var opt = document.createElement('option');
                opt.value = i;
                opt.textContent = 'Platz ' + i;
                sel.appendChild(opt);
            }
        })();

        function confirmSeat() {
            var sel = document.getElementById('seatSelect');
            if (!sel.value) { alert('Bitte Platz wählen!'); return; }
            document.getElementById('seatNumber').value = sel.value;
            document.getElementById('seatRow').style.display = 'none';
            document.getElementById('seatWarning').style.display = 'none';
            document.getElementById('seatConfirmed').style.display = 'block';
            document.getElementById('seatConfirmed').textContent = 'Platz ' + sel.value + ' ✓';
            seatConfirmed = true;
            checkUnlock();
            saveState();
        }

        function confirmNiveau() {
            var sel = document.getElementById('niveauSelect');
            if (!sel.value) { alert('Bitte Niveau wählen!'); return; }
            selectedNiveau = parseInt(sel.value);
            document.getElementById('niveauRow').style.display = 'none';
            document.getElementById('niveauWarning').style.display = 'none';
            document.getElementById('niveauConfirmed').style.display = 'block';
            var labels = {1: '(*) Basis', 2: '(**) Standard', 3: '(***) Erweitert'};
            document.getElementById('niveauConfirmed').textContent = labels[selectedNiveau] + ' ✓';
            niveauConfirmed = true;
            checkUnlock();
            saveState();
        }

        function checkUnlock() {
            if (seatConfirmed && niveauConfirmed) {
                document.getElementById('unlockHint').style.display = 'none';
                document.getElementById('questionsContainer').classList.add('unlocked');
                startTimer();
                updateProgress();
            }
        }

        function startTimer() {
            if (timerInterval) return;
            timerInterval = setInterval(function() {
                timeRemaining--;
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    timeRemaining = 0;
                }
                updateTimerDisplay();
                saveState();
            }, 1000);
        }

        function updateTimerDisplay() {
            var mins = Math.floor(timeRemaining / 60);
            var secs = timeRemaining % 60;
            var display = document.getElementById('timerDisplay');
            display.textContent = mins + ':' + (secs < 10 ? '0' : '') + secs;
            display.className = 'timer-display';
            if (timeRemaining <= 60) display.classList.add('critical');
            else if (timeRemaining <= 300) display.classList.add('warning');
        }

        function updateProgress() {
            var answered = 0;
            var total = 0;
            var questions = document.querySelectorAll('.question');
            questions.forEach(function(q) {
                var qNiveau = parseInt(q.dataset.niveau);
                if (qNiveau <= selectedNiveau) {
                    total++;
                    var inputs = q.querySelectorAll('input, select');
                    var hasAnswer = false;
                    inputs.forEach(function(inp) {
                        if (inp.value && inp.value !== '') hasAnswer = true;
                    });
                    if (hasAnswer) answered++;
                }
            });
            var pct = total > 0 ? (answered / total) * 100 : 0;
            document.getElementById('progressFill').style.width = pct + '%';
            document.getElementById('progressText').textContent = answered + ' / ' + total + ' beantwortet';
        }

        function submitTest() {
            if (submitted) return;
            if (!confirm('Test wirklich abgeben?')) return;
            submitted = true;
            clearInterval(timerInterval);

            var totalScore = 0;
            var maxScore = BE_NIVEAU[selectedNiveau];

            // ═══════════════════════════════════════
            // TEIL I (25 BE)
            // ═══════════════════════════════════════

            // I.1 (2 BE) - Definition
            var s = 0;
            if (document.getElementById('qI1-a').value === 'energie') s++;
            if (document.getElementById('qI1-b').value === 'sekunde') s++;
            totalScore += s;
            showQuestionResult('qI1', s, 2);

            // I.2 (1 BE) - Formel P
            s = (document.getElementById('qI2-a').value === 'ui') ? 1 : 0;
            totalScore += s;
            showQuestionResult('qI2', s, 1);

            // I.3 (1 BE) - Einheit W
            s = (document.getElementById('qI3-a').value === 'watt') ? 1 : 0;
            totalScore += s;
            showQuestionResult('qI3', s, 1);

            // I.4 (1 BE) - 12 * 4 = 48
            var v = parseFloat(document.getElementById('qI4-a').value.replace(',', '.'));
            s = (Math.abs(v - 48) < 0.5) ? 1 : 0;
            totalScore += s;
            showQuestionResult('qI4', s, 1);
            showSolution('qI4', '<span class="fz">P</span> = <span class="fz">U</span> · <span class="fz">I</span> = 12 V · 4 A = 48 W');

            // I.5 (1 BE) - 230 * 8 = 1840
            v = parseFloat(document.getElementById('qI5-a').value.replace(',', '.'));
            s = (Math.abs(v - 1840) < 10) ? 1 : 0;
            totalScore += s;
            showQuestionResult('qI5', s, 1);
            showSolution('qI5', '<span class="fz">P</span> = <span class="fz">U</span> · <span class="fz">I</span> = 230 V · 8 A = 1840 W');

            // I.6 (1 BE) - Formel E
            s = (document.getElementById('qI6-a').value === 'pt') ? 1 : 0;
            totalScore += s;
            showQuestionResult('qI6', s, 1);

            // I.7 (1 BE) - SI-Einheit Joule
            s = (document.getElementById('qI7-a').value === 'joule') ? 1 : 0;
            totalScore += s;
            showQuestionResult('qI7', s, 1);

            // I.8 (1 BE) - 50 * 4 = 200
            v = parseFloat(document.getElementById('qI8-a').value.replace(',', '.'));
            s = (Math.abs(v - 200) < 1) ? 1 : 0;
            totalScore += s;
            showQuestionResult('qI8', s, 1);
            showSolution('qI8', '<span class="fz">E</span> = <span class="fz">P</span> · <span class="fz">t</span> = 50 W · 4 h = 200 Wh');

            // I.9 (1 BE) - 1 kWh = 1000 Wh
            s = (document.getElementById('qI9-a').value === '1000') ? 1 : 0;
            totalScore += s;
            showQuestionResult('qI9', s, 1);

            // I.10 (1 BE) - 2500 Wh = 2,5 kWh
            v = parseFloat(document.getElementById('qI10-a').value.replace(',', '.'));
            s = (Math.abs(v - 2.5) < 0.05) ? 1 : 0;
            totalScore += s;
            showQuestionResult('qI10', s, 1);
            showSolution('qI10', '2500 Wh ÷ 1000 = 2,5 kWh');

            // I.11 (1 BE) - 2,5 kW = 2500 W
            v = parseFloat(document.getElementById('qI11-a').value.replace(',', '.'));
            s = (Math.abs(v - 2500) < 1) ? 1 : 0;
            totalScore += s;
            showQuestionResult('qI11', s, 1);
            showSolution('qI11', '2,5 kW × 1000 = 2500 W');

            // I.12 (1 BE) - 4 * 30 = 120
            v = parseFloat(document.getElementById('qI12-a').value.replace(',', '.'));
            s = (Math.abs(v - 120) < 1) ? 1 : 0;
            totalScore += s;
            showQuestionResult('qI12', s, 1);
            showSolution('qI12', 'Kosten = 4 kWh · 30 <span class="frac"><span class="frac-num">ct</span><span class="frac-den">kWh</span></span> = 120 ct');

            // I.13 (4 BE) - Zuordnung
            s = 0;
            if (document.getElementById('qI13-a').value === 'w') s++;
            if (document.getElementById('qI13-b').value === 'j') s++;
            if (document.getElementById('qI13-c').value === 'a') s++;
            if (document.getElementById('qI13-d').value === 'v') s++;
            totalScore += s;
            showQuestionResult('qI13', s, 4);

            // I.14 (1 BE) - 6 * 3 = 18
            v = parseFloat(document.getElementById('qI14-a').value.replace(',', '.'));
            s = (Math.abs(v - 18) < 0.5) ? 1 : 0;
            totalScore += s;
            showQuestionResult('qI14', s, 1);
            showSolution('qI14', '<span class="fz">P</span> = <span class="fz">U</span> · <span class="fz">I</span> = 6 V · 3 A = 18 W');

            // I.15 (1 BE) - 24 * 2 = 48
            v = parseFloat(document.getElementById('qI15-a').value.replace(',', '.'));
            s = (Math.abs(v - 48) < 0.5) ? 1 : 0;
            totalScore += s;
            showQuestionResult('qI15', s, 1);
            showSolution('qI15', '<span class="fz">P</span> = <span class="fz">U</span> · <span class="fz">I</span> = 24 V · 2 A = 48 W');

            // I.16 (1 BE) - 40 * 5 = 200
            v = parseFloat(document.getElementById('qI16-a').value.replace(',', '.'));
            s = (Math.abs(v - 200) < 1) ? 1 : 0;
            totalScore += s;
            showQuestionResult('qI16', s, 1);
            showSolution('qI16', '<span class="fz">E</span> = <span class="fz">P</span> · <span class="fz">t</span> = 40 W · 5 h = 200 Wh');

            // I.17 (1 BE) - 200 * 2 = 400
            v = parseFloat(document.getElementById('qI17-a').value.replace(',', '.'));
            s = (Math.abs(v - 400) < 1) ? 1 : 0;
            totalScore += s;
            showQuestionResult('qI17', s, 1);
            showSolution('qI17', '<span class="fz">E</span> = <span class="fz">P</span> · <span class="fz">t</span> = 200 W · 2 h = 400 Wh');

            // I.18 (1 BE) - 3,5 kW = 3500 W
            v = parseFloat(document.getElementById('qI18-a').value.replace(',', '.'));
            s = (Math.abs(v - 3500) < 1) ? 1 : 0;
            totalScore += s;
            showQuestionResult('qI18', s, 1);
            showSolution('qI18', '3,5 kW × 1000 = 3500 W');

            // I.19 (1 BE) - 4000 Wh = 4 kWh
            v = parseFloat(document.getElementById('qI19-a').value.replace(',', '.'));
            s = (Math.abs(v - 4) < 0.05) ? 1 : 0;
            totalScore += s;
            showQuestionResult('qI19', s, 1);
            showSolution('qI19', '4000 Wh ÷ 1000 = 4 kWh');

            // I.20 (1 BE) - 5 * 30 = 150
            v = parseFloat(document.getElementById('qI20-a').value.replace(',', '.'));
            s = (Math.abs(v - 150) < 1) ? 1 : 0;
            totalScore += s;
            showQuestionResult('qI20', s, 1);
            showSolution('qI20', 'Kosten = 5 kWh · 30 <span class="frac"><span class="frac-num">ct</span><span class="frac-den">kWh</span></span> = 150 ct');

            // I.21 (1 BE) - kWh auf Stromrechnungen
            s = (document.getElementById('qI21-a').value === 'kwh') ? 1 : 0;
            totalScore += s;
            showQuestionResult('qI21', s, 1);

            // ═══════════════════════════════════════
            // TEIL II (11 BE) - nur wenn Niveau >= 2
            // ═══════════════════════════════════════
            if (selectedNiveau >= 2) {
                // II.1 (3 BE) - 1500 * 2 = 3000 Wh = 3 kWh
                var va = parseFloat(document.getElementById('qII1-a').value.replace(',', '.'));
                var vb = parseFloat(document.getElementById('qII1-b').value.replace(',', '.'));
                s = 0;
                if (Math.abs(va - 3000) < 1) s += 2;
                if (Math.abs(vb - 3) < 0.05) s += 1;
                totalScore += s;
                showQuestionResult('qII1', s, 3);
                showSolution('qII1', 'E = 1500 W · 2 h = 3000 Wh = 3 kWh');

                // II.2 (4 BE) - 2 * 1.5 = 3 kWh, 3 * 30 = 90 ct
                va = parseFloat(document.getElementById('qII2-a').value.replace(',', '.'));
                vb = parseFloat(document.getElementById('qII2-b').value.replace(',', '.'));
                s = 0;
                if (Math.abs(va - 3) < 0.1) s += 2;
                if (Math.abs(vb - 90) < 1) s += 2;
                totalScore += s;
                showQuestionResult('qII2', s, 4);
                showSolution('qII2', 'a) <span class="fz">E</span> = 2 kW · 1,5 h = 3 kWh<br>b) Kosten = 3 kWh · 30 <span class="frac"><span class="frac-num">ct</span><span class="frac-den">kWh</span></span> = 90 ct');

                // II.3 (2 BE) - I = 1840/230 = 8
                v = parseFloat(document.getElementById('qII3-a').value.replace(',', '.'));
                s = (Math.abs(v - 8) < 0.1) ? 2 : 0;
                totalScore += s;
                showQuestionResult('qII3', s, 2);
                showSolution('qII3', '<span class="fz">I</span> = <span class="frac"><span class="frac-num"><span class="fz">P</span></span><span class="frac-den"><span class="fz">U</span></span></span> = <span class="frac"><span class="frac-num">1840 W</span><span class="frac-den">230 V</span></span> = 8 A');

                // II.4 (2 BE) - t = 6/2 = 3
                v = parseFloat(document.getElementById('qII4-a').value.replace(',', '.'));
                s = (Math.abs(v - 3) < 0.1) ? 2 : 0;
                totalScore += s;
                showQuestionResult('qII4', s, 2);
                showSolution('qII4', '<span class="fz">t</span> = <span class="frac"><span class="frac-num"><span class="fz">E</span></span><span class="frac-den"><span class="fz">P</span></span></span> = <span class="frac"><span class="frac-num">6 kWh</span><span class="frac-den">2 kW</span></span> = 3 h');
            }

            // ═══════════════════════════════════════
            // TEIL III (8 BE) - nur wenn Niveau >= 3
            // ═══════════════════════════════════════
            if (selectedNiveau >= 3) {
                // III.1 (4 BE) - 8 W * 24 * 365 = 70080 Wh ≈ 70 kWh, 70 * 0.30 = 21 €
                va = parseFloat(document.getElementById('qIII1-a').value.replace(',', '.'));
                vb = parseFloat(document.getElementById('qIII1-b').value.replace(',', '.'));
                s = 0;
                if (Math.abs(va - 70) < 2) s += 2;
                if (Math.abs(vb - 21) < 1) s += 2;
                totalScore += s;
                showQuestionResult('qIII1', s, 4);
                showSolution('qIII1', 'a) <span class="fz">E</span> = 8 W · 24 h · 365 = 70.080 Wh ≈ 70 kWh<br>b) Kosten = 70 · 0,30 € = 21 €');

                // III.2 (2 BE) - A: 10*6*30=1800 Wh, B: 8*24*30=5760 Wh → B mehr
                s = (document.getElementById('qIII2-a').value === 'b') ? 2 : 0;
                totalScore += s;
                showQuestionResult('qIII2', s, 2);
                showSolution('qIII2', 'A: 10 W · 6 h · 30 = 1800 Wh<br>B: 8 W · 24 h · 30 = 5760 Wh<br>→ Router (B) verbraucht mehr');

                // III.3 (2 BE) - P = 15/5 = 3 kW
                v = parseFloat(document.getElementById('qIII3-a').value.replace(',', '.'));
                s = (Math.abs(v - 3) < 0.1) ? 2 : 0;
                totalScore += s;
                showQuestionResult('qIII3', s, 2);
                showSolution('qIII3', '<span class="fz">P</span> = <span class="frac"><span class="frac-num"><span class="fz">E</span></span><span class="frac-den"><span class="fz">t</span></span></span> = <span class="frac"><span class="frac-num">15 kWh</span><span class="frac-den">5 h</span></span> = 3 kW');
            }

            // Show results
            document.getElementById('submitSection').classList.add('hidden');
            document.getElementById('resultsSection').classList.remove('hidden');
            document.getElementById('scoreDisplay').textContent = totalScore + ' / ' + maxScore;

            var pct = (totalScore / maxScore) * 100;
            var np = calculateNP(pct);
            document.getElementById('gradeDisplay').textContent = np + ' NP';

            fillGradeTable(maxScore, totalScore);
            saveState();
        }

        function showQuestionResult(qId, score, max) {
            var header = document.querySelector('#' + qId + ' .question-header');
            var span = document.createElement('span');
            span.className = 'question-result';
            if (score === max) span.classList.add('full');
            else if (score > 0) span.classList.add('partial');
            else span.classList.add('zero');
            span.textContent = score + '/' + max + ' BE';
            header.appendChild(span);
        }

        function showSolution(qId, text) {
            var q = document.getElementById(qId);
            var div = document.createElement('div');
            div.className = 'solution-box';
            div.innerHTML = '<div class="solution-header">Lösung</div><div class="calculation">' + text + '</div>';
            q.appendChild(div);
        }

        function calculateNP(pct) {
            var thresholds = [100, 96, 90.67, 86, 80, 73.33, 66.67, 60, 53.33, 46.67, 40, 33.33, 26.67, 20];
            var nps = [14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1];
            for (var i = 0; i < thresholds.length; i++) {
                if (pct >= thresholds[i]) return nps[i];
            }
            return 0;
        }

        function fillGradeTable(maxBE, achieved) {
            var row = document.getElementById('gradeRowBE');
            row.innerHTML = '<td>BE</td>';
            var thresholds = [100, 96, 90.67, 86, 80, 73.33, 66.67, 60, 53.33, 46.67, 40, 33.33, 26.67, 20];
            for (var i = 0; i < thresholds.length; i++) {
                var be = Math.ceil(maxBE * thresholds[i] / 100);
                var td = document.createElement('td');
                td.textContent = be;
                if (achieved >= be && (i === 0 || achieved < Math.ceil(maxBE * thresholds[i-1] / 100))) {
                    td.classList.add('current');
                }
                row.appendChild(td);
            }
        }

        // Persistence
        function saveState() {
            var state = {
                seat: document.getElementById('seatNumber').value,
                niveau: selectedNiveau,
                seatConfirmed: seatConfirmed,
                niveauConfirmed: niveauConfirmed,
                submitted: submitted,
                timeRemaining: timeRemaining,
                tabSwitches: tabSwitches,
                answers: {}
            };
            var inputs = document.querySelectorAll('#questionsContainer input, #questionsContainer select');
            inputs.forEach(function(inp) {
                if (inp.id) state.answers[inp.id] = inp.value;
            });
            localStorage.setItem(QUIZ_ID, JSON.stringify(state));
        }

        function loadState() {
            var saved = localStorage.getItem(QUIZ_ID);
            if (!saved) return;
            try {
                var state = JSON.parse(saved);
                if (state.seatConfirmed) {
                    document.getElementById('seatNumber').value = state.seat;
                    document.getElementById('seatRow').style.display = 'none';
                    document.getElementById('seatWarning').style.display = 'none';
                    document.getElementById('seatConfirmed').style.display = 'block';
                    document.getElementById('seatConfirmed').textContent = 'Platz ' + state.seat + ' ✓';
                    seatConfirmed = true;
                }
                if (state.niveauConfirmed) {
                    selectedNiveau = state.niveau;
                    document.getElementById('niveauRow').style.display = 'none';
                    document.getElementById('niveauWarning').style.display = 'none';
                    document.getElementById('niveauConfirmed').style.display = 'block';
                    var labels = {1: '(*) Basis', 2: '(**) Standard', 3: '(***) Erweitert'};
                    document.getElementById('niveauConfirmed').textContent = labels[selectedNiveau] + ' ✓';
                    niveauConfirmed = true;
                }
                if (state.answers) {
                    for (var id in state.answers) {
                        var el = document.getElementById(id);
                        if (el) el.value = state.answers[id];
                    }
                }
                if (state.timeRemaining !== undefined) {
                    timeRemaining = state.timeRemaining;
                }
                if (state.tabSwitches !== undefined) {
                    tabSwitches = state.tabSwitches;
                }
                submitted = state.submitted || false;
                checkUnlock();
                if (submitted) {
                    submitTest();
                }
            } catch(e) {}
        }

        // Input listeners
        document.querySelectorAll('#questionsContainer input, #questionsContainer select').forEach(function(el) {
            el.addEventListener('change', function() {
                updateProgress();
                saveState();
            });
            el.addEventListener('input', function() {
                saveState();
            });
        });

        loadState();
        updateTimerDisplay();
    </script>
</body>
</html>
