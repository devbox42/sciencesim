<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stundenleistung: Verkehrssicherheit</title>
    <style>
        /* ═══════════════════════════════════════════════════════════════════════
           MINITEST: Verkehrssicherheit - Anhalteweg
           Physik Klasse 6 | Fachfarbe: #2c5aa0
           ═══════════════════════════════════════════════════════════════════════ */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
            color: #222;
            font-size: 16px;
            line-height: 1.5;
        }
        .container { max-width: 850px; margin: 0 auto; padding: 20px; }

        /* === HEADER === */
        header {
            background: #2c5aa0;
            color: white;
            padding: 15px 20px;
        }
        header h1 { font-size: 1.3em; font-weight: 600; }
        .header-info { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; margin-top: 8px; }
        .header-info .meta { font-size: 0.85em; opacity: 0.9; }

        /* === PROGRESS === */
        .progress-container { background: white; padding: 10px 20px; border-bottom: 1px solid #ddd; display: flex; align-items: center; gap: 15px; }
        .progress-bar { flex: 1; background: #e0e0e0; height: 8px; }
        .progress-fill { background: #2c5aa0; height: 100%; width: 0%; transition: width 0.3s; }
        .progress-text { font-size: 0.85em; color: #666; min-width: 120px; }

        /* === FRAGEN === */
        .question { background: white; border: 1px solid #ddd; margin: 15px 0; padding: 20px; }
        .question-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; flex-wrap: wrap; gap: 8px; }
        .question-title { color: #2c5aa0; font-weight: 600; font-size: 1em; }
        .question-meta { display: flex; gap: 8px; align-items: center; }
        .question-niveau { padding: 2px 8px; font-size: 0.8em; font-weight: 600; border-radius: 3px; }
        .niveau-1 { background: #e8f5e9; color: #2a7a4b; }
        .niveau-2 { background: #e3f2fd; color: #2c5aa0; }
        .niveau-3 { background: #f3e5f5; color: #7b1fa2; }
        .question-points { background: #f0f0f0; padding: 3px 10px; font-size: 0.8em; color: #666; }
        .question-text { margin-bottom: 15px; }
        .question-result { display: inline-block; padding: 3px 10px; font-size: 0.8em; font-weight: 600; margin-left: 8px; }
        .question-result.full { background: #e8f5e9; color: #2a7a4b; }
        .question-result.partial { background: #fff3e0; color: #b35c00; }
        .question-result.zero { background: #ffebee; color: #c62828; }

        /* === OPTIONEN === */
        .options { margin: 10px 0; }
        .option { display: block; padding: 12px 15px; margin: 6px 0; background: #fafafa; border: 1px solid #ddd; cursor: pointer; transition: all 0.15s; }
        .option:hover { background: #f0f4f8; border-color: #2c5aa0; }
        .option.selected { background: #e3f2fd; border-color: #2c5aa0; }
        .option input { display: none; }
        .option.correct { background: #e8f5e9; border-color: #2a7a4b; }
        .option.incorrect { background: #ffebee; border-color: #c62828; }
        .option.missed { background: #fff8e1; border-color: #b35c00; }

        /* Dropdown */
        select { padding: 8px 12px; font-size: 0.95em; border: 1px solid #ddd; }
        select.correct { border-color: #2a7a4b; background: #e8f5e9; }
        select.incorrect { border-color: #c62828; background: #ffebee; }

        /* === FEEDBACK === */
        .feedback-box { padding: 12px 15px; margin: 10px 0; font-size: 0.9em; display: none; }
        .feedback-box.show { display: block; }
        .feedback-box.correct { background: #e8f5e9; border-left: 3px solid #2a7a4b; }
        .feedback-box.incorrect { background: #ffebee; border-left: 3px solid #c62828; }

        /* Niveau-Hinweis */
        .niveau-hinweis { background: #fff3e0; border: 1px solid #b35c00; color: #b35c00; padding: 8px 12px; margin-bottom: 12px; font-size: 0.85em; font-style: italic; }
        .nicht-gewertet-box { background: #f5f5f5; border: 1px solid #888; color: #666; padding: 10px 15px; margin-top: 12px; text-align: center; font-weight: 600; }

        /* === SUBMIT + RESULTS === */
        .submit-section { background: white; padding: 20px; border: 1px solid #ddd; margin: 20px 0; text-align: center; }
        button { background: #2c5aa0; color: white; border: none; padding: 12px 30px; font-size: 1em; cursor: pointer; margin: 5px; }
        button:hover { background: #1e4080; }
        button:disabled { background: #aaa; cursor: not-allowed; }
        button.btn-secondary { background: #666; }
        .results { background: white; border: 2px solid #2c5aa0; padding: 25px; margin: 20px 0; text-align: center; }
        .results h2 { color: #2c5aa0; margin-bottom: 15px; }
        .results .score { font-size: 3em; font-weight: bold; color: #2c5aa0; }
        .results .grade { font-size: 1.5em; margin: 10px 0; }
        .grade-table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 0.8em; }
        .grade-table th, .grade-table td { border: 1px solid #ddd; padding: 5px 6px; text-align: center; }
        .grade-table th { background: #2c5aa0; color: white; }
        .grade-table .current { background: #e8f5e9; font-weight: bold; }

        /* Info-Box */
        .info-box { background: #fff3e0; border: 1px solid #b35c00; padding: 12px 15px; margin: 15px 0; font-size: 0.9em; }
        .info-box strong { color: #b35c00; }

        /* Bremsweg-Tabelle */
        .bremsweg-tabelle { width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 0.9em; }
        .bremsweg-tabelle th, .bremsweg-tabelle td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        .bremsweg-tabelle th { background: #e8f0fa; color: #2c5aa0; }

        .hidden { display: none; }

        /* === FRAGEN AUSBLENDEN BIS FREIGABE === */
        #questionsContainer { display: none; }
        #questionsContainer.unlocked { display: block; }
        .unlock-hint {
            background: #fff3e0;
            border: 2px solid #b35c00;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            color: #b35c00;
        }

        /* ISO 80000 Bruchdarstellung */
        .unit-frac { display: inline-block; text-align: center; vertical-align: middle; font-family: "Times New Roman", serif; }
        .unit-frac .num { display: block; border-bottom: 1px solid currentColor; padding: 0 2px; line-height: 1.1; }
        .unit-frac .den { display: block; padding: 0 2px; line-height: 1.1; }

        @media print {
            button, .progress-container, .selection-row { display: none; }
            .question { page-break-inside: avoid; }
            .niveau-hinweis { display: none; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Stundenleistung: Verkehrssicherheit</h1>
        <div class="header-info">
            <div class="meta">Physik Klasse 6 | Differenziert (★/★★/★★★)</div>
        </div>
    </header>

    <!-- ═══════════════════════════════════════════════════════════════════════
         PLATZ + NIVEAU AUSWAHL
         ═══════════════════════════════════════════════════════════════════════ -->
    <div class="selection-row" style="display: flex; gap: 20px; flex-wrap: wrap; margin: 15px 0;">
        <!-- Platz-Auswahl -->
        <div class="seat-field" style="flex: 1; min-width: 280px; padding: 15px; background: #fff; border: 1px solid #ddd;">
            <label style="font-weight: 600; font-size: 0.9em; color: #2c5aa0; display: block; margin-bottom: 8px;">Platznummer:</label>
            <div id="seatWarning" style="background: #fff3e0; border: 1px solid #b35c00; padding: 8px 10px; margin-bottom: 10px; font-size: 0.8em; color: #b35c00;">
                Kann nach OK <strong>nicht mehr geändert</strong> werden!
            </div>
            <div id="seatRow" style="display: flex; align-items: center; gap: 8px;">
                <select id="seatSelect" style="padding: 8px 12px; font-size: 1em; border: 1px solid #2c5aa0; min-width: 100px;">
                    <option value="">-- wählen --</option>
                </select>
                <button id="btnSeatOk" onclick="confirmSeat()" style="padding: 8px 15px; font-size: 0.9em;">OK</button>
            </div>
            <div id="seatConfirmed" style="display: none; font-size: 1em; color: #2a7a4b; font-weight: 600;"></div>
            <input type="hidden" id="seatNumber" value="">
        </div>

        <!-- Niveau-Auswahl -->
        <div class="niveau-field" style="flex: 1; min-width: 280px; padding: 15px; background: #fff; border: 1px solid #ddd;">
            <label style="font-weight: 600; font-size: 0.9em; color: #2c5aa0; display: block; margin-bottom: 8px;">Niveau:</label>
            <div id="niveauWarning" style="background: #fff3e0; border: 1px solid #b35c00; padding: 8px 10px; margin-bottom: 10px; font-size: 0.8em; color: #b35c00;">
                Kann nach OK <strong>nicht mehr geändert</strong> werden!
            </div>
            <div id="niveauRow" style="display: flex; align-items: center; gap: 8px;">
                <select id="niveauSelect" style="padding: 8px 12px; font-size: 1em; border: 1px solid #2c5aa0; min-width: 180px;">
                    <option value="">-- wählen --</option>
                    <option value="1">★ Basis (25 BE)</option>
                    <option value="2">★★ Standard (28 BE)</option>
                    <option value="3">★★★ Erweitert (31 BE)</option>
                </select>
                <button id="btnNiveauOk" onclick="confirmNiveau()" style="padding: 8px 15px; font-size: 0.9em;">OK</button>
            </div>
            <div id="niveauConfirmed" style="display: none; font-size: 1em; color: #2a7a4b; font-weight: 600;"></div>
        </div>
    </div>

    <div class="progress-container">
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        <div class="progress-text" id="progressText">Niveau wählen...</div>
    </div>

    <div class="container">
        <!-- ═══════════════════════════════════════════════════════════════════
             UNLOCK-HINWEIS
             ═══════════════════════════════════════════════════════════════════ -->
        <div class="unlock-hint" id="unlockHint">
            <strong>Bitte bestätige zuerst:</strong><br>
            1. Deine Platznummer (mit OK)<br>
            2. Dein Niveau (mit OK)<br><br>
            Danach werden die Aufgaben angezeigt.
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════
             FRAGEN-CONTAINER
             ═══════════════════════════════════════════════════════════════════ -->
        <div id="questionsContainer">

        <!-- Bremsweg-Tabelle für Nachschlagen -->
        <div class="info-box">
            <strong>Bremsweg-Tabelle</strong> (zum Nachschlagen)
            <table class="bremsweg-tabelle">
                <tr>
                    <th>Geschwindigkeit</th>
                    <th>Trocken</th>
                    <th>Nass</th>
                    <th>Eis</th>
                </tr>
                <tr>
                    <td>5 <span class="unit-frac"><span class="num">m</span><span class="den">s</span></span> (18 km/h)</td>
                    <td>2 m</td>
                    <td>4 m</td>
                    <td>10 m</td>
                </tr>
                <tr>
                    <td>10 <span class="unit-frac"><span class="num">m</span><span class="den">s</span></span> (36 km/h)</td>
                    <td>5 m</td>
                    <td>10 m</td>
                    <td>25 m</td>
                </tr>
                <tr>
                    <td>15 <span class="unit-frac"><span class="num">m</span><span class="den">s</span></span> (54 km/h)</td>
                    <td>10 m</td>
                    <td>20 m</td>
                    <td>50 m</td>
                </tr>
                <tr>
                    <td>20 <span class="unit-frac"><span class="num">m</span><span class="den">s</span></span> (72 km/h)</td>
                    <td>20 m</td>
                    <td>40 m</td>
                    <td>100 m</td>
                </tr>
            </table>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════
             NIVEAU 1 (★) FRAGEN - 25 BE
             ═══════════════════════════════════════════════════════════════════ -->

        <!-- Q1: Schrecksekunde (4 BE) -->
        <div class="question" id="q1" data-niveau="1" data-points="4">
            <div class="question-header">
                <div class="question-title">Frage 1: Begriffe</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">★</span>
                    <span class="question-points">4 BE</span>
                </div>
            </div>
            <div class="question-text"><strong>Ordne</strong> die Begriffe den Beschreibungen zu.</div>
            <div style="margin: 15px 0;">
                <div style="display:flex;align-items:center;gap:10px;margin:10px 0;flex-wrap:wrap;">
                    <span style="min-width:200px;">Zeit vom Erkennen bis zur Reaktion:</span>
                    <select id="q1-a" style="padding:8px;flex:1;max-width:200px;">
                        <option value="">-- wählen --</option>
                        <option value="schreck">Schrecksekunde</option>
                        <option value="reakt">Reaktionsweg</option>
                        <option value="brems">Bremsweg</option>
                        <option value="anhalt">Anhalteweg</option>
                    </select>
                </div>
                <div style="display:flex;align-items:center;gap:10px;margin:10px 0;flex-wrap:wrap;">
                    <span style="min-width:200px;">Strecke während der Reaktionszeit:</span>
                    <select id="q1-b" style="padding:8px;flex:1;max-width:200px;">
                        <option value="">-- wählen --</option>
                        <option value="schreck">Schrecksekunde</option>
                        <option value="reakt">Reaktionsweg</option>
                        <option value="brems">Bremsweg</option>
                        <option value="anhalt">Anhalteweg</option>
                    </select>
                </div>
                <div style="display:flex;align-items:center;gap:10px;margin:10px 0;flex-wrap:wrap;">
                    <span style="min-width:200px;">Strecke vom Bremsen bis zum Stillstand:</span>
                    <select id="q1-c" style="padding:8px;flex:1;max-width:200px;">
                        <option value="">-- wählen --</option>
                        <option value="schreck">Schrecksekunde</option>
                        <option value="reakt">Reaktionsweg</option>
                        <option value="brems">Bremsweg</option>
                        <option value="anhalt">Anhalteweg</option>
                    </select>
                </div>
                <div style="display:flex;align-items:center;gap:10px;margin:10px 0;flex-wrap:wrap;">
                    <span style="min-width:200px;">Gesamte Strecke bis zum Stillstand:</span>
                    <select id="q1-d" style="padding:8px;flex:1;max-width:200px;">
                        <option value="">-- wählen --</option>
                        <option value="schreck">Schrecksekunde</option>
                        <option value="reakt">Reaktionsweg</option>
                        <option value="brems">Bremsweg</option>
                        <option value="anhalt">Anhalteweg</option>
                    </select>
                </div>
            </div>
            <div class="feedback-box correct" id="q1-fb-correct">Richtig! Die vier Begriffe sind korrekt zugeordnet.</div>
            <div class="feedback-box incorrect" id="q1-fb-incorrect">Nicht alle Zuordnungen sind korrekt. Schrecksekunde = Zeit, Reaktionsweg = Strecke während Reaktion, Bremsweg = Strecke beim Bremsen, Anhalteweg = Gesamtstrecke.</div>
        </div>

        <!-- Q2: Reaktionsweg-Formel (3 BE) -->
        <div class="question" id="q2" data-niveau="1" data-points="3">
            <div class="question-header">
                <div class="question-title">Frage 2: Reaktionsweg-Formel</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">★</span>
                    <span class="question-points">3 BE</span>
                </div>
            </div>
            <div class="question-text">Welche Formel beschreibt den <strong>Reaktionsweg</strong> korrekt?</div>
            <div class="options" id="q2-options">
                <label class="option" data-value="a"><input type="radio" name="q2" value="a">s<sub>R</sub> = v + t</label>
                <label class="option" data-value="b"><input type="radio" name="q2" value="b">s<sub>R</sub> = v · t</label>
                <label class="option" data-value="c"><input type="radio" name="q2" value="c">s<sub>R</sub> = v ÷ t</label>
                <label class="option" data-value="d"><input type="radio" name="q2" value="d">s<sub>R</sub> = v - t</label>
            </div>
            <div class="feedback-box correct" id="q2-fb-correct">Richtig! Der Reaktionsweg ist s<sub>R</sub> = v · t (Geschwindigkeit mal Reaktionszeit).</div>
            <div class="feedback-box incorrect" id="q2-fb-incorrect">Falsch. Die richtige Formel ist s<sub>R</sub> = v · t. Der Reaktionsweg ist Geschwindigkeit mal Reaktionszeit.</div>
        </div>

        <!-- Q3: Reaktionsweg berechnen (6 BE) -->
        <div class="question" id="q3" data-niveau="1" data-points="6">
            <div class="question-header">
                <div class="question-title">Frage 3: Reaktionsweg berechnen</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">★</span>
                    <span class="question-points">6 BE</span>
                </div>
            </div>
            <div class="question-text"><strong>Berechne</strong> den Reaktionsweg. Die Reaktionszeit beträgt t = 1 s.</div>
            <div style="margin: 15px 0;">
                <div style="display:flex;align-items:center;gap:10px;margin:12px 0;flex-wrap:wrap;">
                    <span style="min-width:180px;">a) Fahrrad, v = 5 <span class="unit-frac"><span class="num">m</span><span class="den">s</span></span>:</span>
                    <span>s<sub>R</sub> = </span>
                    <select id="q3-a" style="padding:8px;min-width:80px;">
                        <option value="">--</option>
                        <option value="3">3</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                    </select>
                    <span>m</span>
                </div>
                <div style="display:flex;align-items:center;gap:10px;margin:12px 0;flex-wrap:wrap;">
                    <span style="min-width:180px;">b) Auto, v = 10 <span class="unit-frac"><span class="num">m</span><span class="den">s</span></span>:</span>
                    <span>s<sub>R</sub> = </span>
                    <select id="q3-b" style="padding:8px;min-width:80px;">
                        <option value="">--</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                        <option value="20">20</option>
                    </select>
                    <span>m</span>
                </div>
                <div style="display:flex;align-items:center;gap:10px;margin:12px 0;flex-wrap:wrap;">
                    <span style="min-width:180px;">c) Auto, v = 20 <span class="unit-frac"><span class="num">m</span><span class="den">s</span></span>:</span>
                    <span>s<sub>R</sub> = </span>
                    <select id="q3-c" style="padding:8px;min-width:80px;">
                        <option value="">--</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                        <option value="20">20</option>
                        <option value="25">25</option>
                    </select>
                    <span>m</span>
                </div>
            </div>
            <div class="feedback-box correct" id="q3-fb-correct">Richtig! s<sub>R</sub> = v · t: 5·1=5m, 10·1=10m, 20·1=20m</div>
            <div class="feedback-box incorrect" id="q3-fb-incorrect">Nicht alle Werte sind korrekt. Formel: s<sub>R</sub> = v · t. Bei t = 1 s ist s<sub>R</sub> = v.</div>
        </div>

        <!-- Q4: Bremsweg ablesen (4 BE) -->
        <div class="question" id="q4" data-niveau="1" data-points="4">
            <div class="question-header">
                <div class="question-title">Frage 4: Bremsweg ablesen</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">★</span>
                    <span class="question-points">4 BE</span>
                </div>
            </div>
            <div class="question-text"><strong>Lies</strong> den Bremsweg aus der Tabelle oben ab.</div>
            <div style="margin: 15px 0;">
                <div style="display:flex;align-items:center;gap:10px;margin:12px 0;flex-wrap:wrap;">
                    <span style="min-width:220px;">a) v = 10 <span class="unit-frac"><span class="num">m</span><span class="den">s</span></span>, trocken:</span>
                    <span>s<sub>B</sub> = </span>
                    <select id="q4-a" style="padding:8px;min-width:80px;">
                        <option value="">--</option>
                        <option value="2">2</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="20">20</option>
                    </select>
                    <span>m</span>
                </div>
                <div style="display:flex;align-items:center;gap:10px;margin:12px 0;flex-wrap:wrap;">
                    <span style="min-width:220px;">b) v = 10 <span class="unit-frac"><span class="num">m</span><span class="den">s</span></span>, nass:</span>
                    <span>s<sub>B</sub> = </span>
                    <select id="q4-b" style="padding:8px;min-width:80px;">
                        <option value="">--</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="20">20</option>
                        <option value="25">25</option>
                    </select>
                    <span>m</span>
                </div>
                <div style="display:flex;align-items:center;gap:10px;margin:12px 0;flex-wrap:wrap;">
                    <span style="min-width:220px;">c) v = 20 <span class="unit-frac"><span class="num">m</span><span class="den">s</span></span>, trocken:</span>
                    <span>s<sub>B</sub> = </span>
                    <select id="q4-c" style="padding:8px;min-width:80px;">
                        <option value="">--</option>
                        <option value="10">10</option>
                        <option value="20">20</option>
                        <option value="40">40</option>
                        <option value="100">100</option>
                    </select>
                    <span>m</span>
                </div>
                <div style="display:flex;align-items:center;gap:10px;margin:12px 0;flex-wrap:wrap;">
                    <span style="min-width:220px;">d) v = 20 <span class="unit-frac"><span class="num">m</span><span class="den">s</span></span>, Eis:</span>
                    <span>s<sub>B</sub> = </span>
                    <select id="q4-d" style="padding:8px;min-width:80px;">
                        <option value="">--</option>
                        <option value="20">20</option>
                        <option value="40">40</option>
                        <option value="80">80</option>
                        <option value="100">100</option>
                    </select>
                    <span>m</span>
                </div>
            </div>
            <div class="feedback-box correct" id="q4-fb-correct">Richtig abgelesen!</div>
            <div class="feedback-box incorrect" id="q4-fb-incorrect">Nicht alle Werte sind korrekt. Schau nochmal in die Tabelle: 10 m/s trocken = 5m, nass = 10m; 20 m/s trocken = 20m, Eis = 100m.</div>
        </div>

        <!-- Q5: Anhalteweg-Formel (2 BE) -->
        <div class="question" id="q5" data-niveau="1" data-points="2">
            <div class="question-header">
                <div class="question-title">Frage 5: Anhalteweg-Formel</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">★</span>
                    <span class="question-points">2 BE</span>
                </div>
            </div>
            <div class="question-text">Wie berechnet man den <strong>Anhalteweg</strong>?</div>
            <div class="options" id="q5-options">
                <label class="option" data-value="a"><input type="radio" name="q5" value="a">s<sub>A</sub> = s<sub>R</sub> - s<sub>B</sub></label>
                <label class="option" data-value="b"><input type="radio" name="q5" value="b">s<sub>A</sub> = s<sub>R</sub> + s<sub>B</sub></label>
                <label class="option" data-value="c"><input type="radio" name="q5" value="c">s<sub>A</sub> = s<sub>R</sub> · s<sub>B</sub></label>
                <label class="option" data-value="d"><input type="radio" name="q5" value="d">s<sub>A</sub> = s<sub>R</sub> ÷ s<sub>B</sub></label>
            </div>
            <div class="feedback-box correct" id="q5-fb-correct">Richtig! Der Anhalteweg ist die Summe aus Reaktionsweg und Bremsweg.</div>
            <div class="feedback-box incorrect" id="q5-fb-incorrect">Falsch. Der Anhalteweg ist s<sub>A</sub> = s<sub>R</sub> + s<sub>B</sub> (Reaktionsweg plus Bremsweg).</div>
        </div>

        <!-- Q6: Anhalteweg berechnen (6 BE) -->
        <div class="question" id="q6" data-niveau="1" data-points="6">
            <div class="question-header">
                <div class="question-title">Frage 6: Anhalteweg berechnen</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">★</span>
                    <span class="question-points">6 BE</span>
                </div>
            </div>
            <div class="question-text"><strong>Berechne</strong> den Anhalteweg. Reaktionszeit t = 1 s.</div>
            <div style="margin: 15px 0; background: #fafafa; padding: 15px;">
                <p style="margin-bottom: 10px;"><strong>Auto, v = 10 <span class="unit-frac"><span class="num">m</span><span class="den">s</span></span>, trockene Straße</strong></p>
                <div style="display:flex;align-items:center;gap:10px;margin:8px 0;flex-wrap:wrap;">
                    <span>Reaktionsweg: s<sub>R</sub> = </span>
                    <select id="q6-sr" style="padding:8px;min-width:80px;">
                        <option value="">--</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                        <option value="20">20</option>
                    </select>
                    <span>m</span>
                </div>
                <div style="display:flex;align-items:center;gap:10px;margin:8px 0;flex-wrap:wrap;">
                    <span>Bremsweg (Tabelle): s<sub>B</sub> = </span>
                    <select id="q6-sb" style="padding:8px;min-width:80px;">
                        <option value="">--</option>
                        <option value="2">2</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="20">20</option>
                    </select>
                    <span>m</span>
                </div>
                <div style="display:flex;align-items:center;gap:10px;margin:8px 0;flex-wrap:wrap;">
                    <span><strong>Anhalteweg: s<sub>A</sub> = </strong></span>
                    <select id="q6-sa" style="padding:8px;min-width:80px;">
                        <option value="">--</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                        <option value="20">20</option>
                        <option value="25">25</option>
                    </select>
                    <span><strong>m</strong></span>
                </div>
            </div>
            <div class="feedback-box correct" id="q6-fb-correct">Richtig! s<sub>R</sub> = 10·1 = 10m, s<sub>B</sub> = 5m (Tabelle), s<sub>A</sub> = 10 + 5 = 15m</div>
            <div class="feedback-box incorrect" id="q6-fb-incorrect">Nicht alle Werte sind korrekt. s<sub>R</sub> = v·t = 10·1 = 10m, s<sub>B</sub> = 5m (aus Tabelle), s<sub>A</sub> = 10 + 5 = 15m.</div>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════
             NIVEAU 2 (★★) FRAGEN - +3 BE = 28 BE
             ═══════════════════════════════════════════════════════════════════ -->

        <!-- Q7: Vergleich Geschwindigkeit (3 BE) -->
        <div class="question" id="q7" data-niveau="2" data-points="3">
            <div class="question-header">
                <div class="question-title">Frage 7: Geschwindigkeit verdoppeln</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-2">★★</span>
                    <span class="question-points">3 BE</span>
                </div>
            </div>
            <div class="question-text">Ein Auto fährt mit v = 10 <span class="unit-frac"><span class="num">m</span><span class="den">s</span></span>. Der Anhalteweg beträgt 15 m (trocken).<br><br>
            Was passiert, wenn die Geschwindigkeit <strong>verdoppelt</strong> wird (v = 20 <span class="unit-frac"><span class="num">m</span><span class="den">s</span></span>)?</div>
            <div class="options" id="q7-options">
                <label class="option" data-value="a"><input type="radio" name="q7" value="a">Der Anhalteweg verdoppelt sich auf 30 m</label>
                <label class="option" data-value="b"><input type="radio" name="q7" value="b">Der Anhalteweg wird etwa 3× so lang (ca. 40 m)</label>
                <label class="option" data-value="c"><input type="radio" name="q7" value="c">Der Anhalteweg bleibt gleich bei 15 m</label>
                <label class="option" data-value="d"><input type="radio" name="q7" value="d">Der Anhalteweg halbiert sich auf 7,5 m</label>
            </div>
            <div class="feedback-box correct" id="q7-fb-correct">Richtig! Bei v = 20 m/s: s<sub>R</sub> = 20m (verdoppelt), s<sub>B</sub> = 20m (aus Tabelle, vervierfacht!). Also s<sub>A</sub> = 40m, etwa 3× so lang wie vorher.</div>
            <div class="feedback-box incorrect" id="q7-fb-incorrect">Falsch. Bei doppelter Geschwindigkeit: Der Reaktionsweg verdoppelt sich (10→20m), aber der Bremsweg vervierfacht sich (5→20m)! Daher wird der Anhalteweg etwa 3× so lang.</div>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════
             NIVEAU 3 (★★★) FRAGEN - +3 BE = 31 BE
             ═══════════════════════════════════════════════════════════════════ -->

        <!-- Q8: Bewertung Verkehrssicherheit (3 BE) -->
        <div class="question" id="q8" data-niveau="3" data-points="3">
            <div class="question-header">
                <div class="question-title">Frage 8: Verkehrssicherheit bewerten</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-3">★★★</span>
                    <span class="question-points">3 BE</span>
                </div>
            </div>
            <div class="question-text">Du fährst mit dem Fahrrad (v = 10 <span class="unit-frac"><span class="num">m</span><span class="den">s</span></span>). Es beginnt zu regnen.<br><br>
            <strong>a)</strong> Wie verändert sich der Anhalteweg?</div>
            <div class="options" id="q8a-options">
                <label class="option" data-value="verlang"><input type="radio" name="q8a" value="verlang">Er wird länger (Bremsweg steigt)</label>
                <label class="option" data-value="gleich"><input type="radio" name="q8a" value="gleich">Er bleibt gleich</label>
                <label class="option" data-value="verkurz"><input type="radio" name="q8a" value="verkurz">Er wird kürzer</label>
            </div>
            <div style="margin-top: 15px;">
            <strong>b)</strong> Welche Maßnahme ist <strong>sinnvoll</strong>?</div>
            <div class="options" id="q8b-options">
                <label class="option" data-value="schnell"><input type="radio" name="q8b" value="schnell">Schneller fahren, um aus dem Regen zu kommen</label>
                <label class="option" data-value="langsam"><input type="radio" name="q8b" value="langsam">Langsamer fahren, um den Anhalteweg zu verkürzen</label>
                <label class="option" data-value="egal"><input type="radio" name="q8b" value="egal">Gleich weiterfahren, Regen ändert nichts</label>
            </div>
            <div class="feedback-box correct" id="q8-fb-correct">Richtig! Bei Nässe steigt der Bremsweg (und damit der Anhalteweg). Daher sollte man langsamer fahren.</div>
            <div class="feedback-box incorrect" id="q8-fb-incorrect">Nicht ganz. Bei nasser Straße ist der Bremsweg größer (siehe Tabelle: 5m → 10m bei v=10m/s). Daher sollte man langsamer fahren, um sicher anzuhalten.</div>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════
             SUBMIT SECTION
             ═══════════════════════════════════════════════════════════════════ -->
        <div class="submit-section" id="submitSection">
            <p style="margin-bottom:15px;">Überprüfe deine Antworten, bevor du abgibst.</p>
            <button onclick="submitTest()" id="submitBtn">Test abgeben</button>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════
             RESULTS SECTION
             ═══════════════════════════════════════════════════════════════════ -->
        <div class="results hidden" id="resultsSection">
            <h2>Ergebnis</h2>
            <div id="studentNameDisplay"></div>
            <div style="margin:10px 0;font-size:0.9em;" id="niveauDisplay"></div>
            <div style="margin-top:20px;">
                <div style="font-size:1.1em; font-weight:600; color:#555; margin-bottom:5px;">Erreichte Punkte:</div>
                <div class="score" id="scoreDisplay">0 / 0</div>
            </div>
            <div class="grade" id="gradeDisplay"></div>
            <table class="grade-table">
                <tr>
                    <th>NP</th><th>14</th><th>13</th><th>12</th><th>11</th><th>10</th><th>9</th><th>8</th><th>7</th><th>6</th><th>5</th><th>4</th><th>3</th><th>2</th><th>1</th>
                </tr>
                <tr>
                    <td>%</td><td>100</td><td>96</td><td>90,7</td><td>86</td><td>80</td><td>73,3</td><td>66,7</td><td>60</td><td>53,3</td><td>46,7</td><td>40</td><td>33,3</td><td>26,7</td><td>20</td>
                </tr>
                <tr id="gradeRow">
                    <td>BE</td><td id="be14">-</td><td id="be13">-</td><td id="be12">-</td><td id="be11">-</td><td id="be10">-</td><td id="be9">-</td><td id="be8">-</td><td id="be7">-</td><td id="be6">-</td><td id="be5">-</td><td id="be4">-</td><td id="be3">-</td><td id="be2">-</td><td id="be1">-</td>
                </tr>
            </table>
            <div style="background: #fff3e0; border: 2px solid #b35c00; padding: 15px; margin: 20px 0; text-align: left;">
                <strong style="color: #b35c00;">Ergebnis sichern:</strong>
                <ol style="margin: 10px 0 0 20px; line-height: 1.8;">
                    <li>Klicke auf <strong>"Drucken / PDF"</strong></li>
                    <li>Wähle <strong>"Als PDF speichern"</strong></li>
                    <li>Lade das PDF in der <strong>Bildungscloud</strong> hoch</li>
                </ol>
            </div>
            <button class="btn-secondary" onclick="window.print()">Drucken / PDF</button>
        </div>

        </div><!-- END questionsContainer -->
    </div>

    <script>
    /* ═══════════════════════════════════════════════════════════════════════════
       MINITEST: Verkehrssicherheit - JavaScript (ES5!)
       ═══════════════════════════════════════════════════════════════════════════ */

    // ===== KONFIGURATION =====
    var STORAGE_KEY = 'mt-physik-6-04-verkehrssicherheit';
    var selectedNiveau = 0;
    var testSubmitted = false;

    // Tab-Wechsel-Protokoll (Anti-Betrug)
    var tabSwitchCount = 0;
    var tabSwitchStart = 0;
    var tabSwitchSeconds = 0;

    // BE pro Niveau
    var niveauPoints = {
        1: 25,  // ★ Basis
        2: 28,  // ★★ Standard
        3: 31   // ★★★ Erweitert
    };

    // Korrekte Antworten
    var answers = {
        q1a: 'schreck',
        q1b: 'reakt',
        q1c: 'brems',
        q1d: 'anhalt',
        q2: 'b',
        q3a: '5',
        q3b: '10',
        q3c: '20',
        q4a: '5',
        q4b: '10',
        q4c: '20',
        q4d: '100',
        q5: 'b',
        q6sr: '10',
        q6sb: '5',
        q6sa: '15',
        q7: 'b',
        q8a: 'verlang',
        q8b: 'langsam'
    };

    // ===== PLATZ-FUNKTIONEN =====
    function generateSeatDropdown() {
        var select = document.getElementById('seatSelect');
        for (var i = 1; i <= 24; i++) {
            var option = document.createElement('option');
            option.value = i;
            option.textContent = 'P' + i;
            select.appendChild(option);
        }
        var saved = localStorage.getItem(STORAGE_KEY + '-seat');
        var seatLocked = localStorage.getItem(STORAGE_KEY + '-seat-locked');
        if (saved && seatLocked === 'true') showLockedSeat(saved);
        else if (saved) select.value = saved;
    }

    function confirmSeat() {
        var select = document.getElementById('seatSelect');
        var num = select.value;
        if (!num) { alert('Bitte wähle zuerst eine Platznummer!'); return; }
        var ok = confirm('Platznummer P' + num + ' bestätigen?\n\nKann NICHT mehr geändert werden!');
        if (!ok) return;
        localStorage.setItem(STORAGE_KEY + '-seat', num);
        localStorage.setItem(STORAGE_KEY + '-seat-locked', 'true');
        document.getElementById('seatNumber').value = num;
        showLockedSeat(num);
        checkUnlocked();
    }

    function showLockedSeat(num) {
        document.getElementById('seatNumber').value = num;
        document.getElementById('seatWarning').style.display = 'none';
        document.getElementById('seatRow').style.display = 'none';
        document.getElementById('seatConfirmed').style.display = 'block';
        document.getElementById('seatConfirmed').innerHTML = 'Platznummer: <strong style="color:#2c5aa0;">P' + num + '</strong> (gesperrt)';
    }

    // ===== NIVEAU-FUNKTIONEN =====
    function restoreNiveauDropdown() {
        var saved = localStorage.getItem(STORAGE_KEY + '-niveau');
        var niveauLocked = localStorage.getItem(STORAGE_KEY + '-niveau-locked');
        if (saved && niveauLocked === 'true') {
            selectedNiveau = parseInt(saved);
            showLockedNiveau(saved);
            selectNiveau(selectedNiveau);
        } else if (saved) {
            document.getElementById('niveauSelect').value = saved;
        }
    }

    function confirmNiveau() {
        var select = document.getElementById('niveauSelect');
        var val = select.value;
        if (!val) { alert('Bitte wähle zuerst ein Niveau!'); return; }
        var niveauStars = ['', '★ Basis', '★★ Standard', '★★★ Erweitert'][parseInt(val)];
        var ok = confirm('Niveau "' + niveauStars + '" bestätigen?\n\nKann NICHT mehr geändert werden!');
        if (!ok) return;
        localStorage.setItem(STORAGE_KEY + '-niveau', val);
        localStorage.setItem(STORAGE_KEY + '-niveau-locked', 'true');
        selectedNiveau = parseInt(val);
        showLockedNiveau(val);
        selectNiveau(selectedNiveau);
        checkUnlocked();
    }

    function showLockedNiveau(val) {
        var niveauStars = ['', '★ Basis (' + niveauPoints[1] + ' BE)', '★★ Standard (' + niveauPoints[2] + ' BE)', '★★★ Erweitert (' + niveauPoints[3] + ' BE)'][parseInt(val)];
        document.getElementById('niveauWarning').style.display = 'none';
        document.getElementById('niveauRow').style.display = 'none';
        document.getElementById('niveauConfirmed').style.display = 'block';
        document.getElementById('niveauConfirmed').innerHTML = 'Niveau: <strong style="color:#2c5aa0;">' + niveauStars + '</strong> (gesperrt)';
    }

    // ===== FRAGEN FREISCHALTEN =====
    function checkUnlocked() {
        var seatLocked = localStorage.getItem(STORAGE_KEY + '-seat-locked') === 'true';
        var niveauLocked = localStorage.getItem(STORAGE_KEY + '-niveau-locked') === 'true';
        var container = document.getElementById('questionsContainer');
        var hint = document.getElementById('unlockHint');

        if (seatLocked && niveauLocked) {
            container.classList.add('unlocked');
            hint.style.display = 'none';
        } else {
            container.classList.remove('unlocked');
            hint.style.display = 'block';
        }
    }

    function selectNiveau(niveau) {
        selectedNiveau = niveau;
        var questions = document.querySelectorAll('.question');
        for (var j = 0; j < questions.length; j++) {
            var qNiveau = parseInt(questions[j].dataset.niveau);
            var qId = questions[j].id;
            var existingHint = document.getElementById(qId + '-niveau-hinweis');
            if (qNiveau > niveau) {
                if (!existingHint) {
                    var hint = document.createElement('div');
                    hint.className = 'niveau-hinweis';
                    hint.id = qId + '-niveau-hinweis';
                    hint.innerHTML = 'Diese Aufgabe wird bei deinem Niveau <strong>nicht gewertet</strong>.';
                    var header = questions[j].querySelector('.question-header');
                    if (header && header.nextSibling) header.parentNode.insertBefore(hint, header.nextSibling);
                }
            } else if (existingHint) {
                existingHint.remove();
            }
        }
        updateProgress();
        saveProgress();
    }

    // ===== OPTIONS SETUP =====
    function setupOptions() {
        // Single-select (Radio)
        var optionContainers = document.querySelectorAll('.options:not(.multi-select)');
        for (var i = 0; i < optionContainers.length; i++) {
            var options = optionContainers[i].querySelectorAll('.option');
            for (var j = 0; j < options.length; j++) {
                options[j].addEventListener('click', function(e) {
                    e.preventDefault();
                    var siblings = this.parentNode.querySelectorAll('.option');
                    for (var k = 0; k < siblings.length; k++) {
                        siblings[k].classList.remove('selected');
                        var sibRadio = siblings[k].querySelector('input');
                        if (sibRadio) sibRadio.checked = false;
                    }
                    this.classList.add('selected');
                    var radio = this.querySelector('input');
                    if (radio) radio.checked = true;
                    updateProgress();
                    saveProgress();
                });
            }
        }
    }

    function setupDropdowns() {
        var dropdowns = document.querySelectorAll('select');
        for (var i = 0; i < dropdowns.length; i++) {
            if (dropdowns[i].id === 'seatSelect' || dropdowns[i].id === 'niveauSelect') continue;
            dropdowns[i].addEventListener('change', function() {
                updateProgress();
                saveProgress();
            });
        }
    }

    // ===== PROGRESS =====
    function isQuestionAnswered(qId) {
        switch(qId) {
            case 'q1':
                return document.getElementById('q1-a').value &&
                       document.getElementById('q1-b').value &&
                       document.getElementById('q1-c').value &&
                       document.getElementById('q1-d').value;
            case 'q2': return !!document.querySelector('input[name="q2"]:checked');
            case 'q3':
                return document.getElementById('q3-a').value &&
                       document.getElementById('q3-b').value &&
                       document.getElementById('q3-c').value;
            case 'q4':
                return document.getElementById('q4-a').value &&
                       document.getElementById('q4-b').value &&
                       document.getElementById('q4-c').value &&
                       document.getElementById('q4-d').value;
            case 'q5': return !!document.querySelector('input[name="q5"]:checked');
            case 'q6':
                return document.getElementById('q6-sr').value &&
                       document.getElementById('q6-sb').value &&
                       document.getElementById('q6-sa').value;
            case 'q7': return !!document.querySelector('input[name="q7"]:checked');
            case 'q8':
                return !!document.querySelector('input[name="q8a"]:checked') &&
                       !!document.querySelector('input[name="q8b"]:checked');
            default: return false;
        }
    }

    function countAnsweredQuestions() {
        if (selectedNiveau === 0) return { answered: 0, total: 0 };
        var answered = 0, total = 0;
        var questions = document.querySelectorAll('.question');
        for (var i = 0; i < questions.length; i++) {
            var qNiveau = parseInt(questions[i].dataset.niveau);
            if (qNiveau <= selectedNiveau) {
                total++;
                if (isQuestionAnswered(questions[i].id)) answered++;
            }
        }
        return { answered: answered, total: total };
    }

    function updateProgress() {
        if (selectedNiveau === 0) {
            document.getElementById('progressText').textContent = 'Niveau wählen...';
            document.getElementById('progressFill').style.width = '0%';
            return;
        }
        var status = countAnsweredQuestions();
        var percent = status.total > 0 ? (status.answered / status.total) * 100 : 0;
        document.getElementById('progressFill').style.width = percent + '%';
        document.getElementById('progressText').textContent = status.answered + ' / ' + status.total + ' beantwortet (' + niveauPoints[selectedNiveau] + ' BE)';
    }

    // ===== PERSISTENCE =====
    function saveProgress() {
        var data = { answers: collectAllAnswers(), timestamp: new Date().toISOString() };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function loadProgress() {
        var saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
            var data = JSON.parse(saved);
            if (data.answers) restoreAnswers(data.answers);
        }
    }

    function collectAllAnswers() {
        return {
            q1a: document.getElementById('q1-a').value,
            q1b: document.getElementById('q1-b').value,
            q1c: document.getElementById('q1-c').value,
            q1d: document.getElementById('q1-d').value,
            q2: getRadioValue('q2'),
            q3a: document.getElementById('q3-a').value,
            q3b: document.getElementById('q3-b').value,
            q3c: document.getElementById('q3-c').value,
            q4a: document.getElementById('q4-a').value,
            q4b: document.getElementById('q4-b').value,
            q4c: document.getElementById('q4-c').value,
            q4d: document.getElementById('q4-d').value,
            q5: getRadioValue('q5'),
            q6sr: document.getElementById('q6-sr').value,
            q6sb: document.getElementById('q6-sb').value,
            q6sa: document.getElementById('q6-sa').value,
            q7: getRadioValue('q7'),
            q8a: getRadioValue('q8a'),
            q8b: getRadioValue('q8b')
        };
    }

    function restoreAnswers(saved) {
        // Dropdowns
        var dropdowns = ['q1-a', 'q1-b', 'q1-c', 'q1-d', 'q3-a', 'q3-b', 'q3-c', 'q4-a', 'q4-b', 'q4-c', 'q4-d', 'q6-sr', 'q6-sb', 'q6-sa'];
        var keys = ['q1a', 'q1b', 'q1c', 'q1d', 'q3a', 'q3b', 'q3c', 'q4a', 'q4b', 'q4c', 'q4d', 'q6sr', 'q6sb', 'q6sa'];
        for (var i = 0; i < dropdowns.length; i++) {
            var el = document.getElementById(dropdowns[i]);
            if (el && saved[keys[i]]) el.value = saved[keys[i]];
        }
        // Radios
        var radios = ['q2', 'q5', 'q7', 'q8a', 'q8b'];
        for (var j = 0; j < radios.length; j++) {
            if (saved[radios[j]]) {
                var radio = document.querySelector('input[name="' + radios[j] + '"][value="' + saved[radios[j]] + '"]');
                if (radio) { radio.checked = true; radio.parentNode.classList.add('selected'); }
            }
        }
        updateProgress();
    }

    function getRadioValue(name) {
        var checked = document.querySelector('input[name="' + name + '"]:checked');
        return checked ? checked.value : '';
    }

    // ===== SUBMIT TEST =====
    function submitTest() {
        if (testSubmitted) return;

        var seatLocked = localStorage.getItem(STORAGE_KEY + '-seat-locked');
        var seatNum = document.getElementById('seatNumber').value;
        if (seatLocked !== 'true' || !seatNum) { alert('Bitte bestätige zuerst deine Platznummer!'); return; }

        var niveauLocked = localStorage.getItem(STORAGE_KEY + '-niveau-locked');
        if (niveauLocked !== 'true' || selectedNiveau === 0) { alert('Bitte bestätige zuerst dein Niveau!'); return; }

        testSubmitted = true;
        localStorage.setItem(STORAGE_KEY + '-submit-time', Date.now());
        var userAnswers = collectAllAnswers();
        var score = 0;
        var maxPoints = niveauPoints[selectedNiveau];

        // ===== NIVEAU 1 (★) - 25 BE =====
        if (selectedNiveau >= 1) {
            // Q1: Begriffe zuordnen (4 BE)
            var q1Score = 0;
            var q1Els = ['q1-a', 'q1-b', 'q1-c', 'q1-d'];
            var q1Keys = ['q1a', 'q1b', 'q1c', 'q1d'];
            for (var i = 0; i < q1Els.length; i++) {
                var el = document.getElementById(q1Els[i]);
                if (userAnswers[q1Keys[i]] === answers[q1Keys[i]]) {
                    q1Score++;
                    el.classList.add('correct');
                } else {
                    el.classList.add('incorrect');
                }
            }
            score += q1Score;
            showFeedback('q1', q1Score === 4);
            showQuestionResult('q1', q1Score, 4);

            // Q2: Formel (3 BE)
            var q2Correct = userAnswers.q2 === answers.q2;
            score += q2Correct ? 3 : 0;
            markRadioQuestion('q2', answers.q2, userAnswers.q2);
            showFeedback('q2', q2Correct);
            showQuestionResult('q2', q2Correct ? 3 : 0, 3);

            // Q3: Reaktionsweg berechnen (6 BE)
            var q3Score = 0;
            var q3Els = ['q3-a', 'q3-b', 'q3-c'];
            var q3Keys = ['q3a', 'q3b', 'q3c'];
            for (var j = 0; j < q3Els.length; j++) {
                var el3 = document.getElementById(q3Els[j]);
                if (userAnswers[q3Keys[j]] === answers[q3Keys[j]]) {
                    q3Score += 2;
                    el3.classList.add('correct');
                } else {
                    el3.classList.add('incorrect');
                }
            }
            score += q3Score;
            showFeedback('q3', q3Score === 6);
            showQuestionResult('q3', q3Score, 6);

            // Q4: Bremsweg ablesen (4 BE)
            var q4Score = 0;
            var q4Els = ['q4-a', 'q4-b', 'q4-c', 'q4-d'];
            var q4Keys = ['q4a', 'q4b', 'q4c', 'q4d'];
            for (var k = 0; k < q4Els.length; k++) {
                var el4 = document.getElementById(q4Els[k]);
                if (userAnswers[q4Keys[k]] === answers[q4Keys[k]]) {
                    q4Score++;
                    el4.classList.add('correct');
                } else {
                    el4.classList.add('incorrect');
                }
            }
            score += q4Score;
            showFeedback('q4', q4Score === 4);
            showQuestionResult('q4', q4Score, 4);

            // Q5: Anhalteweg-Formel (2 BE)
            var q5Correct = userAnswers.q5 === answers.q5;
            score += q5Correct ? 2 : 0;
            markRadioQuestion('q5', answers.q5, userAnswers.q5);
            showFeedback('q5', q5Correct);
            showQuestionResult('q5', q5Correct ? 2 : 0, 2);

            // Q6: Anhalteweg berechnen (6 BE)
            var q6Score = 0;
            var q6Els = ['q6-sr', 'q6-sb', 'q6-sa'];
            var q6Keys = ['q6sr', 'q6sb', 'q6sa'];
            for (var m = 0; m < q6Els.length; m++) {
                var el6 = document.getElementById(q6Els[m]);
                if (userAnswers[q6Keys[m]] === answers[q6Keys[m]]) {
                    q6Score += 2;
                    el6.classList.add('correct');
                } else {
                    el6.classList.add('incorrect');
                }
            }
            score += q6Score;
            showFeedback('q6', q6Score === 6);
            showQuestionResult('q6', q6Score, 6);
        }

        // ===== NIVEAU 2 (★★) - +3 BE =====
        var q7NotGraded = selectedNiveau < 2;
        var q7Correct = userAnswers.q7 === answers.q7;
        var q7Pts = q7Correct ? 3 : 0;
        if (!q7NotGraded) score += q7Pts;
        markRadioQuestion('q7', answers.q7, userAnswers.q7);
        showFeedback('q7', q7Correct);
        showQuestionResult('q7', q7Pts, 3, q7NotGraded);

        // ===== NIVEAU 3 (★★★) - +3 BE =====
        var q8NotGraded = selectedNiveau < 3;
        var q8Score = 0;
        // Q8a (1.5 BE) + Q8b (1.5 BE) = 3 BE
        if (userAnswers.q8a === answers.q8a) q8Score += 1.5;
        if (userAnswers.q8b === answers.q8b) q8Score += 1.5;
        q8Score = Math.round(q8Score); // 0, 2 oder 3
        if (!q8NotGraded) score += q8Score;
        // Markieren
        markRadioQuestion('q8a', answers.q8a, userAnswers.q8a);
        markRadioQuestion('q8b', answers.q8b, userAnswers.q8b);
        showFeedback('q8', q8Score === 3);
        showQuestionResult('q8', q8Score, 3, q8NotGraded);

        markNichtGewertet();
        displayResults(score, maxPoints);
    }

    // ===== HELPER FUNCTIONS =====
    function markRadioQuestion(name, correct, selected) {
        var options = document.querySelectorAll('#' + name + '-options .option');
        for (var i = 0; i < options.length; i++) {
            var val = options[i].dataset.value;
            if (val === correct) options[i].classList.add('correct');
            else if (val === selected && val !== correct) options[i].classList.add('incorrect');
        }
    }

    function showFeedback(qId, isCorrect) {
        var fbCorrect = document.getElementById(qId + '-fb-correct');
        var fbIncorrect = document.getElementById(qId + '-fb-incorrect');
        if (isCorrect && fbCorrect) fbCorrect.classList.add('show');
        else if (!isCorrect && fbIncorrect) fbIncorrect.classList.add('show');
    }

    function showQuestionResult(qId, achieved, maxPts, notGraded) {
        var question = document.getElementById(qId);
        if (!question) return;
        var meta = question.querySelector('.question-meta');
        if (!meta) return;
        var existing = meta.querySelector('.question-result');
        if (existing) existing.remove();

        var result = document.createElement('span');
        result.className = 'question-result';
        if (notGraded) {
            result.style.background = '#f0f0f0';
            result.style.color = '#888';
            result.textContent = '(' + achieved + ')/' + maxPts + ' BE';
        } else {
            if (achieved === maxPts) result.classList.add('full');
            else if (achieved > 0) result.classList.add('partial');
            else result.classList.add('zero');
            result.textContent = achieved + '/' + maxPts + ' BE';
        }
        meta.appendChild(result);
    }

    function markNichtGewertet() {
        var questions = document.querySelectorAll('.question');
        for (var i = 0; i < questions.length; i++) {
            var qNiveau = parseInt(questions[i].dataset.niveau);
            var qId = questions[i].id;
            if (qNiveau > selectedNiveau) {
                var hint = document.getElementById(qId + '-niveau-hinweis');
                if (hint) hint.remove();
                var existingBox = document.getElementById(qId + '-nicht-gewertet');
                if (!existingBox) {
                    var box = document.createElement('div');
                    box.className = 'nicht-gewertet-box';
                    box.id = qId + '-nicht-gewertet';
                    box.textContent = 'Nicht gewertet, nur informativ';
                    questions[i].appendChild(box);
                }
            }
        }
    }

    function displayResults(score, maxPoints) {
        document.getElementById('submitSection').classList.add('hidden');
        document.getElementById('resultsSection').classList.remove('hidden');
        var seatEl = document.getElementById('seatNumber');
        var platzText = (seatEl && seatEl.value) ? 'P' + seatEl.value : '—';
        var niveauStars = ['', '\u2605', '\u2605\u2605', '\u2605\u2605\u2605'][selectedNiveau];

        document.getElementById('studentNameDisplay').textContent = 'Platznummer: ' + platzText;
        document.getElementById('niveauDisplay').textContent = 'Niveau: ' + niveauStars + ' (' + maxPoints + ' BE)';
        document.getElementById('scoreDisplay').textContent = score + ' / ' + maxPoints;

        var thresholds = [100, 96, 90.67, 86, 80, 73.33, 66.67, 60, 53.33, 46.67, 40, 33.33, 26.67, 20];
        var npIds = ['be14', 'be13', 'be12', 'be11', 'be10', 'be9', 'be8', 'be7', 'be6', 'be5', 'be4', 'be3', 'be2', 'be1'];
        for (var i = 0; i < thresholds.length; i++) {
            var beExact = maxPoints * thresholds[i] / 100;
            var be = Math.ceil(beExact * 2) / 2;
            document.getElementById(npIds[i]).textContent = be;
        }

        var percent = (score / maxPoints) * 100;
        var np = 0;
        if (percent >= 100) np = 14;
        else if (percent >= 96) np = 13;
        else if (percent >= 90.67) np = 12;
        else if (percent >= 86) np = 11;
        else if (percent >= 80) np = 10;
        else if (percent >= 73.33) np = 9;
        else if (percent >= 66.67) np = 8;
        else if (percent >= 60) np = 7;
        else if (percent >= 53.33) np = 6;
        else if (percent >= 46.67) np = 5;
        else if (percent >= 40) np = 4;
        else if (percent >= 33.33) np = 3;
        else if (percent >= 26.67) np = 2;
        else if (percent >= 20) np = 1;

        document.getElementById('gradeDisplay').textContent = np + ' Notenpunkte';
        if (np > 0) {
            var cellId = 'be' + np;
            var cell = document.getElementById(cellId);
            if (cell) cell.classList.add('current');
        }

        localStorage.setItem(STORAGE_KEY + '-submitted', 'true');
        localStorage.setItem(STORAGE_KEY + '-score', score);

        // Zeitstempel + Tab-Wechsel anzeigen
        var startTS = localStorage.getItem(STORAGE_KEY + '-start');
        var submitTS = localStorage.getItem(STORAGE_KEY + '-submit-time');
        var switches = localStorage.getItem(STORAGE_KEY + '-tabswitches') || '0';
        var switchSec = localStorage.getItem(STORAGE_KEY + '-tabseconds') || '0';
        var timestampHtml = '<div style="margin-top:20px; padding:12px; background:#f5f5f5; border:1px solid #ddd; text-align:left; font-size:0.85em;">' +
            '<div><strong>Aufruf:</strong> ' + formatTimestamp(startTS) + '</div>' +
            '<div><strong>Abgabe:</strong> ' + formatTimestamp(submitTS) + '</div>' +
            '<div><strong>Tab-Wechsel:</strong> ' + switches + '× (' + formatDuration(parseInt(switchSec)) + ')</div>' +
            '</div>';
        document.getElementById('resultsSection').insertAdjacentHTML('beforeend', timestampHtml);

        disableAllInputs();
    }

    function formatTimestamp(ts) {
        if (!ts) return '—';
        var d = new Date(parseInt(ts));
        var day = d.getDate();
        var month = d.getMonth() + 1;
        var year = d.getFullYear();
        var hours = d.getHours();
        var minutes = d.getMinutes();
        return (day < 10 ? '0' : '') + day + '.' +
               (month < 10 ? '0' : '') + month + '.' + year + ' ' +
               (hours < 10 ? '0' : '') + hours + ':' +
               (minutes < 10 ? '0' : '') + minutes + ' Uhr';
    }

    function initTabSwitchTracking() {
        var savedCount = localStorage.getItem(STORAGE_KEY + '-tabswitches');
        var savedSeconds = localStorage.getItem(STORAGE_KEY + '-tabseconds');
        if (savedCount) tabSwitchCount = parseInt(savedCount);
        if (savedSeconds) tabSwitchSeconds = parseInt(savedSeconds);

        document.addEventListener('visibilitychange', function() {
            if (testSubmitted) return;
            if (document.hidden) {
                tabSwitchStart = Date.now();
                tabSwitchCount++;
                localStorage.setItem(STORAGE_KEY + '-tabswitches', tabSwitchCount);
            } else {
                if (tabSwitchStart > 0) {
                    var duration = Math.round((Date.now() - tabSwitchStart) / 1000);
                    tabSwitchSeconds += duration;
                    localStorage.setItem(STORAGE_KEY + '-tabseconds', tabSwitchSeconds);
                    tabSwitchStart = 0;
                }
            }
        });
    }

    function formatDuration(seconds) {
        if (seconds < 60) return seconds + ' Sek.';
        var min = Math.floor(seconds / 60);
        var sec = seconds % 60;
        return min + ':' + (sec < 10 ? '0' : '') + sec + ' Min.';
    }

    function disableAllInputs() {
        var radios = document.querySelectorAll('input[type="radio"]');
        for (var i = 0; i < radios.length; i++) radios[i].disabled = true;
        var selects = document.querySelectorAll('select');
        for (var k = 0; k < selects.length; k++) selects[k].disabled = true;
        var btnSeatOk = document.getElementById('btnSeatOk');
        if (btnSeatOk) btnSeatOk.disabled = true;
        var btnNiveauOk = document.getElementById('btnNiveauOk');
        if (btnNiveauOk) btnNiveauOk.disabled = true;
    }

    // ===== INIT =====
    window.onload = function() {
        var startTime = localStorage.getItem(STORAGE_KEY + '-start');
        if (!startTime) {
            localStorage.setItem(STORAGE_KEY + '-start', Date.now());
        }

        generateSeatDropdown();
        setupOptions();
        setupDropdowns();

        // WICHTIG: loadProgress() VOR restoreNiveauDropdown()
        loadProgress();

        restoreNiveauDropdown();
        updateProgress();
        checkUnlocked();
        initTabSwitchTracking();

        var submitted = localStorage.getItem(STORAGE_KEY + '-submitted');
        if (submitted === 'true') {
            submitTest();
        }
    };
    </script>
</body>
</html>
