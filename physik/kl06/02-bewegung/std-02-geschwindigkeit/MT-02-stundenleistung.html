<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stundenleistung: Bewegung</title>
    <style>
        /* ═══════════════════════════════════════════════════════════════
           MINT-MINITEST: Bewegung | Physik Klasse 6
           BE-Struktur: * = 25 BE | ** = 29 BE | *** = 35 BE
           ═══════════════════════════════════════════════════════════════ */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
            color: #222;
            font-size: 16px;
            line-height: 1.5;
        }
        .container { max-width: 850px; margin: 0 auto; padding: 20px; }

        header {
            background: #2c5aa0;
            color: white;
            padding: 15px 20px;
        }
        header h1 { font-size: 1.3em; font-weight: 600; }
        .header-info { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; margin-top: 8px; }
        .header-info .meta { font-size: 0.85em; opacity: 0.9; }

        .selection-row { display: flex; gap: 20px; flex-wrap: wrap; margin: 15px 20px; }
        .selection-field { flex: 1; min-width: 280px; padding: 15px; background: #fff; border: 1px solid #ddd; }
        .selection-field label { font-weight: 600; font-size: 0.9em; color: #2c5aa0; display: block; margin-bottom: 8px; }
        .warning-box { background: #fff3e0; border: 1px solid #b35c00; padding: 8px 10px; margin-bottom: 10px; font-size: 0.8em; color: #b35c00; }
        .confirm-row { display: flex; align-items: center; gap: 8px; }
        .confirm-row select { padding: 8px 12px; font-size: 1em; border: 1px solid #2c5aa0; min-width: 100px; }
        .confirmed-text { font-size: 1em; color: #2a7a4b; font-weight: 600; }

        .progress-container { background: white; padding: 10px 20px; border-bottom: 1px solid #ddd; display: flex; align-items: center; gap: 15px; }
        .progress-bar { flex: 1; background: #e0e0e0; height: 8px; }
        .progress-fill { background: #2c5aa0; height: 100%; width: 0%; transition: width 0.3s; }
        .progress-text { font-size: 0.85em; color: #666; min-width: 120px; }

        .question { background: white; border: 1px solid #ddd; margin: 15px 0; padding: 20px; }
        .question-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; flex-wrap: wrap; gap: 8px; }
        .question-title { color: #2c5aa0; font-weight: 600; font-size: 1em; }
        .question-meta { display: flex; gap: 8px; align-items: center; }
        .question-niveau { padding: 2px 8px; font-size: 0.8em; font-weight: 600; border-radius: 3px; }
        .niveau-1 { background: #e8f5e9; color: #2a7a4b; }
        .niveau-2 { background: #e3f2fd; color: #2c5aa0; }
        .niveau-3 { background: #f3e5f5; color: #7b1fa2; }
        .question-points { background: #f0f0f0; padding: 3px 10px; font-size: 0.8em; color: #666; }
        .question-text { margin-bottom: 15px; }
        .question-result { display: inline-block; padding: 3px 10px; font-size: 0.8em; font-weight: 600; margin-left: 8px; }
        .question-result.full { background: #e8f5e9; color: #2a7a4b; }
        .question-result.partial { background: #fff3e0; color: #b35c00; }
        .question-result.zero { background: #ffebee; color: #c62828; }

        .feedback-box { padding: 12px 15px; margin: 10px 0; font-size: 0.9em; display: none; }
        .feedback-box.show { display: block; }
        .feedback-box.correct { background: #e8f5e9; border-left: 3px solid #2a7a4b; }
        .feedback-box.incorrect { background: #ffebee; border-left: 3px solid #c62828; }

        .lueckentext { line-height: 2.2; font-size: 1em; }
        .lueckentext select {
            padding: 4px 8px;
            font-size: 0.95em;
            border: 1px solid #2c5aa0;
            border-radius: 2px;
            background: #fafafa;
            min-width: 130px;
        }
        .lueckentext select.correct { border-color: #2a7a4b; background: #e8f5e9; }
        .lueckentext select.incorrect { border-color: #c62828; background: #ffebee; }

        .zuordnung-table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
        .zuordnung-table th { background: #2c5aa0; color: white; padding: 8px 6px; text-align: center; font-size: 0.85em; }
        .zuordnung-table td { border: 1px solid #ddd; padding: 8px 6px; }
        .zuordnung-table td:first-child { font-weight: 500; }
        .zuordnung-table td:not(:first-child) { text-align: center; }
        .zuordnung-table tr:nth-child(even) { background: #fafafa; }
        .zuordnung-table input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; }
        .zuordnung-table input.correct-check { accent-color: #2a7a4b; }
        .zuordnung-table input.incorrect-check { accent-color: #c62828; outline: 2px solid #c62828; }
        .zuordnung-table input.missed-check { outline: 2px dashed #b35c00; }

        .calc-box { background: #fafafa; border: 1px solid #ddd; padding: 15px; margin: 10px 0; }
        .calc-box h4 { color: #2c5aa0; margin-bottom: 10px; font-size: 0.95em; }
        .calc-row { display: flex; align-items: center; gap: 10px; margin: 8px 0; flex-wrap: wrap; }
        .calc-row label { min-width: 80px; font-weight: 500; }
        .calc-row input[type="text"], .calc-row input[type="number"] {
            padding: 6px 10px;
            font-size: 1em;
            border: 1px solid #2c5aa0;
            width: 100px;
        }
        .calc-row input.correct { border-color: #2a7a4b; background: #e8f5e9; }
        .calc-row input.incorrect { border-color: #c62828; background: #ffebee; }
        .calc-row .unit { color: #666; font-size: 0.9em; }

        .hinweis { background: #fff3e0; border: 1px solid #b35c00; padding: 8px 12px; margin-bottom: 15px; font-size: 0.85em; color: #b35c00; }
        .tipp { background: #e3f2fd; border: 1px solid #2c5aa0; padding: 8px 12px; margin: 10px 0; font-size: 0.85em; color: #2c5aa0; }

        .submit-section { background: white; padding: 20px; border: 1px solid #ddd; margin: 20px 0; text-align: center; }
        button { background: #2c5aa0; color: white; border: none; padding: 12px 30px; font-size: 1em; cursor: pointer; margin: 5px; }
        button:hover { background: #1e4080; }
        button:disabled { background: #aaa; cursor: not-allowed; }
        button.btn-secondary { background: #666; }
        button.btn-small { padding: 8px 15px; font-size: 0.9em; }

        .results { background: white; border: 2px solid #2c5aa0; padding: 25px; margin: 20px 0; text-align: center; }
        .results h2 { color: #2c5aa0; margin-bottom: 15px; }
        .results .score { font-size: 3em; font-weight: bold; color: #2c5aa0; }
        .results .grade { font-size: 1.5em; margin: 10px 0; }
        .grade-table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 0.8em; }
        .grade-table th, .grade-table td { border: 1px solid #ddd; padding: 5px 6px; text-align: center; }
        .grade-table th { background: #2c5aa0; color: white; }
        .grade-table .current { background: #e8f5e9; font-weight: bold; }

        .hidden { display: none; }

        .teacher-section { background: #fff3e0; border: 2px dashed #b35c00; padding: 15px; margin: 20px; }
        .teacher-section h3 { color: #b35c00; margin-bottom: 10px; }

        @media print {
            button, .progress-container, .selection-row, .teacher-section { display: none; }
            .question { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Stundenleistung: Bewegung</h1>
        <div class="header-info">
            <div class="meta">Physik Klasse 6 | Offene Unterlagen erlaubt</div>
        </div>
    </header>

    <div class="selection-row">
        <div class="selection-field">
            <label>Platznummer:</label>
            <div id="seatWarning" class="warning-box">
                Kann nach OK <strong>nicht mehr geändert</strong> werden!
            </div>
            <div id="seatRow" class="confirm-row">
                <select id="seatSelect">
                    <option value="">-- wählen --</option>
                </select>
                <button class="btn-small" onclick="confirmSeat()">OK</button>
            </div>
            <div id="seatConfirmed" class="confirmed-text" style="display:none;"></div>
        </div>

        <div class="selection-field">
            <label>Dein Niveau:</label>
            <div id="niveauWarning" class="warning-box">
                Kann nach OK <strong>nicht mehr geändert</strong> werden!
            </div>
            <div id="niveauRow" class="confirm-row">
                <select id="niveauSelect">
                    <option value="">-- wählen --</option>
                    <option value="1">* Basis (25 BE)</option>
                    <option value="2">** Standard (29 BE)</option>
                    <option value="3">*** Erweitert (35 BE)</option>
                </select>
                <button class="btn-small" onclick="confirmNiveau()">OK</button>
            </div>
            <div id="niveauConfirmed" class="confirmed-text" style="display:none;"></div>
        </div>
    </div>

    <div class="progress-container">
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        <div class="progress-text" id="progressText">Niveau wählen...</div>
    </div>

    <div class="container">

        <!-- ═══════════════════════════════════════════════════════════════════════
             AUFGABE 1: Lückentext - Bewegungsarten (5 BE) - ALLE NIVEAUS
             ═══════════════════════════════════════════════════════════════════════ -->
        <div class="question" id="q1" data-niveau="1" data-points="5">
            <div class="question-header">
                <div class="question-title">Aufgabe 1: Bewegung beschreiben</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">5 BE</span>
                </div>
            </div>
            <div class="question-text">Ergänze den Lückentext.</div>
            <div class="lueckentext">
                Ein Körper ist in Bewegung, wenn er seinen
                <select id="q1-a"><option value="">---</option><option value="ort">Ort</option><option value="namen">Namen</option><option value="zustand">Zustand</option></select>
                verändert. Die
                <select id="q1-b"><option value="">---</option><option value="bahnform">Bahnform</option><option value="farbe">Farbe</option><option value="geschwindigkeit">Geschwindigkeit</option></select>
                beschreibt, wie der Weg aussieht (gerade oder krummlinig). Die
                <select id="q1-c"><option value="">---</option><option value="bewegungsart">Bewegungsart</option><option value="bahnform">Bahnform</option><option value="richtung">Richtung</option></select>
                sagt, ob die Geschwindigkeit gleich bleibt oder sich ändert.

                Eine Bewegung auf einer geraden Linie heißt
                <select id="q1-d"><option value="">---</option><option value="geradlinig">geradlinig</option><option value="krummlinig">krummlinig</option><option value="kreisfoermig">kreisförmig</option></select>.
                Eine kreisförmige Bewegung ist ein Sonderfall von
                <select id="q1-e"><option value="">---</option><option value="geradlinig">geradlinig</option><option value="krummlinig">krummlinig</option><option value="gleichfoermig">gleichförmig</option></select>.
            </div>
            <div class="feedback-box correct" id="q1-fb-correct">Richtig! Du kennst die Grundbegriffe der Bewegung.</div>
            <div class="feedback-box incorrect" id="q1-fb-incorrect">Schau in dein Lernblatt: Kasten 1 und 2 helfen dir!</div>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════════
             AUFGABE 2: Zuordnungstabelle (12 BE = 6 Beispiele × 2) - ALLE NIVEAUS
             ═══════════════════════════════════════════════════════════════════════ -->
        <div class="question" id="q2" data-niveau="1" data-points="12">
            <div class="question-header">
                <div class="question-title">Aufgabe 2: Bewegungen zuordnen</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">12 BE</span>
                </div>
            </div>
            <div class="question-text">Kreuze für jedes Beispiel <strong>genau 2 Kästchen</strong> an: eine Bahnform und eine Bewegungsart.</div>
            <div class="hinweis">Tipp: Kreisförmige Bewegungen sind immer krummlinig!</div>
            <table class="zuordnung-table">
                <thead>
                    <tr>
                        <th style="width:38%;">Beispiel</th>
                        <th>gerad-<br>linig</th>
                        <th>krumm-<br>linig</th>
                        <th>gleich-<br>förmig</th>
                        <th>ungleich-<br>förmig</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-correct="geradlinig,gleichfoermig">
                        <td>a) Rolltreppe (konstante Geschwindigkeit)</td>
                        <td><input type="checkbox" name="q2a-bahn" value="geradlinig"></td>
                        <td><input type="checkbox" name="q2a-bahn" value="krummlinig"></td>
                        <td><input type="checkbox" name="q2a-art" value="gleichfoermig"></td>
                        <td><input type="checkbox" name="q2a-art" value="ungleichfoermig"></td>
                    </tr>
                    <tr data-correct="krummlinig,gleichfoermig">
                        <td>b) Karussell (dreht sich gleichmäßig)</td>
                        <td><input type="checkbox" name="q2b-bahn" value="geradlinig"></td>
                        <td><input type="checkbox" name="q2b-bahn" value="krummlinig"></td>
                        <td><input type="checkbox" name="q2b-art" value="gleichfoermig"></td>
                        <td><input type="checkbox" name="q2b-art" value="ungleichfoermig"></td>
                    </tr>
                    <tr data-correct="geradlinig,ungleichfoermig">
                        <td>c) Auto bremst vor der Ampel</td>
                        <td><input type="checkbox" name="q2c-bahn" value="geradlinig"></td>
                        <td><input type="checkbox" name="q2c-bahn" value="krummlinig"></td>
                        <td><input type="checkbox" name="q2c-art" value="gleichfoermig"></td>
                        <td><input type="checkbox" name="q2c-art" value="ungleichfoermig"></td>
                    </tr>
                    <tr data-correct="krummlinig,ungleichfoermig">
                        <td>d) Schaukel (hin und her)</td>
                        <td><input type="checkbox" name="q2d-bahn" value="geradlinig"></td>
                        <td><input type="checkbox" name="q2d-bahn" value="krummlinig"></td>
                        <td><input type="checkbox" name="q2d-art" value="gleichfoermig"></td>
                        <td><input type="checkbox" name="q2d-art" value="ungleichfoermig"></td>
                    </tr>
                    <tr data-correct="geradlinig,ungleichfoermig">
                        <td>e) Stein fällt vom Baum</td>
                        <td><input type="checkbox" name="q2e-bahn" value="geradlinig"></td>
                        <td><input type="checkbox" name="q2e-bahn" value="krummlinig"></td>
                        <td><input type="checkbox" name="q2e-art" value="gleichfoermig"></td>
                        <td><input type="checkbox" name="q2e-art" value="ungleichfoermig"></td>
                    </tr>
                    <tr data-correct="krummlinig,gleichfoermig">
                        <td>f) Minutenzeiger einer Uhr</td>
                        <td><input type="checkbox" name="q2f-bahn" value="geradlinig"></td>
                        <td><input type="checkbox" name="q2f-bahn" value="krummlinig"></td>
                        <td><input type="checkbox" name="q2f-art" value="gleichfoermig"></td>
                        <td><input type="checkbox" name="q2f-art" value="ungleichfoermig"></td>
                    </tr>
                </tbody>
            </table>
            <div class="feedback-box correct" id="q2-fb-correct">Alle richtig zugeordnet!</div>
            <div class="feedback-box incorrect" id="q2-fb-incorrect">Einige Zuordnungen stimmen nicht. Denke daran: Kreisförmig = krummlinig!</div>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════════
             AUFGABE 3: Geschwindigkeit berechnen (8 BE) - ALLE NIVEAUS
             ═══════════════════════════════════════════════════════════════════════ -->
        <div class="question" id="q3" data-niveau="1" data-points="8">
            <div class="question-header">
                <div class="question-title">Aufgabe 3: Geschwindigkeit berechnen</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">8 BE</span>
                </div>
            </div>
            <div class="question-text">Berechne die Geschwindigkeit. <strong>Schreibe nur die Zahl in das Feld!</strong></div>
            <div class="tipp">Formel: v = s / t (Geschwindigkeit = Weg geteilt durch Zeit)</div>

            <div class="calc-box">
                <h4>a) Schulweg zu Fuß (4 BE)</h4>
                <p>Lisa geht zur Schule. Sie läuft <strong>600 m</strong> in <strong>10 Minuten</strong>.</p>
                <p style="font-size:0.85em; color:#666; margin:5px 0;">Hinweis: Rechne erst Minuten in Sekunden um!</p>
                <div class="calc-row">
                    <label>Zeit t =</label>
                    <input type="number" id="q3a-t" placeholder="?"> <span class="unit">s</span>
                    <span style="font-size:0.8em; color:#888;">(1 BE)</span>
                </div>
                <div class="calc-row">
                    <label>v =</label>
                    <input type="number" id="q3a-v" step="0.1" placeholder="?"> <span class="unit">m/s</span>
                    <span style="font-size:0.8em; color:#888;">(3 BE)</span>
                </div>
            </div>

            <div class="calc-box">
                <h4>b) Sprinter (4 BE)</h4>
                <p>Ein Sprinter läuft <strong>100 m</strong> in <strong>10 s</strong>.</p>
                <div class="calc-row">
                    <label>v =</label>
                    <input type="number" id="q3b-v" step="0.1" placeholder="?"> <span class="unit">m/s</span>
                    <span style="font-size:0.8em; color:#888;">(4 BE)</span>
                </div>
            </div>
            <div class="feedback-box correct" id="q3-fb-correct">Super! Du kannst die Geschwindigkeit berechnen.</div>
            <div class="feedback-box incorrect" id="q3-fb-incorrect">Schau in dein Lernblatt: Kasten 4 zeigt dir die Formel und ein Beispiel.</div>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════════
             AUFGABE 4: Nachdenken (4 BE) - NUR ** und ***
             ═══════════════════════════════════════════════════════════════════════ -->
        <div class="question" id="q4" data-niveau="2" data-points="4">
            <div class="question-header">
                <div class="question-title">Aufgabe 4: Nachdenken</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-2">**</span>
                    <span class="question-points">4 BE</span>
                </div>
            </div>
            <div class="question-text">Beantworte die Fragen.</div>

            <div class="calc-box">
                <h4>a) Wer ist schneller? (2 BE)</h4>
                <p>Anna läuft 200 m in 40 s. Ben läuft 150 m in 25 s.</p>
                <p><strong>Wer ist schneller?</strong></p>
                <div class="calc-row">
                    <select id="q4a" style="padding:8px 12px; font-size:1em; border:1px solid #2c5aa0; min-width:150px;">
                        <option value="">-- wählen --</option>
                        <option value="anna">Anna</option>
                        <option value="ben">Ben</option>
                        <option value="gleich">Beide gleich schnell</option>
                    </select>
                </div>
            </div>

            <div class="calc-box">
                <h4>b) Begründung (2 BE)</h4>
                <p>Berechne beide Geschwindigkeiten:</p>
                <div class="calc-row">
                    <label>Anna: v =</label>
                    <input type="number" id="q4b-anna" step="0.1" placeholder="?"> <span class="unit">m/s</span>
                </div>
                <div class="calc-row">
                    <label>Ben: v =</label>
                    <input type="number" id="q4b-ben" step="0.1" placeholder="?"> <span class="unit">m/s</span>
                </div>
            </div>
            <div class="feedback-box correct" id="q4-fb-correct">Sehr gut! Du kannst Geschwindigkeiten vergleichen.</div>
            <div class="feedback-box incorrect" id="q4-fb-incorrect">Anna: 200/40 = 5 m/s. Ben: 150/25 = 6 m/s. Ben ist schneller!</div>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════════
             AUFGABE 5: Weg und Zeit berechnen (6 BE) - NUR ***
             ═══════════════════════════════════════════════════════════════════════ -->
        <div class="question" id="q5" data-niveau="3" data-points="6">
            <div class="question-header">
                <div class="question-title">Aufgabe 5: Weg und Zeit berechnen</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-3">***</span>
                    <span class="question-points">6 BE</span>
                </div>
            </div>
            <div class="question-text">Stelle die Formel um und berechne.</div>
            <div class="tipp">Formeln: s = v · t und t = s / v (siehe Lernblatt Kasten 5)</div>

            <div class="calc-box">
                <h4>a) Wie weit? (3 BE)</h4>
                <p>Ein Radfahrer fährt mit <strong>v = 8 m/s</strong> für <strong>t = 100 s</strong>. Wie weit kommt er?</p>
                <div class="calc-row">
                    <label>s =</label>
                    <input type="number" id="q5a-s" placeholder="?"> <span class="unit">m</span>
                </div>
            </div>

            <div class="calc-box">
                <h4>b) Wie lange? (3 BE)</h4>
                <p>Ein Bus fährt mit <strong>v = 20 m/s</strong> eine Strecke von <strong>s = 400 m</strong>. Wie lange braucht er?</p>
                <div class="calc-row">
                    <label>t =</label>
                    <input type="number" id="q5b-t" placeholder="?"> <span class="unit">s</span>
                </div>
            </div>
            <div class="feedback-box correct" id="q5-fb-correct">Richtig! Du kannst die Formel umstellen.</div>
            <div class="feedback-box incorrect" id="q5-fb-incorrect">Schau in dein Lernblatt: Kasten 5 zeigt die umgestellten Formeln.</div>
        </div>

        <!-- Submit Section -->
        <div class="submit-section" id="submitSection">
            <p style="margin-bottom:15px;">Überprüfe deine Antworten, bevor du abgibst.</p>
            <button onclick="submitTest()" id="submitBtn">Test abgeben</button>
        </div>

        <!-- Results Section -->
        <div class="results hidden" id="resultsSection">
            <h2>Ergebnis</h2>
            <div id="studentNameDisplay"></div>
            <div style="margin:10px 0;font-size:0.9em;" id="niveauDisplay"></div>
            <div style="margin-top:20px;">
                <div style="font-size:1.1em; font-weight:600; color:#555; margin-bottom:5px;">Erreichte Punkte:</div>
                <div class="score" id="scoreDisplay">0 / 0</div>
            </div>
            <div class="grade" id="gradeDisplay"></div>
            <table class="grade-table">
                <tr>
                    <th>NP</th><th>14</th><th>13</th><th>12</th><th>11</th><th>10</th><th>9</th><th>8</th><th>7</th><th>6</th><th>5</th><th>4</th><th>3</th><th>2</th><th>1</th>
                </tr>
                <tr>
                    <td>%</td><td>100</td><td>96</td><td>90,7</td><td>86</td><td>80</td><td>73,3</td><td>66,7</td><td>60</td><td>53,3</td><td>46,7</td><td>40</td><td>33,3</td><td>26,7</td><td>20</td>
                </tr>
                <tr id="gradeRow">
                    <td>BE</td><td id="be14">-</td><td id="be13">-</td><td id="be12">-</td><td id="be11">-</td><td id="be10">-</td><td id="be9">-</td><td id="be8">-</td><td id="be7">-</td><td id="be6">-</td><td id="be5">-</td><td id="be4">-</td><td id="be3">-</td><td id="be2">-</td><td id="be1">-</td>
                </tr>
            </table>
            <div style="background: #fff3e0; border: 2px solid #b35c00; padding: 15px; margin: 20px 0; text-align: left;">
                <strong style="color: #b35c00;">Ergebnis sichern:</strong>
                <ol style="margin: 10px 0 0 20px; line-height: 1.8;">
                    <li>Klicke auf <strong>"Drucken / PDF"</strong></li>
                    <li>Wähle <strong>"Als PDF speichern"</strong></li>
                    <li>Lade das PDF in der <strong>Bildungscloud</strong> hoch</li>
                </ol>
            </div>
            <button class="btn-secondary" onclick="window.print()">Drucken / PDF</button>
        </div>

        <!-- Teacher Reset Section -->
        <div class="teacher-section" id="teacherSection">
            <h3>Lehrer-Bereich</h3>
            <p style="font-size:0.85em; margin-bottom:10px;">Reset für diesen Platz (löscht alle Eingaben):</p>
            <button class="btn-secondary btn-small" onclick="teacherReset()">Platz zurücksetzen</button>
        </div>
    </div>

    <script>
    // ═══════════════════════════════════════════════════════════════
    // KONFIGURATION
    // ═══════════════════════════════════════════════════════════════
    var STORAGE_KEY = 'mt-physik-6-002-bewegung';
    var STORAGE_HOURS = 22; // Persistenz in Stunden
    var selectedNiveau = 0;
    var testSubmitted = false;
    var seatConfirmed = false;

    // Richtige Antworten
    var answers = {
        'q1-a': 'ort',
        'q1-b': 'bahnform',
        'q1-c': 'bewegungsart',
        'q1-d': 'geradlinig',
        'q1-e': 'krummlinig',
        'q3a-t': 600,
        'q3a-v': 1,
        'q3b-v': 10,
        'q4a': 'ben',
        'q4b-anna': 5,
        'q4b-ben': 6,
        'q5a-s': 800,
        'q5b-t': 20
    };

    // Toleranzen für numerische Eingaben
    var tolerances = {
        'q3a-t': 0,
        'q3a-v': 0.1,
        'q3b-v': 0.1,
        'q4b-anna': 0.1,
        'q4b-ben': 0.1,
        'q5a-s': 0,
        'q5b-t': 0
    };

    // ═══════════════════════════════════════════════════════════════
    // INITIALISIERUNG
    // ═══════════════════════════════════════════════════════════════
    (function() {
        // Platznummern generieren
        var seatSel = document.getElementById('seatSelect');
        for (var i = 1; i <= 30; i++) {
            var opt = document.createElement('option');
            opt.value = i;
            opt.textContent = 'Platz ' + i;
            seatSel.appendChild(opt);
        }

        // Fragen initial verstecken
        var questions = document.querySelectorAll('.question');
        for (var i = 0; i < questions.length; i++) {
            questions[i].style.display = 'none';
        }
        document.getElementById('submitSection').style.display = 'none';

        // Event-Listener für alle Eingaben
        var allInputs = document.querySelectorAll('input, select');
        for (var i = 0; i < allInputs.length; i++) {
            allInputs[i].addEventListener('change', function() {
                saveAnswers();
                updateProgress();
            });
        }

        // Gespeicherte Antworten wiederherstellen
        restoreAnswers();
    })();

    // ═══════════════════════════════════════════════════════════════
    // PLATZ & NIVEAU
    // ═══════════════════════════════════════════════════════════════
    function confirmSeat() {
        var sel = document.getElementById('seatSelect');
        var val = sel.value;
        if (!val) { alert('Bitte Platznummer wählen!'); return; }
        seatConfirmed = true;
        document.getElementById('seatRow').style.display = 'none';
        document.getElementById('seatWarning').style.display = 'none';
        document.getElementById('seatConfirmed').textContent = 'Platz ' + val;
        document.getElementById('seatConfirmed').style.display = 'block';
        saveAnswers();
    }

    function confirmNiveau() {
        if (!seatConfirmed) { alert('Bitte zuerst Platznummer wählen und bestätigen!'); return; }
        var sel = document.getElementById('niveauSelect');
        var val = parseInt(sel.value);
        if (!val) { alert('Bitte Niveau wählen!'); return; }
        selectedNiveau = val;
        document.getElementById('niveauRow').style.display = 'none';
        document.getElementById('niveauWarning').style.display = 'none';
        var labels = { 1: '* Basis (25 BE)', 2: '** Standard (29 BE)', 3: '*** Erweitert (35 BE)' };
        document.getElementById('niveauConfirmed').textContent = labels[val];
        document.getElementById('niveauConfirmed').style.display = 'block';
        showQuestionsForNiveau(val);
        saveAnswers();
        updateProgress();
    }

    function showQuestionsForNiveau(niveau) {
        var questions = document.querySelectorAll('.question');
        for (var i = 0; i < questions.length; i++) {
            var qNiveau = parseInt(questions[i].getAttribute('data-niveau'));
            questions[i].style.display = (qNiveau <= niveau) ? 'block' : 'none';
        }
        document.getElementById('submitSection').style.display = 'block';
    }

    // ═══════════════════════════════════════════════════════════════
    // FORTSCHRITT
    // ═══════════════════════════════════════════════════════════════
    function updateProgress() {
        if (selectedNiveau === 0) return;
        var answered = countAnsweredFields();
        var total = countTotalFields();
        var pct = total > 0 ? Math.round((answered / total) * 100) : 0;
        document.getElementById('progressFill').style.width = pct + '%';
        document.getElementById('progressText').textContent = answered + ' / ' + total + ' beantwortet';
    }

    function countTotalFields() {
        var count = 0;
        // Q1: 5 Dropdowns, Q2: 6×2=12 Checkboxen, Q3: 3 Inputs
        count = 5 + 12 + 3;
        if (selectedNiveau >= 2) count += 3; // Q4: 1 Select + 2 Inputs
        if (selectedNiveau >= 3) count += 2; // Q5: 2 Inputs
        return count;
    }

    function countAnsweredFields() {
        var count = 0;
        // Q1 Selects
        var q1Fields = ['q1-a','q1-b','q1-c','q1-d','q1-e'];
        for (var i = 0; i < q1Fields.length; i++) {
            var el = document.getElementById(q1Fields[i]);
            if (el && el.value !== '') count++;
        }
        // Q2 Checkboxen
        var rows = document.querySelectorAll('#q2 tbody tr');
        for (var r = 0; r < rows.length; r++) {
            var checks = rows[r].querySelectorAll('input[type="checkbox"]');
            var bahnChecked = false, artChecked = false;
            for (var c = 0; c < checks.length; c++) {
                if (checks[c].checked) {
                    if (checks[c].name.indexOf('-bahn') > -1) bahnChecked = true;
                    if (checks[c].name.indexOf('-art') > -1) artChecked = true;
                }
            }
            if (bahnChecked) count++;
            if (artChecked) count++;
        }
        // Q3 Inputs
        var q3Fields = ['q3a-t','q3a-v','q3b-v'];
        for (var i = 0; i < q3Fields.length; i++) {
            var el = document.getElementById(q3Fields[i]);
            if (el && el.value !== '') count++;
        }
        // Q4 (nur ** und ***): 1 Select + 2 Inputs
        if (selectedNiveau >= 2) {
            var el4a = document.getElementById('q4a');
            if (el4a && el4a.value !== '') count++;
            var q4Fields = ['q4b-anna','q4b-ben'];
            for (var i = 0; i < q4Fields.length; i++) {
                var el = document.getElementById(q4Fields[i]);
                if (el && el.value !== '') count++;
            }
        }
        // Q5 (nur ***): 2 Inputs
        if (selectedNiveau >= 3) {
            var q5Fields = ['q5a-s','q5b-t'];
            for (var i = 0; i < q5Fields.length; i++) {
                var el = document.getElementById(q5Fields[i]);
                if (el && el.value !== '') count++;
            }
        }
        return count;
    }

    // ═══════════════════════════════════════════════════════════════
    // SPEICHERN & WIEDERHERSTELLEN
    // ═══════════════════════════════════════════════════════════════
    function saveAnswers() {
        var data = {
            timestamp: Date.now(),
            seat: document.getElementById('seatSelect').value,
            seatConfirmed: seatConfirmed,
            niveau: selectedNiveau,
            submitted: testSubmitted,
            answers: {}
        };
        // Alle Selects
        var allSelects = document.querySelectorAll('select[id^="q"]');
        for (var i = 0; i < allSelects.length; i++) {
            data.answers[allSelects[i].id] = allSelects[i].value;
        }
        // Alle Inputs
        var allInputs = document.querySelectorAll('input[type="number"]');
        for (var i = 0; i < allInputs.length; i++) {
            data.answers[allInputs[i].id] = allInputs[i].value;
        }
        // Alle Checkboxen
        var allChecks = document.querySelectorAll('input[type="checkbox"]');
        for (var i = 0; i < allChecks.length; i++) {
            data.answers[allChecks[i].name + '_' + allChecks[i].value] = allChecks[i].checked;
        }
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function restoreAnswers() {
        var stored = localStorage.getItem(STORAGE_KEY);
        if (!stored) return;
        var data = JSON.parse(stored);

        // Prüfe Ablaufzeit
        var now = Date.now();
        var maxAge = STORAGE_HOURS * 60 * 60 * 1000;
        if (data.timestamp && (now - data.timestamp) > maxAge) {
            localStorage.removeItem(STORAGE_KEY);
            return;
        }

        // Platz wiederherstellen
        if (data.seat) {
            document.getElementById('seatSelect').value = data.seat;
            if (data.seatConfirmed) {
                seatConfirmed = true;
                document.getElementById('seatRow').style.display = 'none';
                document.getElementById('seatWarning').style.display = 'none';
                document.getElementById('seatConfirmed').textContent = 'Platz ' + data.seat;
                document.getElementById('seatConfirmed').style.display = 'block';
            }
        }
        // Niveau wiederherstellen
        if (data.niveau) {
            selectedNiveau = data.niveau;
            document.getElementById('niveauSelect').value = data.niveau;
            document.getElementById('niveauRow').style.display = 'none';
            document.getElementById('niveauWarning').style.display = 'none';
            var labels = { 1: '* Basis (25 BE)', 2: '** Standard (29 BE)', 3: '*** Erweitert (35 BE)' };
            document.getElementById('niveauConfirmed').textContent = labels[data.niveau];
            document.getElementById('niveauConfirmed').style.display = 'block';
            showQuestionsForNiveau(data.niveau);
        }
        // Antworten wiederherstellen
        if (data.answers) {
            for (var key in data.answers) {
                if (key.indexOf('_') > -1) {
                    // Checkbox
                    var parts = key.split('_');
                    var name = parts[0];
                    var val = parts[1];
                    var checks = document.querySelectorAll('input[name="' + name + '"][value="' + val + '"]');
                    for (var i = 0; i < checks.length; i++) {
                        checks[i].checked = data.answers[key];
                    }
                } else {
                    var el = document.getElementById(key);
                    if (el) el.value = data.answers[key];
                }
            }
        }
        // Bereits abgegeben?
        if (data.submitted) {
            testSubmitted = true;
            submitTest(true);
        }
        updateProgress();
    }

    // ═══════════════════════════════════════════════════════════════
    // TEST ABGEBEN
    // ═══════════════════════════════════════════════════════════════
    function submitTest(isRestore) {
        if (!isRestore && !confirm('Test wirklich abgeben? Du kannst danach nichts mehr ändern.')) return;
        testSubmitted = true;
        saveAnswers();

        var totalPoints = 0;
        var earnedPoints = 0;

        // Q1: Lückentext (5 BE)
        var q1Fields = ['q1-a','q1-b','q1-c','q1-d','q1-e'];
        var q1Earned = 0;
        for (var i = 0; i < q1Fields.length; i++) {
            var el = document.getElementById(q1Fields[i]);
            if (el.value === answers[q1Fields[i]]) {
                q1Earned++;
                el.classList.add('correct');
            } else {
                el.classList.add('incorrect');
            }
            el.disabled = true;
        }
        totalPoints += 5;
        earnedPoints += q1Earned;
        showQuestionResult('q1', q1Earned, 5);

        // Q2: Zuordnungstabelle (12 BE)
        var q2Result = evaluateTable('q2');
        totalPoints += 12;
        earnedPoints += q2Result;
        showQuestionResult('q2', q2Result, 12);

        // Q3: Berechnungen (8 BE)
        var q3Earned = 0;
        // q3a-t (1 BE)
        q3Earned += evaluateNumeric('q3a-t', 1);
        // q3a-v (3 BE)
        q3Earned += evaluateNumeric('q3a-v', 3);
        // q3b-v (4 BE)
        q3Earned += evaluateNumeric('q3b-v', 4);
        totalPoints += 8;
        earnedPoints += q3Earned;
        showQuestionResult('q3', q3Earned, 8);

        // Q4: Nur ** und *** (4 BE) - Nachdenken
        if (selectedNiveau >= 2) {
            var q4Earned = 0;
            // q4a Select (2 BE)
            var el4a = document.getElementById('q4a');
            if (el4a.value === answers['q4a']) {
                q4Earned += 2;
                el4a.style.borderColor = '#2a7a4b';
                el4a.style.background = '#e8f5e9';
            } else {
                el4a.style.borderColor = '#c62828';
                el4a.style.background = '#ffebee';
            }
            el4a.disabled = true;
            // q4b (2 BE - je 1)
            q4Earned += evaluateNumeric('q4b-anna', 1);
            q4Earned += evaluateNumeric('q4b-ben', 1);
            totalPoints += 4;
            earnedPoints += q4Earned;
            showQuestionResult('q4', q4Earned, 4);
        }

        // Q5: Nur *** (6 BE) - Weg und Zeit
        if (selectedNiveau >= 3) {
            var q5Earned = 0;
            q5Earned += evaluateNumeric('q5a-s', 3);
            q5Earned += evaluateNumeric('q5b-t', 3);
            totalPoints += 6;
            earnedPoints += q5Earned;
            showQuestionResult('q5', q5Earned, 6);
        }

        // Alle Inputs deaktivieren
        var allInputs = document.querySelectorAll('input, select');
        for (var i = 0; i < allInputs.length; i++) {
            allInputs[i].disabled = true;
        }

        // Ergebnis anzeigen
        document.getElementById('submitSection').style.display = 'none';
        document.getElementById('resultsSection').classList.remove('hidden');
        document.getElementById('scoreDisplay').textContent = earnedPoints + ' / ' + totalPoints;
        document.getElementById('studentNameDisplay').textContent = 'Platz: ' + document.getElementById('seatSelect').value;
        var niveauLabels = { 1: '* Basis', 2: '** Standard', 3: '*** Erweitert' };
        document.getElementById('niveauDisplay').textContent = 'Niveau: ' + niveauLabels[selectedNiveau];

        var pct = (earnedPoints / totalPoints) * 100;
        var np = calculateNP(pct);
        document.getElementById('gradeDisplay').textContent = np + ' Notenpunkte';

        // BE-Tabelle füllen
        var thresholds = [100, 96, 90.67, 86, 80, 73.33, 66.67, 60, 53.33, 46.67, 40, 33.33, 26.67, 20];
        var marked = false;
        for (var i = 14; i >= 1; i--) {
            var beNeeded = Math.ceil(totalPoints * thresholds[14-i] / 100);
            document.getElementById('be' + i).textContent = beNeeded;
            if (!marked && earnedPoints >= beNeeded) {
                document.getElementById('be' + i).classList.add('current');
                marked = true;
            }
        }
    }

    function evaluateNumeric(fieldId, points) {
        var el = document.getElementById(fieldId);
        if (!el) return 0;
        var userVal = parseFloat(el.value);
        var correctVal = answers[fieldId];
        var tol = tolerances[fieldId] || 0;
        var isCorrect = !isNaN(userVal) && Math.abs(userVal - correctVal) <= tol;
        if (isCorrect) {
            el.classList.add('correct');
            el.disabled = true;
            return points;
        } else {
            el.classList.add('incorrect');
            el.disabled = true;
            return 0;
        }
    }

    function evaluateTable(qId) {
        var tableEl = document.getElementById(qId);
        var rows = tableEl.querySelectorAll('tbody tr');
        var earned = 0;
        for (var r = 0; r < rows.length; r++) {
            var correctStr = rows[r].getAttribute('data-correct');
            var correctVals = correctStr.split(',');
            var checks = rows[r].querySelectorAll('input[type="checkbox"]');
            for (var c = 0; c < checks.length; c++) {
                var shouldBeChecked = correctVals.indexOf(checks[c].value) > -1;
                if (checks[c].checked && shouldBeChecked) {
                    checks[c].classList.add('correct-check');
                    earned++;
                } else if (checks[c].checked && !shouldBeChecked) {
                    checks[c].classList.add('incorrect-check');
                } else if (!checks[c].checked && shouldBeChecked) {
                    checks[c].classList.add('missed-check');
                }
                checks[c].disabled = true;
            }
        }
        return earned;
    }

    function showQuestionResult(qId, earned, total) {
        var header = document.querySelector('#' + qId + ' .question-header');
        var span = document.createElement('span');
        span.className = 'question-result';
        if (earned === total) {
            span.className += ' full';
            span.textContent = earned + '/' + total + ' BE';
            var fbCorrect = document.getElementById(qId + '-fb-correct');
            if (fbCorrect) fbCorrect.classList.add('show');
        } else if (earned > 0) {
            span.className += ' partial';
            span.textContent = earned + '/' + total + ' BE';
            var fbIncorrect = document.getElementById(qId + '-fb-incorrect');
            if (fbIncorrect) fbIncorrect.classList.add('show');
        } else {
            span.className += ' zero';
            span.textContent = '0/' + total + ' BE';
            var fbIncorrect = document.getElementById(qId + '-fb-incorrect');
            if (fbIncorrect) fbIncorrect.classList.add('show');
        }
        header.appendChild(span);
    }

    function calculateNP(pct) {
        var thresholds = [
            [100, 14], [96, 13], [90.67, 12], [86, 11], [80, 10],
            [73.33, 9], [66.67, 8], [60, 7], [53.33, 6], [46.67, 5],
            [40, 4], [33.33, 3], [26.67, 2], [20, 1]
        ];
        for (var i = 0; i < thresholds.length; i++) {
            if (pct >= thresholds[i][0]) return thresholds[i][1];
        }
        return 0;
    }

    // ═══════════════════════════════════════════════════════════════
    // LEHRER-RESET
    // ═══════════════════════════════════════════════════════════════
    function teacherReset() {
        var code = prompt('Lehrer-Code eingeben:');
        if (code === '2024') {
            localStorage.removeItem(STORAGE_KEY);
            alert('Platz wurde zurückgesetzt. Seite wird neu geladen.');
            location.reload();
        } else if (code !== null) {
            alert('Falscher Code!');
        }
    }
    </script>
</body>
</html>
