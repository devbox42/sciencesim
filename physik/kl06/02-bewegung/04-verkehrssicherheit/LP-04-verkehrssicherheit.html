<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verkehrssicherheit - Reaktionsweg und Anhalteweg | Physik Klasse 6</title>
    <style>
        :root {
            --physik: #2c5aa0;
            --physik-hell: #e8f0fa;
            --success: #2a7a4b;
            --success-bg: #e8f5e9;
            --warning: #b35c00;
            --warning-bg: #fff3e0;
            --error: #c62828;
            --error-bg: #ffebee;
            --bg: #f5f5f5;
            --white: #ffffff;
            --border: #dddddd;
            --text: #222222;
            --text-muted: #666666;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 16px;
            line-height: 1.6;
            background: var(--bg);
            color: var(--text);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: var(--white);
            border-bottom: 3px solid var(--physik);
            padding: 20px;
            margin-bottom: 20px;
        }

        header h1 {
            color: var(--physik);
            font-size: 1.5em;
            font-weight: 600;
        }

        header .subtitle {
            color: var(--text-muted);
            font-size: 0.9em;
        }

        .progress-bar {
            background: var(--border);
            height: 6px;
            margin-top: 15px;
        }

        .progress-fill {
            background: var(--physik);
            height: 100%;
            width: 0%;
            transition: width 0.3s;
        }

        .section {
            background: var(--white);
            border: 1px solid var(--border);
            padding: 25px;
            margin-bottom: 20px;
            display: none;
        }

        .section.active {
            display: block;
        }

        .section h2 {
            color: var(--physik);
            font-size: 1.2em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--physik-hell);
        }

        .section h3 {
            font-size: 1em;
            margin: 15px 0 10px 0;
        }

        p {
            margin-bottom: 12px;
        }

        .story-box {
            background: var(--physik-hell);
            border-left: 4px solid var(--physik);
            padding: 15px;
            margin: 15px 0;
            font-style: italic;
        }

        .merksatz {
            background: var(--physik-hell);
            border: 2px solid var(--physik);
            padding: 15px;
            margin: 15px 0;
        }

        .merksatz-label {
            background: var(--physik);
            color: white;
            font-size: 0.75em;
            font-weight: 600;
            padding: 2px 8px;
            display: inline-block;
            margin-bottom: 10px;
        }

        .formel {
            font-family: "Times New Roman", serif;
            font-size: 1.2em;
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            background: var(--white);
            border: 1px solid var(--border);
        }

        .formel .var {
            font-style: italic;
        }

        /* ISO 80000: Einheiten als Bruch */
        .unit-frac {
            display: inline-block;
            text-align: center;
            vertical-align: middle;
            font-family: "Times New Roman", serif;
        }
        .unit-frac .num {
            display: block;
            border-bottom: 1px solid currentColor;
            padding: 0 2px;
            line-height: 1.1;
        }
        .unit-frac .den {
            display: block;
            padding: 0 2px;
            line-height: 1.1;
        }
        /* Screenreader: Bruch-Inhalt ausblenden, aria-label wird gelesen */
        .unit-frac[aria-label] .num,
        .unit-frac[aria-label] .den {
            /* Visuell sichtbar, aber Screenreader liest aria-label */
        }

        /* Step Navigation */
        .step-nav {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }
        .step-dot {
            width: 28px;
            height: 28px;
            border: 2px solid var(--physik);
            background: var(--white);
            color: var(--physik);
            font-size: 0.8em;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .step-dot:hover {
            background: var(--physik-hell);
        }
        .step-dot.active {
            background: var(--physik);
            color: white;
        }
        .step-dot.completed {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .beispiel {
            background: #f9f9f9;
            border: 1px solid var(--border);
            padding: 15px;
            margin: 15px 0;
        }

        .beispiel-label {
            font-weight: 600;
            color: var(--physik);
            margin-bottom: 10px;
        }

        .hefter-hinweis {
            background: var(--warning-bg);
            border: 2px solid var(--warning);
            padding: 15px;
            margin: 20px 0;
        }

        .hefter-hinweis-label {
            background: var(--warning);
            color: white;
            font-size: 0.75em;
            font-weight: 600;
            padding: 2px 8px;
            display: inline-block;
            margin-bottom: 10px;
        }

        /* Tabelle */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9em;
        }

        th, td {
            border: 1px solid var(--border);
            padding: 10px;
            text-align: center;
        }

        th {
            background: var(--physik-hell);
            font-weight: 600;
        }

        /* Buttons */
        .btn {
            background: var(--physik);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1em;
            cursor: pointer;
            margin-top: 15px;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-success {
            background: var(--success);
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        /* Reaktionszeit-Spiel */
        .game-container {
            text-align: center;
            padding: 20px;
            background: #f9f9f9;
            border: 1px solid var(--border);
            margin: 15px 0;
        }

        .ampel {
            width: 80px;
            height: 200px;
            background: #333;
            margin: 0 auto 20px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
        }

        .ampel-licht {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #444;
        }

        .ampel-licht.rot.an {
            background: #ff3333;
            box-shadow: 0 0 20px #ff3333;
        }

        .ampel-licht.gelb.an {
            background: #ffcc00;
            box-shadow: 0 0 20px #ffcc00;
        }

        .ampel-licht.gruen.an {
            background: #33cc33;
            box-shadow: 0 0 20px #33cc33;
        }

        .game-result {
            font-size: 1.3em;
            font-weight: 600;
            margin: 15px 0;
        }

        .game-result.gut {
            color: var(--success);
        }

        .game-result.normal {
            color: var(--warning);
        }

        /* Simulation */
        .sim-container {
            background: #f9f9f9;
            border: 1px solid var(--border);
            padding: 20px;
            margin: 15px 0;
        }

        .sim-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .sim-control label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .sim-control select,
        .sim-control input[type="range"] {
            width: 100%;
            padding: 8px;
            font-size: 1em;
        }

        .sim-value {
            text-align: center;
            font-weight: 600;
            margin-top: 5px;
        }

        .sim-canvas-container {
            background: white;
            border: 1px solid var(--border);
            padding: 10px;
        }

        .sim-canvas {
            width: 100%;
            height: 180px;
        }

        .sim-results {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .sim-result-box {
            text-align: center;
            padding: 10px;
            border: 1px solid var(--border);
        }

        .sim-result-box.reaktion {
            background: #e3f2fd;
            border-color: #2196f3;
        }

        .sim-result-box.brems {
            background: #fff3e0;
            border-color: #ff9800;
        }

        .sim-result-box.anhalt {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .sim-result-label {
            font-size: 0.8em;
            color: var(--text-muted);
        }

        .sim-result-value {
            font-size: 1.4em;
            font-weight: 600;
        }

        /* Übungen im Lernpfad */
        .uebung {
            background: #f9f9f9;
            border: 1px solid var(--border);
            padding: 15px;
            margin: 15px 0;
        }

        .uebung-label {
            font-weight: 600;
            color: var(--physik);
            margin-bottom: 10px;
        }

        .uebung input {
            width: 80px;
            padding: 8px;
            font-size: 1em;
            text-align: center;
            border: 1px solid var(--border);
        }

        .uebung .einheit {
            font-family: sans-serif;
            margin-left: 5px;
        }

        .feedback {
            padding: 10px;
            margin-top: 10px;
            display: none;
        }

        .feedback.richtig {
            background: var(--success-bg);
            border: 1px solid var(--success);
            color: var(--success);
            display: block;
        }

        .feedback.falsch {
            background: var(--error-bg);
            border: 1px solid var(--error);
            color: var(--error);
            display: block;
        }

        /* Schätzfrage / Multiple Choice */
        .schaetzfrage {
            background: #f9f9f9;
            border: 1px solid var(--border);
            padding: 15px;
            margin: 15px 0;
        }
        .schaetzfrage-label {
            font-weight: 600;
            color: var(--physik);
            margin-bottom: 10px;
        }
        .mc-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        .mc-btn {
            padding: 10px 20px;
            border: 2px solid var(--physik);
            background: white;
            cursor: pointer;
            font-size: 1em;
        }
        .mc-btn:hover {
            background: var(--physik-hell);
        }
        .mc-btn.selected {
            background: var(--physik);
            color: white;
        }
        .mc-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* Drag & Drop Sortier-Quiz (iPad-tauglich) */
        .sortier-container {
            background: #f9f9f9;
            border: 1px solid var(--border);
            padding: 15px;
            margin: 15px 0;
        }
        .sortier-layout {
            display: flex;
            gap: 15px;
            margin: 15px 0;
        }
        .sortier-slots {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
        }
        .sortier-slot {
            min-height: 70px;
            padding: 12px 15px;
            border: 2px dashed var(--border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
        }
        .sortier-slot-num {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--physik-hell);
            color: var(--physik);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        .sortier-slot-label {
            color: var(--text-muted);
            font-style: italic;
        }
        .sortier-slot.filled {
            border-style: solid;
            border-color: var(--physik);
            background: var(--physik-hell);
        }
        .sortier-slot.filled .sortier-slot-label {
            display: none;
        }
        .sortier-slot.drag-over {
            border-color: var(--physik);
            background: #e0f0ff;
        }
        .sortier-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
        }
        .sortier-item {
            min-height: 70px;
            padding: 12px 15px;
            background: white;
            border: 2px solid var(--physik);
            border-radius: 8px;
            cursor: grab;
            touch-action: none;
            user-select: none;
            display: flex;
            align-items: center;
            transition: transform 0.15s, box-shadow 0.15s;
        }
        .sortier-item:active {
            cursor: grabbing;
        }
        .sortier-item.dragging {
            opacity: 0.5;
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .sortier-item.placed {
            display: none;
        }
        .sortier-item-text {
            font-size: 0.95em;
            line-height: 1.4;
        }
        .sortier-placed-text {
            font-size: 0.95em;
            line-height: 1.4;
        }
        .sortier-reset {
            margin-top: 10px;
            padding: 10px 20px;
            background: #eee;
            border: 1px solid var(--border);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            min-height: 44px;
        }

        /* Pflicht-Eingabe (muss korrekt sein) */
        .pflicht-eingabe {
            background: var(--warning-bg);
            border: 2px solid var(--warning);
            padding: 15px;
            margin: 15px 0;
        }
        .pflicht-eingabe.erfolg {
            background: var(--success-bg);
            border-color: var(--success);
        }

        /* Lücken-Rechnung */
        .luecken-rechnung {
            background: #f9f9f9;
            border: 1px solid var(--border);
            padding: 15px;
            margin: 15px 0;
        }
        .luecken-rechnung input {
            width: 60px;
            padding: 5px;
            text-align: center;
            border: 2px solid var(--physik);
            font-size: 1em;
        }
        .luecken-rechnung input.korrekt {
            border-color: var(--success);
            background: var(--success-bg);
        }
        .luecken-rechnung input.falsch {
            border-color: var(--error);
            background: var(--error-bg);
        }

        /* Mini-Quiz */
        .mini-quiz {
            background: #f9f9f9;
            border: 1px solid var(--border);
            padding: 15px;
            margin: 15px 0;
        }
        .quiz-frage {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        .quiz-frage:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .quiz-ergebnis {
            text-align: center;
            font-size: 1.2em;
            font-weight: 600;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }
        .quiz-ergebnis.show {
            display: block;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .sim-controls {
                grid-template-columns: 1fr;
            }
            .sim-results {
                grid-template-columns: 1fr;
            }
            .mc-options {
                flex-direction: column;
            }
        }
    </style>
</head>
<body class="physik">
    <header>
        <div class="container">
            <h1>Verkehrssicherheit: Reaktionsweg und Anhalteweg</h1>
            <p class="subtitle">Physik Klasse 6 | Bewegungen</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progress"></div>
            </div>
            <div class="step-nav" id="step-nav">
                <div class="step-dot active" onclick="goToSection(1)">1</div>
                <div class="step-dot" onclick="goToSection(2)">2</div>
                <div class="step-dot" onclick="goToSection(3)">3</div>
                <div class="step-dot" onclick="goToSection(4)">4</div>
                <div class="step-dot" onclick="goToSection(5)">5</div>
                <div class="step-dot" onclick="goToSection(6)">6</div>
                <div class="step-dot" onclick="goToSection(7)">7</div>
                <div class="step-dot" onclick="goToSection(8)">8</div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Sektion 1: Geschichte -->
        <section class="section active" id="section1">
            <h2>1. Eine Situation im Straßenverkehr</h2>

            <div class="story-box">
                <strong>Stell dir vor:</strong><br>
                Lena (8 Jahre) spielt am Straßenrand. Plötzlich rollt ihr Ball auf die Fahrbahn.
                Sie bleibt stehen und wartet – so hat sie es gelernt.<br><br>
                In diesem Moment kommt ein Auto mit 50 <span class="unit-frac" aria-label="Kilometer pro Stunde"><span class="num">km</span><span class="den">h</span></span>. Der Fahrer sieht den Ball und bremst sofort. Das Auto ist noch <strong>30 Meter</strong> entfernt.
            </div>

            <div class="schaetzfrage">
                <div class="schaetzfrage-label">Was denkst du?</div>
                <p>Schafft es das Auto rechtzeitig vor dem Ball zu stoppen?</p>
                <div class="mc-options" id="schaetz1-options">
                    <button class="mc-btn" onclick="selectSchaetzung(1, 'ja')">Ja, knapp</button>
                    <button class="mc-btn" onclick="selectSchaetzung(1, 'nein')">Nein, zu spät</button>
                    <button class="mc-btn" onclick="selectSchaetzung(1, 'weiss')">Weiß nicht</button>
                </div>
                <div class="feedback" id="schaetz1-feedback"></div>
            </div>

            <p>Um das zu beantworten, müssen wir verstehen, was passiert, wenn ein Fahrer bremst.
            Es gibt nämlich <strong>zwei wichtige Strecken</strong>:</p>

            <ol>
                <li><strong>Reaktionsweg</strong> – die Strecke, die das Auto fährt, während der Fahrer noch reagiert</li>
                <li><strong>Bremsweg</strong> – die Strecke, die das Auto beim Bremsen zurücklegt</li>
            </ol>

            <div class="nav-buttons">
                <div></div>
                <button class="btn" onclick="goToSection(2)">Weiter</button>
            </div>
        </section>

        <!-- Sektion 2: Schrecksekunde -->
        <section class="section" id="section2">
            <h2>2. Die Schrecksekunde</h2>

            <p>Wenn etwas Unerwartetes passiert, reagieren wir nicht sofort. Das Gehirn braucht Zeit für mehrere Schritte:</p>

            <div class="sortier-container">
                <div class="schaetzfrage-label">Ziehe die Schritte in die richtige Reihenfolge!</div>
                <div class="sortier-layout">
                    <div class="sortier-slots" id="sortier-slots">
                        <div class="sortier-slot" data-pos="1">
                            <span class="sortier-slot-num">1</span>
                            <span class="sortier-slot-label">Hierher ziehen...</span>
                        </div>
                        <div class="sortier-slot" data-pos="2">
                            <span class="sortier-slot-num">2</span>
                            <span class="sortier-slot-label">Hierher ziehen...</span>
                        </div>
                        <div class="sortier-slot" data-pos="3">
                            <span class="sortier-slot-num">3</span>
                            <span class="sortier-slot-label">Hierher ziehen...</span>
                        </div>
                        <div class="sortier-slot" data-pos="4">
                            <span class="sortier-slot-num">4</span>
                            <span class="sortier-slot-label">Hierher ziehen...</span>
                        </div>
                    </div>
                    <div class="sortier-items" id="sortier-items">
                        <!-- Items werden per JS randomisiert eingefügt -->
                    </div>
                </div>
                <button class="sortier-reset" onclick="resetSortierung()">Zurücksetzen</button>
                <div class="feedback" id="sort-feedback"></div>
            </div>

            <p>Diese Zeit nennt man <strong>Reaktionszeit</strong> oder <strong>Schrecksekunde</strong>.</p>

            <div class="merksatz">
                <div class="merksatz-label">Merksatz</div>
                Die <strong>Schrecksekunde</strong> ist die Zeit vom Erkennen einer Gefahr bis zum Beginn der Reaktion.<br>
                Sie beträgt beim Autofahren durchschnittlich etwa <strong>1 Sekunde</strong>.
            </div>

            <p><strong>Wichtig:</strong> Während der Schrecksekunde fährt das Fahrzeug mit voller Geschwindigkeit weiter!</p>

            <div class="hefter-hinweis">
                <div class="hefter-hinweis-label">Arbeitsblatt</div>
                <p><strong>→ Aufgabe 1:</strong> Ergänze die Begriffe im Lückentext (Schrecksekunde, Reaktionsweg, Bremsweg, Anhalteweg).</p>
            </div>

            <div class="nav-buttons">
                <button class="btn" onclick="goToSection(1)">Zurück</button>
                <button class="btn" onclick="goToSection(3)">Weiter</button>
            </div>
        </section>

        <!-- Sektion 3: Mini-Experiment -->
        <section class="section" id="section3">
            <h2>3. Mini-Experiment: Teste deine Reaktionszeit!</h2>

            <p>Wie schnell kannst du reagieren? Finde es heraus!</p>

            <div class="game-container">
                <p><strong>So geht's:</strong> Warte, bis die Ampel <span style="color:#33cc33;font-weight:bold;">GRÜN</span> wird, dann klicke so schnell wie möglich auf den Button!</p>

                <div class="ampel" id="ampel">
                    <div class="ampel-licht rot" id="licht-rot"></div>
                    <div class="ampel-licht gelb" id="licht-gelb"></div>
                    <div class="ampel-licht gruen" id="licht-gruen"></div>
                </div>

                <button class="btn" id="game-btn" onclick="handleGameClick()">Warten...</button>

                <div class="game-result" id="game-result"></div>

                <p id="game-versuche">Versuche: <span id="versuch-count">0</span>/3</p>
                <p id="game-durchschnitt" style="display:none;">Dein Durchschnitt: <strong id="avg-time">-</strong></p>
            </div>

            <div id="game-erklaerung" style="display:none;">
                <div class="merksatz">
                    <div class="merksatz-label">Ergebnis</div>
                    Deine durchschnittliche Reaktionszeit: <strong id="dein-ergebnis">-</strong><br><br>
                    Das ist typisch! Die meisten Menschen brauchen 0,2 bis 0,5 Sekunden.<br>
                    Beim Autofahren rechnet man mit <strong>1 Sekunde</strong>, weil man dort auch noch das Pedal treten muss.
                </div>

                <div class="hefter-hinweis">
                    <div class="hefter-hinweis-label">Arbeitsblatt</div>
                    <p><strong>→ Notiere deine Reaktionszeit</strong> im Feld „Meine Reaktionszeit" auf dem Arbeitsblatt!</p>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn" onclick="goToSection(2)">Zurück</button>
                <button class="btn" onclick="goToSection(4)">Weiter</button>
            </div>
        </section>

        <!-- Sektion 4: Reaktionsweg -->
        <section class="section" id="section4">
            <h2>4. Der Reaktionsweg</h2>

            <p>Der <strong>Reaktionsweg</strong> ist die Strecke, die ein Fahrzeug während der Schrecksekunde zurücklegt.</p>

            <div class="schaetzfrage">
                <div class="schaetzfrage-label">Schätze!</div>
                <p>Ein Auto fährt mit 20 <span class="unit-frac" aria-label="Meter pro Sekunde"><span class="num">m</span><span class="den">s</span></span>. Wie weit fährt es in 1 Sekunde Reaktionszeit?</p>
                <div class="mc-options" id="schaetz4-options">
                    <button class="mc-btn" onclick="selectSchaetzung(4, '10')">10 m</button>
                    <button class="mc-btn" onclick="selectSchaetzung(4, '20')">20 m</button>
                    <button class="mc-btn" onclick="selectSchaetzung(4, '40')">40 m</button>
                </div>
                <div class="feedback" id="schaetz4-feedback"></div>
            </div>

            <div class="merksatz">
                <div class="merksatz-label">So überlegst du</div>
                <strong>Was bedeutet „10 <span class="unit-frac" aria-label="Meter pro Sekunde"><span class="num">m</span><span class="den">s</span></span>"?</strong><br><br>
                Das heißt: Du legst <strong>10 Meter in 1 Sekunde</strong> zurück.<br><br>
                In der Schrecksekunde (1 Sekunde) fährst du also <strong>10 Meter</strong> weiter – das ist der Reaktionsweg!
            </div>

            <div class="beispiel">
                <div class="beispiel-label">Beispiel: Fahrrad</div>
                Ein Fahrrad fährt mit 5 <span class="unit-frac" aria-label="Meter pro Sekunde"><span class="num">m</span><span class="den">s</span></span> (das sind etwa 18 <span class="unit-frac" aria-label="Kilometer pro Stunde"><span class="num">km</span><span class="den">h</span></span>).<br><br>
                5 <span class="unit-frac" aria-label="Meter pro Sekunde"><span class="num">m</span><span class="den">s</span></span> bedeutet: 5 Meter in 1 Sekunde.<br>
                <strong>Reaktionsweg = 5 Meter</strong>
            </div>

            <div class="uebung">
                <div class="uebung-label">Übung: Wie weit fährst du in der Schrecksekunde?</div>
                <p>Ein Auto fährt mit 20 <span class="unit-frac" aria-label="Meter pro Sekunde"><span class="num">m</span><span class="den">s</span></span>.</p>
                <p>Überlege: Wie viele Meter in 1 Sekunde?</p>
                <p>Reaktionsweg: <input type="number" id="ueb1-input" onchange="checkUebung1()"> Meter</p>
                <div class="feedback" id="ueb1-feedback"></div>
            </div>

            <div class="hefter-hinweis">
                <div class="hefter-hinweis-label">Arbeitsblatt</div>
                <p><strong>→ Aufgabe 2:</strong> Berechne den Reaktionsweg für Fahrrad (5 <span class="unit-frac" aria-label="Meter pro Sekunde"><span class="num">m</span><span class="den">s</span></span>) und Auto (10/20 <span class="unit-frac" aria-label="Meter pro Sekunde"><span class="num">m</span><span class="den">s</span></span>).</p>
            </div>

            <div class="nav-buttons">
                <button class="btn" onclick="goToSection(3)">Zurück</button>
                <button class="btn" onclick="goToSection(5)">Weiter</button>
            </div>
        </section>

        <!-- Sektion 5: Bremsweg -->
        <section class="section" id="section5">
            <h2>5. Der Bremsweg</h2>

            <p>Der <strong>Bremsweg</strong> ist die Strecke, die ein Fahrzeug vom Beginn der Bremsung bis zum Stillstand zurücklegt.</p>

            <p>Der Bremsweg hängt ab von:</p>
            <ul>
                <li><strong>Geschwindigkeit</strong> – je schneller, desto länger</li>
                <li><strong>Straßenzustand</strong> – nasse oder vereiste Straßen = längerer Bremsweg</li>
            </ul>

            <div class="merksatz">
                <div class="merksatz-label">Wichtig</div>
                Bei <strong>doppelter Geschwindigkeit</strong> ist der Bremsweg <strong>4-mal so lang</strong>!
            </div>

            <div class="pflicht-eingabe" id="pflicht5-container">
                <div class="schaetzfrage-label">Pflicht-Aufgabe: Lies im Arbeitsblatt nach!</div>
                <p>Schau auf die <strong>Bremsweg-Tabelle</strong> in deinem Arbeitsblatt.</p>
                <p>Wie lang ist der Bremsweg bei <strong>15 <span class="unit-frac" aria-label="Meter pro Sekunde"><span class="num">m</span><span class="den">s</span></span></strong> auf <strong>Eis</strong>?</p>
                <p style="margin-top:10px;">
                    Bremsweg: <input type="number" id="pflicht5-input" style="width:80px; padding:8px; font-size:1em; text-align:center;"> m
                    <button class="btn" onclick="checkPflicht5()" style="margin-left:10px;">Prüfen</button>
                </p>
                <div class="feedback" id="pflicht5-feedback"></div>
            </div>

            <div class="hefter-hinweis" id="hefter5" style="display:none;">
                <div class="hefter-hinweis-label">Arbeitsblatt</div>
                <p><strong>→ Aufgabe 3:</strong> Lies nun alle Bremswege in der Tabelle ab und trage sie ein.</p>
            </div>

            <div class="nav-buttons">
                <button class="btn" onclick="goToSection(4)">Zurück</button>
                <button class="btn" id="btn-weiter5" onclick="goToSection(6)" disabled title="Löse erst die Pflicht-Aufgabe!">Weiter</button>
            </div>
        </section>

        <!-- Sektion 6: Anhalteweg -->
        <section class="section" id="section6">
            <h2>6. Der Anhalteweg</h2>

            <p>Der <strong>Anhalteweg</strong> ist die <strong>gesamte Strecke</strong> vom Erkennen der Gefahr bis zum Stillstand.</p>

            <div class="formel">
                Anhalteweg = Reaktionsweg + Bremsweg
            </div>

            <div class="luecken-rechnung">
                <div class="schaetzfrage-label">Rechne selbst! (Auto fährt 10 <span class="unit-frac" aria-label="Meter pro Sekunde"><span class="num">m</span><span class="den">s</span></span>, trockene Straße)</div>
                <p style="margin:15px 0;">
                    <strong>Reaktionsweg:</strong>
                    10 <span class="unit-frac" aria-label="Meter pro Sekunde"><span class="num">m</span><span class="den">s</span></span> bedeutet <input type="number" id="lr-sr" style="width:60px;" placeholder="?"> Meter in 1 Sekunde
                </p>
                <p style="margin:15px 0;">
                    <strong>Bremsweg:</strong>
                    <input type="number" id="lr-sb" style="width:60px;" placeholder="?"> Meter
                    <span style="color:var(--text-muted); font-size:0.9em;">(lies in der Tabelle: 10 <span class="unit-frac" aria-label="Meter pro Sekunde"><span class="num">m</span><span class="den">s</span></span>, trocken)</span>
                </p>
                <p style="margin:15px 0;">
                    <strong>Anhalteweg:</strong>
                    <input type="number" id="lr-sr2" style="width:60px;" placeholder="?"> m +
                    <input type="number" id="lr-sb2" style="width:60px;" placeholder="?"> m =
                    <input type="number" id="lr-sa" style="width:60px;" placeholder="?"> m
                </p>
                <button class="btn" onclick="checkLueckenRechnung()">Prüfen</button>
                <div class="feedback" id="lr-feedback"></div>
            </div>

            <div class="hefter-hinweis">
                <div class="hefter-hinweis-label">Arbeitsblatt</div>
                <ul style="margin:5px 0 0 0; padding-left:20px;">
                    <li><strong>→ Skizze:</strong> Beschrifte die Balken (Reaktionsweg, Bremsweg, Anhalteweg)</li>
                    <li><strong>→ Aufgabe 4:</strong> Berechne den Anhalteweg für Fahrrad und Auto</li>
                </ul>
            </div>

            <div class="nav-buttons">
                <button class="btn" onclick="goToSection(5)">Zurück</button>
                <button class="btn" onclick="goToSection(7)">Weiter</button>
            </div>
        </section>

        <!-- Sektion 7: Simulation -->
        <section class="section" id="section7">
            <h2>7. Simulation: Probiere es aus!</h2>

            <p>Verändere die Geschwindigkeit und den Straßenzustand und beobachte, wie sich der Anhalteweg ändert.</p>

            <div class="sim-container">
                <div class="sim-controls">
                    <div class="sim-control">
                        <label for="sim-speed">Geschwindigkeit:</label>
                        <input type="range" id="sim-speed" min="5" max="30" step="5" value="10" onchange="updateSim()">
                        <div class="sim-value" id="sim-speed-value">10 <span class="unit-frac" aria-label="Meter pro Sekunde"><span class="num">m</span><span class="den">s</span></span> (36 <span class="unit-frac" aria-label="Kilometer pro Stunde"><span class="num">km</span><span class="den">h</span></span>)</div>
                    </div>
                    <div class="sim-control">
                        <label for="sim-road">Straßenzustand:</label>
                        <select id="sim-road" onchange="updateSim()">
                            <option value="trocken">Trocken</option>
                            <option value="nass">Nass</option>
                            <option value="eis">Eis / Schnee</option>
                        </select>
                    </div>
                </div>

                <div class="sim-canvas-container">
                    <canvas id="sim-canvas" class="sim-canvas"></canvas>
                </div>

                <div class="sim-results">
                    <div class="sim-result-box reaktion">
                        <div class="sim-result-label">Reaktionsweg</div>
                        <div class="sim-result-value" id="res-reaktion">10 m</div>
                    </div>
                    <div class="sim-result-box brems">
                        <div class="sim-result-label">Bremsweg</div>
                        <div class="sim-result-value" id="res-brems">5 m</div>
                    </div>
                    <div class="sim-result-box anhalt">
                        <div class="sim-result-label">Anhalteweg</div>
                        <div class="sim-result-value" id="res-anhalt">15 m</div>
                    </div>
                </div>
            </div>

            <div class="uebung">
                <div class="uebung-label">Aufgabe: Beobachte und antworte!</div>
                <p>Stelle die Simulation auf <strong>v = 20 <span class="unit-frac" aria-label="Meter pro Sekunde"><span class="num">m</span><span class="den">s</span></span></strong> und <strong>Eis</strong>.</p>
                <p>Wie lang ist der Anhalteweg? <input type="number" id="ueb3-input" onchange="checkUebung3()"> <span class="einheit">m</span></p>
                <div class="feedback" id="ueb3-feedback"></div>
            </div>

            <div class="hefter-hinweis">
                <div class="hefter-hinweis-label">Arbeitsblatt</div>
                <p><strong>→ Aufgabe 5:</strong> Analysiere das Ball-Szenario – berechne den Anhalteweg und bewerte, ob das Auto rechtzeitig hält.</p>
            </div>

            <div class="nav-buttons">
                <button class="btn" onclick="goToSection(6)">Zurück</button>
                <button class="btn" onclick="goToSection(8)">Weiter</button>
            </div>
        </section>

        <!-- Sektion 8: Hefter-Hinweis + Zusammenfassung -->
        <section class="section" id="section8">
            <h2>8. Zusammenfassung</h2>

            <div class="merksatz">
                <div class="merksatz-label">Merksatz</div>
                <p><strong>Anhalteweg = Reaktionsweg + Bremsweg</strong></p>
                <ul>
                    <li><strong>Reaktionsweg:</strong> So viele Meter wie die Geschwindigkeit in m/s angibt (bei 1 Sekunde Reaktionszeit)</li>
                    <li><strong>Bremsweg:</strong> Aus der Tabelle ablesen (abhängig von Geschwindigkeit und Straße)</li>
                </ul>
                <p style="margin-top:10px;"><strong>Je schneller du fährst und je glatter die Straße, desto länger der Anhalteweg!</strong></p>
            </div>

            <div class="mini-quiz">
                <div class="schaetzfrage-label">Mini-Quiz: Teste dein Wissen!</div>

                <div class="quiz-frage">
                    <p><strong>1.</strong> Bei doppelter Geschwindigkeit ist der Bremsweg...</p>
                    <div class="mc-options">
                        <button class="mc-btn" onclick="quizAntwort(1, '2x')">2× so lang</button>
                        <button class="mc-btn" onclick="quizAntwort(1, '4x')">4× so lang</button>
                        <button class="mc-btn" onclick="quizAntwort(1, '8x')">8× so lang</button>
                    </div>
                    <div class="feedback" id="quiz1-feedback"></div>
                </div>

                <div class="quiz-frage">
                    <p><strong>2.</strong> Die Schrecksekunde ist...</p>
                    <div class="mc-options">
                        <button class="mc-btn" onclick="quizAntwort(2, 'brems')">die Bremszeit</button>
                        <button class="mc-btn" onclick="quizAntwort(2, 'reakt')">die Reaktionszeit</button>
                        <button class="mc-btn" onclick="quizAntwort(2, 'anhalt')">der Anhalteweg</button>
                    </div>
                    <div class="feedback" id="quiz2-feedback"></div>
                </div>

                <div class="quiz-frage">
                    <p><strong>3.</strong> Anhalteweg = ...</p>
                    <div class="mc-options">
                        <button class="mc-btn" onclick="quizAntwort(3, 'a')">Reaktionsweg − Bremsweg</button>
                        <button class="mc-btn" onclick="quizAntwort(3, 'b')">Reaktionsweg + Bremsweg</button>
                        <button class="mc-btn" onclick="quizAntwort(3, 'c')">Reaktionsweg × Bremsweg</button>
                    </div>
                    <div class="feedback" id="quiz3-feedback"></div>
                </div>

                <div class="quiz-ergebnis" id="quiz-ergebnis"></div>
            </div>

            <div class="hefter-hinweis">
                <div class="hefter-hinweis-label">Arbeitsblatt</div>
                <p><strong>→ Aufgabe 6:</strong> Nutze die Tabelle rückwärts – bestimme die Geschwindigkeit anhand der Bremsspur.</p>
            </div>

            <h3>Zurück zu Lenas Ball...</h3>
            <p>Das Auto fuhr mit 50 <span class="unit-frac" aria-label="Kilometer pro Stunde"><span class="num">km</span><span class="den">h</span></span> (ca. 14 <span class="unit-frac" aria-label="Meter pro Sekunde"><span class="num">m</span><span class="den">s</span></span>) auf trockener Straße.</p>
            <ul>
                <li>Reaktionsweg: ca. 14 m</li>
                <li>Bremsweg: ca. 10 m</li>
                <li><strong>Anhalteweg: ca. 24 m</strong></li>
            </ul>
            <p id="lena-aufloesung">Der Ball war 30 m entfernt. Das Auto hält nach 24 m – also <strong>6 Meter vor dem Ball</strong>. Geschafft!</p>

            <div id="schaetz-aufloesung" style="display:none; margin:15px 0; padding:15px; background:var(--success-bg); border:1px solid var(--success);">
                <strong>Deine Schätzung vom Anfang:</strong> <span id="deine-schaetzung">-</span><br>
                Die richtige Antwort war: <strong>Ja, knapp!</strong> Das Auto stoppt 6 m vor dem Ball.
            </div>

            <p style="margin-top:20px;"><strong>Gut zu wissen:</strong> Lena hat richtig gehandelt – sie ist am Straßenrand stehen geblieben! Als Radfahrer gilt: Bei Regen oder Eis langsamer fahren, weil der Bremsweg länger wird.</p>

            <div class="nav-buttons">
                <button class="btn" onclick="goToSection(7)">Zurück</button>
                <button class="btn btn-success" onclick="fertigMeldung()">Fertig!</button>
            </div>
        </section>
    </div>

    <script>
        // ES5-kompatibel (kein let/const/arrow)
        var LERNPFAD_ID = 'lp-04-verkehrssicherheit';
        var totalSections = 8;
        var currentSection = 1;
        var EXPIRE_HOURS = 16; // Reset nach 16 Stunden

        // Reaktionszeit-Spiel Variablen
        var gameState = 'idle'; // idle, waiting, ready, done
        var gameStartTime = 0;
        var gameResults = [];
        var gameTimeout = null;

        // Bremsweg-Tabelle
        var bremswegTabelle = {
            trocken: { 5: 2, 10: 5, 15: 10, 20: 20, 30: 45 },
            nass: { 5: 4, 10: 10, 15: 20, 20: 40, 30: 90 },
            eis: { 5: 10, 10: 25, 15: 50, 20: 100, 30: 225 }
        };

        // Navigation
        function goToSection(num) {
            if (num < 1 || num > totalSections) return;

            document.getElementById('section' + currentSection).classList.remove('active');
            document.getElementById('section' + num).classList.add('active');
            currentSection = num;

            updateProgress();
            updateStepNav();
            saveProgress();

            if (num === 7) {
                initSim();
                updateSim();
            }

            window.scrollTo(0, 0);
        }

        function updateProgress() {
            var percent = ((currentSection - 1) / (totalSections - 1)) * 100;
            document.getElementById('progress').style.width = percent + '%';
        }

        // Step Navigation aktualisieren
        function updateStepNav() {
            var dots = document.querySelectorAll('.step-dot');
            for (var i = 0; i < dots.length; i++) {
                dots[i].classList.remove('active', 'completed');
                if (i + 1 < currentSection) {
                    dots[i].classList.add('completed');
                } else if (i + 1 === currentSection) {
                    dots[i].classList.add('active');
                }
            }
        }

        // localStorage mit 16-Stunden-Ablauf
        function saveProgress() {
            try {
                var data = {
                    section: currentSection,
                    timestamp: Date.now()
                };
                localStorage.setItem(LERNPFAD_ID + '-progress', JSON.stringify(data));
            } catch (e) {}
        }

        function loadProgress() {
            try {
                var raw = localStorage.getItem(LERNPFAD_ID + '-progress');
                if (raw) {
                    var data = JSON.parse(raw);
                    var ageMs = Date.now() - data.timestamp;
                    var ageHours = ageMs / (1000 * 60 * 60);

                    if (ageHours >= EXPIRE_HOURS) {
                        // Abgelaufen - Reset
                        localStorage.removeItem(LERNPFAD_ID + '-progress');
                        clearAllInputs();
                        return;
                    }

                    if (data.section && data.section > 1) {
                        goToSection(data.section);
                    }
                }
            } catch (e) {}
        }

        // ══════════════════════════════════════════════════════════
        // INPUT-PERSISTENZ
        // ══════════════════════════════════════════════════════════

        function saveInput(id, value) {
            try {
                localStorage.setItem(LERNPFAD_ID + '-' + id, value);
            } catch (e) {}
        }

        function loadInput(id) {
            try {
                return localStorage.getItem(LERNPFAD_ID + '-' + id) || '';
            } catch (e) {
                return '';
            }
        }

        function clearAllInputs() {
            // Alle gespeicherten Eingaben löschen
            var inputIds = [
                'ueb1-input', 'ueb3-input', 'pflicht5-input',
                'lr-v', 'lr-sr', 'lr-sb', 'lr-sr2', 'lr-sb2', 'lr-sa',
                'sort-a', 'sort-b', 'sort-c', 'sort-d'
            ];
            for (var i = 0; i < inputIds.length; i++) {
                try {
                    localStorage.removeItem(LERNPFAD_ID + '-' + inputIds[i]);
                } catch (e) {}
            }
        }

        function loadAllInputs() {
            // Inputs wiederherstellen
            var inputs = document.querySelectorAll('input[type="number"], select');
            for (var i = 0; i < inputs.length; i++) {
                var el = inputs[i];
                if (el.id) {
                    var saved = loadInput(el.id);
                    if (saved) {
                        el.value = saved;
                    }
                }
            }

            // Pflicht-Button ggf. aktivieren
            var pflichtInput = document.getElementById('pflicht5-input');
            if (pflichtInput && pflichtInput.value === '50') {
                var container = document.getElementById('pflicht5-container');
                var hefter = document.getElementById('hefter5');
                var btnWeiter = document.getElementById('btn-weiter5');
                if (container) container.classList.add('erfolg');
                if (hefter) hefter.style.display = 'block';
                if (btnWeiter) {
                    btnWeiter.disabled = false;
                    btnWeiter.title = '';
                }
            }
        }

        function setupInputPersistence() {
            // Event-Listener für alle Inputs
            var inputs = document.querySelectorAll('input[type="number"], select');
            for (var i = 0; i < inputs.length; i++) {
                (function(el) {
                    if (el.id) {
                        el.addEventListener('change', function() {
                            saveInput(el.id, el.value);
                        });
                        el.addEventListener('input', function() {
                            saveInput(el.id, el.value);
                        });
                    }
                })(inputs[i]);
            }
        }

        // Reaktionszeit-Spiel
        function handleGameClick() {
            var btn = document.getElementById('game-btn');

            if (gameState === 'idle') {
                startGameRound();
            } else if (gameState === 'waiting') {
                // Zu früh geklickt!
                clearTimeout(gameTimeout);
                btn.textContent = 'Zu früh! Nochmal...';
                btn.style.background = '#c62828';
                setTimeout(function() {
                    btn.style.background = '#2c5aa0';
                    startGameRound();
                }, 1000);
            } else if (gameState === 'ready') {
                // Reaktionszeit messen
                var reactionTime = (performance.now() - gameStartTime) / 1000;
                gameResults.push(reactionTime);

                document.getElementById('licht-gruen').classList.remove('an');
                document.getElementById('game-result').textContent = reactionTime.toLocaleString('de-DE', {minimumFractionDigits: 3, maximumFractionDigits: 3}) + ' Sekunden!';
                document.getElementById('game-result').className = 'game-result ' + (reactionTime < 0.3 ? 'gut' : 'normal');

                document.getElementById('versuch-count').textContent = gameResults.length;

                if (gameResults.length >= 3) {
                    showGameResults();
                } else {
                    btn.textContent = 'Nächster Versuch';
                    gameState = 'idle';
                }
            }
        }

        function startGameRound() {
            var btn = document.getElementById('game-btn');
            btn.textContent = 'Warten...';
            gameState = 'waiting';

            document.getElementById('licht-rot').classList.add('an');
            document.getElementById('licht-gelb').classList.remove('an');
            document.getElementById('licht-gruen').classList.remove('an');
            document.getElementById('game-result').textContent = '';

            var waitTime = 2000 + Math.random() * 3000; // 2-5 Sekunden

            gameTimeout = setTimeout(function() {
                document.getElementById('licht-rot').classList.remove('an');
                document.getElementById('licht-gruen').classList.add('an');
                btn.textContent = 'KLICK!';
                btn.style.background = '#2a7a4b';
                gameState = 'ready';
                gameStartTime = performance.now();
            }, waitTime);
        }

        function showGameResults() {
            var btn = document.getElementById('game-btn');
            btn.disabled = true;
            btn.textContent = 'Fertig!';
            btn.style.background = '#2a7a4b';
            gameState = 'done';

            var sum = 0;
            for (var i = 0; i < gameResults.length; i++) {
                sum += gameResults[i];
            }
            var avg = sum / gameResults.length;

            document.getElementById('game-durchschnitt').style.display = 'block';
            document.getElementById('avg-time').textContent = avg.toLocaleString('de-DE', {minimumFractionDigits: 3, maximumFractionDigits: 3}) + ' s';

            document.getElementById('game-erklaerung').style.display = 'block';
            document.getElementById('dein-ergebnis').textContent = avg.toLocaleString('de-DE', {minimumFractionDigits: 3, maximumFractionDigits: 3}) + ' s';
        }

        // Übungen
        function checkUebung1() {
            var input = document.getElementById('ueb1-input');
            var feedback = document.getElementById('ueb1-feedback');
            var value = parseFloat(input.value);

            if (value === 20) {
                feedback.className = 'feedback richtig';
                feedback.innerHTML = 'Richtig! s<sub>R</sub> = 20 <span class="unit-frac" aria-label="Meter pro Sekunde"><span class="num">m</span><span class="den">s</span></span> · 1 s = 20 m';
            } else {
                feedback.className = 'feedback falsch';
                feedback.innerHTML = 'Nicht ganz. Tipp: s<sub>R</sub> = v · t = 20 <span class="unit-frac" aria-label="Meter pro Sekunde"><span class="num">m</span><span class="den">s</span></span> · 1 s = ?';
            }
        }

        function checkUebung3() {
            var input = document.getElementById('ueb3-input');
            var feedback = document.getElementById('ueb3-feedback');
            var value = parseFloat(input.value);

            if (value === 120) {
                feedback.className = 'feedback richtig';
                feedback.textContent = 'Richtig! Reaktionsweg (20 m) + Bremsweg auf Eis (100 m) = 120 m';
            } else {
                feedback.className = 'feedback falsch';
                feedback.innerHTML = 'Stelle die Simulation auf v = 20 <span class="unit-frac" aria-label="Meter pro Sekunde"><span class="num">m</span><span class="den">s</span></span> und Eis. Lies den Anhalteweg ab!';
            }
        }

        // ══════════════════════════════════════════════════════════
        // NEUE INTERAKTIONEN
        // ══════════════════════════════════════════════════════════

        // Schätzfragen speichern
        var schaetzungen = {};

        function selectSchaetzung(nr, antwort) {
            schaetzungen[nr] = antwort;
            var options = document.getElementById('schaetz' + nr + '-options');
            var feedback = document.getElementById('schaetz' + nr + '-feedback');
            var btns = options.querySelectorAll('.mc-btn');

            // Alle Buttons deaktivieren, gewählten markieren
            for (var i = 0; i < btns.length; i++) {
                btns[i].disabled = true;
                btns[i].classList.remove('selected');
            }
            event.target.classList.add('selected');

            // Feedback je nach Sektion
            if (nr === 1) {
                feedback.className = 'feedback richtig';
                feedback.innerHTML = 'Deine Schätzung: <strong>' + (antwort === 'ja' ? 'Ja, knapp' : antwort === 'nein' ? 'Nein, zu spät' : 'Weiß nicht') + '</strong>. Am Ende lösen wir auf!';
            } else if (nr === 4) {
                if (antwort === '20') {
                    feedback.className = 'feedback richtig';
                    feedback.innerHTML = 'Richtig! Bei 20 m/s und 1 s Reaktionszeit: 20 m Reaktionsweg.';
                } else {
                    feedback.className = 'feedback falsch';
                    feedback.innerHTML = 'Nicht ganz. s = v · t = 20 m/s · 1 s = 20 m';
                }
            }
        }

        // Sortier-Quiz (Sektion 2)
        // Drag & Drop Sortierung (iPad-tauglich)
        var sortierItems = [
            { id: 'sehen', correct: 1, text: '<strong>Sehen:</strong><br>Die Augen nehmen das Hindernis wahr' },
            { id: 'erkennen', correct: 2, text: '<strong>Erkennen:</strong><br>Das Gehirn versteht: „Gefahr!"' },
            { id: 'entscheiden', correct: 3, text: '<strong>Entscheiden:</strong><br>Das Gehirn entscheidet: „Bremsen!"' },
            { id: 'handeln', correct: 4, text: '<strong>Handeln:</strong><br>Der Fuß bewegt sich zum Bremspedal' }
        ];
        var sortierState = {}; // slot -> itemId mapping
        var draggedItem = null;

        function shuffleArray(arr) {
            var shuffled = arr.slice();
            for (var i = shuffled.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = shuffled[i];
                shuffled[i] = shuffled[j];
                shuffled[j] = temp;
            }
            // Sicherstellen, dass nicht zufällig richtige Reihenfolge
            var isCorrectOrder = true;
            for (var k = 0; k < shuffled.length; k++) {
                if (shuffled[k].correct !== k + 1) {
                    isCorrectOrder = false;
                    break;
                }
            }
            if (isCorrectOrder && shuffled.length > 1) {
                // Tausche erste zwei Elemente
                var tmp = shuffled[0];
                shuffled[0] = shuffled[1];
                shuffled[1] = tmp;
            }
            return shuffled;
        }

        function initSortierung() {
            var container = document.getElementById('sortier-items');
            if (!container) return;
            container.innerHTML = '';
            sortierState = {};

            // Slots zurücksetzen
            document.querySelectorAll('.sortier-slot').forEach(function(slot) {
                slot.classList.remove('filled');
                var placedText = slot.querySelector('.sortier-placed-text');
                if (placedText) placedText.remove();
                var label = slot.querySelector('.sortier-slot-label');
                if (label) label.style.display = '';
            });

            var shuffled = shuffleArray(sortierItems);

            shuffled.forEach(function(item) {
                var div = document.createElement('div');
                div.className = 'sortier-item';
                div.setAttribute('data-id', item.id);
                div.setAttribute('draggable', 'true');
                div.innerHTML = '<span class="sortier-item-text">' + item.text + '</span>';

                // Mouse events
                div.addEventListener('dragstart', handleDragStart);
                div.addEventListener('dragend', handleDragEnd);

                // Touch events für iPad
                div.addEventListener('touchstart', handleTouchStart, {passive: false});
                div.addEventListener('touchmove', handleTouchMove, {passive: false});
                div.addEventListener('touchend', handleTouchEnd);

                container.appendChild(div);
            });

            // Drop zones
            var slots = document.querySelectorAll('.sortier-slot');
            slots.forEach(function(slot) {
                slot.addEventListener('dragover', handleDragOver);
                slot.addEventListener('dragleave', handleDragLeave);
                slot.addEventListener('drop', handleDrop);
            });

            document.getElementById('sort-feedback').style.display = 'none';
        }

        function handleDragStart(e) {
            draggedItem = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            document.querySelectorAll('.sortier-slot').forEach(function(s) {
                s.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            e.preventDefault();
            this.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            if (draggedItem) {
                placeItem(draggedItem, this);
            }
        }

        // Touch handling für iPad
        function handleTouchStart(e) {
            e.preventDefault();
            draggedItem = this;
            this.classList.add('dragging');
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (!draggedItem) return;
            var touch = e.touches[0];
            var target = document.elementFromPoint(touch.clientX, touch.clientY);

            document.querySelectorAll('.sortier-slot').forEach(function(s) {
                s.classList.remove('drag-over');
            });

            // Auch parent prüfen (falls auf Kind-Element)
            while (target && !target.classList.contains('sortier-slot')) {
                target = target.parentElement;
            }
            if (target && target.classList.contains('sortier-slot')) {
                target.classList.add('drag-over');
            }
        }

        function handleTouchEnd(e) {
            if (!draggedItem) return;
            draggedItem.classList.remove('dragging');

            var touch = e.changedTouches[0];
            var target = document.elementFromPoint(touch.clientX, touch.clientY);

            // Auch parent prüfen
            while (target && !target.classList.contains('sortier-slot')) {
                target = target.parentElement;
            }
            if (target && target.classList.contains('sortier-slot')) {
                placeItem(draggedItem, target);
            }

            document.querySelectorAll('.sortier-slot').forEach(function(s) {
                s.classList.remove('drag-over');
            });
            draggedItem = null;
        }

        function getItemById(itemId) {
            for (var i = 0; i < sortierItems.length; i++) {
                if (sortierItems[i].id === itemId) return sortierItems[i];
            }
            return null;
        }

        function placeItem(item, slot) {
            var itemId = item.getAttribute('data-id');
            var pos = parseInt(slot.getAttribute('data-pos'));
            var itemData = getItemById(itemId);

            // Entferne Item aus altem Slot falls vorhanden
            for (var key in sortierState) {
                if (sortierState[key] === itemId) {
                    var oldSlot = document.querySelector('.sortier-slot[data-pos="' + key + '"]');
                    oldSlot.classList.remove('filled');
                    var oldText = oldSlot.querySelector('.sortier-placed-text');
                    if (oldText) oldText.remove();
                    var oldLabel = oldSlot.querySelector('.sortier-slot-label');
                    if (oldLabel) oldLabel.style.display = '';
                    delete sortierState[key];
                }
            }

            // Wenn Slot bereits belegt, altes Item zurück in Liste
            if (sortierState[pos]) {
                var oldItemId = sortierState[pos];
                var oldItem = document.querySelector('.sortier-item[data-id="' + oldItemId + '"]');
                if (oldItem) {
                    oldItem.classList.remove('placed');
                }
            }

            // Item in Slot platzieren
            sortierState[pos] = itemId;
            slot.classList.add('filled');
            item.classList.add('placed');

            // Text im Slot anzeigen
            var label = slot.querySelector('.sortier-slot-label');
            if (label) label.style.display = 'none';

            var placedText = slot.querySelector('.sortier-placed-text');
            if (!placedText) {
                placedText = document.createElement('span');
                placedText.className = 'sortier-placed-text';
                slot.appendChild(placedText);
            }
            placedText.innerHTML = itemData.text;

            checkSortierung();
        }

        function checkSortierung() {
            var feedback = document.getElementById('sort-feedback');

            // Prüfen ob alle 4 platziert
            if (Object.keys(sortierState).length < 4) {
                feedback.style.display = 'none';
                return;
            }

            var allCorrect = true;
            sortierItems.forEach(function(item) {
                var placedPos = null;
                for (var pos in sortierState) {
                    if (sortierState[pos] === item.id) {
                        placedPos = parseInt(pos);
                        break;
                    }
                }
                if (placedPos !== item.correct) {
                    allCorrect = false;
                }
            });

            if (allCorrect) {
                feedback.className = 'feedback richtig';
                feedback.innerHTML = 'Richtig! Sehen → Erkennen → Entscheiden → Handeln';
            } else {
                feedback.className = 'feedback falsch';
                feedback.innerHTML = 'Noch nicht ganz. Tipp: Was passiert zuerst? Die Augen sehen etwas...';
            }
            feedback.style.display = 'block';
        }

        function resetSortierung() {
            document.getElementById('sort-feedback').style.display = 'none';
            initSortierung();
        }

        // Pflicht-Abfrage Bremsweg (Sektion 5)
        function checkPflicht5() {
            var input = document.getElementById('pflicht5-input');
            var feedback = document.getElementById('pflicht5-feedback');
            var container = document.getElementById('pflicht5-container');
            var hefter = document.getElementById('hefter5');
            var btnWeiter = document.getElementById('btn-weiter5');
            var value = parseFloat(input.value);

            // 15 m/s auf Eis = 50 m (aus Tabelle)
            if (value === 50) {
                feedback.className = 'feedback richtig';
                feedback.innerHTML = 'Richtig! Bei 15 m/s auf Eis: Bremsweg = 50 m';
                container.classList.add('erfolg');
                hefter.style.display = 'block';
                btnWeiter.disabled = false;
                btnWeiter.title = '';
            } else {
                feedback.className = 'feedback falsch';
                feedback.innerHTML = 'Schau nochmal in der Tabelle nach: Zeile „15 m/s", Spalte „Eis"';
            }
        }

        // Lücken-Rechnung (Sektion 6) - vereinfacht
        function checkLueckenRechnung() {
            var sr = parseFloat(document.getElementById('lr-sr').value);
            var sb = parseFloat(document.getElementById('lr-sb').value);
            var sr2 = parseFloat(document.getElementById('lr-sr2').value);
            var sb2 = parseFloat(document.getElementById('lr-sb2').value);
            var sa = parseFloat(document.getElementById('lr-sa').value);
            var feedback = document.getElementById('lr-feedback');

            // Erwartete Werte: sr=10, sb=5, sr2=10, sb2=5, sa=15
            var fehler = [];

            function markInput(id, korrekt) {
                var el = document.getElementById(id);
                el.classList.remove('korrekt', 'falsch');
                el.classList.add(korrekt ? 'korrekt' : 'falsch');
            }

            markInput('lr-sr', sr === 10);
            markInput('lr-sb', sb === 5);
            markInput('lr-sr2', sr2 === 10);
            markInput('lr-sb2', sb2 === 5);
            markInput('lr-sa', sa === 15);

            if (sr !== 10) fehler.push('Reaktionsweg = 10 (weil 10 m/s = 10 m in 1 s)');
            if (sb !== 5) fehler.push('Bremsweg = 5 (aus Tabelle: 10 m/s, trocken)');
            if (sa !== 15) fehler.push('Anhalteweg = 10 + 5 = 15');

            if (fehler.length === 0) {
                feedback.className = 'feedback richtig';
                feedback.innerHTML = 'Super! Das Auto braucht 15 Meter zum Anhalten.';
            } else {
                feedback.className = 'feedback falsch';
                feedback.innerHTML = 'Noch nicht ganz. Tipp: ' + fehler[0];
            }
        }

        // Mini-Quiz (Sektion 8)
        var quizPunkte = 0;
        var quizBeantwortet = 0;

        function quizAntwort(frage, antwort) {
            var feedback = document.getElementById('quiz' + frage + '-feedback');
            var btns = feedback.parentElement.querySelectorAll('.mc-btn');

            // Buttons deaktivieren
            for (var i = 0; i < btns.length; i++) {
                btns[i].disabled = true;
            }
            event.target.classList.add('selected');

            quizBeantwortet++;

            // Richtige Antworten: 1='4x', 2='reakt', 3='b'
            var richtig = false;
            if (frage === 1 && antwort === '4x') richtig = true;
            if (frage === 2 && antwort === 'reakt') richtig = true;
            if (frage === 3 && antwort === 'b') richtig = true;

            if (richtig) {
                quizPunkte++;
                feedback.className = 'feedback richtig';
                feedback.innerHTML = 'Richtig!';
            } else {
                feedback.className = 'feedback falsch';
                if (frage === 1) feedback.innerHTML = 'Nicht ganz. Bei doppelter Geschwindigkeit ist der Bremsweg 4× so lang!';
                if (frage === 2) feedback.innerHTML = 'Nicht ganz. Die Schrecksekunde ist die Reaktionszeit.';
                if (frage === 3) feedback.innerHTML = 'Nicht ganz. Anhalteweg = Reaktionsweg + Bremsweg';
            }

            // Alle beantwortet?
            if (quizBeantwortet === 3) {
                var ergebnis = document.getElementById('quiz-ergebnis');
                ergebnis.className = 'quiz-ergebnis show';
                if (quizPunkte === 3) {
                    ergebnis.style.background = 'var(--success-bg)';
                    ergebnis.style.color = 'var(--success)';
                    ergebnis.innerHTML = '★★★ Perfekt! 3/3 richtig!';
                } else if (quizPunkte === 2) {
                    ergebnis.style.background = 'var(--success-bg)';
                    ergebnis.style.color = 'var(--success)';
                    ergebnis.innerHTML = '★★ Gut! 2/3 richtig.';
                } else {
                    ergebnis.style.background = 'var(--warning-bg)';
                    ergebnis.style.color = 'var(--warning)';
                    ergebnis.innerHTML = quizPunkte + '/3 richtig. Schau dir die Merksätze nochmal an!';
                }

                // Schätzung auflösen
                if (schaetzungen[1]) {
                    document.getElementById('schaetz-aufloesung').style.display = 'block';
                    var text = schaetzungen[1] === 'ja' ? 'Ja, knapp' : schaetzungen[1] === 'nein' ? 'Nein, zu spät' : 'Weiß nicht';
                    document.getElementById('deine-schaetzung').textContent = text;
                }
            }
        }

        // Fertig-Button
        function fertigMeldung() {
            alert('Gut gemacht! Du hast den Lernpfad abgeschlossen. Bearbeite jetzt das Arbeitsblatt vollständig!');
        }

        // Simulation
        function initSim() {
            var canvas = document.getElementById('sim-canvas');
            if (!canvas) return;

            // Canvas-Größe an Container anpassen
            var container = canvas.parentElement;
            canvas.width = container.clientWidth - 20;
            canvas.height = 180;
        }

        function updateSim() {
            var speedSlider = document.getElementById('sim-speed');
            var roadSelect = document.getElementById('sim-road');

            if (!speedSlider || !roadSelect) return;

            var v = parseInt(speedSlider.value);
            var road = roadSelect.value;

            // Geschwindigkeitsanzeige aktualisieren (ISO 80000)
            var kmh = v * 3.6;
            document.getElementById('sim-speed-value').innerHTML = v + ' <span class="unit-frac" aria-label="Meter pro Sekunde"><span class="num">m</span><span class="den">s</span></span> (' + Math.round(kmh) + ' <span class="unit-frac" aria-label="Kilometer pro Stunde"><span class="num">km</span><span class="den">h</span></span>)';

            // Reaktionsweg
            var reaktionsweg = v; // bei t = 1s

            // Bremsweg aus Tabelle
            var bremsweg = bremswegTabelle[road][v];

            // Anhalteweg
            var anhalteweg = reaktionsweg + bremsweg;

            // Ergebnisse anzeigen
            document.getElementById('res-reaktion').textContent = reaktionsweg + ' m';
            document.getElementById('res-brems').textContent = bremsweg + ' m';
            document.getElementById('res-anhalt').textContent = anhalteweg + ' m';

            // Canvas zeichnen
            drawSim(reaktionsweg, bremsweg, anhalteweg, road);
        }

        function drawSim(reaktionsweg, bremsweg, anhalteweg, road) {
            var canvas = document.getElementById('sim-canvas');
            if (!canvas) return;

            var ctx = canvas.getContext('2d');
            var w = canvas.width;
            var h = canvas.height;

            // Clear
            ctx.fillStyle = '#f5f5f5';
            ctx.fillRect(0, 0, w, h);

            // Straße
            var strasseY = h - 60;
            ctx.fillStyle = road === 'eis' ? '#b3e5fc' : (road === 'nass' ? '#90a4ae' : '#616161');
            ctx.fillRect(0, strasseY, w, 40);

            // Straßenmarkierung
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.setLineDash([20, 15]);
            ctx.beginPath();
            ctx.moveTo(0, strasseY + 20);
            ctx.lineTo(w, strasseY + 20);
            ctx.stroke();
            ctx.setLineDash([]);

            // Skalierung berechnen
            var maxWeg = 150; // Maximale Darstellung
            var scale = (w - 100) / maxWeg;
            var startX = 50;

            // Balken zeichnen
            var balkenY = 50;
            var balkenH = 30;

            // Reaktionsweg (blau)
            ctx.fillStyle = '#2196f3';
            ctx.fillRect(startX, balkenY, reaktionsweg * scale, balkenH);

            // Bremsweg (orange)
            ctx.fillStyle = '#ff9800';
            ctx.fillRect(startX + reaktionsweg * scale, balkenY, bremsweg * scale, balkenH);

            // Beschriftungen
            ctx.fillStyle = '#333';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';

            if (reaktionsweg * scale > 30) {
                ctx.fillStyle = '#fff';
                ctx.fillText(reaktionsweg + ' m', startX + (reaktionsweg * scale) / 2, balkenY + 20);
            }

            if (bremsweg * scale > 30) {
                ctx.fillStyle = '#fff';
                ctx.fillText(bremsweg + ' m', startX + reaktionsweg * scale + (bremsweg * scale) / 2, balkenY + 20);
            }

            // Auto (einfach)
            var autoX = startX - 35;
            ctx.fillStyle = '#c62828';
            ctx.fillRect(autoX, strasseY - 25, 40, 20);
            ctx.fillRect(autoX + 5, strasseY - 35, 25, 12);

            // Räder
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(autoX + 8, strasseY - 3, 6, 0, Math.PI * 2);
            ctx.arc(autoX + 32, strasseY - 3, 6, 0, Math.PI * 2);
            ctx.fill();

            // Hindernis (Kind/Ball)
            var hindernisX = startX + anhalteweg * scale + 20;
            ctx.fillStyle = '#ff5722';
            ctx.beginPath();
            ctx.arc(hindernisX, strasseY - 10, 10, 0, Math.PI * 2);
            ctx.fill();

            // Legende unten
            ctx.fillStyle = '#333';
            ctx.font = '11px sans-serif';
            ctx.textAlign = 'left';

            ctx.fillStyle = '#2196f3';
            ctx.fillRect(startX, h - 15, 15, 10);
            ctx.fillStyle = '#333';
            ctx.fillText('Reaktionsweg', startX + 20, h - 6);

            ctx.fillStyle = '#ff9800';
            ctx.fillRect(startX + 120, h - 15, 15, 10);
            ctx.fillStyle = '#333';
            ctx.fillText('Bremsweg', startX + 140, h - 6);

            // Gesamt
            ctx.textAlign = 'right';
            ctx.fillStyle = '#4caf50';
            ctx.font = 'bold 14px sans-serif';
            ctx.fillText('Anhalteweg: ' + anhalteweg + ' m', w - 10, h - 6);
        }

        // Initialisierung
        window.onload = function() {
            updateProgress();
            updateStepNav();
            setupInputPersistence();
            loadProgress();
            loadAllInputs();
            initSortierung();

            // Simulation initialisieren wenn Sektion 7 aktiv
            if (currentSection === 7) {
                initSim();
                updateSim();
            }
        };

        window.onresize = function() {
            if (currentSection === 7) {
                initSim();
                updateSim();
            }
        };
    </script>
</body>
</html>
