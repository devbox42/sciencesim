<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stundenleistung: Bewegungsarten</title>
    <style>
        /* ═══════════════════════════════════════════════════════════════
           MINT-MINITEST: Bewegungsarten | Physik Klasse 6
           BE-Struktur: * = 25 BE | ** = 31 BE | *** = 35 BE
           ═══════════════════════════════════════════════════════════════ */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
            color: #222;
            font-size: 16px;
            line-height: 1.5;
        }
        .container { max-width: 850px; margin: 0 auto; padding: 20px; }

        header {
            background: #2c5aa0;
            color: white;
            padding: 15px 20px;
        }
        header h1 { font-size: 1.3em; font-weight: 600; }
        .header-info { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; margin-top: 8px; }
        .header-info .meta { font-size: 0.85em; opacity: 0.9; }

        .progress-container { background: white; padding: 10px 20px; border-bottom: 1px solid #ddd; display: flex; align-items: center; gap: 15px; }
        .progress-bar { flex: 1; background: #e0e0e0; height: 8px; }
        .progress-fill { background: #2c5aa0; height: 100%; width: 0%; transition: width 0.3s; }
        .progress-text { font-size: 0.85em; color: #666; min-width: 120px; }

        .question { background: white; border: 1px solid #ddd; margin: 15px 0; padding: 20px; }
        .question-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; flex-wrap: wrap; gap: 8px; }
        .question-title { color: #2c5aa0; font-weight: 600; font-size: 1em; }
        .question-meta { display: flex; gap: 8px; align-items: center; }
        .question-niveau { padding: 2px 8px; font-size: 0.8em; font-weight: 600; border-radius: 3px; }
        .niveau-1 { background: #e8f5e9; color: #2a7a4b; }
        .niveau-2 { background: #e3f2fd; color: #2c5aa0; }
        .niveau-3 { background: #f3e5f5; color: #7b1fa2; }
        .question-points { background: #f0f0f0; padding: 3px 10px; font-size: 0.8em; color: #666; }
        .question-text { margin-bottom: 15px; }
        .question-result { display: inline-block; padding: 3px 10px; font-size: 0.8em; font-weight: 600; margin-left: 8px; }
        .question-result.full { background: #e8f5e9; color: #2a7a4b; }
        .question-result.partial { background: #fff3e0; color: #b35c00; }
        .question-result.zero { background: #ffebee; color: #c62828; }

        .feedback-box { padding: 12px 15px; margin: 10px 0; font-size: 0.9em; display: none; }
        .feedback-box.show { display: block; }
        .feedback-box.correct { background: #e8f5e9; border-left: 3px solid #2a7a4b; }
        .feedback-box.incorrect { background: #ffebee; border-left: 3px solid #c62828; }

        .lueckentext { line-height: 2.2; font-size: 1em; }
        .lueckentext select {
            padding: 4px 8px;
            font-size: 0.95em;
            border: 1px solid #2c5aa0;
            border-radius: 2px;
            background: #fafafa;
            min-width: 120px;
        }
        .lueckentext select.correct { border-color: #2a7a4b; background: #e8f5e9; }
        .lueckentext select.incorrect { border-color: #c62828; background: #ffebee; }

        .zuordnung-table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
        .zuordnung-table th { background: #2c5aa0; color: white; padding: 8px 6px; text-align: center; font-size: 0.85em; }
        .zuordnung-table td { border: 1px solid #ddd; padding: 8px 6px; }
        .zuordnung-table td:first-child { font-weight: 500; }
        .zuordnung-table td:not(:first-child) { text-align: center; }
        .zuordnung-table tr:nth-child(even) { background: #fafafa; }
        .zuordnung-table input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        .zuordnung-table input.correct-check { accent-color: #2a7a4b; }
        .zuordnung-table input.incorrect-check { accent-color: #c62828; outline: 2px solid #c62828; }
        .zuordnung-table input.missed-check { outline: 2px dashed #b35c00; }

        .hinweis { background: #fff3e0; border: 1px solid #b35c00; padding: 8px 12px; margin-bottom: 15px; font-size: 0.85em; color: #b35c00; }

        .submit-section { background: white; padding: 20px; border: 1px solid #ddd; margin: 20px 0; text-align: center; }
        button { background: #2c5aa0; color: white; border: none; padding: 12px 30px; font-size: 1em; cursor: pointer; margin: 5px; }
        button:hover { background: #1e4080; }
        button:disabled { background: #aaa; cursor: not-allowed; }
        button.btn-secondary { background: #666; }

        .results { background: white; border: 2px solid #2c5aa0; padding: 25px; margin: 20px 0; text-align: center; }
        .results h2 { color: #2c5aa0; margin-bottom: 15px; }
        .results .score { font-size: 3em; font-weight: bold; color: #2c5aa0; }
        .results .grade { font-size: 1.5em; margin: 10px 0; }
        .grade-table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 0.8em; }
        .grade-table th, .grade-table td { border: 1px solid #ddd; padding: 5px 6px; text-align: center; }
        .grade-table th { background: #2c5aa0; color: white; }
        .grade-table .current { background: #e8f5e9; font-weight: bold; }

        .hidden { display: none; }

        @media print {
            button, .progress-container, .selection-row { display: none; }
            .question { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Stundenleistung: Bewegungsarten</h1>
        <div class="header-info">
            <div class="meta">Physik Klasse 6 | Differenziert (*//**/***)</div>
        </div>
    </header>

    <div class="selection-row" style="display: flex; gap: 20px; flex-wrap: wrap; margin: 15px 0;">
        <div class="seat-field" style="flex: 1; min-width: 280px; padding: 15px; background: #fff; border: 1px solid #ddd;">
            <label style="font-weight: 600; font-size: 0.9em; color: #2c5aa0; display: block; margin-bottom: 8px;">Platznummer:</label>
            <div id="seatWarning" style="background: #fff3e0; border: 1px solid #b35c00; padding: 8px 10px; margin-bottom: 10px; font-size: 0.8em; color: #b35c00;">
                Kann nach OK <strong>nicht mehr geändert</strong> werden!
            </div>
            <div id="seatRow" style="display: flex; align-items: center; gap: 8px;">
                <select id="seatSelect" style="padding: 8px 12px; font-size: 1em; border: 1px solid #2c5aa0; min-width: 100px;">
                    <option value="">-- wählen --</option>
                </select>
                <button id="btnSeatOk" onclick="confirmSeat()" style="padding: 8px 15px; font-size: 0.9em;">OK</button>
            </div>
            <div id="seatConfirmed" style="display: none; font-size: 1em; color: #2a7a4b; font-weight: 600;"></div>
            <input type="hidden" id="seatNumber" value="">
        </div>

        <div class="niveau-field" style="flex: 1; min-width: 280px; padding: 15px; background: #fff; border: 1px solid #ddd;">
            <label style="font-weight: 600; font-size: 0.9em; color: #2c5aa0; display: block; margin-bottom: 8px;">Niveau:</label>
            <div id="niveauWarning" style="background: #fff3e0; border: 1px solid #b35c00; padding: 8px 10px; margin-bottom: 10px; font-size: 0.8em; color: #b35c00;">
                Kann nach OK <strong>nicht mehr geändert</strong> werden!
            </div>
            <div id="niveauRow" style="display: flex; align-items: center; gap: 8px;">
                <select id="niveauSelect" style="padding: 8px 12px; font-size: 1em; border: 1px solid #2c5aa0; min-width: 180px;">
                    <option value="">-- wählen --</option>
                    <option value="1">* Basis (25 BE)</option>
                    <option value="2">** Standard (31 BE)</option>
                    <option value="3">*** Erweitert (35 BE)</option>
                </select>
                <button id="btnNiveauOk" onclick="confirmNiveau()" style="padding: 8px 15px; font-size: 0.9em;">OK</button>
            </div>
            <div id="niveauConfirmed" style="display: none; font-size: 1em; color: #2a7a4b; font-weight: 600;"></div>
        </div>
    </div>

    <div class="progress-container">
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        <div class="progress-text" id="progressText">Niveau wählen...</div>
    </div>

    <div class="container">
        <!-- ═══════════════════════════════════════════════════════════════════════
             AUFGABE 1: Lückentext - Was ist Bewegung? (5 BE)
             ═══════════════════════════════════════════════════════════════════════ -->
        <div class="question" id="q1" data-niveau="1" data-points="5">
            <div class="question-header">
                <div class="question-title">Aufgabe 1: Was ist Bewegung?</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">5 BE</span>
                </div>
            </div>
            <div class="question-text">Ergänze den Lückentext.</div>
            <div class="lueckentext">
                Ein Körper ist in <select id="q1-a"><option value="">---</option><option value="bewegung">Bewegung</option><option value="ruhe">Ruhe</option><option value="schwingung">Schwingung</option></select>,
                wenn er seinen <select id="q1-b"><option value="">---</option><option value="ort">Ort</option><option value="namen">Namen</option><option value="zustand">Zustand</option></select>
                verändert. Die <select id="q1-c"><option value="">---</option><option value="bahnform">Bahnform</option><option value="farbe">Farbe</option><option value="masse">Masse</option></select>
                beschreibt, wie der Weg aussieht. Die <select id="q1-d"><option value="">---</option><option value="bewegungsart">Bewegungsart</option><option value="bahnform">Bahnform</option><option value="richtung">Richtung</option></select>
                beschreibt, ob sich die <select id="q1-e"><option value="">---</option><option value="geschwindigkeit">Geschwindigkeit</option><option value="farbe">Farbe</option><option value="masse">Masse</option></select> ändert.
            </div>
            <div class="feedback-box correct" id="q1-fb-correct">Richtig! Ein Körper bewegt sich, wenn er seinen Ort verändert.</div>
            <div class="feedback-box incorrect" id="q1-fb-incorrect">Nicht ganz. Bewegung = Ortsveränderung. Bahnform = Weg. Bewegungsart = Geschwindigkeitsänderung.</div>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════════
             AUFGABE 2: Lückentext - Bahnformen (2 BE)
             ═══════════════════════════════════════════════════════════════════════ -->
        <div class="question" id="q2" data-niveau="1" data-points="2">
            <div class="question-header">
                <div class="question-title">Aufgabe 2: Bahnformen</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">2 BE</span>
                </div>
            </div>
            <div class="question-text">Ergänze die zwei Bahnformen.</div>
            <div class="lueckentext">
                Es gibt zwei Bahnformen:
                <select id="q2-a"><option value="">---</option><option value="geradlinig">geradlinig</option><option value="krummlinig">krummlinig</option><option value="schraeg">schräg</option><option value="senkrecht">senkrecht</option></select>
                (gerade Linie) und
                <select id="q2-b"><option value="">---</option><option value="geradlinig">geradlinig</option><option value="krummlinig">krummlinig</option><option value="schraeg">schräg</option><option value="senkrecht">senkrecht</option></select>
                (gebogene Bahn, z.B. kreisförmig).
            </div>
            <div class="feedback-box correct" id="q2-fb-correct">Richtig! Geradlinig und krummlinig. Kreisförmig ist ein Sonderfall von krummlinig.</div>
            <div class="feedback-box incorrect" id="q2-fb-incorrect">Die zwei Bahnformen sind: geradlinig und krummlinig.</div>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════════
             AUFGABE 3: Lückentext - Bewegungsarten (2 BE)
             ═══════════════════════════════════════════════════════════════════════ -->
        <div class="question" id="q3" data-niveau="1" data-points="2">
            <div class="question-header">
                <div class="question-title">Aufgabe 3: Bewegungsarten</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">2 BE</span>
                </div>
            </div>
            <div class="question-text">Ergänze die zwei Bewegungsarten.</div>
            <div class="lueckentext">
                Es gibt zwei Bewegungsarten:
                <select id="q3-a"><option value="">---</option><option value="gleichfoermig">gleichförmig</option><option value="ungleichfoermig">ungleichförmig</option><option value="schnell">schnell</option><option value="langsam">langsam</option></select>
                (Geschwindigkeit bleibt gleich) und
                <select id="q3-b"><option value="">---</option><option value="gleichfoermig">gleichförmig</option><option value="ungleichfoermig">ungleichförmig</option><option value="schnell">schnell</option><option value="langsam">langsam</option></select>
                (Geschwindigkeit ändert sich).
            </div>
            <div class="feedback-box correct" id="q3-fb-correct">Richtig! Gleichförmig und ungleichförmig.</div>
            <div class="feedback-box incorrect" id="q3-fb-incorrect">Die zwei Bewegungsarten sind: gleichförmig und ungleichförmig.</div>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════════
             AUFGABE 4: Zuordnungstabelle NIVEAU 1 (16 BE = 8 Beispiele × 2)
             ═══════════════════════════════════════════════════════════════════════ -->
        <div class="question" id="q4" data-niveau="1" data-points="16">
            <div class="question-header">
                <div class="question-title">Aufgabe 4: Bewegungen zuordnen</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-1">*</span>
                    <span class="question-points">16 BE</span>
                </div>
            </div>
            <div class="question-text">Kreuze für jedes Beispiel die passende Bahnform und Bewegungsart an. <strong>Pro Zeile genau 2 Kreuze!</strong></div>
            <div class="hinweis">Kreisförmige Bewegungen (z.B. Karussell) sind krummlinig!</div>
            <table class="zuordnung-table">
                <thead>
                    <tr>
                        <th style="width:35%;">Beispiel</th>
                        <th>gerad-<br>linig</th>
                        <th>krumm-<br>linig</th>
                        <th>gleich-<br>förmig</th>
                        <th>ungleich-<br>förmig</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-correct="geradlinig,gleichfoermig">
                        <td>a) Fallschirmspringer (konstante Geschwindigkeit)</td>
                        <td><input type="checkbox" name="q4a-bahn" value="geradlinig"></td>
                        <td><input type="checkbox" name="q4a-bahn" value="krummlinig"></td>
                        <td><input type="checkbox" name="q4a-art" value="gleichfoermig"></td>
                        <td><input type="checkbox" name="q4a-art" value="ungleichfoermig"></td>
                    </tr>
                    <tr data-correct="krummlinig,gleichfoermig">
                        <td>b) Ventilator-Blatt (kreisförmig!)</td>
                        <td><input type="checkbox" name="q4b-bahn" value="geradlinig"></td>
                        <td><input type="checkbox" name="q4b-bahn" value="krummlinig"></td>
                        <td><input type="checkbox" name="q4b-art" value="gleichfoermig"></td>
                        <td><input type="checkbox" name="q4b-art" value="ungleichfoermig"></td>
                    </tr>
                    <tr data-correct="geradlinig,ungleichfoermig">
                        <td>c) Auto bremst</td>
                        <td><input type="checkbox" name="q4c-bahn" value="geradlinig"></td>
                        <td><input type="checkbox" name="q4c-bahn" value="krummlinig"></td>
                        <td><input type="checkbox" name="q4c-art" value="gleichfoermig"></td>
                        <td><input type="checkbox" name="q4c-art" value="ungleichfoermig"></td>
                    </tr>
                    <tr data-correct="krummlinig,ungleichfoermig">
                        <td>d) Achterbahn im Looping</td>
                        <td><input type="checkbox" name="q4d-bahn" value="geradlinig"></td>
                        <td><input type="checkbox" name="q4d-bahn" value="krummlinig"></td>
                        <td><input type="checkbox" name="q4d-art" value="gleichfoermig"></td>
                        <td><input type="checkbox" name="q4d-art" value="ungleichfoermig"></td>
                    </tr>
                    <tr data-correct="krummlinig,ungleichfoermig">
                        <td>e) Schnecke beim Kriechen</td>
                        <td><input type="checkbox" name="q4e-bahn" value="geradlinig"></td>
                        <td><input type="checkbox" name="q4e-bahn" value="krummlinig"></td>
                        <td><input type="checkbox" name="q4e-art" value="gleichfoermig"></td>
                        <td><input type="checkbox" name="q4e-art" value="ungleichfoermig"></td>
                    </tr>
                    <tr data-correct="geradlinig,ungleichfoermig">
                        <td>f) Aufziehauto (wird langsamer)</td>
                        <td><input type="checkbox" name="q4f-bahn" value="geradlinig"></td>
                        <td><input type="checkbox" name="q4f-bahn" value="krummlinig"></td>
                        <td><input type="checkbox" name="q4f-art" value="gleichfoermig"></td>
                        <td><input type="checkbox" name="q4f-art" value="ungleichfoermig"></td>
                    </tr>
                    <tr data-correct="krummlinig,gleichfoermig">
                        <td>g) Minutenzeiger einer Uhr (kreisförmig!)</td>
                        <td><input type="checkbox" name="q4g-bahn" value="geradlinig"></td>
                        <td><input type="checkbox" name="q4g-bahn" value="krummlinig"></td>
                        <td><input type="checkbox" name="q4g-art" value="gleichfoermig"></td>
                        <td><input type="checkbox" name="q4g-art" value="ungleichfoermig"></td>
                    </tr>
                    <tr data-correct="geradlinig,ungleichfoermig">
                        <td>h) Stein fällt vom Baum</td>
                        <td><input type="checkbox" name="q4h-bahn" value="geradlinig"></td>
                        <td><input type="checkbox" name="q4h-bahn" value="krummlinig"></td>
                        <td><input type="checkbox" name="q4h-art" value="gleichfoermig"></td>
                        <td><input type="checkbox" name="q4h-art" value="ungleichfoermig"></td>
                    </tr>
                </tbody>
            </table>
            <div class="feedback-box correct" id="q4-fb-correct">Alle richtig zugeordnet!</div>
            <div class="feedback-box incorrect" id="q4-fb-incorrect">Einige Zuordnungen sind nicht korrekt. Denke daran: Kreisförmig = krummlinig!</div>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════════
             AUFGABE 5: Zuordnungstabelle NIVEAU 2 (6 BE = 3 Beispiele × 2)
             ═══════════════════════════════════════════════════════════════════════ -->
        <div class="question" id="q5" data-niveau="2" data-points="6">
            <div class="question-header">
                <div class="question-title">Aufgabe 5: Weitere Bewegungen</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-2">**</span>
                    <span class="question-points">6 BE</span>
                </div>
            </div>
            <div class="question-text">Kreuze für jedes Beispiel die passende Bahnform und Bewegungsart an.</div>
            <table class="zuordnung-table">
                <thead>
                    <tr>
                        <th style="width:35%;">Beispiel</th>
                        <th>gerad-<br>linig</th>
                        <th>krumm-<br>linig</th>
                        <th>gleich-<br>förmig</th>
                        <th>ungleich-<br>förmig</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-correct="krummlinig,gleichfoermig">
                        <td>i) Mond um die Erde (kreisförmig!)</td>
                        <td><input type="checkbox" name="q5i-bahn" value="geradlinig"></td>
                        <td><input type="checkbox" name="q5i-bahn" value="krummlinig"></td>
                        <td><input type="checkbox" name="q5i-art" value="gleichfoermig"></td>
                        <td><input type="checkbox" name="q5i-art" value="ungleichfoermig"></td>
                    </tr>
                    <tr data-correct="krummlinig,ungleichfoermig">
                        <td>j) Bobfahrer in der Kurve</td>
                        <td><input type="checkbox" name="q5j-bahn" value="geradlinig"></td>
                        <td><input type="checkbox" name="q5j-bahn" value="krummlinig"></td>
                        <td><input type="checkbox" name="q5j-art" value="gleichfoermig"></td>
                        <td><input type="checkbox" name="q5j-art" value="ungleichfoermig"></td>
                    </tr>
                    <tr data-correct="geradlinig,ungleichfoermig">
                        <td>k) Skateboard bergab</td>
                        <td><input type="checkbox" name="q5k-bahn" value="geradlinig"></td>
                        <td><input type="checkbox" name="q5k-bahn" value="krummlinig"></td>
                        <td><input type="checkbox" name="q5k-art" value="gleichfoermig"></td>
                        <td><input type="checkbox" name="q5k-art" value="ungleichfoermig"></td>
                    </tr>
                </tbody>
            </table>
            <div class="feedback-box correct" id="q5-fb-correct">Richtig!</div>
            <div class="feedback-box incorrect" id="q5-fb-incorrect">Nicht ganz. Überlege: Ist die Bahn gerade oder gebogen? Ändert sich die Geschwindigkeit?</div>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════════
             AUFGABE 6: Zuordnungstabelle NIVEAU 3 (4 BE = 2 Beispiele × 2)
             ═══════════════════════════════════════════════════════════════════════ -->
        <div class="question" id="q6" data-niveau="3" data-points="4">
            <div class="question-header">
                <div class="question-title">Aufgabe 6: Knifflige Beispiele</div>
                <div class="question-meta">
                    <span class="question-niveau niveau-3">***</span>
                    <span class="question-points">4 BE</span>
                </div>
            </div>
            <div class="question-text">Kreuze für jedes Beispiel die passende Bahnform und Bewegungsart an.</div>
            <table class="zuordnung-table">
                <thead>
                    <tr>
                        <th style="width:35%;">Beispiel</th>
                        <th>gerad-<br>linig</th>
                        <th>krumm-<br>linig</th>
                        <th>gleich-<br>förmig</th>
                        <th>ungleich-<br>förmig</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-correct="krummlinig,ungleichfoermig">
                        <td>l) Schmetterling fliegt</td>
                        <td><input type="checkbox" name="q6l-bahn" value="geradlinig"></td>
                        <td><input type="checkbox" name="q6l-bahn" value="krummlinig"></td>
                        <td><input type="checkbox" name="q6l-art" value="gleichfoermig"></td>
                        <td><input type="checkbox" name="q6l-art" value="ungleichfoermig"></td>
                    </tr>
                    <tr data-correct="krummlinig,ungleichfoermig">
                        <td>m) Pendel einer Standuhr</td>
                        <td><input type="checkbox" name="q6m-bahn" value="geradlinig"></td>
                        <td><input type="checkbox" name="q6m-bahn" value="krummlinig"></td>
                        <td><input type="checkbox" name="q6m-art" value="gleichfoermig"></td>
                        <td><input type="checkbox" name="q6m-art" value="ungleichfoermig"></td>
                    </tr>
                </tbody>
            </table>
            <div class="feedback-box correct" id="q6-fb-correct">Sehr gut! Auch die kniffligen Beispiele erkannt.</div>
            <div class="feedback-box incorrect" id="q6-fb-incorrect">Das Pendel bewegt sich auf einem Kreisbogen (krummlinig) und wird an den Umkehrpunkten langsamer (ungleichförmig).</div>
        </div>

        <!-- Submit Section -->
        <div class="submit-section" id="submitSection">
            <p style="margin-bottom:15px;">Überprüfe deine Antworten, bevor du abgibst.</p>
            <button onclick="submitTest()" id="submitBtn">Test abgeben</button>
        </div>

        <!-- Results Section -->
        <div class="results hidden" id="resultsSection">
            <h2>Ergebnis</h2>
            <div id="studentNameDisplay"></div>
            <div style="margin:10px 0;font-size:0.9em;" id="niveauDisplay"></div>
            <div style="margin-top:20px;">
                <div style="font-size:1.1em; font-weight:600; color:#555; margin-bottom:5px;">Erreichte Punkte:</div>
                <div class="score" id="scoreDisplay">0 / 0</div>
            </div>
            <div class="grade" id="gradeDisplay"></div>
            <table class="grade-table">
                <tr>
                    <th>NP</th><th>14</th><th>13</th><th>12</th><th>11</th><th>10</th><th>9</th><th>8</th><th>7</th><th>6</th><th>5</th><th>4</th><th>3</th><th>2</th><th>1</th>
                </tr>
                <tr>
                    <td>%</td><td>100</td><td>96</td><td>90,7</td><td>86</td><td>80</td><td>73,3</td><td>66,7</td><td>60</td><td>53,3</td><td>46,7</td><td>40</td><td>33,3</td><td>26,7</td><td>20</td>
                </tr>
                <tr id="gradeRow">
                    <td>BE</td><td id="be14">-</td><td id="be13">-</td><td id="be12">-</td><td id="be11">-</td><td id="be10">-</td><td id="be9">-</td><td id="be8">-</td><td id="be7">-</td><td id="be6">-</td><td id="be5">-</td><td id="be4">-</td><td id="be3">-</td><td id="be2">-</td><td id="be1">-</td>
                </tr>
            </table>
            <div style="background: #fff3e0; border: 2px solid #b35c00; padding: 15px; margin: 20px 0; text-align: left;">
                <strong style="color: #b35c00;">Ergebnis sichern:</strong>
                <ol style="margin: 10px 0 0 20px; line-height: 1.8;">
                    <li>Klicke auf <strong>"Drucken / PDF"</strong></li>
                    <li>Wähle <strong>"Als PDF speichern"</strong></li>
                    <li>Lade das PDF in der <strong>Bildungscloud</strong> hoch</li>
                </ol>
            </div>
            <button class="btn-secondary" onclick="window.print()">Drucken / PDF</button>
        </div>
    </div>

    <script>
    var STORAGE_KEY = 'mt-physik-6-01-bewegungsarten-v2';
    var selectedNiveau = 0;
    var testSubmitted = false;

    var niveauPoints = { 1: 25, 2: 31, 3: 35 };

    var answers = {
        'q1-a': 'bewegung',
        'q1-b': 'ort',
        'q1-c': 'bahnform',
        'q1-d': 'bewegungsart',
        'q1-e': 'geschwindigkeit',
        'q2-a': 'geradlinig',
        'q2-b': 'krummlinig',
        'q3-a': 'gleichfoermig',
        'q3-b': 'ungleichfoermig'
    };

    (function() {
        var seatSel = document.getElementById('seatSelect');
        for (var i = 1; i <= 30; i++) {
            var opt = document.createElement('option');
            opt.value = i;
            opt.textContent = 'Platz ' + i;
            seatSel.appendChild(opt);
        }

        var questions = document.querySelectorAll('.question');
        for (var i = 0; i < questions.length; i++) {
            questions[i].style.display = 'none';
        }
        document.getElementById('submitSection').style.display = 'none';

        var allInputs = document.querySelectorAll('input, select');
        for (var i = 0; i < allInputs.length; i++) {
            allInputs[i].addEventListener('change', function() {
                saveAnswers();
                updateProgress();
            });
        }

        restoreAnswers();
    })();

    function confirmSeat() {
        var sel = document.getElementById('seatSelect');
        var val = sel.value;
        if (!val) { alert('Bitte Platznummer wählen!'); return; }
        document.getElementById('seatNumber').value = val;
        document.getElementById('seatRow').style.display = 'none';
        document.getElementById('seatWarning').style.display = 'none';
        document.getElementById('seatConfirmed').textContent = 'Platz ' + val;
        document.getElementById('seatConfirmed').style.display = 'block';
        saveAnswers();
    }

    function confirmNiveau() {
        var sel = document.getElementById('niveauSelect');
        var val = parseInt(sel.value);
        if (!val) { alert('Bitte Niveau wählen!'); return; }
        selectedNiveau = val;
        document.getElementById('niveauRow').style.display = 'none';
        document.getElementById('niveauWarning').style.display = 'none';
        var labels = { 1: '* Basis (25 BE)', 2: '** Standard (31 BE)', 3: '*** Erweitert (35 BE)' };
        document.getElementById('niveauConfirmed').textContent = labels[val];
        document.getElementById('niveauConfirmed').style.display = 'block';
        showQuestionsForNiveau(val);
        saveAnswers();
        updateProgress();
    }

    function showQuestionsForNiveau(niveau) {
        var questions = document.querySelectorAll('.question');
        for (var i = 0; i < questions.length; i++) {
            var qNiveau = parseInt(questions[i].getAttribute('data-niveau'));
            questions[i].style.display = (qNiveau <= niveau) ? 'block' : 'none';
        }
        document.getElementById('submitSection').style.display = 'block';
    }

    function updateProgress() {
        if (selectedNiveau === 0) return;
        var answered = countAnsweredFields();
        var total = countTotalFields();
        var pct = total > 0 ? Math.round((answered / total) * 100) : 0;
        document.getElementById('progressFill').style.width = pct + '%';
        document.getElementById('progressText').textContent = answered + ' / ' + total + ' beantwortet';
    }

    function countTotalFields() {
        var count = 0;
        if (selectedNiveau >= 1) count += 5 + 2 + 2 + 16;
        if (selectedNiveau >= 2) count += 6;
        if (selectedNiveau >= 3) count += 4;
        return count;
    }

    function countAnsweredFields() {
        var count = 0;
        var selects = ['q1-a','q1-b','q1-c','q1-d','q1-e','q2-a','q2-b','q3-a','q3-b'];
        for (var i = 0; i < selects.length; i++) {
            var el = document.getElementById(selects[i]);
            if (el && el.value !== '') count++;
        }
        var tables = selectedNiveau >= 3 ? ['q4','q5','q6'] : (selectedNiveau >= 2 ? ['q4','q5'] : ['q4']);
        for (var t = 0; t < tables.length; t++) {
            var tableEl = document.getElementById(tables[t]);
            if (!tableEl) continue;
            var rows = tableEl.querySelectorAll('tbody tr');
            for (var r = 0; r < rows.length; r++) {
                var checks = rows[r].querySelectorAll('input[type="checkbox"]');
                var bahnChecked = false, artChecked = false;
                for (var c = 0; c < checks.length; c++) {
                    if (checks[c].checked) {
                        if (checks[c].name.indexOf('-bahn') > -1) bahnChecked = true;
                        if (checks[c].name.indexOf('-art') > -1) artChecked = true;
                    }
                }
                if (bahnChecked) count++;
                if (artChecked) count++;
            }
        }
        return count;
    }

    function saveAnswers() {
        var data = {
            seat: document.getElementById('seatNumber').value,
            niveau: selectedNiveau,
            submitted: testSubmitted,
            answers: {}
        };
        var allSelects = document.querySelectorAll('select[id^="q"]');
        for (var i = 0; i < allSelects.length; i++) {
            data.answers[allSelects[i].id] = allSelects[i].value;
        }
        var allChecks = document.querySelectorAll('input[type="checkbox"]');
        for (var i = 0; i < allChecks.length; i++) {
            data.answers[allChecks[i].name + '_' + allChecks[i].value] = allChecks[i].checked;
        }
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function restoreAnswers() {
        var stored = localStorage.getItem(STORAGE_KEY);
        if (!stored) return;
        var data = JSON.parse(stored);
        if (data.seat) {
            document.getElementById('seatNumber').value = data.seat;
            document.getElementById('seatSelect').value = data.seat;
            document.getElementById('seatRow').style.display = 'none';
            document.getElementById('seatWarning').style.display = 'none';
            document.getElementById('seatConfirmed').textContent = 'Platz ' + data.seat;
            document.getElementById('seatConfirmed').style.display = 'block';
        }
        if (data.niveau) {
            selectedNiveau = data.niveau;
            document.getElementById('niveauSelect').value = data.niveau;
            document.getElementById('niveauRow').style.display = 'none';
            document.getElementById('niveauWarning').style.display = 'none';
            var labels = { 1: '* Basis (25 BE)', 2: '** Standard (31 BE)', 3: '*** Erweitert (35 BE)' };
            document.getElementById('niveauConfirmed').textContent = labels[data.niveau];
            document.getElementById('niveauConfirmed').style.display = 'block';
            showQuestionsForNiveau(data.niveau);
        }
        if (data.answers) {
            for (var key in data.answers) {
                if (key.indexOf('_') > -1) {
                    var parts = key.split('_');
                    var name = parts[0];
                    var val = parts[1];
                    var checks = document.querySelectorAll('input[name="' + name + '"][value="' + val + '"]');
                    for (var i = 0; i < checks.length; i++) {
                        checks[i].checked = data.answers[key];
                    }
                } else {
                    var el = document.getElementById(key);
                    if (el) el.value = data.answers[key];
                }
            }
        }
        if (data.submitted) {
            testSubmitted = true;
            submitTest(true);
        }
        updateProgress();
    }

    function submitTest(isRestore) {
        if (!isRestore && !confirm('Test wirklich abgeben? Du kannst danach nichts mehr ändern.')) return;
        testSubmitted = true;
        saveAnswers();

        var totalPoints = 0;
        var earnedPoints = 0;

        // Q1: Lückentext Bewegung (5 BE)
        var q1Fields = ['q1-a','q1-b','q1-c','q1-d','q1-e'];
        var q1Earned = 0;
        for (var i = 0; i < q1Fields.length; i++) {
            var el = document.getElementById(q1Fields[i]);
            if (el.value === answers[q1Fields[i]]) {
                q1Earned++;
                el.classList.add('correct');
            } else {
                el.classList.add('incorrect');
            }
            el.disabled = true;
        }
        totalPoints += 5;
        earnedPoints += q1Earned;
        showQuestionResult('q1', q1Earned, 5);

        // Q2: Lückentext Bahnformen (2 BE)
        var q2Fields = ['q2-a','q2-b'];
        var q2Earned = 0;
        for (var i = 0; i < q2Fields.length; i++) {
            var el = document.getElementById(q2Fields[i]);
            if (el.value === answers[q2Fields[i]]) {
                q2Earned++;
                el.classList.add('correct');
            } else {
                el.classList.add('incorrect');
            }
            el.disabled = true;
        }
        totalPoints += 2;
        earnedPoints += q2Earned;
        showQuestionResult('q2', q2Earned, 2);

        // Q3: Lückentext Bewegungsarten (2 BE)
        var q3Fields = ['q3-a','q3-b'];
        var q3Earned = 0;
        for (var i = 0; i < q3Fields.length; i++) {
            var el = document.getElementById(q3Fields[i]);
            if (el.value === answers[q3Fields[i]]) {
                q3Earned++;
                el.classList.add('correct');
            } else {
                el.classList.add('incorrect');
            }
            el.disabled = true;
        }
        totalPoints += 2;
        earnedPoints += q3Earned;
        showQuestionResult('q3', q3Earned, 2);

        // Q4: Zuordnungstabelle (16 BE)
        var q4Result = evaluateTable('q4');
        totalPoints += 16;
        earnedPoints += q4Result;
        showQuestionResult('q4', q4Result, 16);

        // Q5: Niveau 2 (6 BE)
        if (selectedNiveau >= 2) {
            var q5Result = evaluateTable('q5');
            totalPoints += 6;
            earnedPoints += q5Result;
            showQuestionResult('q5', q5Result, 6);
        }

        // Q6: Niveau 3 (4 BE)
        if (selectedNiveau >= 3) {
            var q6Result = evaluateTable('q6');
            totalPoints += 4;
            earnedPoints += q6Result;
            showQuestionResult('q6', q6Result, 4);
        }

        var allInputs = document.querySelectorAll('input, select');
        for (var i = 0; i < allInputs.length; i++) {
            allInputs[i].disabled = true;
        }

        document.getElementById('submitSection').style.display = 'none';
        document.getElementById('resultsSection').classList.remove('hidden');
        document.getElementById('scoreDisplay').textContent = earnedPoints + ' / ' + totalPoints;
        document.getElementById('studentNameDisplay').textContent = 'Platz: ' + document.getElementById('seatNumber').value;
        var niveauLabels = { 1: '* Basis', 2: '** Standard', 3: '*** Erweitert' };
        document.getElementById('niveauDisplay').textContent = 'Niveau: ' + niveauLabels[selectedNiveau];

        var pct = (earnedPoints / totalPoints) * 100;
        var np = calculateNP(pct);
        document.getElementById('gradeDisplay').textContent = np + ' Notenpunkte';

        var thresholds = [100, 96, 90.67, 86, 80, 73.33, 66.67, 60, 53.33, 46.67, 40, 33.33, 26.67, 20];
        var marked = false;
        for (var i = 14; i >= 1; i--) {
            var beNeeded = Math.ceil(totalPoints * thresholds[14-i] / 100);
            document.getElementById('be' + i).textContent = beNeeded;
            if (!marked && earnedPoints >= beNeeded) {
                document.getElementById('be' + i).classList.add('current');
                marked = true;
            }
        }
    }

    function evaluateTable(qId) {
        var tableEl = document.getElementById(qId);
        var rows = tableEl.querySelectorAll('tbody tr');
        var earned = 0;
        for (var r = 0; r < rows.length; r++) {
            var correctStr = rows[r].getAttribute('data-correct');
            var correctVals = correctStr.split(',');
            var checks = rows[r].querySelectorAll('input[type="checkbox"]');
            for (var c = 0; c < checks.length; c++) {
                var shouldBeChecked = correctVals.indexOf(checks[c].value) > -1;
                if (checks[c].checked && shouldBeChecked) {
                    checks[c].classList.add('correct-check');
                    earned++;
                } else if (checks[c].checked && !shouldBeChecked) {
                    checks[c].classList.add('incorrect-check');
                } else if (!checks[c].checked && shouldBeChecked) {
                    checks[c].classList.add('missed-check');
                }
                checks[c].disabled = true;
            }
        }
        return earned;
    }

    function showQuestionResult(qId, earned, total) {
        var header = document.querySelector('#' + qId + ' .question-header');
        var span = document.createElement('span');
        span.className = 'question-result';
        if (earned === total) {
            span.className += ' full';
            span.textContent = earned + '/' + total + ' BE';
            document.getElementById(qId + '-fb-correct').classList.add('show');
        } else if (earned > 0) {
            span.className += ' partial';
            span.textContent = earned + '/' + total + ' BE';
            document.getElementById(qId + '-fb-incorrect').classList.add('show');
        } else {
            span.className += ' zero';
            span.textContent = '0/' + total + ' BE';
            document.getElementById(qId + '-fb-incorrect').classList.add('show');
        }
        header.appendChild(span);
    }

    function calculateNP(pct) {
        var thresholds = [
            [100, 14], [96, 13], [90.67, 12], [86, 11], [80, 10],
            [73.33, 9], [66.67, 8], [60, 7], [53.33, 6], [46.67, 5],
            [40, 4], [33.33, 3], [26.67, 2], [20, 1]
        ];
        for (var i = 0; i < thresholds.length; i++) {
            if (pct >= thresholds[i][0]) return thresholds[i][1];
        }
        return 0;
    }

    // Auto-Save beim Schließen (vor Abgabe)
    window.addEventListener('beforeunload', function() {
        if (!testSubmitted) saveAnswers();
    });
    </script>
</body>
</html>
